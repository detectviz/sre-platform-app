# Notifications API Paths
paths:
  /settings/notification-channels:
    get:
      tags: [Notifications]
      summary: List notification channels
      description: 取得通知管道列表，支援分頁、排序與關鍵字搜尋。
      operationId: listNotificationChannels
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/PageSizeParam"
        - $ref: "#/components/parameters/SortByParam"
        - $ref: "#/components/parameters/SortOrderParam"
        - name: keyword
          in: query
          description: 依名稱模糊搜尋。
          schema:
            type: string
      responses:
        "200":
          description: 成功取得通知管道列表。
          content:
            application/json:
              schema:
                type: object
                properties:
                  page:
                    type: integer
                  page_size:
                    type: integer
                  total:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/NotificationChannel"
        "401":
          $ref: "#/components/responses/Unauthorized"
    post:
      tags: [Notifications]
      summary: Create notification channel
      description: 建立新的通知管道。
      operationId: createNotificationChannel
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NotificationChannelCreate"
            example:
              name: SRE On-call Email
              type: email
              enabled: true
              config:
                to: sre-oncall@example.com
                cc: sre-manager@example.com
      responses:
        "201":
          description: 通知管道建立成功。
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationChannel"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /settings/notification-channels/batch-actions:
    post:
      tags: [Notifications]
      summary: Batch update notification channels
      description: 批次啟用、停用或刪除通知管道。
      operationId: batchUpdateNotificationChannels
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [action, ids]
              properties:
                action:
                  type: string
                  enum: [enable, disable, delete]
                ids:
                  type: array
                  items:
                    type: string
                  minItems: 1
            example:
              action: enable
              ids: [chan-1, chan-2]
      responses:
        "200":
          description: 批次操作完成。
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BatchResult"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /settings/notification-channels/{id}:
    parameters:
      - $ref: "#/components/parameters/IdParam"
    patch:
      tags: [Notifications]
      summary: Update notification channel
      description: 更新通知管道設定。
      operationId: updateNotificationChannel
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NotificationChannelUpdate"
            example:
              enabled: false
              config:
                to: sre-oncall@example.com
      responses:
        "200":
          description: 通知管道更新成功。
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationChannel"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "401":
          $ref: "#/components/responses/Unauthorized"
    delete:
      tags: [Notifications]
      summary: Soft delete notification channel
      description: 將通知管道標記為刪除。
      operationId: deleteNotificationChannel
      responses:
        "200":
          description: 刪除成功，回傳空物件。
          content:
            application/json:
              schema:
                type: object
              example: {}
        "404":
          $ref: "#/components/responses/NotFound"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /settings/notification-channels/{id}/test:
    parameters:
      - $ref: "#/components/parameters/IdParam"
    post:
      tags: [Notifications]
      summary: Test notification channel
      description: 送出測試通知並更新最新測試結果。
      operationId: testNotificationChannel
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  default: 測試通知
      responses:
        "200":
          description: 測試通知已送出。
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
              example:
                success: true
                message: 測試通知已送出至「SRE On-call Email」。
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /settings/notification-strategies:
    get:
      tags: [Notifications]
      summary: List notification strategies
      description: 取得通知策略列表，支援分頁、排序與關鍵字搜尋。
      operationId: listNotificationStrategies
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/PageSizeParam"
        - $ref: "#/components/parameters/SortByParam"
        - $ref: "#/components/parameters/SortOrderParam"
        - name: keyword
          in: query
          description: 依策略名稱模糊搜尋。
          schema:
            type: string
      responses:
        "200":
          description: 成功取得通知策略列表。
          content:
            application/json:
              schema:
                type: object
                properties:
                  page:
                    type: integer
                  page_size:
                    type: integer
                  total:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/NotificationStrategy"
        "401":
          $ref: "#/components/responses/Unauthorized"
    post:
      tags: [Notifications]
      summary: Create notification strategy
      description: 建立新的通知策略。
      operationId: createNotificationStrategy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NotificationStrategyCreate"
            example:
              name: Critical Database Alerts
              enabled: true
              trigger_condition: severity == 'critical'
              severity_levels: [critical]
              impact_levels: [high]
              channel_ids: [chan-1]
      responses:
        "201":
          description: 通知策略建立成功。
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationStrategy"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /settings/notification-strategies/batch-actions:
    post:
      tags: [Notifications]
      summary: Batch update notification strategies
      description: 批次啟用、停用或刪除通知策略。
      operationId: batchUpdateNotificationStrategies
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [action, ids]
              properties:
                action:
                  type: string
                  enum: [enable, disable, delete]
                ids:
                  type: array
                  items:
                    type: string
                  minItems: 1
            example:
              action: disable
              ids: [strat-001, strat-002]
      responses:
        "200":
          description: 批次操作完成。
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BatchResult"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /settings/notification-strategies/{id}:
    parameters:
      - $ref: "#/components/parameters/IdParam"
    patch:
      tags: [Notifications]
      summary: Update notification strategy
      description: 更新通知策略設定。
      operationId: updateNotificationStrategy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NotificationStrategyUpdate"
            example:
              enabled: false
              channel_ids: [chan-1, chan-2]
      responses:
        "200":
          description: 通知策略更新成功。
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationStrategy"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "401":
          $ref: "#/components/responses/Unauthorized"
    delete:
      tags: [Notifications]
      summary: Soft delete notification strategy
      description: 將通知策略標記為刪除。
      operationId: deleteNotificationStrategy
      responses:
        "200":
          description: 刪除成功，回傳空物件。
          content:
            application/json:
              schema:
                type: object
              example: {}
        "404":
          $ref: "#/components/responses/NotFound"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /settings/notification-history:
    get:
      tags: [Notifications]
      summary: List notification history
      description: 取得通知發送紀錄，支援分頁與排序。
      operationId: listNotificationHistory
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/PageSizeParam"
        - $ref: "#/components/parameters/SortByParam"
        - $ref: "#/components/parameters/SortOrderParam"
      responses:
        "200":
          description: 成功取得通知紀錄。
          content:
            application/json:
              schema:
                type: object
                properties:
                  page:
                    type: integer
                  page_size:
                    type: integer
                  total:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/NotificationHistoryRecord"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /settings/notification-history/{id}/resend:
    parameters:
      - $ref: "#/components/parameters/IdParam"
    post:
      tags: [Notifications]
      summary: Resend notification history record
      description: 重新發送指定的通知紀錄。
      operationId: resendNotificationHistory
      responses:
        "200":
          description: 通知已重新發送。
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
              example:
                success: true
                message: 通知已重新發送。
        "404":
          $ref: "#/components/responses/NotFound"
        "401":
          $ref: "#/components/responses/Unauthorized"
