# Automation Schemas
components:
  schemas:
    # ===================
    # Automation Playbook
    # ===================
    AutomationPlaybook:
      type: object
      required: [id, name, type, content, created_at]
      properties:
        id:
          type: string
          example: script-restart-service
        name:
          type: string
          example: 重啟服務腳本
        type:
          type: string
          enum: [shell, python, ansible, terraform]
          example: shell
        content:
          type: string
          example: |
            #!/bin/bash
            systemctl restart nginx
        description:
          type: string
          example: 自動重啟 Nginx 服務
        parameters:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              type:
                type: string
              required:
                type: boolean
              default:
                type: string
          example:
            - name: service_name
              type: string
              required: true
              default: nginx
        last_run_at:
          type: string
          format: date-time
          example: "2024-01-15T09:30:00Z"
        last_run_status:
          type: string
          enum: [success, failed, pending]
          example: success
        run_count:
          type: integer
          example: 42
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        deleted_at:
          type: string
          format: date-time
          nullable: true

    AutomationPlaybookCreate:
      type: object
      required: [name, type, content]
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 200
        type:
          type: string
          enum: [shell, python, ansible, terraform]
        content:
          type: string
          minLength: 1
        description:
          type: string
        parameters:
          type: array
          items:
            type: object

    AutomationPlaybookUpdate:
      type: object
      properties:
        name:
          type: string
        content:
          type: string
        description:
          type: string
        parameters:
          type: array
          items:
            type: object

    # ===================
    # Automation Execution
    # ===================
    AutomationExecution:
      type: object
      required: [id, script_id, script_name, trigger_source, triggered_by, status, start_time]
      properties:
        id:
          type: string
          example: exec-001
        script_id:
          type: string
          example: script-restart-service
        script_name:
          type: string
          example: 重啟服務腳本
        incident_id:
          type: string
          nullable: true
          example: INC-001
        alert_rule_id:
          type: string
          nullable: true
          example: rule-cpu-high
        target_resource_id:
          type: string
          nullable: true
          example: res-web-001
        trigger_source:
          type: string
          enum: [manual, event, schedule, webhook]
          example: event
        triggered_by:
          type: string
          example: usr-001
        status:
          type: string
          enum: [pending, running, success, failed]
          example: success
        start_time:
          type: string
          format: date-time
          example: "2024-01-15T10:00:00Z"
        end_time:
          type: string
          format: date-time
          nullable: true
          example: "2024-01-15T10:02:30Z"
        duration_ms:
          type: integer
          example: 150000
        output:
          type: string
          example: |
            Service nginx restarted successfully
            Active: active (running) since Mon 2024-01-15 10:02:15
        error:
          type: string
          nullable: true
          example: null
        resolved_incident:
          type: boolean
          example: true

    # ===================
    # Automation Trigger
    # ===================
    AutomationTrigger:
      type: object
      required: [id, name, type, enabled, target_playbook_id, created_at]
      properties:
        id:
          type: string
          example: trigger-daily-backup
        name:
          type: string
          example: 每日備份觸發器
        type:
          type: string
          enum: [Schedule, Webhook, Event]
          example: Schedule
        enabled:
          type: boolean
          example: true
        target_playbook_id:
          type: string
          example: script-backup
        cron:
          type: string
          example: "0 2 * * *"
          description: Cron expression for schedule triggers
        cron_description:
          type: string
          example: "每天凌晨 2 點執行"
        webhook_url:
          type: string
          format: uri
          example: "https://api.example.com/webhook/trigger/backup"
        event_conditions:
          type: object
          example:
            event_type: incident.critical
            severity: critical
        last_triggered_at:
          type: string
          format: date-time
          example: "2024-01-15T02:00:00Z"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        deleted_at:
          type: string
          format: date-time
          nullable: true

    AutomationTriggerCreate:
      type: object
      required: [name, type, enabled, target_playbook_id]
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 200
        type:
          type: string
          enum: [Schedule, Webhook, Event]
        enabled:
          type: boolean
        target_playbook_id:
          type: string
        cron:
          type: string
          description: Required for Schedule type
        event_conditions:
          type: object
          description: Required for Event type

    AutomationTriggerUpdate:
      type: object
      properties:
        name:
          type: string
        enabled:
          type: boolean
        cron:
          type: string
        event_conditions:
          type: object
