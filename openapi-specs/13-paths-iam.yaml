# IAM API Paths
paths:
  /iam/users:
    get:
      tags: [IAM]
      summary: List users
      description: 取得使用者列表，支援分頁、排序與關鍵字搜尋。
      operationId: listIamUsers
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PageSizeParam'
        - $ref: '#/components/parameters/SortByParam'
        - $ref: '#/components/parameters/SortOrderParam'
        - name: keyword
          in: query
          description: 依名稱或 Email 模糊搜尋。
          schema:
            type: string
      responses:
        '200':
          description: 成功取得使用者列表。
          content:
            application/json:
              schema:
                type: object
                properties:
                  page:
                    type: integer
                  page_size:
                    type: integer
                  total:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
    post:
      tags: [IAM]
      summary: Create user
      description: 建立新使用者。
      operationId: createIamUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
            example:
              name: 張三
              email: zhang.san@example.com
              role: SRE
              team: SRE 平台團隊
      responses:
        '201':
          description: 使用者建立成功。
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /iam/users/batch-actions:
    post:
      tags: [IAM]
      summary: Batch update users
      description: 批次刪除或停用使用者。
      operationId: batchUpdateIamUsers
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [action, ids]
              properties:
                action:
                  type: string
                  enum: [delete, disable]
                ids:
                  type: array
                  items:
                    type: string
                  minItems: 1
            examples:
              deleteUsers:
                value:
                  action: delete
                  ids: [usr-001, usr-002]
              disableUsers:
                value:
                  action: disable
                  ids: [usr-003]
      responses:
        '200':
          description: 批次操作完成。
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
              example:
                success: true
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /iam/users/import:
    post:
      tags: [IAM]
      summary: Import users
      description: 從外部來源批次匯入使用者。
      operationId: importIamUsers
      responses:
        '200':
          description: 匯入已執行。
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              example:
                message: 成功匯入 25 位人員。
        '401':
          $ref: '#/components/responses/Unauthorized'

  /iam/users/{id}:
    parameters:
      - $ref: '#/components/parameters/IdParam'
    patch:
      tags: [IAM]
      summary: Update user
      description: 更新使用者資訊。
      operationId: updateIamUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdate'
            example:
              role: Developer
              status: inactive
      responses:
        '200':
          description: 使用者更新成功。
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
    delete:
      tags: [IAM]
      summary: Soft delete user
      description: 將使用者標記為刪除。
      operationId: deleteIamUser
      responses:
        '200':
          description: 刪除成功，回傳空物件。
          content:
            application/json:
              schema:
                type: object
              example: {}
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /iam/teams:
    get:
      tags: [IAM]
      summary: List teams
      description: 取得團隊列表，支援分頁與關鍵字搜尋。
      operationId: listIamTeams
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PageSizeParam'
        - $ref: '#/components/parameters/SortByParam'
        - $ref: '#/components/parameters/SortOrderParam'
        - name: keyword
          in: query
          description: 依團隊名稱模糊搜尋。
          schema:
            type: string
      responses:
        '200':
          description: 成功取得團隊列表。
          content:
            application/json:
              schema:
                type: object
                properties:
                  page:
                    type: integer
                  page_size:
                    type: integer
                  total:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Team'
        '401':
          $ref: '#/components/responses/Unauthorized'
    post:
      tags: [IAM]
      summary: Create team
      description: 建立新團隊並指派擁有者。
      operationId: createIamTeam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TeamCreate'
            example:
              name: SRE 平台團隊
              description: 管理平台可靠性
              owner_id: usr-001
      responses:
        '201':
          description: 團隊建立成功。
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Team'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /iam/teams/batch-actions:
    post:
      tags: [IAM]
      summary: Batch update teams
      description: 批次刪除多個團隊。
      operationId: batchUpdateIamTeams
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [action, ids]
              properties:
                action:
                  type: string
                  enum: [delete]
                ids:
                  type: array
                  items:
                    type: string
                  minItems: 1
            example:
              action: delete
              ids: [team-001, team-002]
      responses:
        '200':
          description: 批次操作完成。
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
              example:
                success: true
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /iam/teams/{id}:
    parameters:
      - $ref: '#/components/parameters/IdParam'
    patch:
      tags: [IAM]
      summary: Update team
      description: 更新團隊資訊或成員。
      operationId: updateIamTeam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TeamUpdate'
            example:
              member_ids: [usr-001, usr-002]
      responses:
        '200':
          description: 團隊更新成功。
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Team'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
    delete:
      tags: [IAM]
      summary: Soft delete team
      description: 將團隊標記為刪除。
      operationId: deleteIamTeam
      responses:
        '200':
          description: 刪除成功，回傳空物件。
          content:
            application/json:
              schema:
                type: object
              example: {}
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /iam/roles:
    get:
      tags: [IAM]
      summary: List roles
      description: 取得角色列表，支援分頁與關鍵字搜尋。
      operationId: listIamRoles
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PageSizeParam'
        - $ref: '#/components/parameters/SortByParam'
        - $ref: '#/components/parameters/SortOrderParam'
        - name: keyword
          in: query
          description: 依角色名稱模糊搜尋。
          schema:
            type: string
      responses:
        '200':
          description: 成功取得角色列表。
          content:
            application/json:
              schema:
                type: object
                properties:
                  page:
                    type: integer
                  page_size:
                    type: integer
                  total:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Role'
        '401':
          $ref: '#/components/responses/Unauthorized'
    post:
      tags: [IAM]
      summary: Create role
      description: 建立新角色並設定權限。
      operationId: createIamRole
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleCreate'
            example:
              name: Automation Operator
              description: 負責執行與管理自動化腳本
              permissions:
                - automation.read
                - automation.execute
      responses:
        '201':
          description: 角色建立成功。
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /iam/roles/batch-actions:
    post:
      tags: [IAM]
      summary: Batch update roles
      description: 批次刪除多個角色。
      operationId: batchUpdateIamRoles
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [action, ids]
              properties:
                action:
                  type: string
                  enum: [delete]
                ids:
                  type: array
                  items:
                    type: string
                  minItems: 1
            example:
              action: delete
              ids: [role-001, role-002]
      responses:
        '200':
          description: 批次操作完成。
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
              example:
                success: true
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /iam/roles/{id}:
    parameters:
      - $ref: '#/components/parameters/IdParam'
    patch:
      tags: [IAM]
      summary: Update role
      description: 更新角色資訊或權限。
      operationId: updateIamRole
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleUpdate'
            example:
              permissions:
                - incidents.read
                - resources.read
      responses:
        '200':
          description: 角色更新成功。
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
    delete:
      tags: [IAM]
      summary: Soft delete role
      description: 將角色標記為刪除。
      operationId: deleteIamRole
      responses:
        '200':
          description: 刪除成功，回傳空物件。
          content:
            application/json:
              schema:
                type: object
              example: {}
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /iam/permissions:
    get:
      tags: [IAM]
      summary: List available permissions
      description: 取得系統可用權限清單，用於角色設定。
      operationId: listIamPermissions
      responses:
        '200':
          description: 成功取得權限列表。
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    module:
                      type: string
                    description:
                      type: string
                    actions:
                      type: array
                      items:
                        type: object
                        properties:
                          key:
                            type: string
                          label:
                            type: string
        '401':
          $ref: '#/components/responses/Unauthorized'

  /iam/audit-logs:
    get:
      tags: [IAM]
      summary: List IAM audit logs
      description: 取得 IAM 相關的稽核紀錄。
      operationId: listIamAuditLogs
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PageSizeParam'
        - $ref: '#/components/parameters/SortByParam'
        - $ref: '#/components/parameters/SortOrderParam'
      responses:
        '200':
          description: 成功取得稽核紀錄。
          content:
            application/json:
              schema:
                type: object
                properties:
                  page:
                    type: integer
                  page_size:
                    type: integer
                  total:
                    type: integer
                  items:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        timestamp:
                          type: string
                          format: date-time
                        user:
                          type: object
                          properties:
                            id:
                              type: string
                            name:
                              type: string
                        action:
                          type: string
                        target:
                          type: object
                          properties:
                            type:
                              type: string
                            name:
                              type: string
                        result:
                          type: string
                        ip:
                          type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
