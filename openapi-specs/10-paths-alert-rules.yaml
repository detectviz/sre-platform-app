# Alert Rules API Paths
paths:
  /alert-rules:
    get:
      tags: [Alert Rules]
      summary: List alert rules
      description: Retrieve a paginated list of alert rules with optional filtering.
      operationId: listAlertRules
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PageSizeParam'
        - $ref: '#/components/parameters/SortByParam'
        - $ref: '#/components/parameters/SortOrderParam'
        - name: enabled
          in: query
          schema:
            type: boolean
        - name: severity
          in: query
          schema:
            type: string
            enum: [critical, warning, info]
        - name: keyword
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Successful response with paginated alert rules.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedAlertRules'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags: [Alert Rules]
      summary: Create alert rule
      description: Create a new alert rule.
      operationId: createAlertRule
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlertRuleCreate'
      responses:
        '201':
          description: Alert rule created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlertRule'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /alert-rules/import:
    post:
      tags: [Alert Rules]
      summary: Import alert rules
      description: Import alert rules from an uploaded definition file.
      operationId: importAlertRules
      requestBody:
        description: Optional metadata describing the import source.
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                source:
                  type: string
                  description: Identifier of the import source.
      responses:
        '200':
          description: Import completed summary.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleMessageResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /alert-rules/{id}:
    parameters:
      - $ref: '#/components/parameters/IdParam'
    get:
      tags: [Alert Rules]
      summary: Get alert rule by ID
      description: Retrieve a specific alert rule by its ID.
      operationId: getAlertRuleById
      responses:
        '200':
          description: Successful response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlertRule'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    patch:
      tags: [Alert Rules]
      summary: Update alert rule
      description: Update an existing alert rule.
      operationId: updateAlertRule
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlertRuleUpdate'
      responses:
        '200':
          description: Alert rule updated successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlertRule'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags: [Alert Rules]
      summary: Delete alert rule
      description: Soft delete an alert rule.
      operationId: deleteAlertRule
      responses:
        '204':
          description: Alert rule deleted successfully.
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /alert-rules/{id}/test:
    parameters:
      - $ref: '#/components/parameters/IdParam'
    post:
      tags: [Alert Rules]
      summary: Test alert rule payload
      description: Evaluate sample payload data against an alert rule's conditions.
      operationId: testAlertRule
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlertRuleTestRequest'
      responses:
        '200':
          description: Test evaluation result.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlertRuleTestResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /alert-rules/templates:
    get:
      tags: [Alert Rules]
      summary: List alert rule templates
      operationId: listAlertRuleTemplates
      responses:
        '200':
          description: A list of alert rule templates.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AlertRuleTemplate'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /alert-rules/templates/default:
    get:
      tags: [Alert Rules]
      summary: Get default alert rule template
      description: Retrieve the platform default alert rule template configuration.
      operationId: getDefaultAlertRuleTemplate
      responses:
        '200':
          description: Default alert rule template.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlertRule'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /alert-rules/resource-types:
    get:
      tags: [Alert Rules]
      summary: List alert rule resource types
      description: Retrieve supported resource types for alert rule targeting.
      operationId: listAlertRuleResourceTypes
      responses:
        '200':
          description: Supported resource types.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ResourceType'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /alert-rules/exporter-types:
    get:
      tags: [Alert Rules]
      summary: List exporter types
      description: Retrieve supported exporter/agent integrations for alert rules.
      operationId: listAlertRuleExporterTypes
      responses:
        '200':
          description: Supported exporter types.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ExporterType'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /alert-rules/count:
    get:
      tags: [Alert Rules]
      summary: Get alert rule count
      operationId: getAlertRuleCount
      parameters:
        - name: matchers
          in: query
          schema:
            type: string
      responses:
        '200':
          description: The total count of alert rules.
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /alert-rules/metrics:
    get:
      tags: [Alert Rules]
      summary: List available metrics
      operationId: listAvailableMetricsForRule
      responses:
        '200':
          description: A list of available metrics for rules.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MetricMetadata'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /alert-rules/{id}/incidents:
    parameters:
      - $ref: '#/components/parameters/IdParam'
    get:
      tags: [Alert Rules]
      summary: List incidents for a rule
      description: Retrieve a list of incidents that were triggered by a specific alert rule.
      operationId: listIncidentsForRule
      responses:
        '200':
          description: A list of incidents.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Incident'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /alert-rules/{id}/trigger:
    parameters:
      - $ref: '#/components/parameters/IdParam'
    post:
      tags: [Alert Rules]
      summary: Manually trigger alert rule
      description: Simulate an alert event and produce an incident for the specified rule.
      operationId: triggerAlertRule
      responses:
        '200':
          description: Alert rule triggered successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  incident_id:
                    type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /alert-rules/batch-actions:
    post:
      tags: [Alert Rules]
      summary: Batch operations for alert rules
      description: Perform enable, disable, or delete actions on multiple alert rules.
      operationId: batchAlertRuleActions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [action, ids]
              properties:
                action:
                  type: string
                  enum: [enable, disable, delete]
                ids:
                  type: array
                  items:
                    type: string
                  minItems: 1
      responses:
        '200':
          description: Batch action completed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  schemas:
    PaginatedAlertRules:
      type: object
      required: [items, total]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/AlertRule'
        total:
          type: integer
        page:
          type: integer
        page_size:
          type: integer

    AlertRuleTestRequest:
      type: object
      required: [payload]
      properties:
        payload:
          $ref: '#/components/schemas/AlertRuleTestPayload'

    AlertRuleTestPayload:
      type: object
      required: [metric, value, resource]
      properties:
        metric:
          type: string
        value:
          type: number
        resource:
          type: string

    AlertRuleTestResult:
      type: object
      required: [matches, preview]
      properties:
        matches:
          type: boolean
        preview:
          type: string

    ResourceType:
      type: object
      required: [id, name, icon]
      properties:
        id:
          type: string
        name:
          type: string
        icon:
          type: string

    ExporterType:
      type: object
      required: [id, name, description]
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
