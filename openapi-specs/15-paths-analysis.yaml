# Analysis & AI API Paths
paths:
  /analysis/overview:
    get:
      tags: [Analysis]
      summary: Get analysis overview
      description: Retrieve an overview of system health, anomalies, and suggestions.
      operationId: getAnalysisOverview
      parameters:
        - name: time_range
          in: query
          schema:
            type: string
            example: "24h"
      responses:
        "200":
          description: Analysis overview data.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisOverviewData"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/AIServiceUnavailable"

  /analysis/capacity-planning:
    get:
      tags: [Analysis]
      summary: Get capacity planning insights
      description: Retrieve capacity planning trends, forecasts, and suggestions.
      operationId: getCapacityPlanningAnalysis
      responses:
        "200":
          description: Capacity planning data.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CapacityPlanningData"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /analysis/incidents/{id}:
    parameters:
      - $ref: "#/components/parameters/IdParam"
    post:
      tags: [Analysis]
      summary: Analyze incident
      description: Generate an in-depth analysis for a single incident.
      operationId: analyzeIncident
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                include_related:
                  type: boolean
                  default: false
      responses:
        "200":
          description: Incident analysis report.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IncidentAnalysis"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/AIServiceUnavailable"

  /analysis/incidents/multi:
    post:
      tags: [Analysis]
      summary: Analyze multiple incidents
      description: Analyze correlations and common root causes across multiple incidents.
      operationId: analyzeMultipleIncidents
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [incident_ids]
              properties:
                incident_ids:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: Multi-incident analysis report.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MultiIncidentAnalysis"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/AIServiceUnavailable"

  /analysis/resources/{id}:
    parameters:
      - $ref: "#/components/parameters/IdParam"
    post:
      tags: [Analysis]
      summary: Analyze resource
      description: Perform a risk and optimization analysis for a specific resource.
      operationId: analyzeResource
      responses:
        "200":
          description: Resource analysis report.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResourceAnalysisReport"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/AIServiceUnavailable"

  /backtesting/run:
    post:
      tags: [Analysis]
      summary: Run alert rule backtesting
      description: Trigger a historical data replay for one or multiple alert rules within a specific time range.
      operationId: runBacktesting
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BacktestingRunRequest"
      responses:
        "202":
          description: Backtesting task accepted.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BacktestingRunResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /backtesting/results/{task_id}:
    parameters:
      - name: task_id
        in: path
        required: true
        schema:
          type: string
    get:
      tags: [Analysis]
      summary: Get backtesting results
      description: Retrieve the aggregated results, trigger timeline, and tuning recommendations for a completed backtesting task.
      operationId: getBacktestingResults
      responses:
        "200":
          description: Backtesting execution summary and detailed metrics.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BacktestingResultsResponse"
        "202":
          description: Backtesting task is still running.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BacktestingResultsResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /analysis/resources/batch:
    post:
      tags: [Analysis]
      summary: Batch analyze resources
      description: Perform analysis on multiple resources and get a summary report.
      operationId: batchAnalyzeResources
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [resource_ids]
              properties:
                resource_ids:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: Batch resource analysis report.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BatchResourceAnalysisReport"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/AIServiceUnavailable"

  /analysis/logs:
    post:
      tags: [Analysis]
      summary: Analyze logs
      description: Analyze logs for a given query and time range to detect patterns and anomalies.
      operationId: analyzeLogs
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [query, time_range]
              properties:
                query:
                  type: string
                time_range:
                  type: object
                  required: [start, end]
                  properties:
                    start:
                      type: string
                      format: date-time
                    end:
                      type: string
                      format: date-time
      responses:
        "200":
          description: Log analysis report.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LogAnalysis"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/AIServiceUnavailable"

  /analysis/predict/capacity:
    post:
      tags: [Analysis]
      summary: Predict capacity needs
      description: Forecast capacity requirements for a specific resource.
      operationId: predictCapacity
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [resource_id]
              properties:
                resource_id:
                  type: string
                metrics:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: Capacity prediction report.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CapacityPrediction"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/AIServiceUnavailable"

  /analysis/predict/incidents:
    post:
      tags: [Analysis]
      summary: Predict potential incidents
      description: Forecast potential incidents based on historical trends.
      operationId: predictIncidents
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                resource_ids:
                  type: array
                  items:
                    type: string
                min_probability:
                  type: number
                  format: float
      responses:
        "200":
          description: Incident prediction report.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IncidentPrediction"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/AIServiceUnavailable"

  /analysis/anomalies:
    post:
      tags: [Analysis]
      summary: Detect anomalies
      description: Detect anomalies for a given set of resources and time range.
      operationId: detectAnomalies
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [resource_ids, time_range]
              properties:
                resource_ids:
                  type: array
                  items:
                    type: string
                time_range:
                  type: object
                  required: [start, end]
                  properties:
                    start:
                      type: string
                      format: date-time
                    end:
                      type: string
                      format: date-time
      responses:
        "200":
          description: Anomaly detection report.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnomalyDetection"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/AIServiceUnavailable"

  /ai/alert-rules/analyze:
    post:
      tags: [AI]
      summary: Analyze alert rules
      description: Generate an AI-driven analysis summary for the selected alert rules.
      operationId: analyzeAlertRules
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [rule_ids]
              properties:
                rule_ids:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: Alert rule analysis report.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RuleAnalysisReport'
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/AIServiceUnavailable"

  /ai/silence-rules/analyze:
    post:
      tags: [AI]
      summary: Analyze silence rules
      description: Generate an AI-driven review of the selected silence rules.
      operationId: analyzeSilenceRules
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [rule_ids]
              properties:
                rule_ids:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: Silence rule analysis report.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RuleAnalysisReport'
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/AIServiceUnavailable"
