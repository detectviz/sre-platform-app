# Dashboard API Paths
paths:
  /dashboards:
    get:
      tags: [Dashboards]
      summary: List dashboards
      description: Retrieve a paginated list of dashboards with optional filtering and sorting.
      operationId: listDashboards
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PageSizeParam'
        - $ref: '#/components/parameters/SortByParam'
        - $ref: '#/components/parameters/SortOrderParam'
        - name: category
          in: query
          description: Filter by category.
          schema:
            type: string
          example: 基礎設施
        - name: keyword
          in: query
          description: Case-insensitive keyword for fuzzy name matching.
          schema:
            type: string
      responses:
        '200':
          description: Successful response with paginated dashboards.
          content:
            application/json:
              schema:
                type: object
                properties:
                  page:
                    type: integer
                    example: 1
                  page_size:
                    type: integer
                    example: 20
                  total:
                    type: integer
                    example: 45
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Dashboard'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags: [Dashboards]
      summary: Create dashboard
      description: Create a new dashboard.
      operationId: createDashboard
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DashboardCreate'
            examples:
              grafanaDashboard:
                summary: Grafana Dashboard
                value:
                  name: "Production Metrics"
                  type: "grafana"
                  category: "基礎設施"
                  description: "生產環境關鍵指標監控"
                  team_id: "team-sre"
                  owner_id: "usr-001"
                  grafana_dashboard_uid: "prod-metrics-uid"
              customDashboard:
                summary: Custom Dashboard
                value:
                  name: "Custom Overview"
                  type: "custom"
                  category: "業務監控"
                  resource_ids: ["res-001", "res-002"]
      responses:
        '201':
          description: Dashboard created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dashboard'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /dashboards/{id}:
    parameters:
      - $ref: '#/components/parameters/IdParam'
    get:
      tags: [Dashboards]
      summary: Get dashboard by ID
      description: Retrieve a specific dashboard by its ID.
      operationId: getDashboardById
      responses:
        '200':
          description: Successful response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dashboard'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    patch:
      tags: [Dashboards]
      summary: Update dashboard
      description: Update an existing dashboard.
      operationId: updateDashboard
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DashboardUpdate'
            example:
              name: "Updated Dashboard Name"
              description: "Updated description"
      responses:
        '200':
          description: Dashboard updated successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dashboard'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags: [Dashboards]
      summary: Delete dashboard
      description: Soft delete a dashboard (sets deleted_at timestamp).
      operationId: deleteDashboard
      responses:
        '204':
          description: Dashboard deleted successfully.
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /dashboards/available-grafana:
    get:
      tags: [Dashboards]
      summary: List available Grafana dashboards
      description: Retrieve Grafana dashboards that are not yet linked to the platform.
      operationId: listAvailableGrafanaDashboards
      responses:
        '200':
          description: List of available Grafana dashboards.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  required: [uid, title, url]
                  properties:
                    uid:
                      type: string
                      example: grafana-uid-1
                    title:
                      type: string
                      example: Service Health
                    url:
                      type: string
                      format: uri
                      example: https://grafana.example.com/d/grafana-uid-1
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /dashboards/templates:
    get:
      tags: [Dashboards]
      summary: List dashboard templates
      description: Retrieve reusable templates that can be applied when creating dashboards.
      operationId: listDashboardTemplates
      responses:
        '200':
          description: Template catalog.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DashboardTemplate'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /dashboards/sre-war-room/service-health:
    get:
      tags: [Dashboards]
      summary: Get SRE War Room service health
      description: Retrieve the service health visualization data for the SRE War Room dashboard.
      operationId: getDashboardServiceHealth
      responses:
        '200':
          description: Heatmap data used to render the service health panel.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceHealthData'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /dashboards/sre-war-room/resource-group-status:
    get:
      tags: [Dashboards]
      summary: Get SRE War Room resource group status
      description: Retrieve stacked bar data that summarises resource health per group for the SRE War Room.
      operationId: getDashboardResourceGroupStatus
      responses:
        '200':
          description: Resource group status series data.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResourceGroupStatusData'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /dashboards/infrastructure-insights/options:
    get:
      tags: [Dashboards]
      summary: Get Infrastructure Insights options
      description: Retrieve option metadata for the Infrastructure Insights dashboard page.
      operationId: getInfraInsightsOptions
      responses:
        '200':
          description: Dashboard option metadata.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InfraInsightsOptions'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /dashboards/batch-actions:
    post:
      tags: [Dashboards]
      summary: Batch dashboard operations
      description: Perform batch operations on multiple dashboards.
      operationId: batchDashboardActions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [action, ids]
              properties:
                action:
                  type: string
                  enum: [delete]
                  description: Action to perform.
                ids:
                  type: array
                  items:
                    type: string
                  minItems: 1
                  description: List of dashboard IDs.
            example:
              action: delete
              ids: ["dash-001", "dash-002", "dash-003"]
      responses:
        '200':
          description: Batch operation completed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchResult'
              example:
                success: true
                updated: 3
                skipped_ids: []
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'