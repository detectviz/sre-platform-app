# 元件規格書 (Component Specification)

**元件名稱 (Component)**: 工具列
**類型 (Type)**: Component
**來源路徑 (Source Path)**: components/Toolbar.tsx
**建立日期 (Created)**: 2025-10-06
**狀態 (Status)**: Draft
**依據憲法條款 (Based on)**: `.specify/memory/constitution.md`
**使用次數**: 13 次
**使用模組**: incidents-list, alert-rules, resources-list, dashboards-list

---

## 一、功能概述 (Functional Overview)

統一的工具列元件,支援左右動作按鈕與批次操作

---

## 二、操作邏輯 (User Flow)

### 主要使用流程
1. 父元件傳入左側動作、右側動作、批次動作
2. Toolbar 渲染按鈕列
3. 當無選取項目時,顯示左右動作
4. 當有選取項目時,顯示批次動作列與選取數量
5. 使用者點擊按鈕觸發對應事件

### 互動事件
- 左側動作按鈕的 onClick 事件
- 右側動作按鈕的 onClick 事件
- 批次動作按鈕的 onClick 事件
- `onClearSelection`: 清除選取

---

## 三、狀態管理 (State Management)

### 內部狀態
- 無特殊狀態

### 外部控制
- `selectedCount`: 選取項目數量
- `leftActions`: 左側動作按鈕陣列
- `rightActions`: 右側動作按鈕陣列
- `batchActions`: 批次動作按鈕陣列

---

## 四、可配置屬性 (Props)

| 屬性名稱 | 類型 | 必填 | 預設值 | 說明 |
|----------|------|------|--------|------|
| leftActions | ReactNode | ❌ | null | 左側動作按鈕 |
| rightActions | ReactNode | ❌ | null | 右側動作按鈕 |
| selectedCount | number | ❌ | 0 | 選取項目數量 |
| onClearSelection | () => void | ❌ | - | 清除選取事件 |
| batchActions | ReactNode | ❌ | null | 批次動作按鈕 |

---

## 五、錯誤與例外處理 (Error Handling)

- 當按鈕點擊事件處理失敗時,由父元件處理錯誤
- 無內部錯誤處理邏輯

---

## 六、關聯模組 (Related Modules)

以下模組使用此元件:
- **incidents-list**
- **alert-rules**
- **resources-list**
- **dashboards-list**

---

## 七、設計原則遵循 (Design Principles)

| 項目 | 狀態 | 說明 |
|------|------|------|
| 可重用性 (Reusability) | ✅ | 元件設計為通用,可跨多個模組使用 |
| 一致性 (Consistency) | ✅ | 遵循統一的 UI 設計系統與互動模式 |
| 可存取性 (Accessibility) | ✅ | 支援鍵盤導航與 ARIA 屬性 |
| 主題支援 (Theme Support) | ✅ | 使用 Theme Token,支援深淺色主題 |
| i18n 支援 (i18n) | ✅ | 所有文案透過 useContent 存取 |

---

## 四、權限控制機制 (Permission Control)

### 4.1 批次操作的權限控制策略

權限控制採用**隱藏/禁用混合策略**,根據權限類型決定 UI 顯示方式:

#### 權限控制策略矩陣

| 權限類型 | UI 顯示方式 | 互動狀態 | 理由 |
|---------|------------|---------|------|
| 完全無權限 | 隱藏按鈕 | - | 避免使用者困惑 |
| 部分權限 | 顯示 + 禁用 + Tooltip | 禁用,顯示原因 | 告知權限不足原因 |
| 有權限但不可用 | 顯示 + 禁用 + Tooltip | 禁用,顯示前置條件 | 告知前置條件 (如未選取資料) |
| 有權限且可用 | 顯示 + 啟用 | 可點擊 | 正常操作 |

#### UI 設計範例

```
[完全無權限] → 按鈕不顯示

[部分權限]
┌─────────────────────────┐
│ [🗑 刪除] (禁用)         │  ← Hover 顯示 Tooltip
│ "您沒有權限刪除此項目"    │
└─────────────────────────┘

[有權限但不可用]
┌─────────────────────────┐
│ [🗑 刪除] (禁用)         │  ← Hover 顯示 Tooltip
│ "請先選擇要刪除的項目"    │
└─────────────────────────┘

[有權限且可用]
┌─────────────────────────┐
│ [🗑 刪除] (啟用)         │  ← 可點擊
└─────────────────────────┘
```

#### 批次操作特殊處理

當部分項目有權限、部分無權限時:

1. **權限檢查**: 篩選出有權限的項目
2. **數量確認**: 顯示可操作數量與無權限數量
3. **使用者確認**: 顯示確認對話框,說明影響範圍
4. **執行操作**: 僅對有權限的項目執行操作

#### 確認對話框範例

```
┌──────────────────────────────────────┐
│ 確認批次刪除                    [✕] │
├──────────────────────────────────────┤
│ 您選擇了 10 筆項目:                  │
│ • 可刪除: 7 筆                       │
│ • 無權限: 3 筆                       │
│                                      │
│ 是否繼續刪除 7 筆項目?               │
├──────────────────────────────────────┤
│           [取消]  [確認刪除]         │
└──────────────────────────────────────┘
```

#### 前後端分工

| 項目 | 前端 | 後端 |
|------|------|------|
| 權限檢查 (UI 層級) | ✅ | - |
| 按鈕顯示/隱藏邏輯 | ✅ | - |
| Tooltip 提示 | ✅ | - |
| 批次操作篩選 | ✅ | - |
| 確認對話框 | ✅ | - |
| 權限驗證 (API 層級) | - | ✅ |
| 批次操作執行 | - | ✅ |

---

## 五、響應式佈局 (Responsive Layout)

### 5.1 工具列在不同螢幕尺寸的響應式策略

採用**按鈕收合至「更多」下拉選單**策略:

#### 響應式斷點定義

| 螢幕尺寸 | 斷點 | 顯示策略 | 可見按鈕數 |
|----------|------|---------|-----------|
| 大螢幕 | ≥ 1024px | 顯示所有按鈕 | 全部 (5-7 個) |
| 中螢幕 | 768px - 1023px | 顯示主要按鈕 + 更多選單 | 3-4 個 |
| 小螢幕 | < 768px | 顯示主要按鈕 + 更多選單 | 1-2 個 |

#### UI 設計範例

```
[大螢幕 ≥ 1024px]
┌──────────────────────────────────────────┐
│ [新增] [匯入] [匯出] [刪除] [欄位設定]    │
└──────────────────────────────────────────┘

[中螢幕 768-1023px]
┌──────────────────────────────────────────┐
│ [新增] [匯入] [匯出] [更多 ▼]             │
│                       └─ 刪除            │
│                       └─ 欄位設定        │
└──────────────────────────────────────────┘

[小螢幕 < 768px]
┌──────────────────────────────────────────┐
│ [新增] [更多 ▼]                           │
│         └─ 匯入                          │
│         └─ 匯出                          │
│         └─ 刪除                          │
│         └─ 欄位設定                      │
└──────────────────────────────────────────┘
```

#### 按鈕優先級定義

| 按鈕 | 優先級 | 說明 |
|------|-------|------|
| 新增 | P0 | 最高優先級,永遠可見 |
| 匯入 | P1 | 高優先級 |
| 匯出 | P1 | 高優先級 |
| 刪除 | P2 | 中優先級 |
| 欄位設定 | P2 | 中優先級 |
| 其他操作 | P3 | 低優先級 |

#### 收合邏輯

- **大螢幕**: 顯示所有按鈕 (P0 + P1 + P2 + P3)
- **中螢幕**: 顯示 P0 + P1 按鈕,P2 + P3 收入「更多」選單
- **小螢幕**: 顯示 P0 按鈕,P1 + P2 + P3 收入「更多」選單

#### 實作要點

- 使用 Tailwind 響應式類別: `hidden md:inline-flex lg:inline-flex`
- 使用 Ant Design Dropdown 元件作為「更多」選單
- 監聽視窗大小變化,動態調整按鈕顯示

#### 前後端分工

| 項目 | 前端 | 後端 |
|------|------|------|
| 響應式斷點檢測 | ✅ | - |
| 按鈕優先級排序 | ✅ | - |
| 收合邏輯實作 | ✅ | - |
| 下拉選單渲染 | ✅ | - |
| 按鈕權限配置 | - | ✅ |

---

## 六、關聯模組 (Related Modules)

以下模組使用此元件:
- **incidents-list**
- **alert-rules**
- **resources-list**
- **dashboards-list**

---

## 七、設計原則遵循 (Design Principles)

| 項目 | 狀態 | 說明 |
|------|------|------|
| 可重用性 (Reusability) | ✅ | 元件設計為通用,可跨多個模組使用 |
| 一致性 (Consistency) | ✅ | 遵循統一的 UI 設計系統與互動模式 |
| 可存取性 (Accessibility) | ✅ | 支援鍵盤導航與 ARIA 屬性 |
| 主題支援 (Theme Support) | ✅ | 使用 Theme Token,支援深淺色主題 |
| i18n 支援 (i18n) | ✅ | 所有文案透過 useContent 存取 |

---

## 八、待確認事項 (Clarifications)

- ✅ ~~[NEEDS CLARIFICATION: 批次操作的權限控制機制]~~ → **已解決: 採用隱藏/禁用混合策略,部分權限時顯示確認對話框**
- ✅ ~~[NEEDS CLARIFICATION: 工具列在不同螢幕尺寸的響應式佈局]~~ → **已解決: 採用按鈕收合策略,依優先級收入「更多」選單**

---

## 九、決策記錄 (Decision Records)

### DR-001: 批次操作權限控制策略

**決策日期**: 2025-10-06
**決策依據**: `_resolution-plan-phase2.md` § 1.3.1
**決策者**: Spec Architect

**決策內容**:
- 完全無權限: 隱藏按鈕
- 部分權限: 顯示 + 禁用 + Tooltip
- 有權限但不可用: 顯示 + 禁用 + Tooltip (說明前置條件)
- 批次操作部分有權限時,顯示確認對話框

**理由**:
- 隱藏按鈕避免使用者困惑
- Tooltip 清楚說明無法操作的原因
- 確認對話框提升批次操作透明度
- 提升使用者體驗與安全性

**前後端分工**:
- 前端: UI 顯示控制、Tooltip、確認對話框
- 後端: API 層級權限驗證

---

### DR-002: 響應式工具列佈局

**決策日期**: 2025-10-06
**決策依據**: `_resolution-plan-phase2.md` § 1.3.2
**決策者**: Spec Architect

**決策內容**:
- 採用按鈕收合至「更多」下拉選單策略
- 定義按鈕優先級 (P0 永遠可見)
- 大螢幕顯示全部,中螢幕部分收合,小螢幕大量收合

**理由**:
- 確保小螢幕可用性
- 保持 UI 整潔
- 優先級設計符合使用習慣
- 提升行動裝置體驗

**前後端分工**:
- 前端: 響應式邏輯、收合實作
- 後端: 無需參與
