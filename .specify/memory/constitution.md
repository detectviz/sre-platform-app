<!--
同步影響報告 (2025-10-05)
版本變更：1.0.0 → 1.1.0
修改原則：保持五大核心原則，細化技術標準與文件規範；加入 UI 色票與表格一致性規範；落實 i18n 與常數集中化；補強 Mock 合約與測試要求。
新增章節：UI/UX 設計系統、前端工程規範、Mock 與 API 合約、版本治理
移除章節：無
需要更新的範本：plan-template.md（憲法檢查清單增補）、tasks-template.md（加入 i18n/常數抽離工作類型）
後續待辦事項：無
-->
# SRE 平台憲法

## 核心原則

### 一、觀測性與可靠性優先
所有功能必須可觀測：指標、記錄、告警三位一體。每項畫面與流程須定義健康檢查與錯誤回饋。任何新增功能不得降低穩定性或掩蓋故障訊號。

### 二、資料治理與血緣追蹤
資料從來源到消費必須可追溯。任何轉換、儲存、輸出需具備血緣紀錄與審計軌跡。以治理先於洞察與自動化，確保可驗證與可回溯。

### 三、安全性與多租戶隔離
租戶資料嚴格隔離。所有操作遵循 RBAC 與審計記錄。安全檢查先於資料操作，並符合既定標準（GDPR、ISO27001）。

### 四、自動化與可解釋智慧
自動化需可審計、可回滾、可人工干預。AI/Insight 需提供可解釋依據與血緣連結，任何自動化決策皆可追蹤與覆核。

### 五、標準化與一致性
程式碼、API、資料結構與 UI 風格遵循統一標準：命名規則、驗證、錯誤模型、色票、表格模式。重大變更需遷移計畫與文件更新。

---

## 技術標準

### 技術棧與版本（前端）
- **React 19**、**TypeScript 5**、**Vite 6**
- **Ant Design 5**（重置樣式為主）、**Tailwind（CDN）**
- **ECharts 6**（CDN）、**dayjs 1.11**、**axios 1.12**、**React Router 7**

### 應用組件與規約
- 路由：僅由集中設定管理；禁止硬寫路徑字串。
- 狀態：Context 與自訂 hooks 為主；避免 props drilling。
- 圖表：統一 `useChartTheme()` 與預設 grid/tooltip 配置；禁止頁面內硬寫色彩陣列。
- 表單與表格：採統一的 **表格基底**、**排序表頭**、**分頁容器**。

### API 與錯誤模型
- `services/api.ts` 為唯一入口；前綴 `/api/v1` 固化於設定。
- 統一錯誤模型：`{ code, message, details? }`；UI 僅讀取標準欄位。
- 任何 API 變更需同步更新 Mock 與合約測試。

### 命名與型別
- TypeScript **禁用隱式 `any`**；新增型別需置於 `types/` 或模組內 `types.ts`。
- 枚舉與常數集中：`constants/`（狀態鍵、圖示鍵、路由、訊息鍵）。
- 檔名與元件：`PascalCase` 元件、`kebab-case` 路徑、明確後綴 `Page/Modal/Drawer`。

---

## UI / UX 設計系統

### 色票與語義（深色主題基準）
- 參考 **Grafana status palette**：
  - Error：`hsl(0,70%,45%)`（紅偏暗）
  - Warning：`hsl(35,70%,45%)`（琥珀橙）
  - Success：`hsl(130,50%,45%)`（溫和綠）
  - Info：`hsl(210,60%,50%)`（青藍）
- 原則：
  - 保留紅/橙/綠/藍語義，但**統一明度與飽和度**。
  - **背景採半透明**（非實心主色）。
  - 文字使用柔和亮度，降低過強對比。
  - 全部落為 **token**，支援主題切換。

### KPI 卡與趨勢顏色
- 底色代表語義；趨勢代表方向。
- 紅/橙/綠底時，趨勢箭頭與數字一律 **白色**，避免撞色；藍/灰底保留紅↑綠↓。
- 必備層級：標題 14px、主值 28–32px、說明 12px；卡片有圓角與輕邊框。

### 表格一致性
- 容器：`rounded-xl border-slate-800 bg-slate-900/70 overflow-hidden`。
- 表頭：`text-xs text-slate-400 uppercase bg-slate-800/50 sticky top-0 z-10`。
- 列：`border-b border-slate-800 hover:bg-slate-800/40`，儲存格 `px-6 py-4`。
- 選中行背景：`bg-sky-900/50`；分頁固定於容器底部。

### 快速篩選（QuickFilterBar）
- 膠囊按鈕支援單/多選、可選統計數；輸出標準 `onChange(values: string[])`。
- 與搜尋框同層，統一尺寸；統計數為可選增強（準確度不足時隱藏）。

---

## 前端工程規範

### 內容與 i18n
- 禁止硬寫文案；所有文字進入 `content/{locale}.json` 或 `useContent()`。
- 錯誤訊息、按鈕文字、時間範圍、狀態標籤全部以 **鍵** 存取。

### 顏色與樣式
- 禁止直接硬寫 `text-slate-* / bg-*-*/xx` 作為語義色；以 **Theme Token** 與 **設計系統色票** 存取。
- KPI 與圖表色由 token 供應；頁面不得自定義隨機色。

### 常數與枚舉
- 狀態鍵、圖示鍵、路由、錯誤碼、時間格式統一於 `constants/`。
- 僅在 constants 定義合法值；頁面以 map 取 label 與樣式。

### 程式品質
- 導入 ESLint + Prettier 規則；CI 中必須通過 Lint 與型別檢查。
- 新增程式碼不得新增 `any`；必要時以 `unknown` + 縮小。

---

## Mock 與 API 合約

### Mock 原則
- Mock 伺服器與正式 API **共享合約**；路由、回傳欄位、錯誤模型一致。
- 任何頁面所需的新欄位（如 `metrics.cpu`、`event_count`）須先在 Mock 補齊。

### 合約測試
- 在 CI 以合約測試驗證 `services/api.ts` 對每個端點的序列化與錯誤處理。
- SDK/Hook 以最小可行回傳型別保證（避免頁面型別重複）。

---

## 開發工作流程

### 結構化階段（P0–P3）
- **P0**：關鍵修復、可靠性/觀測性缺口
- **P1**：安全與驗證、常數化與 i18n 抽離
- **P2**：功能完整與 API 標準化、表格/色票一致化
- **P3**：效能與 UX 細化、可維護性優化

### 品質關卡
- PR 模板需勾選：觀測性、治理、UI 一致性、i18n、token 使用、無硬編碼。
- 關鍵路徑測試覆蓋率 **100%**；含整合測試（列表 → 詳情 → 回到列表）。
- 任何 API/行為變更需同步更新文件與 Mock。

### 測試紀律
- 合約測試先於實作；UI 端到端測試覆蓋主要工作流程。
- 安全測試含權限繞過與多租戶隔離驗證。
- 效能測試依 SLI/SLO 監控，表格渲染與查詢作為關鍵量測。

---

## 版本治理與依賴
- CDN 版本需對齊本地型別（React、Tailwind、ECharts）。
- 升版與鎖版策略文件化；重大升版需風險評估與回滾方案。

---

## 治理
憲法優先於所有其他指引。所有 PR 必須證明符合本憲法。修正案流程：
1. 說明變更動機與目標
2. 影響分析（功能、相依、風險）
3. 遷移計畫（程式碼、Mock、文件）
4. 技術審議通過
5. 文件更新與團隊告知

定期合規審查確保持續遵守；違規將阻擋部署直至修正。原則上偏好簡單可驗證解法，複雜度需被正當化。

**版本**：1.1.0 | **通過日期**：2025-10-05 | **最後修訂**：2025-10-05