# SRE 平台憲法

> 本文件為 Detectviz SRE Platform 的技術與治理最高準則。  
> 所有規格、文件與實作皆須遵循本憲法。  
> 開發執行層原則請參考 [`development-guideline.md`](./development-guideline.md)。

---

## 核心原則

### 一、觀測性與可靠性優先
所有功能必須可觀測：指標、記錄、告警三位一體。  
每項畫面與流程須定義健康檢查與錯誤回饋。任何新增功能不得降低穩定性或掩蓋故障訊號。

### 二、資料治理與血緣追蹤
資料從來源到消費必須可追溯。任何轉換、儲存、輸出需具備血緣紀錄與審計軌跡。  
以治理先於洞察與自動化，確保可驗證與可回溯。

### 三、安全性與多租戶隔離
租戶資料嚴格隔離。所有操作遵循 RBAC 與審計記錄。安全檢查先於資料操作。

### 四、自動化與可解釋智慧
自動化需可審計、可回滾、可人工干預。AI/Insight 需提供可解釋依據與血緣連結，任何自動化決策皆可追蹤與覆核。

### 五、標準化與一致性
程式碼、API、資料結構與 UI 風格遵循統一標準：命名規則、驗證、錯誤模型、色票、表格模式。  
重大變更需遷移計畫與文件更新。

---

## 技術標準

### 一、前端實作原則
- 前端為正式產品實作範疇（非 MVP）。  
- 所有畫面、狀態與互動必須能真實執行並可測試。  
- 開發採 **Frontend-First + Mock 驅動** 策略，後端開發暫緩時，以 Mock Server 驗證資料流與 UI 一致性。  
- Mock 結構與介面需嚴格遵守 `/specs` 下的 `spec.md` 文件中定義的技術實現細節。

### 二、規格與目錄
- `/specs` 為根級規格目錄，遵循 **SpecKit** 開發哲學。  
- 所有規格文件（spec.md）為唯一事實來源（Single Source of Truth），包含功能需求、資料實體、權限控制與技術實現細節。  
- 前端、Mock、與未來後端 API 必須一致遵循此結構。

### 三、設計與技術棧
- 採用 Grafana UI / Scenes SDK 為主體架構。  
- React + TypeScript 為主要開發語言。  
- 後端採 Go + FastAPI，資料儲存以 PostgreSQL 為核心。  
- 所有外部依賴需經安全與維護評估，版本升級須附風險分析。  

### 四、API 與錯誤模型
- 所有 API 需透過 `/api/v1` 統一路徑。  
- 錯誤模型格式固定為 `{ code, message, details? }`。  
- 任何 API 變更需同步更新 Mock、Contracts 與測試。

### 五、命名與型別
- TypeScript 禁用隱式 `any`；所有型別需置於 `types/` 或模組內。  
- 枚舉、常數與狀態鍵集中於 `constants/`。  
- 檔名與元件命名統一規則：`PascalCase` 元件、`kebab-case` 路徑。

---

## UI / UX 設計原則

### 一致性優先
所有介面與互動行為必須遵循統一設計系統。  
UI 元件與樣式不可任意定義，須透過中央設計系統或共用元件庫取得。

### 語義導向
顏色、圖示、狀態、標籤皆必須以語義 token 命名與存取。  
禁止於程式碼中硬寫樣式或顏色值。

### 可調適性
UI 元件必須支援主題切換（深色 / 淺色）與自訂化 token。  
任何視覺調整應能透過 Theme Token 實現。

### 無障礙與可視性
文字、色彩對比度與互動範圍應符合 WCAG AA 標準。  
所有按鈕、表單、圖表需有輔助說明（ARIA 標籤或提示文字）。

---

## Mock 與 API 合約
- Mock 與正式 API 必須共用相同結構、回傳欄位與錯誤模型。  
- 所有頁面新增欄位（如 `metrics.cpu`、`event_count`）需同步更新 Mock 與合約測試。  
- Mock 僅作為後端尚未實作期間的暫代層，用於驗證 UI 與資料流。  

---

## AI 生成與規格合規

所有 AI 生成的文件（spec、plan、task、review）皆需：
1. 引用 `.specify/memory/constitution.md` 作為上位規範。  
2. 同時引用 `.specify/memory/development-guideline.md` 作為執行層準則。  
3. 通過以下六項自動檢查：  
   - **觀測性**：是否描述記錄、指標、告警與可視化介面行為。  
   - **安全性**：是否明確定義 RBAC、審計事件、租戶隔離規則。  
   - **一致性**：是否遵循命名規範、設計系統與前端結構一致性。  
   - **i18n / 常數化**：是否避免硬字串、硬枚舉與非語義化標籤。  
   - **資料閉環**：是否完整描述輸入 → 處理 → 輸出 → 回饋與審計鏈。  
   - **Mock 與資料流一致性**：  
     是否在前端行為、Mock Server 回應與 `/specs` 中的 `data-model` / `contracts` 定義間保持完全一致。

---

## 治理原則
憲法優先於所有其他文件與指引。  
任何 PR、AI 生成內容或文件更新，均需證明符合本憲法。  
修正案流程：
1. 說明變更動機與目標  
2. 分析影響範圍（功能、風險、相依性）  
3. 制定遷移與文件更新計畫  
4. 通過技術審議後方可生效  

---

**版本**：1.4.0  
**通過日期**：2025-10-12  
**最後修訂**：2025-10-12  
**相依文件**：[development-guideline.md](./development-guideline.md)