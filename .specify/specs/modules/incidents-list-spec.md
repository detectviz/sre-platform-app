# Feature Specification: Incidents List Management

**模組代碼**: `incidents-list`
**模組層級**: 核心功能（事件管理）
**憲法版本**: `.specify/memory/constitution.md` (v1.3.0)
**最後更新**: 2025-10-08
**狀態**: Ready for Technical Review

---

## 一、主要使用者情境（User Scenarios & Testing）

### Primary User Story

作為一名站點可靠性工程師（SRE）、維運人員或系統管理員，我需要一個集中化的事件管理介面，讓我能夠：

1. **快速評估系統健康狀況** — 集中查看所有事件（Incidents），按嚴重性、狀態、時間排序，一目了然掌握當前系統問題
2. **高效處理事件** — 認領、指派、解決、靜音事件，支援單一與批次操作，加速事件處理流程
3. **深入調查事件細節** — 查看事件的完整詳細資訊（來源告警、相關事件、時間軸、備註），追蹤事件處理歷程
4. **協作處理複雜事件** — 添加備註、指派給其他成員、關聯相關事件，支援團隊協作與知識傳承
5. **個人化工作介面** — 自訂表格欄位、保存篩選條件、快速切換常用視圖，提升工作效率

### 具體情境（Specific Scenarios）

#### 情境 A：緊急事件快速響應

**背景**：凌晨 2:00 收到告警通知，生產環境資料庫 CPU 使用率達 95%，需立即處理。

**流程**：
1. 我進入「事件列表（Incidents List）」頁面
2. 系統自動按嚴重性排序，最上方顯示一筆 `critical` 等級的新事件：
   - **標題**：Database CPU Usage Critical - prod-db-01
   - **狀態**：New
   - **嚴重性**：Critical
   - **來源**：Prometheus Alert
   - **觸發時間**：2025-10-08 02:15:30
3. 我點擊該事件，右側滑出詳細資訊抽屜（Drawer），顯示：
   - **事件摘要**：CPU 使用率從 40% 激增至 95%（持續 5 分鐘）
   - **影響範圍**：prod-db-01（影響 3 個微服務）
   - **來源告警**：Prometheus Alert Rule: `high_cpu_usage`
   - **時間軸**：2 次告警觸發（02:15、02:18）
4. 我點擊「認領（Acknowledge）」按鈕，系統即時更新：
   - 事件狀態：New → Acknowledged
   - 指派人員：設定為我（john@example.com）
   - 時間軸新增記錄：「john@example.com 於 02:20 認領此事件」
5. 我添加備註：「初步排查：發現大量慢查詢，正在優化索引」
6. 20 分鐘後，問題解決，我點擊「解決（Resolve）」按鈕，系統更新：
   - 事件狀態：Acknowledged → Resolved
   - 解決時間：2025-10-08 02:40:15
   - 處理時長：25 分鐘
7. 系統自動記錄審計日誌：「john@example.com 解決事件 INC-2025100802」

**價值**：快速響應緊急事件，完整記錄處理過程，支援事後複盤與改進。

---

#### 情境 B：批次處理已修復事件

**背景**：系統部署後，10 個事件已自動恢復（告警已解除），需批次標記為已解決。

**流程**：
1. 我進入「事件列表」頁面
2. 使用快速篩選：狀態 = Acknowledged + 標籤 = `auto-recovered`
3. 系統顯示 10 筆符合條件的事件
4. 我點擊表格頂部的「全選」複選框，選中所有 10 筆事件
5. 工具列右側自動切換為批次操作按鈕：「認領」、「解決」、「靜音」、「AI 分析」、「匯出」
6. 我點擊「解決（Resolve）」按鈕，系統顯示確認對話框：
   「確定將 10 個事件標記為已解決？此操作不可復原。」
7. 我確認後，系統批次更新所有事件狀態為 Resolved
8. 系統顯示成功提示：「已成功解決 10 個事件」
9. 表格即時刷新，已解決的事件從列表中移除（因預設篩選不包含 Resolved 狀態）
10. 系統自動記錄審計日誌：「john@example.com 批次解決 10 個事件（INC-2025100803 ~ INC-2025100812）」

**價值**：批次處理提升效率，避免逐一手動操作，減少重複工作。

---

#### 情境 C：事件深度調查與協作

**背景**：複雜事件需要團隊協作調查，涉及多個系統與多次操作。

**流程**：
1. 我進入「事件列表」頁面，點擊一筆 `high` 等級事件：「API Gateway Response Time Degradation」
2. 右側抽屜顯示事件詳細資訊：
   - **事件時間軸**（Timeline）：顯示事件的完整歷程（告警觸發、狀態變更、備註添加、相關事件關聯）
   - **來源告警**（Source Alerts）：3 條 Prometheus 告警（response_time_p99、error_rate、request_count）
   - **相關事件**（Related Incidents）：關聯 2 個相關事件（Database Slowdown、Cache Miss Rate High）
   - **靜音記錄**（Silence History）：無
3. 我在備註區輸入：「初步分析：疑似資料庫慢查詢導致 API 回應變慢，需 DBA 協助排查」
4. 我點擊「指派（Assign）」按鈕，選擇 DBA 團隊成員「alice@example.com」
5. 系統發送通知給 Alice：「john@example.com 將事件 INC-2025100815 指派給您」
6. Alice 查看事件後，添加備註：「已發現慢查詢根因，正在優化索引，預計 30 分鐘完成」
7. 30 分鐘後，Alice 添加備註：「索引優化完成，API 回應時間已恢復正常」，並點擊「解決」
8. 我查看時間軸，看到完整的協作過程：
   - `02:30` - john@example.com 認領事件
   - `02:35` - john@example.com 添加備註：初步分析...
   - `02:40` - john@example.com 指派給 alice@example.com
   - `02:45` - alice@example.com 添加備註：已發現根因...
   - `03:15` - alice@example.com 添加備註：索引優化完成...
   - `03:20` - alice@example.com 解決事件
9. 系統自動記錄所有操作於審計日誌

**價值**：支援團隊協作，完整記錄事件處理歷程，便於事後複盤與知識傳承。

---

#### 情境 D：AI 輔助根因分析

**背景**：多個事件同時發生，需快速識別根因與關聯性。

**流程**：
1. 我進入「事件列表」頁面，看到過去 1 小時內觸發了 15 個事件
2. 我使用快速篩選：時間範圍 = 過去 1 小時，系統顯示所有 15 筆事件
3. 我全選這 15 筆事件，點擊「AI 分析（AI Analyze）」按鈕
4. 系統顯示進度提示：「正在分析 15 個事件，請稍候...」
5. 30 秒後，系統顯示 AI 分析報告：
   - **根因分析**：「疑似資料庫主機 prod-db-01 磁碟空間不足，導致查詢變慢，進而觸發多個上游服務告警」
   - **事件關聯圖**：以視覺化方式顯示事件間的依賴關係（Database → API Gateway → User Service → Order Service）
   - **建議操作**：
     1. 優先處理根因事件：INC-2025100820（Database Disk Full）
     2. 相關事件可標記為「自動恢復」，待根因解決後自動解除
     3. 建議設定磁碟空間告警規則，提前預防
6. 我點擊「接受建議」，系統自動執行：
   - 將 INC-2025100820 標記為「根因事件（Root Cause）」
   - 將其他 14 個事件標記為「相關事件（Related）」，並關聯至根因事件
   - 將其他 14 個事件的優先級降低（High → Medium）
7. 我處理根因事件（清理磁碟空間），解決後，系統自動檢查相關事件是否自動恢復
8. 系統顯示：「根因事件已解決，14 個相關事件中 12 個已自動恢復，剩餘 2 個需人工確認」
9. 系統自動記錄 AI 分析報告與建議操作於事件時間軸

**價值**：AI 輔助快速識別根因，減少人工分析時間，提升事件處理效率。

---

#### 情境 E：個人化工作介面

**背景**：不同團隊成員關注的事件欄位不同，需個人化表格顯示。

**流程**：
1. 我進入「事件列表」頁面，預設顯示 8 個欄位（標題、狀態、嚴重性、觸發時間、指派人員、標籤、來源、操作）
2. 我覺得「來源（Source）」欄位不重要，但希望顯示「影響範圍（Impact）」與「處理時長（Duration）」
3. 我點擊工具列右上角的「欄位設定（Column Settings）」按鈕
4. 系統彈出欄位設定對話框，顯示所有可用欄位（共 15 個）：
   - 已啟用：標題、狀態、嚴重性、觸發時間、指派人員、標籤、來源、操作
   - 可用：影響範圍、處理時長、解決時間、建立者、最後更新時間、相關事件數、備註數
5. 我取消勾選「來源」，勾選「影響範圍」與「處理時長」
6. 我拖曳欄位排序，調整為：標題、嚴重性、狀態、影響範圍、處理時長、觸發時間、指派人員、標籤、操作
7. 我點擊「儲存」，系統即時更新表格欄位與順序
8. 系統將我的設定保存至後端（關聯至我的使用者帳號）
9. 下次我再次進入「事件列表」頁面，系統自動載入我的個人化設定
10. 我的同事 Alice 登入後，看到的仍是預設欄位設定（個人化設定不影響其他使用者）

**價值**：個人化介面提升工作效率，不同角色可根據需求自訂顯示內容。

---

### 現有痛點（Pain Points）

#### 痛點 1：事件分散多個系統，缺乏統一視圖

**問題**：事件分散在監控系統（Prometheus）、日誌系統（Elasticsearch）、告警平台（PagerDuty），無統一查詢入口。
**影響**：SRE 需在多個系統間切換，效率低下，容易遺漏關鍵事件。
**解決**：集中化事件管理，統一查詢介面，自動聚合多來源事件（Prometheus、Kubernetes、Log Analysis）。

---

#### 痛點 2：批次操作不便，重複工作量大

**問題**：處理多個相似事件時，需逐一點擊操作，無法批次處理。
**影響**：效率低下，尤其在大規模事件發生時（例如：系統部署後 50 個事件同時觸發）。
**解決**：支援批次操作（認領、解決、靜音、匯出），一鍵處理多個事件。

---

#### 痛點 3：事件處理歷程不透明，難以追溯

**問題**：事件狀態變更後，無法查看完整的處理歷程（誰在何時做了什麼操作）。
**影響**：事後複盤時無法還原事件處理過程，無法識別改進點。
**解決**：完整記錄事件時間軸（Timeline），包含所有狀態變更、備註添加、指派操作、告警觸發。

---

#### 痛點 4：根因分析依賴人工，效率低下

**問題**：多個事件同時發生時，需人工分析事件間的關聯性與根因。
**影響**：分析耗時，可能延誤根因處理，導致事件持續時間延長。
**解決**：AI 輔助根因分析，自動識別事件關聯性，提供根因建議與操作建議。

---

#### 痛點 5：表格欄位固定，無法個人化

**問題**：不同角色（SRE、開發、管理層）關注的事件資訊不同，但表格欄位固定。
**影響**：無法快速找到關鍵資訊，需滾動或點擊查看，效率低下。
**解決**：支援個人化欄位設定，使用者可自訂顯示欄位與順序，系統自動保存設定。

---

## 二、驗收場景（Acceptance Scenarios）

### 場景群組 A：事件查詢與篩選（Incident Query & Filter）

#### A1. 按狀態篩選事件

1. **Given** 我在「事件列表」頁面。
2. **When** 我在快速篩選欄選擇「狀態：New」。
3. **Then** 系統必須（MUST）即時過濾，僅顯示狀態為 New 的事件。
4. **And** 系統必須（MUST）在頁面頂部顯示符合條件的總筆數（例如：「共 25 筆事件」）。
5. **And** 篩選條件必須（MUST）顯示於頁面頂部（例如：「狀態：New (25)」）。

---

#### A2. 按嚴重性排序事件

1. **Given** 我在「事件列表」頁面。
2. **When** 我點擊「嚴重性（Severity）」欄位標題。
3. **Then** 系統必須（MUST）按嚴重性降序排列（Critical → High → Medium → Low）。
4. **And** 我再次點擊「嚴重性」欄位標題，系統必須（MUST）切換為升序排列。
5. **And** 排序狀態必須（MUST）在欄位標題顯示排序圖示（↓ 或 ↑）。

---

#### A3. 複合篩選（狀態 + 嚴重性 + 時間範圍）

1. **Given** 我在「事件列表」頁面。
2. **When** 我設定以下篩選條件：
   - 狀態：Acknowledged
   - 嚴重性：Critical + High（多選）
   - 時間範圍：過去 24 小時
3. **Then** 系統必須（MUST）顯示同時符合所有條件的事件（AND 邏輯）。
4. **And** 系統必須（MUST）在頁面頂部顯示當前篩選條件摘要與結果筆數。
5. **And** 我可以一鍵清除所有篩選條件，恢復顯示全部事件。

---

#### A4. 搜尋事件標題或標籤

1. **Given** 我在「事件列表」頁面。
2. **When** 我在搜尋框輸入關鍵字 `database`。
3. **Then** 系統必須（MUST）搜尋事件標題（Title）與標籤（Tags）欄位。
4. **And** 系統必須（MUST）顯示包含該關鍵字的所有事件。
5. **And** 系統必須（MUST）高亮匹配的文字部分（例如：`**database**`）。

---

### 場景群組 B：單一事件操作（Single Incident Operations）

#### B1. 認領事件（Acknowledge）

1. **Given** 事件列表顯示一筆狀態為 New 的事件。
2. **When** 我點擊該事件行內的「認領（Acknowledge）」按鈕。
3. **Then** 系統必須（MUST）更新事件狀態為 Acknowledged。
4. **And** 系統必須（MUST）設定指派人員為我（當前登入使用者）。
5. **And** 系統必須（MUST）在事件時間軸新增記錄：「john@example.com 於 [時間] 認領此事件」。
6. **And** 系統必須（MUST）記錄審計日誌（類別：`incident-acknowledged`）。

---

#### B2. 指派事件給其他成員

1. **Given** 事件列表顯示一筆已認領的事件（指派人員：我）。
2. **When** 我點擊「重新指派（Reassign）」按鈕，選擇團隊成員「alice@example.com」。
3. **Then** 系統必須（MUST）更新事件的指派人員為 alice@example.com。
4. **And** 系統必須（MUST）發送通知給 Alice：「john@example.com 將事件 [ID] 指派給您」。
5. **And** 系統必須（MUST）在事件時間軸新增記錄：「john@example.com 將事件指派給 alice@example.com」。
6. **And** 系統必須（MUST）記錄審計日誌（類別：`incident-reassigned`）。

---

#### B3. 解決事件（Resolve）

1. **Given** 事件列表顯示一筆狀態為 Acknowledged 的事件（指派人員：我）。
2. **When** 我點擊「解決（Resolve）」按鈕。
3. **Then** 系統必須（MUST）更新事件狀態為 Resolved。
4. **And** 系統必須（MUST）記錄解決時間（Resolved At）為當前時間戳。
5. **And** 系統必須（MUST）計算處理時長（Duration = Resolved At - Acknowledged At）。
6. **And** 系統必須（MUST）在事件時間軸新增記錄：「john@example.com 於 [時間] 解決此事件，處理時長：25 分鐘」。
7. **And** 系統必須（MUST）記錄審計日誌（類別：`incident-resolved`）。

---

#### B4. 快速靜音事件（Quick Silence）

1. **Given** 事件列表顯示一筆重複觸發的事件（已觸發 10 次）。
2. **When** 我點擊「靜音（Silence）」按鈕，選擇靜音時長「1 小時」。
3. **Then** 系統必須（MUST）建立靜音規則，靜音此事件（依事件 ID 或告警規則）。
4. **And** 系統必須（MUST）設定靜音期限為 1 小時後。
5. **And** 系統必須（MUST）在事件時間軸新增記錄：「john@example.com 靜音此事件 1 小時」。
6. **And** 系統必須（MUST）記錄審計日誌（類別：`incident-silenced`）。
7. **And** 在靜音期間內，相同告警觸發時，系統必須（MUST）自動抑制（不產生新事件）。

---

### 場景群組 C：批次操作（Batch Operations）

#### C1. 批次認領事件

1. **Given** 我在事件列表選擇 5 筆狀態為 New 的事件（使用複選框）。
2. **When** 我點擊工具列的「批次認領（Batch Acknowledge）」按鈕。
3. **Then** 系統必須（MUST）顯示確認對話框：「確定認領 5 個事件？」。
4. **And** 我確認後，系統必須（MUST）批次更新所有事件狀態為 Acknowledged，指派人員設定為我。
5. **And** 系統必須（MUST）顯示成功提示：「已成功認領 5 個事件」。
6. **And** 系統必須（MUST）記錄審計日誌（類別：`incident-batch-acknowledged`，內容：事件 ID 清單）。

---

#### C2. 批次解決事件

1. **Given** 我在事件列表選擇 10 筆狀態為 Acknowledged 的事件。
2. **When** 我點擊工具列的「批次解決（Batch Resolve）」按鈕。
3. **Then** 系統必須（MUST）顯示確認對話框：「確定解決 10 個事件？此操作不可復原。」。
4. **And** 我確認後，系統必須（MUST）批次更新所有事件狀態為 Resolved。
5. **And** 系統必須（MUST）顯示成功提示：「已成功解決 10 個事件」。
6. **And** 系統必須（MUST）記錄審計日誌（類別：`incident-batch-resolved`）。

---

#### C3. 批次 AI 分析

1. **Given** 我在事件列表選擇 15 筆事件（過去 1 小時內觸發）。
2. **When** 我點擊工具列的「AI 分析（AI Analyze）」按鈕。
3. **Then** 系統必須（MUST）顯示進度提示：「正在分析 15 個事件，請稍候...」。
4. **And** 系統必須（MUST）調用 AI 分析服務，分析事件關聯性與根因。
5. **And** 分析完成後（預計 30 秒），系統必須（MUST）顯示 AI 分析報告（包含根因分析、事件關聯圖、建議操作）。
6. **And** 系統必須（MUST）記錄 AI 分析報告於事件時間軸。
7. **And** 系統必須（MUST）記錄審計日誌（類別：`incident-ai-analyzed`）。

---

### 場景群組 D：事件詳細資訊查看（Incident Detail View）

#### D1. 查看事件完整詳細資訊

1. **Given** 事件列表顯示一筆事件。
2. **When** 我點擊該事件的任一資料列。
3. **Then** 系統必須（MUST）從右側滑出詳細資訊抽屜（Drawer）。
4. **And** 抽屜必須（MUST）顯示以下結構化資訊：
   - 事件摘要（標題、狀態、嚴重性、觸發時間、指派人員）
   - 來源告警（Source Alerts）：顯示觸發此事件的告警清單（Prometheus Alert、Kubernetes Event）
   - 相關事件（Related Incidents）：顯示關聯的其他事件（手動關聯或 AI 自動識別）
   - 時間軸（Timeline）：顯示事件的完整歷程（告警觸發、狀態變更、備註添加、指派操作）
   - 靜音記錄（Silence History）：顯示此事件的靜音歷史（靜音時間、靜音人員、靜音時長）

---

#### D2. 在時間軸中查看操作歷程

1. **Given** 事件詳細資訊抽屜已開啟。
2. **When** 我滾動至「時間軸（Timeline）」區域。
3. **Then** 系統必須（MUST）按時間倒序顯示所有操作記錄（最新記錄在前）。
4. **And** 每筆記錄必須（MUST）包含：操作時間、操作者、操作類型（認領、解決、備註、靜音）、操作內容。
5. **And** 備註類型的記錄必須（MUST）支援展開/摺疊（長文字自動摺疊，點擊「展開」顯示完整內容）。

---

#### D3. 添加備註（Add Comment）

1. **Given** 事件詳細資訊抽屜已開啟。
2. **When** 我在備註輸入框輸入文字：「初步排查：發現慢查詢，正在優化索引」，並點擊「新增備註」。
3. **Then** 系統必須（MUST）在時間軸中新增一筆備註記錄。
4. **And** 備註必須（MUST）顯示操作時間、操作者（我）、備註內容。
5. **And** 系統必須（MUST）記錄審計日誌（類別：`incident-comment-added`）。

---

#### D4. 刪除自己的備註

1. **Given** 時間軸中顯示我添加的一筆備註。
2. **When** 我點擊該備註旁的「刪除」按鈕，並確認。
3. **Then** 系統必須（MUST）從時間軸中移除該備註。
4. **And** 系統必須（MUST）記錄審計日誌（類別：`incident-comment-deleted`）。
5. **And** 若備註為其他使用者添加，系統必須（MUST）隱藏「刪除」按鈕（僅備註作者或管理員可刪除）。

---

### 場景群組 E：表格欄位自訂（Table Column Customization）

#### E1. 開啟欄位設定對話框

1. **Given** 我在「事件列表」頁面。
2. **When** 我點擊工具列右上角的「欄位設定（Column Settings）」按鈕。
3. **Then** 系統必須（MUST）彈出欄位設定對話框。
4. **And** 對話框必須（MUST）顯示所有可用欄位（共 15 個），並標註目前啟用狀態（已啟用/未啟用）。
5. **And** 對話框必須（MUST）支援拖曳調整欄位順序。

---

#### E2. 自訂顯示欄位

1. **Given** 欄位設定對話框已開啟。
2. **When** 我取消勾選「來源（Source）」，勾選「影響範圍（Impact）」與「處理時長（Duration）」。
3. **Then** 對話框必須（MUST）即時更新預覽（顯示調整後的欄位清單）。
4. **And** 我點擊「儲存」後，系統必須（MUST）即時更新表格欄位。
5. **And** 系統必須（MUST）將我的設定保存至後端（關聯至我的使用者帳號）。

---

#### E3. 重置為預設欄位

1. **Given** 欄位設定對話框已開啟，我已自訂欄位。
2. **When** 我點擊「重置為預設（Reset to Default）」按鈕。
3. **Then** 系統必須（MUST）恢復為系統預設的欄位設定（8 個預設欄位）。
4. **And** 系統必須（MUST）刪除我的個人化設定（下次載入時使用預設設定）。

---

### 場景群組 F：事件匯出與匯入（Incident Export & Import）

#### F1. 匯出當前篩選結果（CSV）

1. **Given** 我已篩選出 50 筆符合條件的事件。
2. **When** 我點擊「匯出（Export）」按鈕，選擇格式「CSV」。
3. **Then** 系統必須（MUST）產出包含所有 50 筆事件的 CSV 檔案。
4. **And** CSV 必須（MUST）包含所有啟用的表格欄位（按當前顯示順序）。
5. **And** 系統必須（MUST）記錄匯出行為於審計日誌（類別：`incident-export`）。

---

#### F2. 匯出選中的事件（JSON）

1. **Given** 我在事件列表選擇 10 筆事件。
2. **When** 我點擊「匯出（Export）」按鈕，選擇格式「JSON」。
3. **Then** 系統必須（MUST）產出包含所選 10 筆事件的 JSON 檔案。
4. **And** JSON 必須（MUST）包含完整事件資訊（包括時間軸、備註、相關事件）。
5. **And** 系統必須（MUST）記錄匯出行為於審計日誌。

---

#### F3. 匯入事件資料

1. **Given** 我準備了包含 20 筆事件的 CSV 檔案（從其他系統匯出）。
2. **When** 我點擊「匯入（Import）」按鈕，上傳 CSV 檔案。
3. **Then** 系統必須（MUST）驗證 CSV 格式（檢查必填欄位：標題、嚴重性、觸發時間）。
4. **And** 系統必須（MUST）顯示預覽清單：「將匯入 20 個事件」，並標註衝突項（例如：事件 ID 已存在）。
5. **And** 我確認匯入後，系統必須（MUST）批次建立事件，並記錄審計日誌（類別：`incident-batch-imported`）。

---

## 三、功能需求（Functional Requirements）

### 3.1. 事件查詢與篩選（Incident Query & Filter）

| 編號 | 說明 |
|------|------|
| **FR-QF-001** | 系統必須（MUST）支援按狀態篩選事件（New、Acknowledged、Resolved）。 |
| **FR-QF-002** | 系統必須（MUST）支援按嚴重性篩選事件（Critical、High、Medium、Low），支援多選（OR 邏輯）。 |
| **FR-QF-003** | 系統必須（MUST）支援按時間範圍篩選事件（絕對時間與相對時間，例如：「過去 24 小時」）。 |
| **FR-QF-004** | 系統必須（MUST）支援按指派人員篩選事件（支援選擇特定使用者或「未指派」）。 |
| **FR-QF-005** | 系統必須（MUST）支援按標籤篩選事件（支援多選，OR 邏輯）。 |
| **FR-QF-006** | 系統必須（MUST）支援複合篩選（多個條件同時生效，AND 邏輯）。 |
| **FR-QF-007** | 系統必須（MUST）支援搜尋事件標題與標籤（全文搜尋，高亮匹配文字）。 |
| **FR-QF-008** | 系統必須（MUST）支援按任一欄位排序（升序/降序）。 |

---

### 3.2. 單一事件操作（Single Incident Operations）

| 編號 | 說明 |
|------|------|
| **FR-SO-001** | 系統必須（MUST）支援認領事件（Acknowledge），更新狀態為 Acknowledged，設定指派人員為當前使用者。 |
| **FR-SO-002** | 系統必須（MUST）支援重新指派事件（Reassign），更新指派人員，並發送通知給新指派人員。 |
| **FR-SO-003** | 系統必須（MUST）支援解決事件（Resolve），更新狀態為 Resolved，記錄解決時間與處理時長。 |
| **FR-SO-004** | 系統必須（MUST）支援快速靜音事件（Quick Silence），建立靜音規則（依事件 ID 或告警規則），設定靜音期限。 |
| **FR-SO-005** | 系統必須（MUST）在所有操作後記錄審計日誌（類別：`incident-*`）。 |

---

### 3.3. 批次操作（Batch Operations）

| 編號 | 說明 |
|------|------|
| **FR-BO-001** | 系統必須（MUST）支援批次認領事件（選中多個事件，一鍵認領）。 |
| **FR-BO-002** | 系統必須（MUST）支援批次解決事件（選中多個事件，一鍵解決）。 |
| **FR-BO-003** | 系統必須（MUST）支援批次 AI 分析（選中多個事件，分析關聯性與根因）。 |
| **FR-BO-004** | 系統必須（MUST）在批次操作前顯示確認對話框（顯示操作摘要與影響範圍）。 |
| **FR-BO-005** | 系統必須（MUST）在批次操作後顯示成功/失敗摘要（例如：「已成功解決 10 個事件，2 個失敗」）。 |

---

### 3.4. 事件詳細資訊查看（Incident Detail View）

| 編號 | 說明 |
|------|------|
| **FR-DV-001** | 系統必須（MUST）支援點擊任一事件，從右側滑出詳細資訊抽屜（Drawer）。 |
| **FR-DV-002** | 抽屜必須（MUST）顯示事件摘要、來源告警、相關事件、時間軸、靜音記錄。 |
| **FR-DV-003** | 時間軸必須（MUST）按時間倒序顯示所有操作記錄（告警觸發、狀態變更、備註添加、指派操作）。 |
| **FR-DV-004** | 系統必須（MUST）支援在時間軸中添加備註（Comment）。 |
| **FR-DV-005** | 系統必須（MUST）支援刪除自己的備註（僅備註作者或管理員可刪除）。 |

---

### 3.5. 表格欄位自訂（Table Column Customization）

| 編號 | 說明 |
|------|------|
| **FR-TC-001** | 系統必須（MUST）支援自訂表格顯示欄位（選擇啟用/停用特定欄位）。 |
| **FR-TC-002** | 系統必須（MUST）支援拖曳調整欄位順序。 |
| **FR-TC-003** | 系統必須（MUST）將使用者的欄位設定保存至後端（關聯至使用者帳號）。 |
| **FR-TC-004** | 系統必須（MUST）在使用者下次登入時自動載入個人化設定。 |
| **FR-TC-005** | 系統必須（MUST）支援重置為預設欄位設定。 |

---

### 3.6. 事件匯出與匯入（Incident Export & Import）

| 編號 | 說明 |
|------|------|
| **FR-EI-001** | 系統必須（MUST）支援匯出當前篩選結果（CSV、JSON 格式）。 |
| **FR-EI-002** | 系統必須（MUST）支援匯出選中的事件（CSV、JSON 格式）。 |
| **FR-EI-003** | 系統必須（MUST）支援匯入事件資料（CSV 格式），並驗證必填欄位。 |
| **FR-EI-004** | 系統必須（MUST）在匯入前顯示預覽清單，標註衝突項（例如：事件 ID 已存在）。 |
| **FR-EI-005** | 系統必須（MUST）記錄所有匯出/匯入行為於審計日誌。 |

---

### 3.7. AI 輔助分析（AI-Assisted Analysis）

| 編號 | 說明 |
|------|------|
| **FR-AI-001** | 系統必須（MUST）支援 AI 分析多個事件的關聯性與根因。 |
| **FR-AI-002** | AI 分析報告必須（MUST）包含：根因分析、事件關聯圖、建議操作。 |
| **FR-AI-003** | 系統必須（MUST）支援「接受建議」功能，自動執行 AI 建議的操作（標記根因事件、關聯相關事件、調整優先級）。 |
| **FR-AI-004** | 系統必須（MUST）記錄 AI 分析報告於事件時間軸。 |

---

### 3.8. 效能與擴展性（Performance & Scalability）

| 編號 | 說明 |
|------|------|
| **FR-PS-001** | 事件列表載入時間必須（MUST）在 3 秒內完成（100 筆事件）。 |
| **FR-PS-002** | 篩選操作響應時間必須（MUST）在 2 秒內完成（包含多維度複合篩選）。 |
| **FR-PS-003** | 批次操作處理時間必須（MUST）在 10 秒內完成（包含 100 筆事件）。 |
| **FR-PS-004** | AI 分析響應時間必須（MUST）在 30 秒內完成（分析 15 筆事件）。 |

---

## 四、關鍵資料實體（Key Entities）

| 實體名稱 | 描述 | 關聯 |
|-----------|------|------|
| **Incident** | 事件記錄，包含標題、狀態、嚴重性、觸發時間、指派人員、標籤、來源。 | User (Assignee)、SilenceRule、Tags、IncidentEvent |
| **IncidentEvent** | 事件時間軸中的單點事件，包含操作時間、操作者、操作類型、操作內容。 | Incident |
| **IncidentComment** | 事件備註，包含備註內容、作者、建立時間。 | Incident、User |
| **IncidentAnalysis** | AI 分析報告，包含根因分析、事件關聯圖、建議操作。 | Incident (多對多) |
| **SilenceRule** | 靜音規則，包含靜音目標（事件 ID 或告警規則）、靜音期限、建立者。 | Incident |
| **IncidentFilter** | 事件篩選條件，包含狀態、嚴重性、時間範圍、指派人員、標籤。 | - |
| **TableColumnSetting** | 使用者的表格欄位設定，包含啟用欄位清單與順序。 | User |

---

## 五、權限控制（RBAC）

| 權限字串 | 描述 |
|-----------|------|
| `incidents:list:read` | 檢視事件列表頁面。 |
| `incidents:list:update` | 修改事件（認領、解決、重新指派、快速靜音）。 |
| `incidents:list:comment` | 添加與刪除事件備註。 |
| `incidents:list:analyze` | 觸發 AI 分析功能。 |
| `incidents:list:export` | 匯出事件資料（CSV、JSON）。 |
| `incidents:list:import` | 匯入事件資料（CSV）。 |
| `incidents:list:config` | 修改欄位設定（個人化表格欄位）。 |

---

## 六、邊界案例（Edge Cases）

### 6.1. API 請求失敗

**情境**：載入事件列表時，後端 API 請求失敗（網路錯誤或服務異常）。
**處理**：
- 系統必須（MUST）在表格區域顯示錯誤訊息：「載入事件失敗，請稍後重試」
- 系統必須（MUST）提供「重試（Retry）」按鈕，點擊後重新發送請求
- 系統必須（MUST）記錄錯誤於系統日誌，便於排查

---

### 6.2. 匯出空列表

**情境**：使用者嘗試匯出事件，但當前篩選結果為空（無任何事件）。
**處理**：
- 系統必須（MUST）顯示提示訊息：「目前無可匯出的事件，請調整篩選條件」
- 系統必須（MUST）禁用「匯出」按鈕（按鈕顯示為灰色，不可點擊）

---

### 6.3. 後端未提供欄位定義

**情境**：後端 API 未返回表格欄位定義（例如：服務異常或版本不相容）。
**處理**：
- 系統必須（MUST）使用備用機制，顯示一組預設的基礎欄位（標題、狀態、嚴重性、觸發時間、指派人員）
- 系統必須（MUST）記錄警告於系統日誌：「後端未提供欄位定義，使用預設欄位」

---

### 6.4. 批次操作部分失敗

**情境**：批次解決 10 個事件，其中 2 個因權限不足而失敗。
**處理**：
- 系統必須（MUST）顯示摘要：「已成功解決 8 個事件，2 個失敗」
- 系統必須（MUST）列出失敗的事件清單與失敗原因（例如：「INC-001: 權限不足」）
- 系統必須（MUST）記錄審計日誌（包含成功與失敗事件清單）

---

### 6.5. 事件時間軸過長導致載入變慢

**情境**：事件已存在 30 天，時間軸包含 500 筆操作記錄，載入變慢。
**處理**：
- 系統必須（MUST）採用分頁載入（初次載入最新 50 筆記錄）
- 系統必須（MUST）提供「載入更多（Load More）」按鈕，點擊後載入下一頁（50 筆）
- 系統應該（SHOULD）在載入時顯示進度提示（例如：「正在載入...」）

---

### 6.6. AI 分析超時

**情境**：AI 分析 15 個事件，處理時間超過 60 秒（預期 30 秒）。
**處理**：
- 系統必須（MUST）顯示超時提示：「AI 分析耗時較長，已轉為後台任務處理」
- 系統必須（MUST）在任務完成後發送通知（郵件或站內訊息）：「AI 分析完成，請查看報告」
- 系統必須（MUST）記錄 AI 分析任務於審計日誌（包含任務狀態：處理中/完成/失敗）

---

## 七、觀測性與治理（Observability & Governance）

### 7.1. Logging & Tracing
- [ ] 所有事件 CRUD 操作記錄於審計日誌（類別：`incident-*`，內容：事件 ID、操作類型、執行者）
- [ ] 所有批次操作記錄於審計日誌（類別：`incident-batch-*`，內容：事件 ID 清單、成功數、失敗數）
- [ ] 所有匯出/匯入操作記錄於審計日誌（類別：`incident-export/import`）
- [ ] 所有 AI 分析操作記錄於審計日誌（類別：`incident-ai-analyzed`）
- [ ] 分散式追蹤（Trace ID）貫穿整個事件處理流程（查詢 → 操作 → 審計日誌）

### 7.2. Metrics & Alerts
- [ ] 監控事件總量（按狀態分組：New、Acknowledged、Resolved）
- [ ] 監控事件處理時長（P50、P90、P99）
- [ ] 監控批次操作頻率與成功率
- [ ] 監控 AI 分析執行次數與平均耗時
- [ ] 告警：若事件處理時長超過 2 小時，發送告警
- [ ] 告警：若 AI 分析失敗率超過 10%，發送告警

### 7.3. RBAC
- [ ] 所有事件查詢必須檢查 `incidents:list:read` 權限
- [ ] 所有事件操作必須檢查 `incidents:list:update` 權限
- [ ] AI 分析功能必須檢查 `incidents:list:analyze` 權限
- [ ] 匯出/匯入功能必須檢查 `incidents:list:export/import` 權限

### 7.4. i18n
- [ ] 所有 UI 文案支援 `zh-TW`、`en-US`
- [ ] 事件狀態（Status）顯示標籤使用 i18n Key
- [ ] 嚴重性（Severity）顯示標籤使用 i18n Key
- [ ] 所有錯誤訊息支援多語系

### 7.5. Theme Token
- [ ] 事件狀態標記顏色使用 Theme Token（New: `info-badge-bg`、Acknowledged: `warning-badge-bg`、Resolved: `success-badge-bg`）
- [ ] 嚴重性標記顏色使用 Theme Token（Critical: `danger-badge-bg`、High: `warning-badge-bg`、Medium: `info-badge-bg`、Low: `neutral-badge-bg`）

---

## 八、審查與驗收清單（Review Checklist）

- [x] 文件結構符合憲法 v1.3.0 標準
- [x] Primary User Story 包含 5 個能力點、5 個具體情境、5 個痛點分析
- [x] Acceptance Scenarios 包含 18 個場景，分為 6 個群組（A-F）
- [x] Functional Requirements 包含 40 個需求，分為 8 個類別
- [x] 完整 RBAC 定義（7 個權限）
- [x] 完整邊界案例（6 個）
- [x] 完整觀測性與治理清單（Logging、Metrics、RBAC、i18n、Theme Token）
- [x] 移除所有技術實作細節，保持技術中立

---

## 九、模糊與待確認事項（Clarifications）

| 項目 | 狀態 | 備註 |
|------|------|------|
| AI 分析模型來源 | [NEEDS CLARIFICATION] | AI 分析功能是使用內建規則引擎或外部 AI 服務（OpenAI、Claude），需評估成本與效果。 |
| 事件關聯規則 | [NEEDS CLARIFICATION] | 相關事件的關聯規則（手動關聯 vs. 自動關聯），自動關聯的依據（標籤、時間、來源、影響範圍）。 |
| 靜音規則作用範圍 | [NEEDS CLARIFICATION] | 快速靜音功能的作用範圍（僅靜音當前事件 vs. 靜音相同告警規則的所有未來事件）。 |
| 事件歷史保留期限 | [NEEDS CLARIFICATION] | 已解決事件是否有保留期限（例如：保留 90 天或永久保留），過期後如何處理（歸檔或刪除）。 |
| 批次操作數量限制 | [NEEDS CLARIFICATION] | 批次操作是否有數量限制（例如：最多選擇 100 個事件），超過限制如何處理（分批執行或禁止操作）。 |
