# 功能規格書（Feature Specification）

**模組名稱 (Module)**: profile-preference
**類型 (Type)**: Module
**建立日期 (Created)**: 2025-10-06
**狀態 (Status)**: Draft
**依據憲法條款 (Based on)**: `.specify/memory/constitution.md` (v1.2.0)

---

## 一、主要使用者情境（User Scenarios & Testing）

### 主要使用者故事（Primary User Story）
作為一名平台使用者，我希望能根據自己的工作習慣和偏好來客製化平台的外觀和行為。我希望能調整介面的顏色主題以適應不同的工作環境、設定我熟悉的語言和時區，並將我最關心的儀表板設為我的預設首頁，以便我一登入就能看到最重要的資訊。

### 驗收情境（Acceptance Scenarios）
1.  **Given** 我偏好在夜間工作，覺得預設的亮色主題很刺眼。
    **When** 我在「偏好設定」頁面將「介面主題」更改為「深色」，並點擊「儲存設定」。
    **Then** 整個平台的使用者介面應立即或在下次刷新後切換為深色主題。

2.  **Given** 我最常查看的是「服務 A 健康度」儀表板。
    **When** 我在「預設首頁」的下拉選單中選擇「服務 A 健康度」，並儲存設定。
    **Then** 下次我登入或訪問平台根路徑時，應直接被導向到該儀表板。

3.  **Given** 我不小心修改了一些設定，但想恢復到系統的初始狀態。
    **When** 我點擊「重置為預設」按鈕。
    **Then** 頁面上的所有選項應恢復為系統管理員設定的預設值。

4. **Given** 我希望介面主題能依據作業系統設定自動切換，  
   **When** 我在「介面主題」選項中選擇「自動（依系統設定）」並儲存偏好，  
   **Then** 系統應在使用者裝置切換明暗模式時自動套用對應主題，  
   **And Then** 若使用者手動切換為「亮色」或「暗色」，則覆蓋自動偵測行為，直到使用者再次選擇「自動」為止。

### 邊界案例（Edge Cases）
- 如果使用者沒有任何可用的儀表板（例如，新帳號且未被授予任何權限），「預設首頁」的下拉選單應被禁用，並顯示提示訊息。
- 「儲存設定」按鈕在使用者沒有做出任何修改時應處於禁用狀態。
- 更改語言設定後，應提示使用者需要重新整理頁面才能完全套用。

---

## 二、功能需求（Functional Requirements）

- **FR-001**：系統必須（MUST）提供一個介面，允許使用者設定其個人化的偏好。
- **FR-002**：可設定的偏好必須（MUST）至少包括：介面主題、語言、時區和預設首頁。
- **FR-003**：所有可用的選項（如主題列表、語言列表、時區列表、儀表板列表）必須（MUST）由後端 API 動態提供。
- **FR-004**：系統必須（MUST）提供「儲存變更」的功能，用於將使用者的修改持久化。
- **FR-005**：只有在設定被修改後，「儲存變更」按鈕才應變為可點擊狀態。
- **FR-006**：系統必須（MUST）提供「重置為預設」的功能，允許使用者一鍵恢復到系統預設的偏好設定。
- **FR-007**：系統必須（MUST）提供「匯出偏好設定」的功能，允許使用者將其當前設定下載為一個 JSON 檔案。
- **FR-008 (AS-IS)**：只有在設定被修改後，「儲存變更」按鈕才應變為可點擊狀態。
- **FR-009 (FUTURE)**：系統應支援「匯入偏好設定」功能。
- **FR-010 (FUTURE)**：頁面應提供草稿自動儲存功能。
- **FR-011**：系統必須（MUST）支援三種主題模式：「亮色」、「暗色」、「自動（依系統設定）」，並允許使用者自由切換。
- **FR-012**：當主題設定為「自動」時，系統應根據使用者裝置環境自動變更外觀，且變更應於次登入時持續生效。
- **FR-013**：使用者偏好設定必須（MUST）在儲存後立即持久化，並於重新登入時完整還原。若儲存失敗，系統應提示使用者並保留原設定狀態。

---

## 三、關鍵資料實體（Key Entities）
| 實體名稱 | 描述 | 關聯 |
|-----------|------|------|
| **UserPreferences** | 核心資料實體，代表一個使用者的完整偏好設定集合。 | Dashboard |
| **PreferenceOptions**| 由後端提供的、用於填充各個下拉選單的可用選項列表。 | - |

---

## 四、權限控制 (Role-Based Access Control)

**[FUTURE REQUIREMENT]** 此頁面未來可能需要根據使用者權限進行訪問控制，但目前對所有使用者可見。

---

## 五、觀測性與治理檢查（Observability & Governance Checklist）

此部分描述當前 MVP 的狀態，作為未來迭代的基準。

| 項目 | 狀態 | 說明 |
|------|------|------|
| 記錄與追蹤 (Logging/Tracing) | 🟡 | 未實現。 |
| 指標與告警 (Metrics & Alerts) | 🟡 | 未實現。 |
| RBAC 權限與審計 | 🟡 | 未實現。此頁面目前對所有登入者可見。 |
| i18n 文案 | 🔴 | 未實現。此頁面所有 UI 文字均為硬編碼的中文，未接入 i18n 內容管理系統。 |
| Theme Token 使用 | 🟡 | 部分實現。UI 混用預定義樣式與直接的 Tailwind 色票。 |

---

## 六、審查與驗收清單（Review & Acceptance Checklist）

- [x] 無技術實作語句。
- [x] 所有必填段落皆存在。
- [x] 所有 FR 可測試且明確。
- [x] 無未標註的模糊需求。
- [x] 符合 `.specify/memory/constitution.md`。（已標注違規與待確認項）

---

## 七、模糊與待確認事項（Clarifications）

- **[NEEDS CLARIFICATION] i18n**: 目前 MVP 在此頁面完全使用硬編碼中文，例如 `'偏好設定已成功儲存。'`，未來需全面遷移至 i18n 內容管理系統。
- **[NEEDS CLARIFICATION] Theming**: MVP 廣泛使用 Tailwind CSS 的原子化 class (如 `bg-sky-600`) 來定義語義顏色和樣式，未來需重構為使用中央設計系統的 Theme Token。
- **[NEEDS CLARIFICATION] Draft Management**: 草稿自動儲存 (FR-010) 等進階功能未在當前 MVP 中實現。
- **[NEEDS CLARIFICATION] 自動主題偵測**：需確認自動模式是否依據瀏覽器或作業系統層級的設定進行偵測。  
- **[FUTURE] 同步機制**：未來是否支援跨裝置同步偏好設定（例如使用者在不同電腦登入後保持相同外觀與語言）仍待確認。