# Feature Specification: Resources Discovery

**Feature Branch**: `[resources-discovery]`  
**Created**: 2025-10-10  
**Status**: Draft  
**Input**: "提供統一的資源探索模組，整合自動掃描、資源總覽與拓撲視覺化功能。"

---

## 一、主要使用者情境（User Scenarios & Testing）

### Primary User Story
作為 SRE 團隊主管或平台架構師，我希望能在一個整合頁面中：
- 自動發現並納管新資源；
- 檢視所有已註冊資源的全域分佈；
- 在拓撲圖中理解資源間的依賴關係與健康狀態。

以便在規劃、監控及問題排除時具備完整上下文。

### Acceptance Scenarios
1. **Given** 我在「資源探索」頁面，  
   **When** 系統完成自動掃描，  
   **Then** 我應能看到新發現資源的清單及狀態（待審核 / 已納管 / 忽略）。

2. **Given** 我想快速掌握資源總覽，  
   **When** 頁面載入完成，  
   **Then** 系統應顯示 KPI 卡片（總資源數、健康率、新發現數）、類型分佈圓餅圖及雲端供應商長條圖。

3. **Given** 我想分析資源關聯，  
   **When** 我切換至拓撲視圖，  
   **Then** 我應能看到節點間的連線結構，顯示健康狀態並支援縮放、拖曳與懸停檢視詳細資訊。

4. **Given** 我需要重新掃描環境，  
   **When** 我點擊「重新探索」按鈕並選擇目標範圍，  
   **Then** 系統應執行新的自動發現任務，並在完成後更新結果。

5. **Given** 我需要驗證掃描結果，  
   **When** 我點擊某筆「發現任務」記錄，  
   **Then** 系統應顯示任務摘要（開始時間、持續時間、發現項數、異常）與詳細結果。

---

## 二、功能需求（Functional Requirements）

| 編號 | 說明 |
|------|------|
| **FR-001** | 系統必須（MUST）提供自動資源掃描功能，支援多雲環境（AWS、GCP、Azure、On-Prem）。 |
| **FR-002** | 系統必須（MUST）允許使用者手動觸發探索任務並選擇範圍（全部 / 指定群組 / 資料源）。 |
| **FR-003** | 系統必須（MUST）展示探索任務清單，顯示狀態、進度與最後執行時間。 |
| **FR-004** | 系統必須（MUST）在探索完成後顯示新發現資源並標記狀態（待確認 / 已納管 / 忽略）。 |
| **FR-005** | 系統必須（MUST）提供資源總覽儀表板，包括 KPI、分佈圖與統計摘要。 |
| **FR-006** | 系統必須（MUST）提供拓撲圖視覺化介面，顯示資源節點與關聯。 |
| **FR-007** | 拓撲圖中的節點需根據健康狀態使用語義化顏色（如健康、警告、故障）。 |
| **FR-008** | 系統必須（MUST）允許節點懸停檢視詳細資料（名稱、IP、群組、最近告警）。 |
| **FR-009** | 系統必須（MUST）允許手動刷新總覽與拓撲資料。 |
| **FR-010** | 系統必須（MUST）支援自動排程探索任務（每日 / 每週）。 |
| **FR-011** | 所有 UI 文字與圖表標籤必須使用 i18n Key。 |
| **FR-012** | 所有顏色與狀態樣式必須遵循 Theme Token。 |
| **FR-013** | 系統必須（MUST）根據使用者權限過濾可見資源與探索結果。 |
| **FR-014** | 系統應允許導出探索結果報表（CSV / JSON）。 |
| **FR-015** | [FUTURE] 支援資源關聯自動偵測與依賴鏈學習（Dependency Mapping AI）。 |

---

## 三、關鍵資料實體（Key Entities）

| 實體名稱 | 描述 | 關聯 |
|-----------|------|------|
| **DiscoveryJob** | 自動探索任務，包含執行狀態、時間與發現結果。 | 由使用者或排程觸發。 |
| **DiscoveredResource** | 掃描中發現的資源，具類型、名稱、位置、狀態。 | 隸屬於 DiscoveryJob。 |
| **ResourceTopology** | 用於拓撲圖呈現的結構資料。 | 節點關聯至 Resource 與 Datasource。 |
| **ResourceOverviewData** | 資源總覽統計資料（KPI 與圖表）。 | 聚合自所有資源與群組。 |

---

## 四、權限控制（RBAC）

| 權限字串 | 描述 |
|-----------|------|
| `resources:discovery:read` | 檢視資源探索頁與結果。 |
| `resources:discovery:execute` | 觸發新探索任務。 |
| `resources:discovery:manage` | 管理排程與任務設定。 |

---

## 五、觀測性與治理檢查（Observability & Governance）

| 項目 | 狀態 | 說明 |
|------|------|------|
| Logging / Audit | ✅ | 所有探索與刷新操作皆須記錄審計日誌。 |
| Metrics | ✅ | 收集探索任務成功率、平均耗時、拓撲節點數量等指標。 |
| RBAC | ✅ | 依使用者權限控制任務觸發與資料可視性。 |
| Theme / i18n | ✅ | 全面遵循平台樣式與多語系設計。 |
| [FUTURE] AI Correlation | ⚙️ | 將探索結果與事件告警自動關聯分析。 |

---

## 六、審查與驗收清單（Review & Acceptance Checklist）

- [x] 文件結構符合模板。  
- [x] 已整合自動探索、資源總覽與拓撲三大功能。  
- [x] 無技術實作語句。  
- [x] 與憲法 v1.3.0 一致。  
- [x] 所有需求皆可測試。  

---

## 七、模糊與待確認事項（Clarifications）

| 項目 | 狀態 | 備註 |
|------|------|------|
| 多雲連線驗證方式 | [NEEDS CLARIFICATION] | 不同雲供應商 API 權限驗證機制是否統一。 |
| 拓撲圖資料來源 | [NEEDS CLARIFICATION] | 是否直接來自監控資料庫或需即時計算。 |
| 掃描任務錯誤處理 | [FUTURE] | 是否需支援自動重試與失敗告警。 |
| AI 依賴學習 | [FUTURE] | 是否由平台端或外部模型訓練支援。 |