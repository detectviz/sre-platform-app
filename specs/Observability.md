# 可觀測性 (Observability)

### **提案：平台級前端可觀測性實施方案**

**目標**：建立一個標準化的前端性能指標和 API 呼叫遙測的收集機制，以滿足 `constitution.md` 中對「可觀測性」的要求。

**1. 核心技術選型：**

- 建議整合業界標準的真實使用者監控 (RUM) 和應用程式性能監控 (APM) SDK，例如 **Sentry**、**Datadog** 或 **OpenTelemetry for Web**。最終選擇應基於團隊現有的技術棧。本提案將以一個通用的 SDK 為例。

**2. 需收集的數據：**

- **核心網頁指標 (Core Web Vitals)**：SDK 必須被設定為自動收集所有頁面的核心指標，包括：
    - 最大內容繪製 (LCP)
    - 首次輸入延遲 (FID) / 下次繪製互動 (INP)
    - 累計版面配置轉移 (CLS)
- **API 呼叫遙測 (API Call Telemetry)**：所有透過中央 API 客戶端 (`services/api.ts`) 發出的請求，都必須被自動監測以捕獲：
    - 請求延遲（耗時）。
    - HTTP 狀態碼（成功/失敗）。
    - 請求與回應的大小（若可行的話）。
    - 一個交易 ID (Transaction ID)，以便將前端請求與後端追蹤鏈路關聯起來。
- **自訂性能標記**：對於特別複雜的元件或使用者互動（例如，拓撲圖的渲染、日誌檢視器的滾動），應使用 SDK 的 API 來添加自訂的性能標記，以測量特定的操作耗時。

**3. 實施策略：**

- **全域初始化**：所選的 SDK 應在應用的進入點（例如 `index.tsx` 或 `App.tsx`）進行一次性的初始化。
- **API 客戶端整合**：在 `services/api.ts` 中的 `axios` 實例將被增強，加入攔截器（interceptors），為每一次 API 呼叫自動開始和結束性能測量事務。
- **錯誤邊界 (Error Boundary)**：應在應用的根部實現一個全域的 React `ErrorBoundary` 元件。此邊界將捕獲任何未處理的 JavaScript 錯誤，並將其上報至可觀測性平台，從而避免白畫面並提供寶貴的偵錯資訊。

**4. 前端職責：**

- **整合**：由開發者負責整合和設定所選的 SDK。
- **自訂監測**：對於新的、複雜的功能，開發者有責任在必要時添加自訂的性能標記。
- **避免手動記錄**：開發者**不應**手動記錄那些已經被中央 `axios` 攔截器捕獲的簡單 API 失敗事件。只應在 `ErrorBoundary` 中為未處理的錯誤記錄額外的上下文。

