# 功能規格：事件與告警 (Incidents & Alerts)

本文檔旨在根據現有的平台頁面截圖，逆向工程並定義「事件與告警」模組的功能規格。所有描述均基於對 UI/UX、互動流程及模擬 API 的分析。

**注意**：請一律使用 **繁體中文** 回報，程式碼需加入 **繁體中文註解**。

---

### `incidents-list-overview.png`

**現況描述**
- **頁面標題**：頁面主標題為「事件列表」。
- **頂部操作區**：包含「匯入」與「新增事件」兩個主要按鈕。
- **篩選與搜尋**：
    - 提供一個文字搜尋框，提示使用者「搜尋事件摘要...」。
    - 提供多個下拉式篩選器，包括「狀態」、「等級」、「指派對象」。
    - 提供一個日期範圍選擇器來篩選事件發生時間。
- **批次操作工具列**：當使用者勾選列表中的項目時出現，顯示已選取的項目數量，並提供「批次關閉」和「指派」操作。
- **事件列表**：以表格形式呈現，欄位包含：
    - `摘要`：事件的主要描述。
    - `資源`：與事件相關的資源名稱。
    - `等級`：以不同顏色的標籤顯示，例如 `Critical` (紅色)、`Warning` (橘色)。
    - `狀態`：以標籤顯示，例如 `New`、`Acknowledged`。
    - `指派對象`：顯示被指派處理此事件的人員或團隊。
    - `發生時間`：事件首次發生的時間戳。
    - `關聯規則`：觸發此事件的告警規則名稱。
- **分頁控制**：表格右下方提供分頁功能，用於瀏覽大量事件。

**互動流程**
- **搜尋**：使用者在搜尋框輸入關鍵字並按下 Enter 或點擊搜尋按鈕後，列表應僅顯示摘要欄位匹配關鍵字的事件。
- **篩選**：使用者可透過下拉選單選擇特定狀態、等級或指派對象，列表會即時更新以符合篩選條件。使用者也可以透過日期選擇器篩選特定時間範圍內的事件。
- **排序**：使用者可點擊表格標頭（例如「發生時間」）對事件列表進行升序或降序排序。
- **批次操作**：
    1. 使用者勾選列表項目左側的核取方塊。
    2. 批次操作工具列出現。
    3. 使用者點擊「批次關閉」，會彈出一個確認視窗，要求填寫解決方案說明。
    4. 使用者點擊「指派」，會彈出 `incidents-assign-modal.png` 所示的指派視窗。
- **新增事件**：點擊「新增事件」按鈕，應開啟一個表單或精靈，讓使用者手動建立新事件。
- **查看詳情**：點擊任一事件的「摘要」連結，應導向至該事件的詳情頁 (`incidents-detail-timeline.png`)。

**API 與資料流**
- **取得事件列表**
    - **Endpoint**: `GET /api/v1/incidents`
    - **傳入參數 (Query Params)**:
        - `page: number` (分頁頁碼)
        - `page_size: number` (每頁項目數)
        - `sort_by: string` (排序欄位，例如 `occurred_at`)
        - `sort_order: 'asc' | 'desc'` (排序方向)
        - `search: string` (搜尋關鍵字)
        - `status: string` (狀態篩選)
        - `severity: string` (等級篩選)
        - `assignee_id: string` (指派對象篩選)
        - `start_date: string` (ISO 格式日期)
        - `end_date: string` (ISO 格式日期)
    - **傳出資料 (Response Body)**: `Paginated<Incident>`
        ```typescript
        // 註解：分頁後的事件列表回應
        {
          items: Incident[], // 事件物件陣列
          total: number,     // 總項目數
          page: number,      // 目前頁碼
          page_size: number  // 每頁大小
        }
        ```
    - **資料流**：頁面載入時，前端呼叫此 API 取得第一頁資料。當使用者進行搜尋、篩選、排序或換頁時，前端會帶上對應的查詢參數重新呼叫此 API，並更新表格內容。

- **批次關閉事件**
    - **Endpoint**: `POST /api/v1/incidents/batch-close`
    - **傳入參數 (Request Body)**:
        ```typescript
        // 註解：批次關閉事件的請求
        {
          incident_ids: string[], // 要關閉的事件 ID 陣列
          resolution_note: string // 解決方案說明
        }
        ```
    - **資料流**：使用者選擇事件並點擊「批次關閉」後，前端收集所選事件的 ID，並將其與解決方案說明一同發送到此 API。成功後，前端應重新整理事件列表或更新對應事件的狀態為 `resolved`。

- **批次指派事件**
    - **Endpoint**: `POST /api/v1/incidents/batch-assign`
    - **傳入參數 (Request Body)**:
        ```typescript
        // 註解：批次指派事件的請求
        {
          incident_ids: string[], // 要指派的事件 ID 陣列
          assignee_id: string,    // 被指派者的使用者 ID
          assignee_name: string   // 被指派者的名稱
        }
        ```
    - **資料流**：在指派視窗中選擇指派對象並確認後，前端將所選事件 ID 和指派對象資訊發送到此 API。成功後，前端應重新整理列表或更新對應事件的「指派對象」欄位。

**需求與規格定義**
- **使用者需求**
    - 作為一名 SRE/維運人員，我希望能快速瀏覽所有進行中的事件，以便了解系統的整體健康狀況。
    - 我希望能根據事件的嚴重等級進行篩選，以便優先處理最緊急的問題。
    - 我希望能將多個相關的事件一次性指派給特定人員，以提升處理效率。
    - 我希望能搜尋特定關鍵字，以便快速找到與某個服務或錯誤訊息相關的事件。
- **功能規格**
    - **[Spec-INC-List-001]** 系統必須提供一個事件列表頁，預設按「發生時間」降序顯示所有「未解決」的事件。
    - **[Spec-INC-List-002]** 系統必須支援依據「狀態」、「等級」、「指派對象」和「發生時間範圍」對事件進行篩選。
    - **[Spec-INC-List-003]** 系統必須提供關鍵字搜尋功能，該功能應匹配事件的「摘要」欄位。
    - **[Spec-INC-List-004]** 系統必須支援對列表中的多個事件進行「批次關閉」操作，並記錄解決方案。
    - **[Spec-INC-List-005]** 系統必須支援對列表中的多個事件進行「批次指派」操作。
    - **[Spec-INC-List-006]** 系統必須支援對所有可見欄位進行升序或降序排序。
    - **[Spec-INC-List-007]** 當事件數量超過單頁顯示上限時，系統必須提供分頁功能。
    - **[Spec-INC-List-008]** `[NEEDS CLARIFICATION: 「匯入」按鈕的具體功能]` 需定義匯入的檔案格式（例如 CSV, JSON）以及對應的欄位。

---

### `incidents-detail-timeline.png` & `incidents-detail-ai-analysis.png`

**現況描述**
- **頁面佈局**: 頁面頂部顯示事件的核心摘要資訊，如事件 ID、摘要、狀態、等級、發生時間等。
- **主要內容區**: 分為兩個主要頁籤 (Tabs):「時間軸 (Timeline)」和「AI 分析 (AI Analysis)」。
- **時間軸 (Timeline)**:
    - 以時間倒序顯示事件的所有歷史紀錄。
    - 紀錄類型包含：系統自動生成（如 `Created`）、使用者操作（如 `Acknowledged`, `Note Added`）、狀態變更等。
    - 每條紀錄包含時間戳、操作者（使用者或系統）、操作類型和詳細內容。
    - 提供一個輸入框讓使用者「新增筆記 (Add a note)」。
- **AI 分析 (AI Analysis)**:
    - 包含一個「啟動 AI 分析」按鈕。
    - 分析結果區塊，顯示 AI 生成的內容，可能包括：
        - `根本原因分析 (Root Cause Analysis)`
        - `影響範圍評估 (Impact Assessment)`
        - `建議解決方案 (Recommended Actions)`
- **右側資訊欄**:
    - **事件詳情**: 顯示事件的詳細屬性，如資源、關聯規則、指派對象、標籤 (Tags) 等。
    - **操作按鈕**: 提供「指派」、「靜默」、「關閉事件」等操作按鈕。
    - **關聯自動化**: 顯示與此事件相關的自動化腳本執行紀錄。

**互動流程**
- **查看詳情**: 頁面載入時，自動顯示「時間軸」分頁。使用者可以點擊「AI 分析」頁籤切換內容。
- **新增筆記**:
    1. 使用者在「時間軸」分頁的輸入框中輸入文字。
    2. 點擊「送出」按鈕。
    3. 新的筆記會出現在時間軸的最上方。
- **觸發 AI 分析**:
    1. 使用者切換到「AI 分析」分頁。
    2. 點擊「啟動 AI 分析」按鈕。
    3. 系統顯示載入狀態，並在完成後顯示分析結果。
- **執行操作**:
    - 點擊「指派」按鈕，會彈出 `incidents-assign-modal.png` 所示的指派視窗。
    - 點擊「靜默」按鈕，會彈出 `incidents-silence-modal.png` 所示的靜默視窗。
    - 點擊「關閉事件」，會要求使用者填寫解決方案並將事件狀態更新為 `resolved`。
- **查看關聯腳本**: 點擊關聯自動化區塊中的任一執行紀錄，應導向至該次執行的詳細日誌頁面。

**API 與資料流**
- **取得事件詳情**
    - **Endpoint**: `GET /api/v1/incidents/:id`
    - **傳出資料 (Response Body)**: `Incident` 物件，包含 `history` 陣列。
    - **資料流**: 進入頁面時，前端使用事件 ID 呼叫此 API，取得所有基礎資訊並渲染頁面。

- **新增筆記**
    - **Endpoint**: `POST /api/v1/incidents/:id/actions`
    - **傳入參數 (Request Body)**:
        ```typescript
        // 註解：新增筆記的請求
        {
          "action": "add_note",
          "details": "使用者輸入的筆記內容。"
        }
        ```
    - **資料流**: 使用者提交筆記後，前端呼叫此 API。成功後，前端應重新取得事件詳情或將新筆記動態插入到時間軸中。

- **啟動 AI 分析**
    - **Endpoint**: `POST /api/v1/ai/incidents/analyze`
    - **傳入參數 (Request Body)**:
        ```typescript
        // 註解：啟動 AI 分析的請求
        {
          "incident_ids": ["<current_incident_id>"]
        }
        ```
    - **傳出資料 (Response Body)**: `IncidentAnalysis` 物件，包含分析結果。
    - **資料流**: 使用者點擊分析按鈕後，前端呼叫此 API。API 回傳分析結果後，前端將其顯示在 AI 分析區塊。

- **取得關聯自動化執行紀錄**
    - **Endpoint**: `GET /api/v1/incidents/:id/executions`
    - **傳出資料 (Response Body)**: `AutomationExecution[]` 陣列。
    - **資料流**: 頁面載入時，前端可呼叫此 API 取得與該事件相關的自動化執行紀錄，並顯示在右側資訊欄。

**需求與規格定義**
- **使用者需求**
    - 我需要一個集中的地方查看單一事件的所有相關資訊，包括它的生命週期和所有變更歷史。
    - 我希望能為事件添加處理過程中的筆記，以便團隊成員了解最新進度。
    - 當我對事件原因感到困惑時，我希望能借助 AI 分析來獲得可能的根本原因和解決建議。
    - 我希望能直接從事件詳情頁對事件進行指派、靜默或關閉等操作。
- **功能規格**
    - **[Spec-INC-Detail-001]** 系統必須提供一個事件詳情頁，以頁籤形式區分「時間軸」和「AI 分析」。
    - **[Spec-INC-Detail-002]** 「時間軸」必須按時間倒序顯示事件的所有歷史活動，包括創建、狀態變更、指派和使用者筆記。
    - **[Spec-INC-Detail-003]** 使用者必須能夠在「時間軸」頁籤中為事件新增文字筆記。
    - **[Spec-INC-Detail-004]** 「AI 分析」頁籤必須提供一個按鈕，讓使用者可以觸發對當前事件的 AI 分析。
    - **[Spec-INC-Detail-005]** 系統必須在 AI 分析完成後，清晰地展示根本原因、影響範圍和建議方案。
    - **[Spec-INC-Detail-006]** 頁面必須提供快捷操作按鈕，用於「指派」、「靜默」和「關閉事件」。
    - **[Spec-INC-Detail-007]** `[NEEDS CLARIFICATION: AI 分析是否需要費用或權限]` 需確認 AI 分析功能是否為付費功能，或需要特定角色權限才能使用。
    - **[Spec-INC-Detail-008]** 頁面右側應顯示與此事件相關的自動化執行紀錄列表。

---

### `incidents-assign-modal.png`

**現況描述**
- **視窗標題**: 「指派事件」。
- **核心元件**: 一個下拉式選單，用於選擇「指派對象」。此選單應支援搜尋功能，以便在大量使用者中快速查找。
- **操作按鈕**: 包含「取消」和「確認」兩個按鈕。

**互動流程**
1. 使用者在事件列表頁或詳情頁點擊「指派」按鈕，觸發此彈出視窗。
2. 使用者在「指派對象」下拉選單中輸入關鍵字搜尋，或直接從列表中選取一名使用者。
3. 點擊「確認」按鈕，系統將事件指派給所選使用者。
4. 點擊「取消」或關閉視窗，則不進行任何操作。

**API 與資料流**
- **取得使用者列表 (用於下拉選單)**
    - **Endpoint**: `GET /api/v1/iam/users`
    - **資料流**: 當使用者點開下拉選單或輸入搜尋時，前端呼叫此 API 獲取可供選擇的使用者列表。

- **指派事件**
    - **Endpoint**: `POST /api/v1/incidents/batch-assign` (此端點通用於單一或多個事件指派)
    - **傳入參數 (Request Body)**:
        ```typescript
        // 註解：指派事件的請求
        {
          "incident_ids": ["<incident_id_1>", "<incident_id_2>", ...],
          "assignee_id": "<selected_user_id>",
          "assignee_name": "<selected_user_name>"
        }
        ```
    - **資料流**: 使用者點擊「確認」後，前端收集事件 ID(s) 和被指派者的資訊，並呼叫此 API。成功後，前端應更新事件列表或詳情頁上的「指派對象」欄位。

**需求與規格定義**
- **使用者需求**: 我希望能將一個或多個事件快速地指派給團隊中的特定成員來負責處理。
- **功能規格**:
    - **[Spec-INC-Modal-001]** 系統必須提供一個用於指派事件的彈出視窗。
    - **[Spec-INC-Modal-002]** 視窗中的「指派對象」選單必須能從系統使用者列表中搜尋並選取人員。
    - **[Spec-INC-Modal-003]** 確認指派後，系統必須更新目標事件的 `assignee` 或 `owner_id` 欄位。

---

### `incidents-silence-modal.png`

**現況描述**
- **視窗標題**: 「靜默此事件」。
- **核心元件**: 提供一組預設的靜默時長選項（例如「1 小時」、「4 小時」、「24 小時」）以及一個「自訂」選項。
- **操作按鈕**: 包含「取消」和「確認」兩個按鈕。

**互動流程**
1. 使用者在事件詳情頁點擊「靜默」按鈕，觸發此彈出視窗。
2. 使用者選擇一個預設的時長，或選擇「自訂」並輸入指定的靜默時長。
3. 點擊「確認」按鈕，系統將在指定時間內壓制此事件的通知。
4. 點擊「取消」或關閉視窗，則不進行任何操作。

**API 與資料流**
- **靜默事件**
    - **Endpoint**: `POST /api/v1/incidents/:id/actions`
    - **傳入參數 (Request Body)**:
        ```typescript
        // 註解：靜默事件的請求
        {
          "action": "silence",
          "duration_hours": 4 // 使用者選擇的靜默時長（小時）
        }
        ```
    - **資料流**: 使用者點擊「確認」後，前端將事件 ID 和靜默時長一同發送到此 API。成功後，前端應更新事件詳情頁的狀態為 `silenced`。

**需求與規格定義**
- **使用者需求**: 對於已知的、暫時無法處理或不重要的事件，我希望能暫時將其靜默，避免持續收到通知。
- **功能規格**:
    - **[Spec-INC-Modal-004]** 系統必須提供一個用於靜默單一事件的彈出視窗。
    - **[Spec-INC-Modal-005]** 視窗中必須提供預設的靜默時長選項，並允許使用者自訂時長。
    - **[Spec-INC-Modal-006]** 確認靜默後，系統必須在指定時間內抑制該事件的相關通知，並將事件狀態更新為 `silenced`。
    - **[Spec-INC-Modal-007]** `[NEEDS CLARIFICATION: 自訂時長的單位]` 需明確自訂時長的單位是分鐘、小時還是天。

---

### 告警規則管理 (Alert Rules)

此功能區塊包含告警規則的列表管理以及建立/編輯規則的精靈。

#### `incidents-alert-rules-list.png` & `incidents-alert-rules-column-settings.png`

**現況描述**
- **頁面標題**: 「告警規則」。
- **操作按鈕**: 包含「匯入」與「新增規則」按鈕。
- **篩選與搜尋**: 提供「啟用狀態」、「等級」的下拉篩選器，以及一個文字搜尋框。
- **規則列表**:
    - 以表格呈現，支援自訂欄位顯示與排序 (`incidents-alert-rules-column-settings.png`)。
    - 預設欄位包含：`名稱`, `等級`, `目標`, `條件`, `啟用狀態`, `最後更新時間`。
    - 支援透過核取方塊進行批次操作，如「啟用」、「停用」、「刪除」。
- **欄位設定**:
    - 提供一個彈出視窗，讓使用者可以勾選要顯示的欄位，並透過拖拉調整欄位順序。

**互動流程**
- **新增規則**: 點擊「新增規則」按鈕，開啟告警規則建立精靈 (`incidents-alert-rule-wizard-step1.png`)。
- **編輯規則**: 點擊任一規則的名稱，開啟同樣的精靈，但會預先填入該規則的現有設定。
- **批次操作**: 使用者勾選多個規則後，點擊對應的批次操作按鈕（啟用/停用/刪除）來一次修改多個規則。
- **自訂欄位**: 使用者點擊「欄位設定」按鈕，在彈出視窗中修改表格欄位後儲存，列表視圖應即時更新。

**API 與資料流**
- **取得規則列表**: `GET /api/v1/alert-rules`
    - **參數**: `page`, `page_size`, `sort_by`, `sort_order`, `keyword`, `enabled`, `severity`。
    - **資料流**: 頁面載入及使用者操作篩選、搜尋、分頁時呼叫。
- **批次操作**: `POST /api/v1/alert-rules/batch-actions`
    - **參數**: `{ action: 'enable' | 'disable' | 'delete', ids: string[] }`。
    - **資料流**: 使用者執行批次操作時呼叫。
- **儲存欄位設定**: `PUT /api/v1/settings/column-config/alert-rules`
    - **參數**: 包含使用者偏好的欄位鍵值與順序的陣列。
    - **資料流**: 使用者在欄位設定視窗點擊儲存時呼叫。

**需求與規格定義**
- **使用者需求**:
    - 我需要一個地方集中管理所有的告警規則。
    - 我希望能快速啟用或停用某些規則，以應對臨時的維護或變更。
    - 我希望能自訂列表顯示的欄位，只看我關心的資訊。
- **功能規格**:
    - **[Spec-AR-List-001]** 系統必須提供一個可搜尋、篩選、排序及分頁的告警規則列表。
    - **[Spec-AR-List-002]** 系統必須支援對告警規則進行批次的「啟用」、「停用」和「刪除」操作。
    - **[Spec-AR-List-003]** 系統必須允許使用者自訂列表的顯示欄位與順序，且此設定需被保存。

---

#### `incidents-alert-rule-wizard-step1.png` to `step5.png`

**現況描述**
這是一個多步驟的精靈 (Wizard)，用於引導使用者建立或編輯一條告警規則。

- **步驟 1: 選擇範本 (`step1`)**
    - 提供一個可搜尋的範本列表，使用者可從預設範本開始，或選擇「從空白建立」。
    - **實現細節**: 精靈首步呈現雙欄版面：左側依監控目標類型列出篩選按鈕，右側顯示可捲動的範本卡片清單，卡片內容含概要、預設條件與通知示例，並以顏色框線高亮已選範本 【F:components/AlertRuleEditModal.tsx†L73-L200】
- **步驟 2: 基本資訊與生效範圍 (`step2-basic`, `step2-scope`)**
    - **基本資訊**: 填寫 `規則名稱`、`描述`、`等級`，並可選地指派給特定 `團隊` 或 `負責人`。
    - **生效範圍**: 讓使用者從一個可搜尋的資源列表中，勾選此規則要監控的目標資源。
    - **實現細節**: 第二步聚焦規則基本資料：上方提供名稱與描述欄位，下方以卡片呈現監控範圍設定、附加標籤篩選與符合資源預覽 【F:components/AlertRuleEditModal.tsx†L308-L399】
- **步驟 3: 觸發條件 (`step3`)**
    - 允許使用者定義一或多個觸發條件。每個條件包含 `指標 (Metric)`、`運算子 (Function)` 和 `閾值 (Threshold)`。
    - 支援設定觸發的持續時間（例如：持續超過 5 分鐘）。
- **步驟 4: 事件內容 (`step4`)**
    - 讓使用者自訂當規則被觸發時，所產生的事件內容。
    - 包含使用變數（如 `{{resource.name}}`）的 `事件摘要` 和 `描述` 範本。
    - 允許為產生的事件附加固定的 `標籤 (Tags)`。
- **步驟 5: 自動化 (`step5`)**
    - 提供一個開關，讓使用者決定是否要啟用「自動化修復」。
    - 若啟用，可從一個下拉選單中選擇一個已存在的「自動化腳本 (Playbook)」。

**互動流程**
1. 使用者從步驟 1 選擇範本或空白建立開始。
    - **實現細節**: 初次開啟會同時載入監控資源類型與可用範本，載入完成前使用骨架畫面；使用者可透過左側類型切換、右上搜尋框即時縮小結果，再以按鈕選定範本以啟用「下一步」 【F:components/AlertRuleEditModal.tsx†L31-L137】【F:components/AlertRuleEditModal.tsx†L970-L1000】
2. 依序填寫步驟 2 到 5 的表單內容。
    - **實現細節**: 進入步驟即載入資源群組與資源列表，使用者可依「全部／群組／特定資源」模式切換；每次切換會重設已選清單，避免過期條件殘留 【F:components/AlertRuleEditModal.tsx†L231-L367】
3. 系統應在使用者輸入時提供即時驗證（例如，必填欄位不可為空）。
    - **實現細節**: 若尚未選取範本便嘗試前進，系統會以 toast 阻擋並提醒使用者完成選取，確保流程完整性 【F:components/AlertRuleEditModal.tsx†L970-L1000】
4. 在最後一步點擊「完成」或「儲存」按鈕，系統將所有步驟的資料整合成一個物件，提交給後端。

**API 與資料流**
- **取得範本列表**: `GET /api/v1/alert-rules/templates`
    - **實現細節**: 進入步驟時同步呼叫 `GET /alert-rules/resource-types` 與 `GET /alert-rules/templates` 取得篩選條件與範本資料 【F:components/AlertRuleEditModal.tsx†L31-L137】【F:mock-server/handlers.ts†L1152-L1183】
- **取得資源列表**: `GET /api/v1/resources`
- **取得指標列表**: `GET /api/v1/alert-rules/metrics`
- **取得自動化腳本列表**: `GET /api/v1/automation/scripts`
- **建立新規則**: `POST /api/v1/alert-rules`
    - **傳入參數**: 一個包含所有精靈步驟設定的 `AlertRule` 物件。
- **更新現有規則**: `PATCH /api/v1/alert-rules/:id`
    - **傳入參數**: 同上，但包含要更新的規則 ID。
- **預設範本設定**: `GET /api/v1/alert-rules/templates/default`
    - **實現細節**: 若為新增流程，下一步會預先取得預設值以併入範本預設值 【F:components/AlertRuleEditModal.tsx†L907-L998】【F:mock-server/handlers.ts†L1152-L1183】
- **資料流**: 在精靈的每一步，前端可能會呼叫對應的 API 來填充下拉選單選項（如資源、指標、腳本）。當使用者完成所有步驟並儲存時，前端將彙整所有狀態，透過單一的 `POST` 或 `PATCH` 請求發送給後端。

**需求與規格定義**
- **使用者需求**:
    - 我希望能有一個引導式的介面來幫助我正確地建立一條告警規則。
    - 我希望能重複使用現有的設定，例如從一個範本開始建立。
    - 我希望能精確地定義告警的觸發條件，例如針對特定資源的某個指標超過閾值。
    - 我希望能自訂告警觸發後產生的事件內容，以便快速識別問題。
    - 我希望能將告警與一個自動化修復腳本關聯，實現問題的自動處理。
- **功能規格**:
    - **[Spec-AR-Wiz-001]** 系統必須提供一個多步驟精靈，用於建立和編輯告警規則。
    - **[Spec-AR-Wiz-002]** 精靈必須允許使用者從預設範本或空白狀態開始建立。
    - **[Spec-AR-Wiz-003]** 規則必須能關聯到一或多個監控資源。
    - **[Spec-AR-Wiz-004]** 規則的觸發條件必須能基於「指標、運算子、閾值」的組合，並可設定持續時間。
    - **[Spec--AR-Wiz-005]** 系統必須支援使用變數來自訂觸發後產生的事件摘要和描述。
    - **[Spec-AR-Wiz-006]** 規則可以選擇性地關聯一個自動化腳本，以便在觸發時自動執行。
    - **[Spec-AR-Wiz-007]** `[NEEDS CLARIFICATION: 條件群組的邏輯]` 需明確觸發條件是否支援多個條件群組，以及群組間的 AND/OR 邏輯。

---

### 靜默規則管理 (Silence Rules)

此功能區塊包含靜默規則的列表管理以及建立/編輯規則的精靈。

#### `incidents-silence-rules-list.png`

**現況描述**
- **頁面標題**: 「靜默規則」。
- **操作按鈕**: 包含「新增規則」按鈕。
- **篩選與搜尋**: 提供「啟用狀態」、「類型」的下拉篩選器，以及一個文字搜尋框。
- **規則列表**:
    - 以表格呈現，欄位包含：`名稱`, `類型`, `條件`, `排程`, `啟用狀態`, `最後更新時間`。
    - 支援透過核取方塊進行批次操作，如「啟用」、「停用」、「刪除」。

**互動流程**
- **新增規則**: 點擊「新增規則」按鈕，開啟靜默規則建立精靈 (`incidents-silence-rule-wizard-step1.png`)。
- **編輯規則**: 點擊任一規則的名稱，開啟同樣的精靈，但會預先填入該規則的現有設定。
- **批次操作**: 使用者勾選多個規則後，點擊對應的批次操作按鈕來一次修改多個規則。

**API 與資料流**
- **取得規則列表**: `GET /api/v1/silence-rules`
    - **參數**: `page`, `page_size`, `sort_by`, `sort_order`, `keyword`, `type`, `enabled`。
- **批次操作**: `POST /api/v1/silence-rules/batch-actions`
    - **參數**: `{ action: 'enable' | 'disable' | 'delete', ids: string[] }`。

**需求與規格定義**
- **使用者需求**:
    - 我希望能預先設定一些規則，在特定時間（例如計畫性維護期間）自動靜默某些告警，避免不必要的通知。
- **功能規格**:
    - **[Spec-SR-List-001]** 系統必須提供一個可搜尋、篩選、排序及分頁的靜默規則列表。
    - **[Spec-SR-List-002]** 系統必須支援對靜默規則進行批次的「啟用」、「停用」和「刪除」操作。

---

#### `incidents-silence-rule-wizard-step1.png` to `step3.png`

**現況描述**
這是一個三步驟的精靈，用於引導使用者建立或編輯一條靜默規則。

- **步驟 1: 基本資訊 (`step1`)**
    - 讓使用者填寫 `規則名稱` 和 `描述`。
- **步驟 2: 靜默排程 (`step2-once`, `step2-recurring`)**
    - **排程類型**: 提供「單次生效」和「週期性生效」兩種模式。
    - **單次生效**: 使用者需選擇 `開始時間` 和 `結束時間`。
    - **週期性生效**: 使用者需設定 `重複頻率`（如每日、每週）、`星期幾`（若為每週）、以及每日生效的 `時間區間`。
- **步驟 3: 靜默條件 (`step3`)**
    - 讓使用者定義要靜默哪些事件的匹配條件。
    - 使用者可以新增一或多條匹配條件，每條條件由 `標籤 (Label)`、`運算子 (Operator)` 和 `值 (Value)` 組成。
    - 例如：`severity = critical`。

**互動流程**
1. 使用者依序填寫步驟 1 到 3 的表單內容。
2. 在步驟 2，介面會根據選擇的排程類型（單次/週期性）動態切換對應的表單欄位。
3. 在步驟 3，使用者可以動態新增或移除匹配條件。
4. 在最後一步點擊「完成」或「儲存」按鈕，系統將所有設定提交給後端。

**API 與資料流**
- **建立新規則**: `POST /api/v1/silence-rules`
    - **傳入參數**: 一個 `SilenceRule` 物件，其結構需能表達所有精靈中的設定。
        ```typescript
        // 註解：建立靜默規則的請求
        {
          "name": "string",
          "description": "string",
          "schedule": {
            "type": "'once' | 'recurring'",
            // 若為 once
            "start_time": "ISO_date_string",
            "end_time": "ISO_date_string",
            // 若為 recurring
            "frequency": "'daily' | 'weekly'",
            "days_of_week": "number[]", // 0=Sun, 1=Mon...
            "time_from": "HH:mm",
            "time_to": "HH:mm",
            "timezone": "string" // 例如 "Asia/Taipei"
          },
          "matchers": [
            { "key": "string", "operator": "'=' | '!=' | 'contains'", "value": "string" }
          ]
        }
        ```
- **更新現有規則**: `PATCH /api/v1/silence-rules/:id`
    - **傳入參數**: 同上，但包含要更新的規則 ID。
- **資料流**: 使用者完成所有步驟並儲存時，前端將彙整所有狀態，透過單一的 `POST` 或 `PATCH` 請求發送給後端。

**需求與規格定義**
- **使用者需求**:
    - 我希望能建立一個在特定時間範圍內生效的單次靜默規則。
    - 我希望能建立一個週期性（例如每週二）生效的靜默規則，以應對固定的維護作業。
    - 我希望能精確定義要靜默的告警條件，例如只靜默來自某個特定服務的、等級為警告的告警。
- **功能規格**:
    - **[Spec-SR-Wiz-001]** 系統必須提供一個多步驟精靈，用於建立和編輯靜默規則。
    - **[Spec-SR-Wiz-002]** 規則的排程必須支援「單次」和「週期性」兩種模式。
    - **[Spec-SR-Wiz-003]** 週期性排程必須支援至少以「日」或「週」為單位的重複。
    - **[Spec-SR-Wiz-004]** 規則的匹配條件必須支援基於事件標籤的多條件組合。
    - **[Spec-SR-Wiz-005]** `[NEEDS CLARIFICATION: 匹配條件的邏輯]` 需明確多個匹配條件之間是 AND 還是 OR 邏輯。