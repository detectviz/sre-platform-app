# Identity & Teams 功能規格

本文檔旨在定義「身份與團隊 (Identity & Teams)」模組的功能需求與規格。

---

### `identity-users-list.png`

**現況描述**
- **頁面標題**: 身份與存取管理，統一管理身份認證、存取權限和組織架構。
- **KPI 指標卡**:
    - **使用者總數**: 顯示目前系統內的總用戶數 (例如 124)。
    - **活躍使用者**: 顯示處於活躍狀態的用戶數 (例如 98) 及活躍比例。
    - **登入失敗 (24H)**: 顯示過去 24 小時內，來自不同 IP 的登入失敗次數。
- **頁籤導覽**:
    - 人員管理 (預設選中)
    - 團隊管理
    - 角色管理
    - 審計日誌
- **工具列**:
    - **左側**: 搜尋和篩選按鈕。
    - **右側**: 匯入、匯出、欄位設定、邀請人員 (主按鈕)。
    - **批次操作 (勾選後出現)**: 停用、刪除。
- **使用者列表**:
    - 以表格形式呈現，包含欄位：名稱 (含頭像與 Email)、角色、團隊、狀態、上次登入、操作。
    - **狀態**: 使用不同顏色的標籤 (Pill) 標示，例如 `Active` (綠色)、`Inactive` (灰色)、`Invited` (黃色)。
    - **操作**: 每行提供「編輯」和「刪除」按鈕。
- **列表功能**:
    - 支援複選框進行多選。
    - 底部提供分頁控制。

**互動流程**
- **邀請人員**:
    - 使用者點擊右上角的「邀請人員」按鈕。
    - 系統彈出 `identity-invite-member-modal.png` 視窗。
- **編輯人員**:
    - 使用者點擊任一列的「編輯」圖示按鈕。
    - 系統彈出 `identity-edit-member-modal.png` 視窗，並載入該人員的現有資料。
- **刪除人員**:
    - 使用者點擊任一列的「刪除」圖示按鈕。
    - 系統彈出確認對話框，詢問「您確定要刪除使用者 [使用者名稱] 嗎？此操作無法復原。」
    - 確認後，該使用者被刪除，列表自動更新。
- **批次操作**:
    - 使用者勾選列表中的一個或多個項目。
    - 工具列出現「已選取 [N] 個項目」以及「停用」、「刪除」等批次操作按鈕。
    - 點擊批次操作按鈕，系統將對所有選中項目執行該操作。
- **搜尋與篩選**:
    - 使用者點擊「搜尋和篩選」按鈕。
    - 系統彈出 `UnifiedSearchModal` 視窗，提供基於多個條件的搜尋功能。
- **分頁**:
    - 使用者可以點擊分頁元件來切換頁碼或調整每頁顯示的項目數量。

**API 與資料流**
- **載入使用者列表**:
    - **API**: `GET /api/v1/iam/users`
    - **傳入參數**:
        - `page`: 當前頁碼 (例如 `1`)
        - `page_size`: 每頁數量 (例如 `10`)
        - `filters`: (可選) 篩選條件物件
    - **傳出資料**: `{ "items": User[], "total": number }`
    - **流程**: 頁面載入時，呼叫此 API 獲取第一頁的使用者資料並渲染列表。
- **刪除使用者**:
    - **API**: `DELETE /api/v1/iam/users/:id`
    - **傳入參數**: `id` (使用者 ID)
    - **流程**: 使用者確認刪除後，呼叫此 API，成功後重新整理列表。
- **批次刪除使用者**:
    - **API**: `POST /api/v1/iam/users/batch-actions`
    - **傳入參數**: `{ "action": "delete", "ids": string[] }`
    - **流程**: 使用者執行批次刪除後，呼叫此 API，成功後重新整理列表。

**需求與規格定義**
- **需求 1**: 系統必須以分頁列表形式，展示所有使用者帳號。
- **規格 1.1**: 列表應預設顯示使用者頭像、名稱、Email、角色、團隊、狀態、上次登入時間。
- **規格 1.2**: 使用者狀態（如：活躍、停用、已邀請）需使用不同顏色的標籤清晰標示。
- **需求 2**: 使用者應能夠邀請新成員加入系統。
- **規格 2.1**: 需提供「邀請人員」按鈕，點擊後開啟邀請表單。
- **需求 3**: 使用者應能夠編輯現有成員的資訊。
- **規格 3.1**: 每位成員旁需有「編輯」按鈕，點擊後開啟編輯表單。
- **需求 4**: 使用者應能夠刪除成員。
- **規格 4.1**: 每位成員旁需有「刪除」按鈕。
- **規格 4.2**: 刪除操作前，必須有警告提示與二次確認步驟。
- **需求 5**: 系統應支援對使用者進行批次操作。
- **規格 5.1**: 列表需支援多選功能。
- **規格 5.2**: 當至少選擇一項時，應顯示批次操作選項，至少包含批次刪除。

---

### `identity-invite-member-modal.png`

**現況描述**
- **標題**: 邀請新成員
- **表單欄位**:
    - **電子郵件**: 文字輸入框，必填。
    - **姓名 (選填)**: 文字輸入框，可選。
    - **角色**: 下拉選單，必選。
    - **團隊**: 下拉選單，必選。
- **按鈕**:
    - **取消**: 關閉視窗。
    - **發送邀請**: 提交表單。

**互動流程**
- 使用者在「電子郵件」欄位輸入被邀請者的 Email。
- 使用者可選擇性填寫「姓名」。
- 使用者從「角色」和「團隊」下拉選單中選擇對應的選項。
- **驗證**:
    - 「電子郵件」為必填項，格式需符合 Email 規則。
    - 「角色」和「團隊」為必選項。
    - 若未填寫必填項，點擊「發送邀請」時應提示錯誤。
- 點擊「發送邀請」按鈕，若驗證通過，則提交邀請並關閉視窗。

**API 與資料流**
- **發送邀請**:
    - **API**: `POST /api/v1/iam/users`
    - **傳入參數**: `{ "email": "user@example.com", "name": "使用者全名", "role": "Admin", "team": "SRE Platform" }`
    - **流程**:
        1. 使用者填寫完表單並點擊「發送邀請」。
        2. 前端呼叫 API，將表單資料作為 payload 送出。
        3. API 成功回應後 (HTTP 201)，關閉此 modal。
        4. 父頁面 (`PersonnelManagementPage`) 重新呼叫 `GET /api/v1/iam/users` 以更新使用者列表，新邀請的使用者狀態應為「Invited」。

**需求與規格定義**
- **需求 1**: 系統必須提供一個表單，讓管理者可以透過 Email 邀請新成員。
- **規格 1.1**: 表單必須包含電子郵件、姓名、角色和團隊欄位。
- **規格 1.2**: 電子郵件為必填項，且後端需驗證其唯一性。
- **規格 1.3**: 姓名為選填項。
- **規格 1.4**: 角色和團隊為必選項，其選項應來自系統已有的角色和團隊列表。
- **需求 2**: 邀請成功後，系統應給予明確回饋。
- **規格 2.1**: 成功發送邀請後，邀請視窗應自動關閉。
- **規格 2.2**: 使用者列表應自動刷新，並顯示剛被邀請的使用者，其狀態為「已邀請」。

---

### `identity-edit-member-modal.png`

**現況描述**
- **標題**: 編輯成員: [Admin User]
- **表單欄位**:
    - **電子郵件**: 文字輸入框，唯讀 (disabled)。
    - **姓名**: 文字輸入框，唯讀。
    - **角色**: 下拉選單，可編輯。
    - **團隊**: 下拉選單，可編輯。
    - **狀態**: 下拉選單，可編輯。
- **按鈕**:
    - **取消**: 關閉視窗，不儲存任何變更。
    - **儲存變更**: 提交表單。

**互動流程**
- 視窗打開時，表單會自動填入該使用者的現有資料。
- 使用者可以修改「角色」、「團隊」和「狀態」欄位。
- 「電子郵件」和「姓名」為顯示資訊，不可在此修改。
- 點擊「儲存變更」按鈕，提交修改。
- 點擊「取消」按鈕，放棄所有變更並關閉視窗。

**API 與資料流**
- **儲存變更**:
    - **API**: `PATCH /api/v1/iam/users/:id`
    - **傳入參數**:
        - `id`: 使用者 ID
        - **Payload**: `{ "role": "New Role", "team": "New Team", "status": "Active" }`
    - **流程**:
        1. 使用者修改資料後點擊「儲存變更」。
        2. 前端呼叫 API，將修改後的資料作為 payload 送出。
        3. API 成功回應後 (HTTP 200)，關閉此 modal。
        4. 父頁面 (`PersonnelManagementPage`) 重新整理使用者列表，以顯示更新後的資料。

**需求與規格定義**
- **需求 1**: 系統必須允許管理者編輯現有成員的資訊。
- **規格 1.1**: 編輯表單應包含使用者的角色、團隊和狀態。
- **規格 1.2**: 為確保帳號一致性，使用者的電子郵件和姓名在此介面中應為唯讀。
- **規格 1.3**: 角色、團隊和狀態的選項應來自系統設定。
- **需求 2**: 儲存成功後，變更應立即生效。
- **規格 2.1**: 成功儲存後，編輯視窗應自動關閉。
- **規格 2.2**: 使用者列表應自動刷新，以反映最新的使用者資訊。
- **[NEEDS CLARIFICATION: 需補充說明的問題]**: 更改使用者狀態（例如從「活躍」到「停用」）是否應觸發其他系統行為，例如立即終止其 session？

---

### `identity-teams-list.png`

**現況描述**
- **頁面導覽**: 位於「身份與存取管理」下的「團隊管理」頁籤。
- **工具列**:
    - **左側**: 搜尋和篩選按鈕。
    - **右側**: 欄位設定、新增團隊 (主按鈕)。
    - **批次操作 (勾選後出現)**: 刪除。
- **團隊列表**:
    - 以表格形式呈現，包含欄位：團隊名稱、擁有者、成員數、創建時間、操作。
    - **操作**: 每行提供「編輯」和「刪除」按鈕。
- **列表功能**:
    - 支援複選框進行多選。
    - 底部提供分頁控制。

**互動流程**
- **新增團隊**:
    - 使用者點擊右上角的「新增團隊」按鈕。
    - 系統彈出 `identity-edit-team-modal.png` 視窗 (此處為共用視窗，標題為「新增團隊」)。
- **編輯團隊**:
    - 使用者點擊任一列的「編輯」圖示按鈕。
    - 系統彈出 `identity-edit-team-modal.png` 視窗，並載入該團隊的現有資料。
- **刪除團隊**:
    - 使用者點擊任一列的「刪除」圖示按鈕。
    - 系統彈出確認對話框，詢問「您確定要刪除團隊 [團隊名稱] 嗎？此操作無法復原，但不會刪除團隊內的成員。」
    - 確認後，該團隊被刪除，列表自動更新。
- **批次刪除**:
    - 使用者勾選列表中的一個或多個項目。
    - 工具列出現批次操作按鈕「刪除」。
    - 點擊按鈕後，系統將對所有選中項目執行刪除。

**API 與資料流**
- **載入團隊列表**:
    - **API**: `GET /api/v1/iam/teams`
    - **傳入參數**:
        - `page`: 當前頁碼
        - `page_size`: 每頁數量
        - `filters`: (可選) 篩選條件
    - **傳出資料**: `{ "items": Team[], "total": number }`
    - **流程**: 頁面載入時，呼叫此 API 獲取團隊資料並渲染列表。同時，會非同步載入所有使用者資料 (`GET /api/v1/iam/users`)，用於顯示團隊擁有者名稱。
- **刪除團隊**:
    - **API**: `DELETE /api/v1/iam/teams/:id`
    - **傳入參數**: `id` (團隊 ID)
    - **流程**: 使用者確認刪除後，呼叫此 API，成功後重新整理列表。
- **批次刪除團隊**:
    - **API**: `POST /api/v1/iam/teams/batch-actions`
    - **傳入參數**: `{ "action": "delete", "ids": string[] }`

**需求與規格定義**
- **需求 1**: 系統必須以列表形式，展示所有團隊。
- **規格 1.1**: 列表應顯示團隊名稱、擁有者、成員數量和創建時間。
- **需求 2**: 使用者應能夠新增團隊。
- **規格 2.1**: 需提供「新增團隊」按鈕，點擊後開啟新增表單。
- **需求 3**: 使用者應能夠編輯現有團隊的資訊。
- **規格 3.1**: 每個團隊旁需有「編輯」按鈕，點擊後開啟編輯表單。
- **需求 4**: 使用者應能夠刪除團隊。
- **規格 4.1**: 每個團隊旁需有「刪除」按鈕。
- **規格 4.2**: 刪除操作前，必須有警告提示與二次確認步驟。
- **規格 4.3**: 刪除團隊的操作不應影響團隊內成員帳號本身的存在。

---

### `identity-edit-team-modal.png`

**現況描述**
- **標題**: 編輯團隊 (新增時標題為「新增團隊」)
- **表單欄位**:
    - **團隊名稱**: 文字輸入框，必填。
    - **擁有者**: 下拉選單，可從現有使用者中指派。
    - **描述**: 多行文字輸入框。
- **成員管理**:
    - **可用的用戶**: 顯示尚未加入此團隊的所有使用者列表。
    - **團隊成員**: 顯示已加入此團隊的使用者列表。
    - 透過左右箭頭按鈕，在兩個列表間移動使用者，以加入或移除成員。
- **按鈕**:
    - **取消**: 關閉視窗。
    - **儲存**: 提交變更。

**互動流程**
- **新增團隊**:
    - 使用者填寫「團隊名稱」，並可選填「描述」。
    - 使用者從「擁有者」下拉選單中選擇一位團隊擁有者。
    - 使用者可從「可用的用戶」列表中，將成員加入到「團隊成員」列表中。
- **編輯團隊**:
    - 視窗打開時，表單會自動填入該團隊的現有資料。
    - 使用者可以修改團隊名稱、擁有者、描述及成員列表。
- **新增/移除成員**:
    - 在「可用的用戶」列表中點擊一位使用者，該使用者會被移至「團隊成員」列表。
    - 在「團隊成員」列表中點擊一位使用者，該使用者會被移回「可用的用戶」列表。
- **儲存**:
    - 點擊「儲存」按鈕，若驗證通過，則提交變更並關閉視窗。
    - **驗證**: 「團隊名稱」為必填項。

**API 與資料流**
- **載入初始資料**:
    - **API**: `GET /api/v1/iam/users`
    - **流程**: 為了填充「擁有者」下拉選單和「可用的用戶」列表，Modal 需要獲取所有使用者的資料。這通常在父層級 (`TeamManagementPage`) 就已獲取。
- **新增團隊**:
    - **API**: `POST /api/v1/iam/teams`
    - **傳入參數**: `{ "name": string, "owner_id": string, "description": string, "member_ids": string[] }`
    - **流程**: 點擊儲存後，呼叫此 API，成功後關閉視窗並刷新團隊列表。
- **更新團隊**:
    - **API**: `PATCH /api/v1/iam/teams/:id`
    - **傳入參數**: 同上。
    - **流程**: 點擊儲存後，呼叫此 API，成功後關閉視窗並刷新團隊列表。

**需求與規格定義**
- **需求 1**: 系統必須提供一個表單，讓管理者可以新增或編輯團隊。
- **規格 1.1**: 表單必須包含團隊名稱 (必填)、擁有者、描述和成員管理功能。
- **需求 2**: 管理者應能夠為團隊指派一位擁有者。
- **規格 2.1**: 擁有者必須從現有的系統使用者中選擇。
- **需求 3**: 管理者應能夠管理團隊的成員。
- **規格 3.1**: 介面需清楚劃分「團隊成員」與「非團隊成員」。
- **規格 3.2**: 需提供直觀的操作方式（如按鈕或拖放），讓管理者可以新增或移除團隊成員。
- **[NEEDS CLARIFICATION: 需補充說明的問題]**: 一位使用者是否可以同時屬於多個團隊？從目前的介面來看，似乎是支援的，但需要確認。

---

### `identity-roles-list.png`

**現況描述**
- **頁面導覽**: 位於「身份與存取管理」下的「角色管理」頁籤。
- **工具列**:
    - **左側**: 搜尋和篩選按鈕。
    - **右側**: 欄位設定、新增角色 (主按鈕)。
- **角色列表**:
    - 以表格形式呈現，包含欄位：啟用 (開關)、角色名稱 (含描述)、使用者數量、創建時間、操作。
    - **啟用/停用**: 提供一個 Toggle Switch，可直接在列表上快速啟用或停用該角色。
    - **操作**: 每行提供「編輯」和「刪除」按鈕。
- **列表功能**:
    - 支援複選框進行多選。
    - 底部提供分頁控制。

**互動流程**
- **新增角色**:
    - 使用者點擊右上角的「新增角色」按鈕。
    - 系統彈出 `identity-edit-role-modal.png` 視窗 (標題為「新增角色」)。
- **編輯角色**:
    - 使用者點擊任一列的「編輯」圖示按鈕。
    - 系統彈出 `identity-edit-role-modal.png` 視窗，並載入該角色的現有資料。
- **刪除角色**:
    - 使用者點擊任一列的「刪除」圖示按鈕。
    - 系統彈出確認對話框，詢問「您確定要刪除角色 [角色名稱] 嗎？擁有此角色的使用者將失去相關權限。」
    - 確認後，該角色被刪除，列表自動更新。
- **啟用/停用角色**:
    - 使用者點擊「啟用」欄位下的開關。
    - 系統立即更新該角色的狀態，無需進入編輯頁面。
    - `handleToggleEnabled` 函式觸發 `PATCH /api/v1/iam/roles/:id` 來更新狀態。

**API 與資料流**
- **載入角色列表**:
    - **API**: `GET /api/v1/iam/roles`
    - **傳入參數**:
        - `page`: 當前頁碼
        - `page_size`: 每頁數量
        - `filters`: (可選) 篩選條件
    - **傳出資料**: `{ "items": Role[], "total": number }`
    - **流程**: 頁面載入時，呼叫此 API 獲取角色資料並渲染列表。
- **刪除角色**:
    - **API**: `DELETE /api/v1/iam/roles/:id`
    - **傳入參數**: `id` (角色 ID)
    - **流程**: 使用者確認刪除後，呼叫此 API，成功後重新整理列表。
- **更新角色啟用狀態**:
    - **API**: `PATCH /api/v1/iam/roles/:id`
    - **傳入參數**: `{ "enabled": boolean }`
    - **流程**: 使用者點擊啟用開關時，呼叫此 API 更新狀態，成功後刷新列表。

**需求與規格定義**
- **需求 1**: 系統必須以列表形式，展示所有可用的角色。
- **規格 1.1**: 列表應顯示角色名稱、描述、使用者計數和創建時間。
- **規格 1.2**: 必須提供快速啟用/停用角色的功能，例如使用開關 (Toggle Switch)。
- **需求 2**: 使用者應能夠新增自訂角色。
- **規格 2.1**: 需提供「新增角色」按鈕，點擊後開啟角色建立表單。
- **需求 3**: 使用者應能夠編輯現有角色的權限。
- **規格 3.1**: 每個角色旁需有「編輯」按鈕，點擊後開啟權限編輯介面。
- **需求 4**: 使用者應能夠刪除角色。
- **規格 4.1**: 每個角色旁需有「刪除」按鈕。
- **規格 4.2**: 刪除操作前，必須有警告提示與二次確認步驟。
- **規格 4.3**: 系統內建的預設角色 (如 Administrator) 可能不允許被刪除或編輯。 `[NEEDS CLARIFICATION: 需確認哪些角色是系統保留，不可操作的]`

---

### `identity-edit-role-modal.png`

**現況描述**
- **標題**: 編輯角色 (新增時為「新增角色」)
- **表單欄位**:
    - **角色名稱**: 文字輸入框，必填。
    - **描述**: 多行文字輸入框。
- **權限設定**:
    - 以功能模組 (如 Incidents, Resources) 進行分組。
    - 每個模組可展開，顯示具體的權限項目 (如 全選、讀取、建立、更新、刪除)。
    - 使用核取方塊 (Checkbox) 進行權限的勾選。
- **按鈕**:
    - **取消**: 關閉視窗。
    - **儲存**: 提交變更。

**互動流程**
- **設定權限**:
    - 使用者可以展開任一功能模組。
    - 勾選「全選」會自動選取該模組下的所有權限。
    - 可單獨勾選或取消勾選「讀取」、「建立」、「更新」、「刪除」等權限。
- **儲存**:
    - 點擊「儲存」按鈕，若驗證通過，則提交變更並關閉視窗。
    - **驗證**: 「角色名稱」為必填項。

**API 與資料流**
- **載入權限定義**:
    - **API**: `[NEEDS CLARIFICATION: 未在程式碼中明確找到，推測為 GET /api/v1/iam/permissions 或類似端點]`
    - **流程**: 為了渲染權限設定樹，Modal 需要獲取所有可用的權限項定義。
- **新增角色**:
    - **API**: `POST /api/v1/iam/roles`
    - **傳入參數**: `{ "name": string, "description": string, "permissions": { [resource: string]: string[] } }`
    - **流程**: 點擊儲存後，呼叫此 API 建立新角色，成功後關閉視窗並刷新角色列表。
- **更新角色**:
    - **API**: `PATCH /api/v1/iam/roles/:id`
    - **傳入參數**: 同上。
    - **流程**: 點擊儲存後，呼叫此 API 更新角色，成功後關閉視窗並刷新角色列表。

**需求與規格定義**
- **需求 1**: 系統必須提供一個表單，讓管理者可以定義角色的名稱、描述與權限。
- **規格 1.1**: 角色名稱為必填項。
- **需求 2**: 權限設定必須以功能模組分組，提供清晰的層級結構。
- **規格 2.1**: 每個功能模組下應提供細分的權限選項（例如 CRUD - Create, Read, Update, Delete）。
- **規格 2.2**: 應提供「全選」功能，方便管理者快速授予某個模組的所有權限。
- **[NEEDS CLARIFICATION: 需補充說明的問題]**: 權限之間的依賴關係為何？例如，是否必須先有「讀取」權限才能勾選「更新」或「刪除」？

---

### `identity-audit-log-list.png`

**現況描述**
- **頁面導覽**: 位於「身份與存取管理」下的「審計日誌」頁籤。
- **工具列**:
    - **左側**: 檢索和篩選按鈕。
    - **右側**: 欄位設定、匯出。
- **日誌列表**:
    - 以表格形式呈現，包含欄位：時間、使用者、操作、目標、結果。
    - **可排序欄位**: 列表的表頭（時間、使用者、操作、目標、結果）旁有排序圖示，表示可以點擊進行升序或降序排序。
    - **結果**: 使用不同顏色標示，例如 `SUCCESS` (綠色)。
- **列表功能**:
    - 點擊任一列會觸發開啟日誌詳情側邊欄。
    - 底部提供分頁控制。

**互動流程**
- **檢視詳情**:
    - 使用者點擊任一列日誌。
    - 系統從右側滑出 `identity-audit-log-detail.png` 詳情抽屜 (Drawer)。
- **排序**:
    - 使用者點擊可排序的欄位標題。
    - 列表會根據該欄位進行升序或降序排序，並向後端發送對應的 API 請求。
- **檢索與篩選**:
    - 使用者點擊「檢索和篩選」按鈕。
    - 系統彈出 `UnifiedSearchModal` 視窗，提供基於多個條件的日誌搜尋功能（例如：時間範圍、使用者、操作類型）。
- **匯出**:
    - 使用者點擊「匯出」按鈕。
    - 系統會將當前列表中的資料匯出為 CSV 檔案。

**API 與資料流**
- **載入日誌列表**:
    - **API**: `GET /api/v1/iam/audit-logs`
    - **傳入參數**:
        - `page`: 當前頁碼
        - `page_size`: 每頁數量
        - `filters`: (可選) 篩選條件
        - `sort_by`: (可選) 排序欄位 (例如 `timestamp`)
        - `sort_order`: (可選) 排序方向 (`asc` 或 `desc`)
    - **傳出資料**: `{ "items": AuditLog[], "total": number }`
    - **流程**: 頁面載入時，預設按時間降序呼叫此 API，獲取日誌資料並渲染列表。
- **匯出日誌**:
    - **前端實作**: `exportToCsv` 服務。
    - **流程**: 點擊匯出按鈕時，前端會收集當前 `logs` 陣列中的資料，轉換成 CSV 格式並觸發瀏覽器下載。

**需求與規格定義**
- **需求 1**: 系統必須記錄所有重要的使用者活動與系統事件，並以列表形式展示。
- **規格 1.1**: 日誌列表應至少包含時間、執行操作的使用者、操作類型、操作目標和結果。
- **規格 1.2**: 結果欄位應使用顏色區分成功 (`success`) 與失敗 (`failure`)，方便快速識別。
- **需求 2**: 使用者應能夠方便地檢視單筆日誌的完整詳細資訊。
- **規格 2.1**: 點擊列表中的任一項目，應以側邊抽屜 (Drawer) 或類似方式顯示該日誌的原始 JSON 資料。
- **需求 3**: 使用者應能夠對日誌進行排序與篩選。
- **規格 3.1**: 列表應支援按主要欄位（如時間、使用者）進行升序和降序排序。
- **規格 3.2**: 需提供強大的篩選功能，允許使用者根據時間範圍、使用者、操作類型等條件進行檢索。
- **需求 4**: 使用者應能夠將日誌匯出存檔。
- **規格 4.1**: 需提供匯出功能，支援將當前檢視的日誌匯出為 CSV 格式。

---

### `identity-audit-log-detail.png`

**現況描述**
- **類型**: 側邊抽屜 (Drawer)。
- **標題**: 日誌詳情: [log-001]
- **內容**:
    - 以 `pre` 和 `code` 標籤格式化的 JSON 物件，顯示該筆日誌的完整原始資料。
    - JSON 內容包含 `id`, `timestamp`, `user` (物件), `action`, `target` (物件), `result`, `ip`, `details` (物件) 等欄位。

**互動流程**
- **開啟**: 在日誌列表頁點擊任一筆日誌時，此抽屜從右側滑出。
- **關閉**:
    - 點擊抽屜右上角的 "X" 按鈕。
    - 點擊抽屜外的遮罩區域。
    - 按下 `Escape` 鍵。

**API 與資料流**
- **資料來源**: 無獨立 API 呼叫。
- **流程**:
    1. `AuditLogsPage` 透過 `GET /api/v1/iam/audit-logs` 獲取日誌列表資料。
    2. 使用者點擊某一列，觸發 `setSelectedLog(log)`。
    3. `Drawer` 元件根據 `selectedLog` 的狀態變為可見，並將 `selectedLog` 物件的內容格式化為 JSON 顯示。

**需求與規格定義**
- **需求 1**: 系統必須提供一個介面，以易於閱讀的方式展示單筆日誌的完整、未經修改的原始資料。
- **規格 1.1**: 應使用抽屜 (Drawer) 或彈出視窗 (Modal) 來展示詳情，避免跳轉頁面。
- **規格 1.2**: 日誌詳情應以格式化的 JSON 或等效的鍵值對形式呈現，確保所有資訊都被完整揭露。
- **規格 1.3**: 標題應清晰標示正在檢視的日誌 ID。