# 功能規格書（Feature Specification）: Dashboards Management

**建立日期**: 2025-10-10
**狀態**: Draft
**輸入**: 使用者描述: "提供一個統一的儀表板管理介面，用於快速切換、管理和擴充平台內建及外部連結的 Grafana 儀表板"

## 使用者情境與測試 *(mandatory)*

### 使用者故事 1 - 作為 SRE，在統一介面中查看與切換多種類型的儀表板 (優先級: P1)

作為一名 SRE，在日常監控和問題排查時，我需要在一個統一的介面中快速查看和切換多個儀表板，無論它們是平台內建的還是從外部 Grafana 連結的。目前的痛點是在多個系統和 URL 之間頻繁跳轉，操作複雜且效率低下。

**為什麼此優先級**: 解決了監控視圖分散的核心痛點，為使用者提供了單一入口，是提升日常維運效率的基礎。

**獨立測試**: 可以通過在儀表板清單中成功看到一個「內建」儀表板和一個「外部」儀表板，並能點擊它們順利載入對應的儀表板內容來獨立測試。

**驗收情境**:

1.  **Given** 我在儀表板管理頁面中, **When** 我查看儀表板清單, **Then** 系統應顯示所有「內建」與「外部」儀表板，並以標籤清晰區分來源。
2.  **Given** 我想了解儀表板的元數據, **When** 我打開儀表板資訊側欄, **Then** 系統應顯示其版本、來源、上次同步時間等資訊。
3.  **Given** 我需要依不同場景切換儀表板呈現方式, **When** 我切換「顯示模式」為「標準」或「全螢幕」, **Then** 系統應即時重新渲染視圖。

---

### 使用者故事 2 - 作為平台管理員，連結外部 Grafana 儀表板以擴充監控能力 (優先級: P2)

作為平台管理員，當平台內建的儀表板無法滿足特定業務需求時，我需要能夠將團隊在自己 Grafana 中建立的儀表板連結到平台中，方便整個團隊存取。目前的痛點是，如果無法連結，自訂儀表板就成了資訊孤島。

**為什麼此優先級**: 提供了平台的擴充性，允許團隊利用現有的 Grafana 資源，滿足客製化的監控需求。

**獨立測試**: 可以通過在管理頁面輸入一個有效的 Grafana 儀表板 URL，成功建立連結後，在儀表板清單中看到這個新的「外部」儀表板來獨立測試。

**驗收情境**:

1.  **Given** 我需要新增外部 Grafana 儀表板, **When** 我輸入 Grafana UID 或完整 URL 並確認, **Then** 系統應驗證儀表板是否存在並成功建立連結。
2.  **Given** 我新增了一個外部儀表板連結, **When** 我在儀表板清單中點擊它, **Then** 系統應能在 iframe 或新頁面中正確載入該儀表板。

---

### 使用者故事 3 - 作為平台使用者，個人化儀表板偏好以提升效率 (優先級: P3)

作為平台使用者，我希望能將最常用的儀表板設定為我的預設首頁，並能將一些儀表板加入書籤以便快速尋找。目前的痛點是每次登入或重新整理後都需要手動尋找常用儀表板，浪費時間。

**為什麼此優先級**: 提升使用者體驗，減少重複的導航操作，讓使用者可以更快地進入工作狀態。

**驗收情境**:

1.  **Given** 我想在首頁自動顯示常用儀表板, **When** 我在設定中將某個儀表板設為「預設儀表板」並儲存, **Then** 下次登入後首頁應自動導向該儀表板。
2.  **Given** 我瀏覽儀表板清單, **When** 我點擊一個儀表板旁的書籤圖示, **Then** 該儀表板應被標記為我的個人書籤，並可以透過篩選快速找到。
3.  **Given** 我在桌面版設定了書籤, **When** 我在手機版登入同一帳號, **Then** 書籤狀態應保持同步。
4.  **Given** 我切換排序為「最近使用」, **When** 我重新開啟儀表板管理頁, **Then** 系統應自動保留我的排序偏好設定。

---

### 邊界案例

- **內建儀表板**: 內建儀表板應為唯讀，不允許使用者編輯或刪除其連結。
- **外部儀表板失效**: 當一個外部連結的 Grafana 儀表板在源頭被刪除時，平台中的連結點擊後應顯示「儀表板不存在或無權限存取」的錯誤頁面。
- **權限問題**: 當使用者沒有權限查看某個外部儀表板時，點擊連結後應顯示 Grafana 的權限錯誤頁面。

## 功能需求 *(mandatory)*

### 功能需求

- **FR-001**: 系統必須（MUST）支援「內建」和「外部」兩種類型的儀表板，並在清單中清晰標示。
- **FR-002**: 內建儀表板必須（MUST）是唯讀的。
- **FR-003**: 系統必須（MUST）允許使用者透過 Grafana 的 UID 或 URL 來新增外部儀表板的連結。
- **FR-004**: 儀表板清單必須（MUST）支援搜尋、排序和分頁功能。
- **FR-005**: 系統必須（MUST）提供多種顯示模式，如標準、全螢幕。
- **FR-006**: 使用者必須（MUST）能夠設定個人的預設儀表板。
- **FR-007**: 使用者必須（MUST）能夠將儀表板加入書籤，且偏好設定（書籤、排序）需要跨裝置同步。
- **FR-008**: 所有新增、刪除儀表板連結的操作必須（MUST）記錄到審計日誌。

### 關鍵資料實體 *(如果功能涉及資料則包含)*

- **Dashboard**: 代表一個儀表板。主要屬性: id, name, type (`BUILT_IN`|`EXTERNAL`), source_id (e.g., Grafana UID), url。
- **UserDashboardPreference**: 儲存使用者的儀表板偏好。主要屬性: user_id, default_dashboard_id, bookmarked_dashboard_ids (`id[]`)。

## 權限控制 *(RBAC)*

### 權限模型設計

權限圍繞儀表板的查看和管理（主要是外部連結的管理）進行設計。

#### 所需權限定義

- **`dashboards:read`**: 允許檢視儀表板清單與內容。
- **`dashboards:link:create`**: 允許新增外部 Grafana 儀表板連結。
- **`dashboards:link:delete`**: 允許刪除外部儀表板連結。
- **`dashboards:preferences:update`**: 允許使用者設定自己的偏好（如預設儀表板、書籤）。

#### 角色指派建議

- **Admin 角色**: `dashboards:read`, `dashboards:link:create`, `dashboards:link:delete`, `dashboards:preferences:update`。
- **Editor 角色**: `dashboards:read`, `dashboards:link:create`, `dashboards:link:delete`, `dashboards:preferences:update`。
- **Viewer 角色**: `dashboards:read`, `dashboards:preferences:update`。

#### 權限檢查點

- **進入儀表板頁面**: 檢查 `dashboards:read` 權限。
- **顯示「新增連結」按鈕**: 檢查 `dashboards:link:create` 權限。
- **顯示「刪除連結」按鈕**: 檢查 `dashboards:link:delete` 權限。
- **儲存個人偏好**: 檢查 `dashboards:preferences:update` 權限。

---

## 觀測性與治理檢查（Observability & Governance Checklist）

{{specs/common.md}}

---

## 成功標準 *(mandatory)*

### 可衡量成果

- **SC-001**: 使用者可以在 30 秒內成功新增一個外部儀表板連結。
- **SC-002**: 儀表板（內嵌框架）的平均載入時間應低於 3 秒。
- **SC-003**: 95% 的使用者能在首次使用時成功找到並設定自己的預設儀表板。

---

## 模糊與待確認事項（Clarifications）

- **儀表板同步**: [FUTURE] 未來是否需要支援將外部儀表板的 JSON 內容同步到平台內，以實現版本控制和更深入的整合？
- **儀表板匯入/匯出**: [FUTURE] 是否需要支援匯出/匯入儀表板的連結設定，以方便在不同環境間遷移？
- **Grafana Scenes**: [FUTURE] 未來是否考慮整合 Grafana Scenes 作為內建儀表板的底層技術？