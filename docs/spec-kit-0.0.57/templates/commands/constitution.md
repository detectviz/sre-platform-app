---
description: 從互動式或提供的原則輸入建立或更新專案憲法，確保所有相依模板保持同步。
---

## 使用者輸入

```text
$ARGUMENTS
```

如果不為空，您**必須**在繼續之前考慮使用者輸入。

## 大綱

您正在更新位於 `/memory/constitution.md` 的專案憲法。此文件是一個 TEMPLATE，包含方括號中的占位符代幣（例如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）。您的工作是 (a) 收集/推導具體值，(b) 精確填寫模板，以及 (c) 跨相依工件傳播任何修訂。

遵循此執行流程：

1. 載入位於 `/memory/constitution.md` 的現有憲法模板。
   - 識別 `[ALL_CAPS_IDENTIFIER]` 形式的每個占位符代幣。
   **重要**：使用者可能需要比模板中使用的原則更多或更少。如果指定了數量，請尊重該數量——遵循一般模板。您將相應更新文檔。

2. 收集/推導占位符的值：
   - 如果使用者輸入（對話）提供值，請使用它。
   - 否則從現有儲存庫上下文推斷（README、文檔、先前憲法版本如果嵌入）。
   - 對於治理日期：`RATIFICATION_DATE` 是原始採用日期（如果未知請詢問或標記 TODO），`LAST_AMENDED_DATE` 如果進行了變更則為今天，否則保持先前日期。
   - `CONSTITUTION_VERSION` 必須根據語義版本控制規則遞增：
     * MAJOR：向後不相容的治理/原則移除或重新定義。
     * MINOR：新增原則/部分或實質擴展指導。
     * PATCH：澄清、措辭、拼寫修正、非語義精煉。
   - 如果版本提升類型模糊，請在最終確定之前提出理由。

3. 起草更新的憲法內容：
   - 用具體文字替換每個占位符（除了專案選擇尚未定義而故意保留的模板插槽外，不要留下方括號代幣——明確說明任何保留的理由）。
   - 保留標題層次結構，註釋在替換後可以移除，除非它們仍然提供澄清指導。
   - 確保每個原則部分：簡潔的名稱行，捕捉不可協商規則的段落（或項目符號清單），如果不明顯則提供明確的理由。
   - 確保治理部分列出修訂程序、版本控制政策和合規審查期望。

4. 一致性傳播檢查清單（將先前檢查清單轉換為主動驗證）：
   - 讀取 `/templates/plan-template.md` 並確保任何「憲法檢查」或規則與更新後的原則對齊。
   - 讀取 `/templates/spec-template.md` 以進行範圍/需求對齊——如果憲法新增/移除強制性部分或約束則更新。
   - 讀取 `/templates/tasks-template.md` 並確保任務分類反映新增或移除的原則驅動任務類型（例如：可觀測性、版本控制、測試紀律）。
   - 讀取 `/templates/commands/*.md` 中的每個命令文件（包括此文件）以驗證沒有過時的參考（僅限代理特定的名稱如 CLAUDE）在需要通用指導時保留。
   - 讀取任何運行時指導文檔（例如：`README.md`、`docs/quickstart.md`，或代理特定的指導文件如果存在）。更新對已變更原則的參考。

5. 產生同步影響報告（在更新後作為 HTML 註釋前置於憲法文件頂部）：
   - 版本變更：舊版 → 新版
   - 修改原則清單（舊標題 → 新標題如果重新命名）
   - 新增部分
   - 移除部分
   - 需要更新的模板（✅ 已更新 / ⚠ 待處理）含文件路徑
   - 如果有意延遲任何占位符則跟進 TODO。

6. 最終輸出前的驗證：
   - 沒有剩餘未解釋的方括號代幣。
   - 版本行與報告匹配。
   - 日期為 ISO 格式 YYYY-MM-DD。
   - 原則為宣告式、可測試，並避免模糊語言（"should" → 在適當處以 MUST/SHOULD 理由替換）。

7. 將完成的憲法寫回 `/memory/constitution.md`（覆蓋）。

8. 向使用者輸出最終摘要，包含：
   - 新版本和提升理由。
   - 標記為手動跟進的任何文件。
   - 建議的提交訊息（例如：`docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

格式和風格要求：
- 完全按照模板使用 Markdown 標題（不要降級/提升層級）。
- 換行長理由行以保持可讀性（理想 <100 個字元），但不要強制執行會造成尷尬中斷的換行。
- 在部分之間保留單一空白行。
- 避免尾隨空格。

如果使用者提供部分更新（例如：僅一個原則修訂），仍執行驗證和版本決定步驟。

如果缺少關鍵資訊（例如：批准日期真正未知），插入 `TODO(<FIELD_NAME>): explanation` 並在同步影響報告的延遲項目中包含。

不要建立新模板；始終在現有的 `/memory/constitution.md` 文件上操作。
