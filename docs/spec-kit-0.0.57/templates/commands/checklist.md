---
description: 基於使用者需求為目前功能產生自訂檢查清單。
scripts:
  sh: scripts/bash/check-prerequisites.sh --json
  ps: scripts/powershell/check-prerequisites.ps1 -Json
---

## 檢查清單目的：「英文的單元測試」

**關鍵概念**：檢查清單是**需求撰寫的單元測試**——它們驗證特定領域中需求的品質、清晰度和完整性。

**不是用於驗證/測試**：
- ❌ 不是「驗證按鈕點擊正確」
- ❌ 不是「測試錯誤處理是否運作」
- ❌ 不是「確認 API 回傳 200」
- ❌ 不是檢查程式碼/實作是否符合規格

**用於需求品質驗證**：
- ✅ 「所有卡片類型的視覺層次需求是否已定義？」（完整性）
- ✅ 「『顯著顯示』是否以具體的尺寸/定位量化？」（清晰度）
- ✅ 「懸停狀態需求是否在所有互動元素中一致？」（一致性）
- ✅ 「鍵盤導航的無障礙需求是否已定義？」（覆蓋率）
- ✅ 「規格是否定義標誌圖片載入失敗時會發生什麼？」（邊界案例）

**比喻**：如果您的規格是用英文撰寫的程式碼，檢查清單就是其單元測試套件。您正在測試需求是否撰寫良好、完整、明確並準備實作——而不是實作是否運作。

## 使用者輸入

```text
$ARGUMENTS
```

如果不為空，您**必須**在繼續之前考慮使用者輸入。

## 執行步驟

1. **設定**：從儲存庫根目錄執行 `{SCRIPT}` 並解析 FEATURE_DIR 和 AVAILABLE_DOCS 清單的 JSON。
   - 所有文件路徑必須為絕對路徑。

2. **澄清意圖（動態）**：推導最多三個初始上下文澄清問題（無預製目錄）。它們必須：
   - 從使用者的措辭 + 從 spec/plan/tasks 提取的訊號產生
   - 僅詢問實質改變檢查清單內容的資訊
   - 如果在 `$ARGUMENTS` 中已經明確，則個別跳過
   - 偏好精確而非廣泛

   產生演算法：
   1. 提取訊號：功能領域關鍵字（例如：auth、latency、UX、API）、風險指標（"critical"、"must"、"compliance"）、利害關係人提示（"QA"、"review"、"security team"）和明確交付物（"a11y"、"rollback"、"contracts"）。
   2. 將訊號聚類為候選焦點領域（最多 4 個），按相關性排名。
   3. 如果未明確，識別可能的受眾和時機（author、reviewer、QA、release）。
   4. 偵測缺失維度：範圍廣度、深度/嚴謹性、風險強調、排除邊界、可衡量的驗收標準。
   5. 從這些原型中制定問題：
      - 範圍精煉（例如："這應該包含與 X 和 Y 的整合接觸點，還是保持在本地模組正確性？"）
      - 風險優先順序（例如："這些潛在風險領域中哪些應該接受強制性門檻檢查？"）
      - 深度校準（例如："這是一個輕量級的預提交健全清單還是一個正式的發行門檻？"）
      - 受眾框架（例如："這將僅由作者使用，還是在 PR 審查期間由同儕使用？"）
      - 邊界排除（例如："我們應該在本輪明確排除效能調整項目嗎？"）
      - 場景類別差距（例如："未偵測到復原流程——復原/部分失敗路徑是否在範圍內？"）

   問題格式規則：
   - 如果提出選項，產生包含欄位的緊湊表格：選項 | 候選 | 為什麼重要
   - 限制為最多 A–E 選項；如果自由格式答案更清晰，則省略表格
   - 從不要求使用者重述他們已經說過的話
   - 避免推測性類別（無幻覺）。如果不確定，明確詢問："確認 X 是否屬於範圍。"

   互動不可能時的預設值：
   - 深度：標準
   - 受眾：如果與程式碼相關則為 Reviewer (PR)；否則為 Author
   - 焦點：前 2 個相關性聚類

   輸出問題（標籤 Q1/Q2/Q3）。答案後：如果 ≥2 個場景類別（Alternate / Exception / Recovery / Non-Functional domain）仍不清楚，您可以詢問最多兩個額外的針對性跟進（Q4/Q5），每個都有單行理由（例如："未解決的復原路徑風險"）。總計不超過五個問題。如果使用者明確拒絕更多，則跳過升級。

3. **理解使用者請求**：結合 `$ARGUMENTS` + 澄清答案：
   - 推導檢查清單主題（例如：security、review、deploy、ux）
   - 整合使用者提及的明確必須項目
   - 將焦點選擇映射到類別腳手架
   - 從 spec/plan/tasks 推斷任何缺失的上下文（不要幻覺）

4. **載入功能上下文**：從 FEATURE_DIR 讀取：
   - spec.md：功能需求和範圍
   - plan.md（如果存在）：技術細節、依賴
   - tasks.md（如果存在）：實作任務

   **上下文載入策略**：
   - 僅載入與活躍焦點領域相關的必要部分（避免完整文件傾倒）
   - 偏好將長部分總結為簡潔的場景/需求項目符號
   - 使用漸進式揭露：僅在偵測到差距時新增跟進檢索
   - 如果來源文件很大，產生臨時摘要項目而不是嵌入原始文字

5. **產生檢查清單**——建立「需求的單元測試」：
   - 如果不存在，建立 `FEATURE_DIR/checklists/` 目錄
   - 產生唯一的檢查清單檔案名稱：
     - 使用基於領域的簡短、描述性名稱（例如：`ux.md`、`api.md`、`security.md`）
     - 格式：`[domain].md`
     - 如果檔案存在，附加到現有檔案
   - 從 CHK001 開始順序編號項目
   - 每個 `/speckit.checklist` 執行建立一個新檔案（從不覆蓋現有檢查清單）

   **核心原則——測試需求，而不是實作**：
   每個檢查清單項目必須評估需求本身是否符合：
   - **完整性**：所有必要的需求是否都存在？
   - **清晰度**：需求是否明確且具體？
   - **一致性**：需求是否彼此對齊？
   - **可衡量性**：需求是否可以客觀驗證？
   - **覆蓋率**：所有場景/邊界案例是否都被涵蓋？

   **類別結構**——按需求品質維度分組項目：
   - **需求完整性**（所有必要的需求是否已記錄？）
   - **需求清晰度**（需求是否具體且明確？）
   - **需求一致性**（需求是否無衝突地對齊？）
   - **驗收標準品質**（成功標準是否可衡量？）
   - **場景覆蓋率**（所有流程/案例是否都被涵蓋？）
   - **邊界案例覆蓋率**（邊界條件是否已定義？）
   - **非功能需求**（效能、安全性、無障礙等——它們是否已指定？）
   - **依賴與假設**（它們是否已記錄並驗證？）
   - **歧義與衝突**（什麼需要澄清？）
   
   **如何撰寫檢查清單項目——「英文的單元測試」**：

   ❌ **錯誤**（測試實作）：
   - "驗證登陸頁面顯示 3 個劇集卡片"
   - "測試懸停狀態在桌面上運作"
   - "確認標誌點擊導航至首頁"

   ✅ **正確**（測試需求品質）：
   - "精選劇集的確切數量和佈局是否已指定？" [完整性]
   - "'顯著顯示' 是否以具體的尺寸/定位量化？" [清晰度]
   - "懸停狀態需求是否在所有互動元素中一致？" [一致性]
   - "所有互動 UI 的鍵盤導航需求是否已定義？" [覆蓋率]
   - "標誌圖片載入失敗時的後備行為是否已指定？" [邊界案例]
   - "非同步劇集資料的載入狀態是否已定義？" [完整性]
   - "規格是否定義了競爭 UI 元素的視覺層次？" [清晰度]

   **項目結構**：
   每個項目應該遵循此模式：
   - 詢問需求品質的問題格式
   - 專注於規格/計劃中已寫入（或未寫入）的內容
   - 在括號中包含品質維度 [完整性/清晰度/一致性/等]
   - 檢查現有需求時參考規格部分 `[Spec §X.Y]`
   - 檢查缺失需求時使用 `[Gap]` 標記
   
   **按品質維度的範例**：

   完整性：
   - "所有 API 故障模式的錯誤處理需求是否已定義？ [Gap]"
   - "所有互動元素的可及性需求是否已指定？ [完整性]"
   - "響應式佈局的行動斷點需求是否已定義？ [Gap]"

   清晰度：
   - "'快速載入' 是否以具體的時序閾值量化？ [清晰度, Spec §NFR-2]"
   - "'相關劇集' 選擇標準是否明確定義？ [清晰度, Spec §FR-5]"
   - "'顯著' 是否以可衡量的視覺屬性定義？ [歧義, Spec §FR-4]"

   一致性：
   - "導航需求是否在所有頁面中對齊？ [一致性, Spec §FR-10]"
   - "卡片元件需求是否在登陸和詳細頁面間一致？ [一致性]"

   覆蓋率：
   - "零狀態場景的需求是否已定義（無劇集）？ [覆蓋率, 邊界案例]"
   - "並發使用者互動場景是否被處理？ [覆蓋率, Gap]"
   - "部分資料載入失敗的需求是否已指定？ [覆蓋率, 異常流程]"

   可衡量性：
   - "視覺層次需求是否可衡量/測試？ [驗收標準, Spec §FR-1]"
   - "'平衡的視覺重量' 是否可以客觀驗證？ [可衡量性, Spec §FR-2]"

   **場景分類與覆蓋率**（需求品質焦點）：
   - 檢查是否存在以下場景的需求：主要、替代、異常/錯誤、復原、非功能場景
   - 對於每個場景類別，詢問：" [場景類型] 需求是否完整、清晰且一致？"
   - 如果場景類別缺失：" [場景類型] 需求是有意排除還是缺失？ [Gap]"
   - 當狀態變異發生時包含彈性/復原："遷移失敗的復原需求是否已定義？ [Gap]"

   **追蹤要求**：
   - 最低限度：≥80% 的項目必須包含至少一個追蹤參考
   - 每個項目應參考：規格部分 `[Spec §X.Y]`，或使用標記：`[Gap]`、`[Ambiguity]`、`[Conflict]`、`[Assumption]`
   - 如果沒有 ID 系統存在："需求和驗收標準 ID 方案是否已建立？ [追蹤]"

   **發現並解決問題**（需求品質問題）：
   詢問關於需求本身的問題：
   - 歧義："術語 'fast' 是否以具體指標量化？ [歧義, Spec §NFR-1]"
   - 衝突："§FR-10 和 §FR-10a 間的導航需求是否衝突？ [衝突]"
   - 假設："『始終可用的 podcast API』假設是否已驗證？ [假設]"
   - 依賴："外部 podcast API 需求是否已記錄？ [依賴, Gap]"
   - 缺失定義："『視覺層次』是否以可衡量標準定義？ [Gap]"

   **內容整合**：
   - 軟性上限：如果原始候選項目 > 40，按風險/影響優先排序
   - 合併檢查相同需求方面的近似重複項目
   - 如果 >5 個低影響邊界案例，建立一個項目："邊界案例 X、Y、Z 是否在需求中被處理？ [覆蓋率]"

   **🚫 絕對禁止**——這些使它成為實作測試，而不是需求測試：
   - ❌ 以 "Verify"、"Test"、"Confirm"、"Check" + 實作行為開頭的任何項目
   - ❌ 參考程式碼執行、使用者動作、系統行為
   - ❌ "Displays correctly"、"works properly"、"functions as expected"
   - ❌ "Click"、"navigate"、"render"、"load"、"execute"
   - ❌ 測試案例、測試計劃、QA 程序
   - ❌ 實作細節（框架、API、演算法）

   **✅ 所需模式**——這些測試需求品質：
   - ✅ "[需求類型] 是否為 [場景] 定義/指定/記錄？"
   - ✅ "[模糊術語] 是否以具體標準量化/澄清？"
   - ✅ "[部分 A] 和 [部分 B] 間的需求是否一致？"
   - ✅ "[需求] 是否可以客觀衡量/驗證？"
   - ✅ "[邊界案例/場景] 是否在需求中被處理？"
   - ✅ "規格是否定義了 [缺失方面]？"

6. **結構參考**：按照 `templates/checklist-template.md` 中的標準模板產生檢查清單，包括標題、元部分、類別標題和 ID 格式。如果模板不可用，使用：H1 標題、目的/建立元行、`##` 類別部分包含 `- [ ] CHK### <需求項目>` 行，全域遞增 ID 從 CHK001 開始。

7. **報告**：輸出建立檢查清單的完整路徑、項目計數，並提醒使用者每次執行建立一個新檔案。總結：
   - 選定的焦點領域
   - 深度等級
   - 角色/時機
   - 任何明確的使用者指定必須項目已納入

**重要**：每個 `/speckit.checklist` 命令呼叫使用簡短、描述性名稱建立檢查清單檔案，除非檔案已存在。這允許：

- 不同類型的多個檢查清單（例如：`ux.md`、`test.md`、`security.md`）
- 指示檢查清單目的的簡單、易記檔案名稱
- 在 `checklists/` 資料夾中輕鬆識別和導航

為避免雜亂，請使用描述性類型並在完成時清理過時的檢查清單。

## 範例檢查清單類型與樣本項目

**UX 需求品質：** `ux.md`

樣本項目（測試需求，而不是實作）：
- "視覺層次需求是否以可衡量標準定義？ [清晰度, Spec §FR-1]"
- "UI 元素的數量和定位是否明確指定？ [完整性, Spec §FR-1]"
- "互動狀態需求（懸停、焦點、活躍）是否一致定義？ [一致性]"
- "所有互動元素的可及性需求是否已指定？ [覆蓋率, Gap]"
- "圖片載入失敗時的後備行為是否已定義？ [邊界案例, Gap]"
- "'顯著顯示' 是否可以客觀衡量？ [可衡量性, Spec §FR-4]"

**API 需求品質：** `api.md`

樣本項目：
- "所有故障場景的錯誤回應格式是否已指定？ [完整性]"
- "速率限制需求是否以具體閾值量化？ [清晰度]"
- "認證需求是否在所有端點間一致？ [一致性]"
- "外部依賴的重試/超時需求是否已定義？ [覆蓋率, Gap]"
- "版本控制策略是否在需求中記錄？ [Gap]"

**效能需求品質：** `performance.md`

樣本項目：
- "效能需求是否以具體指標量化？ [清晰度]"
- "所有關鍵使用者旅程的效能目標是否已定義？ [覆蓋率]"
- "不同載入條件下的效能需求是否已指定？ [完整性]"
- "效能需求是否可以客觀衡量？ [可衡量性]"
- "高載入場景的降級需求是否已定義？ [邊界案例, Gap]"

**安全性需求品質：** `security.md`

樣本項目：
- "所有受保護資源的認證需求是否已指定？ [覆蓋率]"
- "敏感資訊的資料保護需求是否已定義？ [完整性]"
- "威脅模型是否已記錄且需求與之對齊？ [追蹤]"
- "安全性需求是否與合規義務一致？ [一致性]"
- "安全性故障/違規回應需求是否已定義？ [Gap, 異常流程]"

## 反面範例：什麼不該做

**❌ 錯誤——這些測試實作，而不是需求：**

```markdown
- [ ] CHK001 - 驗證登陸頁面顯示 3 個劇集卡片 [Spec §FR-001]
- [ ] CHK002 - 測試懸停狀態在桌面上正確運作 [Spec §FR-003]
- [ ] CHK003 - 確認標誌點擊導航至首頁 [Spec §FR-010]
- [ ] CHK004 - 檢查相關劇集部分顯示 3-5 個項目 [Spec §FR-005]
```

**✅ 正確——這些測試需求品質：**

```markdown
- [ ] CHK001 - 精選劇集的數量和佈局是否明確指定？ [完整性, Spec §FR-001]
- [ ] CHK002 - 懸停狀態需求是否為所有互動元素一致定義？ [一致性, Spec §FR-003]
- [ ] CHK003 - 所有可點擊品牌元素的導航需求是否清晰？ [清晰度, Spec §FR-010]
- [ ] CHK004 - 相關劇集的選擇標準是否已記錄？ [Gap, Spec §FR-005]
- [ ] CHK005 - 非同步劇集資料的載入狀態需求是否已定義？ [Gap]
- [ ] CHK006 - "視覺層次" 需求是否可以客觀衡量？ [可衡量性, Spec §FR-001]
```

**關鍵差異：**
- 錯誤：測試系統是否正確運作
- 正確：測試需求是否正確撰寫
- 錯誤：行為驗證
- 正確：需求品質驗證
- 錯誤："它是否做 X？"
- 正確："X 是否明確指定？"
