---
description: 基於可用的設計工件為功能產生可執行、有依賴順序的 tasks.md。
scripts:
  sh: scripts/bash/check-prerequisites.sh --json
  ps: scripts/powershell/check-prerequisites.ps1 -Json
---

## 使用者輸入

```text
$ARGUMENTS
```

如果不為空，您**必須**在繼續之前考慮使用者輸入。

## 大綱

1. **設定**：從儲存庫根目錄執行 `{SCRIPT}` 並解析 FEATURE_DIR 和 AVAILABLE_DOCS 清單。所有路徑必須為絕對路徑。

2. **載入設計文件**：從 FEATURE_DIR 讀取：
   - **必要**：plan.md（技術棧、程式庫、結構）、spec.md（具有優先級的使用者故事）
   - **選用**：data-model.md（實體）、contracts/（API 端點）、research.md（決定）、quickstart.md（測試場景）
   - 注意：並非所有專案都有所有文件。根據可用的內容產生任務。

3. **執行任務產生工作流程**（遵循模板結構）：
   - 載入 plan.md 並提取技術棧、程式庫、專案結構
   - **載入 spec.md 並提取具有優先級的使用者故事（P1、P2、P3 等）**
   - 如果 data-model.md 存在：提取實體 → 映射到使用者故事
   - 如果 contracts/ 存在：每個檔案 → 映射端點到使用者故事
   - 如果 research.md 存在：提取決定 → 產生設定任務
   - **按使用者故事產生任務**：
     - 設定任務（所有故事需要的共享基礎設施）
     - **基礎任務（任何使用者故事開始前必須完成的先決條件）**
     - 對於每個使用者故事（按優先順序 P1、P2、P3...）：
       - 分組完成該故事所需的所有任務
       - 包含該故事特定的模型、服務、端點、UI 元件
       - 標記哪些任務是 [P] 可平行化的
       - 如果請求測試：包含該故事特定的測試
     - 潤飾/整合任務（跨切面關注點）
   - **測試是可選的**：僅在功能規格中明確請求或使用者要求 TDD 方法時產生測試任務
   - 應用任務規則：
     - 不同檔案 = 標記 [P] 為平行
     - 相同檔案 = 順序（無 [P]）
     - 如果請求測試：在實作前測試（TDD 順序）
   - 順序編號任務（T001、T002...）
   - 產生顯示使用者故事完成順序的依賴圖
   - 為每個使用者故事建立平行執行範例
   - 驗證任務完整性（每個使用者故事都有所有需要的任務，獨立可測試）

4. **產生 tasks.md**：使用 `.specify/templates/tasks-template.md` 作為結構，填寫：
   - 從 plan.md 取得正確的功能名稱
   - 階段 1：設定任務（專案初始化）
   - 階段 2：基礎任務（所有使用者故事的阻擋性先決條件）
   - 階段 3+：每個使用者故事一個階段（從 spec.md 按優先順序）
     - 每個階段包含：故事目標、獨立測試標準、測試（如果請求）、實作任務
     - 每個任務的清晰 [Story] 標籤（US1、US2、US3...）
     - 每個故事中可平行化任務的 [P] 標記
     - 每個故事階段後的檢查點標記
   - 最終階段：潤飾與跨切面關注點
   - 按執行順序編號的任務（T001、T002...）
   - 每個任務的清晰檔案路徑
   - 顯示故事完成順序的依賴部分
   - 每個故事的平行執行範例
   - 實作策略部分（先 MVP、增量交付）

5. **報告**：輸出產生 tasks.md 的路徑和摘要：
   - 總任務計數
   - 每個使用者故事的任務計數
   - 識別的平行機會
   - 每個故事的獨立測試標準
   - 建議的 MVP 範圍（通常只是使用者故事 1）

任務產生的上下文：{ARGS}

tasks.md 應該是立即可執行的——每個任務必須足夠具體，讓 LLM 可以在沒有額外上下文的情況下完成它。

## 任務產生規則

**重要**：測試是可選的。僅在使用者明確請求測試或功能規格中要求 TDD 方法時產生測試任務。

**關鍵**：任務必須按使用者故事組織，以實現獨立的實作和測試。

1. **從使用者故事（spec.md）**——主要組織：
   - 每個使用者故事（P1、P2、P3...）獲得自己的階段
   - 將所有相關元件映射到他們的故事：
     - 該故事需要的模型
     - 該故事需要的服務
     - 該故事需要的端點/UI
     - 如果請求測試：該故事特定的測試
   - 標記故事依賴（大多數故事應該是獨立的）
   
2. **從契約**：
   - 映射每個契約/端點 → 到它服務的使用者故事
   - 如果請求測試：每個契約 → 在該故事階段中實作前的契約測試任務 [P]

3. **從資料模型**：
   - 映射每個實體 → 到需要它的使用者故事
   - 如果實體服務多個故事：放在最早的故事或設定階段
   - 關係 → 適當故事階段中的服務層任務

4. **從設定/基礎設施**：
   - 共享基礎設施 → 設定階段（階段 1）
   - 基礎/阻擋任務 → 基礎階段（階段 2）
     - 範例：資料庫架構設定、認證框架、核心程式庫、基礎配置
     - 這些必須在任何使用者故事實作前完成
   - 故事特定設定 → 在該故事階段內

5. **順序**：
   - 階段 1：設定（專案初始化）
   - 階段 2：基礎（阻擋性先決條件——必須在使用者故事前完成）
   - 階段 3+：按優先順序的使用者故事（P1、P2、P3...）
     - 在每個故事內：測試（如果請求）→ 模型 → 服務 → 端點 → 整合
   - 最終階段：潤飾與跨切面關注點
   - 每個使用者故事階段應該是一個完整、獨立可測試的增量

