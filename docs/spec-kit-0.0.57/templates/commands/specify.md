---
description: 從自然語言功能描述建立或更新功能規格。
scripts:
  sh: scripts/bash/create-new-feature.sh --json "{ARGS}"
  ps: scripts/powershell/create-new-feature.ps1 -Json "{ARGS}"
---

## 使用者輸入

```text
$ARGUMENTS
```

如果不為空，您**必須**在繼續之前考慮使用者輸入。

## 大綱

使用者在觸發訊息中 `/speckit.specify` 後輸入的文字**就是**功能描述。即使 `{ARGS}` 在下面顯示為字面值，也假設您在此對話中始終可以取得它。除非使用者提供了空命令，否則不要要求使用者重複它。

給定該功能描述，請執行以下操作：

1. 從儲存庫根目錄執行腳本 `{SCRIPT}` 並解析其 JSON 輸出以取得 BRANCH_NAME 和 SPEC_FILE。所有文件路徑必須為絕對路徑。
  **重要** 您只能執行此腳本一次。JSON 在終端機中作為輸出提供——始終參考它以取得您要找的實際內容。
2. 載入 `templates/spec-template.md` 以了解必要部分。

3. 遵循此執行流程：

    1. 從輸入解析使用者描述
       如果為空：錯誤 "未提供功能描述"
    2. 從描述提取關鍵概念
       識別：角色、動作、資料、約束
    3. 對於不清楚的方面：
       - 基於上下文和業界標準做出明智猜測
       - 僅在以下情況標記 [NEEDS CLARIFICATION: 具體問題]：
         - 選擇顯著影響功能範圍或使用者體驗
         - 存在多個合理解釋且有不同影響
         - 沒有合理的預設值
       - **限制：總共最多 3 個 [NEEDS CLARIFICATION] 標記**
       - 按影響優先處理澄清：範圍 > 安全性/隱私 > 使用者體驗 > 技術細節
    4. 填寫使用者場景與測試部分
       如果沒有清晰的使用者流程：錯誤 "無法確定使用者場景"
    5. 產生功能需求
       每個需求必須可測試
       對未指定的細節使用合理預設值（在假設部分記錄假設）
    6. 定義成功標準
       建立可衡量、技術無關的結果
       包含定量指標（時間、效能、量）和定性指標（使用者滿意度、任務完成）
       每個標準必須在沒有實作細節的情況下可驗證
    7. 識別關鍵實體（如果涉及資料）
    8. 回傳：成功（規格準備規劃）

4. 使用模板結構將規格寫入 SPEC_FILE，用從功能描述（引數）推導出的具體細節替換占位符，同時保留部分順序和標題。

5. **規格品質驗證**：寫入初始規格後，根據品質標準驗證它：

   a. **建立規格品質檢查清單**：使用檢查清單模板結構在 `FEATURE_DIR/checklists/requirements.md` 產生檢查清單檔案，包含這些驗證項目：

      ```markdown
      # 規格品質檢查清單：[功能名稱]

      **目的**：在繼續規劃前驗證規格完整性和品質
      **建立日期**：[日期]
      **功能**：[連結到 spec.md]

      ## 內容品質

      - [ ] 沒有實作細節（語言、框架、API）
      - [ ] 專注於使用者價值和業務需求
      - [ ] 為非技術利害關係人撰寫
      - [ ] 所有強制性部分已完成

      ## 需求完整性

      - [ ] 沒有剩餘的 [NEEDS CLARIFICATION] 標記
      - [ ] 需求可測試且明確
      - [ ] 成功標準可衡量
      - [ ] 成功標準是技術無關的（無實作細節）
      - [ ] 所有驗收場景已定義
      - [ ] 邊界案例已識別
      - [ ] 範圍已清楚界定
      - [ ] 依賴和假設已識別

      ## 功能準備度

      - [ ] 所有功能需求都有清晰的驗收標準
      - [ ] 使用者場景涵蓋主要流程
      - [ ] 功能符合成功標準中定義的可衡量結果
      - [ ] 沒有實作細節滲入規格

      ## 註記

      - 標記為未完成的项目在 `/speckit.clarify` 或 `/speckit.plan` 前需要更新規格
      ```

   b. **執行驗證檢查**：根據每個檢查清單項目審查規格：
      - 對於每個項目，確定通過或失敗
      - 記錄發現的具體問題（引用相關規格部分）
   
   c. **處理驗證結果**：

      - **如果所有項目通過**：標記檢查清單完成並繼續到步驟 6

      - **如果項目失敗（不包括 [NEEDS CLARIFICATION]）**：
        1. 列出失敗項目和具體問題
        2. 更新規格以解決每個問題
        3. 重新執行驗證直到所有項目通過（最多 3 次迭代）
        4. 如果 3 次迭代後仍失敗，在檢查清單註記中記錄剩餘問題並警告使用者

      - **如果 [NEEDS CLARIFICATION] 標記仍存在**：
        1. 從規格中提取所有 [NEEDS CLARIFICATION: ...] 標記
        2. **限制檢查**：如果存在超過 3 個標記，僅保留最關鍵的 3 個（按範圍/安全性/UX 影響），其餘進行明智猜測
        3. 對於每個需要的澄清（最多 3 個），以此格式向使用者提出選項：

           ```markdown
           ## 問題 [N]：[主題]

           **上下文**：[引用相關規格部分]

           **我們需要知道什麼**：[來自 NEEDS CLARIFICATION 標記的具體問題]

           **建議答案**：

           | 選項 | 答案 | 影響 |
           |------|------|------|
           | A    | [第一個建議答案] | [這對功能意味著什麼] |
           | B    | [第二個建議答案] | [這對功能意味著什麼] |
           | C    | [第三個建議答案] | [這對功能意味著什麼] |
           | 自訂 | 提供您自己的答案 | [解釋如何提供自訂輸入] |

           **您的選擇**：_[等待使用者回應]_
           ```

        4. **關鍵——表格格式**：確保 markdown 表格正確格式化：
           - 使用一致間距，管道對齊
           - 每個儲存格應有內容周圍的空格：`| 內容 |` 而不是 `|內容|`
           - 標題分隔符必須至少有 3 個破折號：`|--------|`
           - 測試表格在 markdown 預覽中正確呈現
        5. 依序編號問題（Q1、Q2、Q3——總共最多 3 個）
        6. 在等待回應前一起呈現所有問題
        7. 等待使用者回應所有問題的選擇（例如："Q1: A, Q2: 自訂 - [細節], Q3: B"）
        8. 通過替換每個 [NEEDS CLARIFICATION] 標記為使用者選擇或提供的答案來更新規格
        9. 所有澄清解決後重新執行驗證

   d. **更新檢查清單**：每次驗證迭代後，以目前通過/失敗狀態更新檢查清單檔案

6. 報告完成，包括分支名稱、規格檔案路徑、檢查清單結果，以及下一個階段的準備度（`/speckit.clarify` 或 `/speckit.plan`）。

**註記：**腳本在寫入前建立並簽出新分支並初始化規格檔案。

## 一般指南

## 快速指南

- 專注於使用者需要**什麼**以及**為什麼**。
- 避免如何實作（無技術棧、API、程式碼結構）。
- 為業務利害關係人撰寫，而不是開發者。
- 不要在規格中建立任何嵌入的檢查清單。那將是單獨的命令。

### 部分要求

- **強制性部分**：每個功能都必須完成
- **選用部分**：僅在與功能相關時包含
- 當部分不適用時，完全移除它（不要留下 "N/A"）

### 適用於 AI 產生

從使用者提示建立此規格時：

1. **做出明智猜測**：使用上下文、業界標準和常見模式填補差距
2. **記錄假設**：在假設部分記錄合理預設值
3. **限制澄清**：最多 3 個 [NEEDS CLARIFICATION] 標記——僅用於關鍵決定，這些決定：
   - 顯著影響功能範圍或使用者體驗
   - 有多個合理解釋且有不同影響
   - 缺乏任何合理預設值
4. **優先處理澄清**：範圍 > 安全性/隱私 > 使用者體驗 > 技術細節
5. **像測試者一樣思考**：每個模糊需求都應該在 "可測試且明確" 檢查清單項目中失敗
6. **需要澄清的常見領域**（僅在沒有合理預設值時）：
   - 功能範圍和邊界（包含/排除特定使用案例）
   - 使用者類型和權限（如果可能有衝突的多重解釋）
   - 安全/合規要求（當法律/財務上重要時）
   
**合理預設值的範例**（不要詢問這些）：

- 資料保留：領域的業界標準實務
- 效能目標：標準網頁/行動應用程式期望值，除非指定
- 錯誤處理：使用者友善的訊息和適當的後備
- 認證方法：網頁應用的標準基於會話或 OAuth2
- 整合模式：RESTful API，除非另行指定

### 成功標準指南

成功標準必須是：

1. **可衡量**：包含具體指標（時間、百分比、計數、速率）
2. **技術無關**：不提及框架、語言、資料庫或工具
3. **以使用者為中心**：從使用者/業務視角描述結果，而不是系統內部
4. **可驗證**：可以在不知道實作細節的情況下測試/驗證

**良好範例**：

- "使用者可以在 3 分鐘內完成結帳"
- "系統支援 10,000 個並發使用者"
- "95% 的搜尋在 1 秒內返回結果"
- "任務完成率改善 40%"

**不良範例**（實作導向）：

- "API 回應時間在 200ms 以下"（太技術性，使用 "使用者立即看到結果"）
- "資料庫可以處理 1000 TPS"（實作細節，使用面向使用者的指標）
- "React 元件有效呈現"（框架特定）
- "Redis 快取命中率高於 80%"（技術特定）
