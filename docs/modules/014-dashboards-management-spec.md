# Feature Specification: Dashboards Management

**Created**: 2025-10-10
**Status**: Ready for Technical Review
**Based on**: `.specify/memory/constitution.md` (v1.3.0)

---

## 一、主要使用者情境（User Scenarios & Testing）

### Primary User Story
作為一名 SRE 或平台管理員，我需要在平台內快速切換與管理多個儀表板，包括平台內建儀表板（官方維護版本）與連結的 Grafana 儀表板（自訂或外部擴充），以便在單一介面中觀察系統狀態並根據需要擴展分析能力，無需在多個系統間跳轉。

#### 具體情境:
- **日常監控**: 登入平台後，我需要立即看到預設的系統概覽儀表板，快速評估所有關鍵服務的健康狀態。
- **深度分析**: 當發現異常指標時，我需要切換至專門的效能分析或錯誤追蹤儀表板，進行根因分析。
- **自訂擴展**: 當平台內建儀表板無法滿足特定需求時，我需要連結團隊在 Grafana 中已建立的自訂儀表板，並將其整合至平台選單中，方便全團隊存取。

#### 現有痛點:
- **多系統跳轉**: 若無統一管理介面，團隊成員需記憶多個不同的 Grafana URL，增加操作複雜度與認知負擔。
- **版本衝突與設定丟失**: 內建與外部儀表板混雜時，容易誤編輯或覆蓋官方維護的版本，導致平台升級時自訂設定丟失。
- **導航效率低下**: 缺乏預設首頁設定時，每次登入都需手動導航至常用儀表板，浪費時間。

### Acceptance Scenarios

#### 場景群組 A：儀表板清單管理 (3 個)
1.  **Given** 我在儀表板管理頁面中, **When** 我查看儀表板清單, **Then** 系統應顯示所有「內建」與「外部」儀表板，並以標籤區分來源。
2.  **Given** 我想比較內建與外部儀表板的差異, **When** 我打開儀表板資訊側欄, **Then** 系統應顯示版本、來源、上次同步時間與授權資訊。
3.  **Given** 我瀏覽儀表板清單, **When** 點擊書籤圖示, **Then** 該儀表板應被標記為我的個人書籤，並顯示於清單頂部。

#### 場景群組 B：外部 Grafana 儀表板連結 (2 個)
4.  **Given** 我需要新增外部 Grafana 儀表板, **When** 我輸入 Grafana UID 或完整 URL 並確認, **Then** 系統應驗證儀表板是否存在並成功建立連結，且該儀表板可立即載入顯示。
5.  **Given** 我希望使用平台提供的「主機監控」儀表板作為首頁, **When** 我在設定中選擇該內建儀表板, **Then** 系統應允許將其設為首頁或顯示於選單中，內建儀表板不可編輯或複製。

#### 場景群組 C：顯示模式與偏好設定 (3 個)
6.  **Given** 我想在首頁自動顯示常用儀表板, **When** 我設定「預設儀表板」並儲存, **Then** 下次登入後首頁應自動導向該儀表板。
7.  **Given** 我需要依不同場景切換儀表板呈現方式, **When** 我切換「顯示模式」為「標準」、「全螢幕」或「聚焦面板」, **Then** 系統應即時重新渲染視圖並記住我的選擇。
8.  **Given** 我切換排序為「最近使用」, **When** 我重新開啟儀表板管理頁, **Then** 系統應自動保留我的排序偏好設定。

#### 場景群組 D：整合情境與跨裝置同步 (1 個)
9.  **Given** 我在不同裝置登入同帳號, **When** 開啟儀表板清單, **Then** 書籤狀態應同步出現在同一帳號的所有登入環境中。

---

## 二、功能需求（Functional Requirements）

### 2.1. 儀表板類型與清單管理 (Dashboard Types & List Management)
| 編號 | 說明 |
|------|------|
| **FR-DT-001** | 系統必須（MUST）支援「內建」與「外部」兩種類型的儀表板。 |
| **FR-DT-002** | 內建儀表板必須（MUST）為唯讀，不可編輯或複製。 |
| **FR-DT-003** | 儀表板清單必須（MUST）支援搜尋、排序與分頁功能。 |

### 2.2. 外部 Grafana 整合 (External Grafana Integration)
| 編號 | 說明 |
|------|------|
| **FR-EG-001** | 系統必須（MUST）允許透過 Grafana UID 或 URL 新增外部儀表板連結。 |
| **FR-EG-002** | 新增時必須（MUST）驗證儀表板是否存在且可存取。 |

### 2.3. 顯示模式與視圖控制 (Display Modes & View Control)
| 編號 | 說明 |
|------|------|
| **FR-DV-001** | 系統必須（MUST）提供標準模式、全螢幕模式、聚焦面板模式。 |
| **FR-DV-002** | 系統必須（MUST）提供自動刷新間隔設定。 |

### 2.4. 使用者偏好與書籤 (User Preferences & Bookmarks)
| 編號 | 說明 |
|------|------|
| **FR-UP-001** | 使用者必須（MUST）可設定個人預設儀表板。 |
| **FR-UP-002** | 使用者可（MAY）將任何儀表板標記為「書籤」。 |
| **FR-UP-003** | 書籤與排序偏好必須（MUST）跨裝置同步。 |

### 2.5. 審計與版本控制 (Audit & Version Control)
| 編號 | 說明 |
|------|------|
| **FR-AV-001** | 系統必須（MUST）記錄所有新增、刪除、同步儀表板的操作至審計日誌。 |
| **FR-AV-002** | 內建儀表板版本更新時，系統應（SHOULD）自動記錄版本變更。 |

### 2.6. 未來擴展 (Future Enhancements)
| 編號 | 說明 |
|------|------|
| **FR-FE-001** | [FUTURE] 支援場景：整合 Grafana Scenes Dashboard 為內建儀表板。 |
| **FR-FE-002** | [FUTURE] 支援儀表板共用設定匯出／匯入。 |

---

## 三、權限控制（RBAC）

| 權限字串 | 描述 |
|-----------|------|
| `dashboards:read` | 檢視儀表板清單與內容。 |
| `dashboards:edit` | 修改或複製內建儀表板。 |
| `dashboards:link` | 新增外部 Grafana 儀表板連結。 |
| `dashboards:delete` | 刪除使用者自訂或外部儀表板。 |
| `dashboards:sync` | 同步外部 Grafana 儀表板內容。 |

---

## 四、觀測性與治理檢查（Observability & Governance）

| 項目 | 狀態 | 說明 |
|------|------|------|
| Logging / Audit | ✅ | 所有新增、同步、刪除操作須記錄審計。 |
| Metrics | ✅ | 記錄儀表板使用頻率與平均載入時間。 |
| RBAC | ✅ | 嚴格依使用者角色顯示與控制操作權限。 |
| Theme / i18n | ✅ | 使用多語系與語義化樣式。 |
| [FUTURE] Integration | ⚙️ | 未來版本支援 Grafana Scenes 整合。 |