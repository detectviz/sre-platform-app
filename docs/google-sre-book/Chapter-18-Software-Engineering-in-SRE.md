# SRE 中的軟體工程

作者：Dave Helstroom 和 Trisha Weir，與 Evan Leonard 和 Kurt Delimon 合著
編輯：Kavita Guliani

如果你請人說出一項 Google 的軟體工程成果，他們很可能會列出像 Gmail 或地圖這樣的消費者產品；有些人甚至可能提到像 Bigtable 或 Colossus 這樣的底層基礎設施。但事實上，有大量的幕後軟體工程是消費者永遠看不到的。其中一些產品是在 SRE 內部開發的。

從某些方面來看，Google 的生產環境是人類有史以來建造過最複雜的機器之一。SRE 對生產環境的複雜性有第一手的經驗，這使得他們非常適合開發適當的工具來解決與維持生產環境運作相關的內部問題和使用案例。這些工具大多數都與維持正常執行時間和保持低延遲的總體指令有關，但形式多樣：例如二進位檔案的推出機制、監控，或建立在動態伺服器組合上的開發環境。總體而言，這些由 SRE 開發的工具是成熟的軟體工程專案，不同於一次性的解決方案和快速的修補，而開發這些工具的 SRE 們已經採用了以產品為基礎的心態，同時考慮到內部客戶和未來計畫的路線圖。

## 為什麼 SRE 內部的軟體工程很重要？

在許多方面，Google 生產環境的巨大規模使得內部軟體開發成為必需，因為很少有第三方工具的設計規模能滿足 Google 的需求。公司成功的軟體專案歷史讓我們體會到直接在 SRE 內部開發的好處。

SRE 在有效開發內部軟體方面處於獨特的地位，原因有幾個：

- SRE 組織內 Google 特定生產知識的廣度和深度使其工程師能夠設計和創造軟體，並適當考慮到可擴展性、故障期間的優雅降級以及與其他基礎設施或工具輕鬆介面的能力等維度。
- 因為 SRE 深入了解主題，他們很容易理解正在開發的工具的需求和要求。
- 與目標使用者——同為 SRE 的同事——的直接關係產生了坦率和高信號的使用者回饋。將工具發布給對問題領域非常熟悉的內部受眾，意味著開發團隊可以更快地啟動和迭代。內部使用者通常對最簡化的 UI 和其他 alpha 產品問題更為理解。

從純粹務實的角度來看，Google 顯然受益於讓具有 SRE 經驗的工程師開發軟體。經過刻意設計，SRE 支援的服務的成長速度超過了 SRE 組織的成長速度；SRE 的指導原則之一是「團隊規模不應與服務成長成正比」。在服務呈指數級增長的情況下實現團隊線性增長，需要持續的自動化工作和努力簡化工具、流程以及服務的其他方面，這些方面會給生產的日常運營帶來低效率。讓具有直接運行生產系統經驗的人開發最終有助於正常執行時間和延遲目標的工具，是非常有道理的。

另一方面，個別 SRE 以及更廣泛的 SRE 組織也從 SRE 驅動的軟體開發中受益。

SRE 內部成熟的軟體開發專案為 SRE 提供了職業發展機會，也為那些不希望自己的編碼技能生疏的工程師提供了一個出口。長期專案工作為中斷和隨叫隨到的工作提供了急需的平衡，並且可以為那些希望其職業生涯在軟體工程和系統工程之間保持平衡的工程師提供工作滿足感。

除了設計自動化工具和減少 SRE 工程師工作量的其他努力之外，軟體開發專案還可以透過吸引和幫助留住具有各種技能的工程師，進一步使 SRE 組織受益。團隊多樣性的可取性對 SRE 來說更是如此，因為各種背景和解決問題的方法可以幫助預防盲點。為此，Google 始終致力於為其 SRE 團隊配備具有傳統軟體開發經驗的工程師和具有系統工程經驗的工程師。

# Auxon 案例研究：專案背景和問題領域

本案例研究探討了 Auxon，這是一個在 SRE 內部開發的強大工具，用於自動化 Google 生產環境中運行的服務的容量規劃。為了最好地理解 Auxon 是如何構思的以及它解決了哪些問題，我們將首先研究與容量規劃相關的問題領域，以及傳統方法在 Google 和整個行業中為服務帶來的困難。有關 Google 如何使用「服務」和「叢集」等術語的更多背景資訊，請參閱《從 SRE 的視角看 Google 的生產環境》。

## 傳統容量規劃

計算資源的容量規劃有許多策略（參見 [Hix15a]），但這些方法大多數可以歸結為一個可以近似表示的循環：

- 使用我們今天可用的最佳數據來規劃未來
- 通常涵蓋從幾個季度到數年的時間

需要強調的是，容量規劃是一個永無止境的循環：假設會改變，部署會延遲，預算會被削減，導致計畫一再修訂。而每一次修訂都會產生連鎖效應，必須在所有後續季度的計畫中傳播。例如，本季度的短缺必須在未來季度中彌補。傳統的容量規劃以需求為主要驅動因素，並手動調整供應以適應需求的每次變化。

### 天生脆弱

傳統的容量規劃產生的資源分配計畫可能會被任何看似微小的變化所打亂。例如：

- 服務的效率下降，需要比預期更多的資源來服務相同的需求。
- 客戶採用率增加，導致預計需求增加。
- 新計算資源叢集的交付日期延遲。
- 關於性能目標的產品決策改變了所需服務部署的形態（服務的「足跡」）和所需資源的數量。

微小的變化需要交叉檢查整個分配計畫，以確保計畫仍然可行；較大的變化（如資源交付延遲或產品策略變更）可能需要從頭開始重新創建計畫。單個叢集的交付延遲可能會影響多個服務的冗餘或延遲要求：其他叢集中的資源分配必須增加以彌補延遲，這些以及任何其他變化都必須在整個計畫中傳播。

此外，考慮到任何給定季度（或其他時間範圍）的容量計畫都是基於前幾個季度容量計畫的預期結果，這意味著任何一個季度的變化都會導致更新後續季度的工作。

### 費力且不精確

對於許多團隊來說，收集產生需求預測所需數據的過程緩慢且容易出錯。當需要尋找容量以滿足未來需求時，並非所有資源都同樣適用。例如，如果延遲要求意味著服務必須承諾在與使用者相同的大陸上服務使用者需求，那麼在北美獲得額外的資源將無法緩解亞洲的容量短缺。每個預測都有約束，即關於如何實現它的參數；約束從根本上與意圖有關，下一節將討論意圖。

將受約束的資源請求映射到可用容量的實際資源分配同樣緩慢：手動將請求裝箱到有限的空間中，或者找到符合有限預算的解決方案，既複雜又乏味。

這個過程可能已經描繪了一幅黯淡的畫面，但更糟糕的是，它所需要的工具通常不可靠或繁瑣。電子表格在可擴展性問題上嚴重不足，並且錯誤檢查能力有限。數據變得陳舊，追蹤變化變得困難。團隊常常被迫做出簡化的假設並降低其需求的複雜性，僅僅是為了使維持足夠的容量成為一個可處理的問題。

當服務所有者面臨將來自各種服務的一系列容量請求裝入他們可用的資源中，並以滿足服務可能具有的各種約束的方式時，會產生額外的不精確性。裝箱問題是一個 NP 困難問題，人類很難用手計算。此外，來自服務的容量請求通常是一組不靈活的需求要求：叢集 Y 中的 X 個核心。為什麼需要 X 個核心或 Y 叢集，以及圍繞這些參數的任何自由度，在請求到達試圖將一長串需求裝入可用供應的人手中時早已丟失。

最終結果是大量的人力投入，以得出一個充其量是近似的裝箱方案。該過程對變化很脆弱，並且沒有已知的最優解的界限。

## 我們的解決方案：基於意圖的容量規劃

指定需求，而不是實現。

在 Google，許多團隊已經轉向我們稱之為「基於意圖的容量規劃」的方法。這種方法的基本前提是，以程式化的方式編碼服務需求的依賴關係和參數（意圖），並使用該編碼自動生成一個分配計畫，詳細說明哪些資源分配給哪個服務，在哪個叢集中。如果需求、供應或服務要求發生變化，我們可以簡單地根據變化的參數自動生成一個新的計畫，這就是新的最佳資源分配方案。

隨著服務的真實需求和靈活性被捕捉到，容量計畫現在在面對變化時變得更加靈活，我們可以達到一個滿足盡可能多參數的最優解決方案。將裝箱問題委託給電腦後，人力勞動大大減少，服務所有者可以專注於更高層次的優先事項，如 SLO、生產依賴關係和服務基礎設施需求，而不是低層次的資源搜刮。

作為一個額外的好處，使用計算優化從意圖映射到實現可以達到更高的精度，最終為組織節省成本。裝箱問題遠非一個已解決的問題，因為某些類型仍被認為是 NP 困難的；然而，今天的演算法可以求解到一個已知的最優解。

# 基於意圖的容量規劃

意圖是服務所有者希望如何運行其服務的理由。從具體的資源需求轉向動機原因，以達到真正的容量規劃意圖，通常需要多個層次的抽象。考慮以下抽象鏈：

那麼，意圖驅動的容量規劃應該使用哪個層次的意圖呢？理想情況下，所有層次的意圖都應該被一起支持，服務在越多地轉向指定意圖而非實現時受益越多。根據 Google 的經驗，服務在跨越到第 3 步時往往能獲得最大的收益：有很好的靈活性，並且此請求的影響是以更高層次和可理解的術語表示的。特別複雜的服務可能會瞄準第 4 步。

## 意圖的前置條件

我們需要哪些資訊來捕捉服務的意圖？這就需要依賴關係、性能指標和優先級。

### 依賴關係

Google 的服務依賴於許多其他基礎設施和面向使用者的服務，這些依賴關係嚴重影響服務可以被放置在哪裡。例如，想像一個面向使用者的服務 Foo，它依賴於一個基礎設施存儲服務 Bar。Foo 表示一個要求，即 Bar 必須位於 Foo 網路延遲 30 毫秒的範圍內。這個要求對於我們在哪裡放置 Foo 和 Bar 都有重要影響，意圖驅動的容量規劃必須考慮這些約束。

此外，生產依賴關係是嵌套的：在前面的例子上進一步構建，想像服務 Bar 對於一個較低層的分散式存儲服務 Baz 和一個應用程式管理服務 Qux 有自己的依賴關係。因此，我們現在可以放置 Foo 的位置取決於我們可以放置 Bar、Baz 和 Qux 的位置。一組給定的生產依賴關係可以被共享，可能帶有關於意圖的不同規定。

### 性能指標

對一個服務的需求會涓滴而下，導致對一個或多個其他服務的需求。理解依賴關係鏈有助於形成裝箱問題的一般範圍，但我們仍然需要更多關於預期資源使用的資訊。服務 Foo 需要多少計算資源來服務 N 個使用者查詢？對於服務 Foo 的每 N 個查詢，我們期望服務 Bar 有多少 Mbps 的數據？

性能指標是依賴關係之間的黏合劑。它們將一個或多個較高層次的資源類型轉換為一個或多個較低層次的資源類型。為服務推導適當的性能指標可能涉及負載測試和資源使用監控。

### 優先級

不可避免地，資源約束會導致權衡和艱難的決定：在所有服務的眾多要求中，當容量不足時應該犧牲哪些要求？

也許服務 Foo 的 N+2 冗餘比服務 Bar 的 N+1 冗餘更重要。或者也許 X 的功能發布不如服務 Baz 的 N+0 冗餘重要。

意圖驅動的規劃迫使這些決定以透明、公開和一致的方式做出。資源約束也需要同樣的權衡，但 prioritization 往往可能是臨時的，對服務所有者不透明。基於意圖的規劃允許 prioritization 根據需要進行細粒度或粗粒度的劃分。

## Auxon 介紹

Auxon 是 Google 對基於意圖的容量規劃和資源分配解決方案的實現，也是 SRE 設計和開發的軟體工程產品的典型例子：它是由 SRE 內部的一小群軟體工程師和一名技術專案經理在兩年時間內建立的。Auxon 是一個完美的案例研究，展示了如何在 SRE 內部培養軟體開發。

Auxon 正積極用於規劃 Google 數百萬美元機器資源的使用。它已成為 Google 幾個主要部門容量規劃的關鍵組成部分。

作為一個產品，Auxon 提供了收集服務資源需求和依賴關係的基於意圖的描述的方法。這些使用者意圖被表示為所有者希望如何配置服務的要求。要求可能被指定為一個請求，如「我的服務必須是每個大陸 N+2」或「前端伺服器必須距離後端伺服器不超過 50 毫秒」。Auxon 透過使用者配置語言或程式化 API 收集這些資訊，從而將人類意圖轉換為機器可解析的約束。要求可以被優先排序，這個功能在資源不足以滿足所有要求，因此必須做出權衡時非常有用。這些要求——意圖——最終在內部表示為一個巨大的混合整數或線性規劃。Auxon 解決這個線性規劃，並使用由此產生的裝箱解決方案來制定資源分配計畫。

圖 18-1 及其後的解釋概述了 Auxon 的主要組件。

性能數據描述了服務如何擴展：對於叢集 Y 中的每個需求單位 X，使用了多少個依賴 Z 的單位？根據所討論服務的成熟度，這種擴展數據可以透過多種方式推導。一些服務進行負載測試，而其他服務則根據過去的性能推斷其擴展。

每個服務的需求預測數據描述了預測需求信號的使用趨勢。一些服務從需求預測中推導其未來使用情況——按大陸劃分的每秒查詢預測。並非所有服務都有需求預測：一些服務（例如，像 Colossus 這樣的存儲服務）的需求純粹來自於依賴它們的服務。

資源供應提供了關於基礎、基本資源可用性的數據：例如，預計在未來某個特定時間點可供使用的機器數量。在線性規劃術語中，資源供應作為一個上限，限制了服務如何增長以及服務可以被放置在哪裡。最終，我們希望在基於意圖的服務組合描述允許的情況下，最好地利用這個資源供應。

資源定價提供了關於基礎、基本資源成本的數據。例如，機器的成本可能因特定設施的空間/電力費用而在全球範圍內有所不同。在線性規劃術語中，價格告知了總體計算成本，這作為我們想要最小化的目標。

意圖配置是將基於意圖的資訊提供給 Auxon 的關鍵。它定義了什麼構成一個服務，以及服務之間如何相互關聯。該配置最終作為一個配置層，允許所有其他組件被連接在一起。它的設計是人類可讀和可配置的。

Auxon 配置語言引擎根據從意圖配置接收到的資訊採取行動。該組件制定一個機器可讀的請求：一個可以被 Auxon 求解器理解的協定緩衝區。它對配置應用輕微的健全性檢查，並被設計為人類可配置的意圖定義和機器可解析的優化請求之間的閘道。

Auxon 求解器是該工具的大腦。它根據從配置語言引擎接收到的優化請求，制定巨大的混合整數或線性規劃。它的設計具有高度可擴展性，這使得求解器可以在 Google 叢集內運行的數百甚至數千台機器上並行運行。除了混合整數線性規劃工具包外，Auxon 求解器中還有處理諸如調度、管理工作池和下降決策樹等任務的組件。

分配計畫是 Auxon 求解器的輸出。它規定了哪些資源應該分配給哪些服務，在哪些位置。它是容量規劃問題需求的基於意圖的定義的計算實現細節。分配計畫還包括有關任何無法滿足的要求的資訊——例如，如果由於缺乏資源或相互競爭的要求過於嚴格而無法滿足某個要求。

## 需求與實現：成功與經驗教訓

Auxon 最初是由一名 SRE 和一名技術專案經理構想出來的，他們各自被其團隊指派負責規劃 Google 基礎設施的很大一部分容量。由於他們在電子表格中進行過手動容量規劃，他們很清楚地了解了效率低下的地方以及透過自動化改進的機會，以及這樣一個工具可能需要的功能。

在 Auxon 的整個開發過程中，產品背後的 SRE 團隊繼續深入參與生產世界。該團隊在 Google 的多個服務的隨叫隨到輪換中保持角色，並參與這些服務的設計討論和技術領導。透過這些持續的互動，團隊能夠保持與生產世界的聯繫：他們既是自己產品的消費者，也是開發者。當產品失敗時，團隊會直接受到影響。功能請求是透過團隊自身的第一手經驗獲得的。第一手的問題領域經驗不僅為產品的成功帶來了巨大的主人翁意識，而且還有助於賦予產品在 SRE 內部的信譽和合法性。

### 近似法

不要專注於解決方案的完美和純粹，特別是當問題的邊界還不清楚時。啟動並迭代。

任何足夠複雜的軟體工程工作都必然會遇到關於組件應如何設計或問題應如何處理的不確定性。Auxon 在其開發早期就遇到了這樣的不確定性，因為線性規劃世界對團隊成員來說是未知的領域。線性規劃的局限性，這似乎是產品可能運作方式的核心部分，並沒有被很好地理解。為了解決團隊對這個不夠了解的依賴關係的擔憂，我們選擇最初建立一個簡化的求解器引擎（所謂的「笨求解器」），它應用了一些簡單的啟發式方法，根據使用者指定的需求來安排服務。雖然「笨求解器」永遠不會產生一個真正最優的解決方案，但它讓團隊感覺到我們對 Auxon 的願景是可以實現的，即使我們從第一天起就沒有建立出完美的東西。

當部署近似法以幫助加速開發時，重要的是要以一種允許團隊未來進行增強和重新審視近似法的方式進行工作。在「笨求解器」的案例中，整個求解器介面在 Auxon 內部被抽象出來，以便求解器內部可以在以後被替換。最終，當我們對統一的線性規劃模型建立信心時，用更聰明的東西替換「笨求解器」是一個簡單的操作。

Auxon 的產品需求也有一些未知數。在需求模糊的情況下開發軟體可能是一個令人沮喪的挑戰，但一定程度的不確定性不應成為阻礙。利用這種模糊性作為一個激勵，確保軟體設計得既通用又模組化。例如，Auxon 專案的目標之一是與 Google 內部的自動化系統整合，以允許分配計畫直接在生產中實施（根據需要分配資源、啟動/關閉/調整服務大小）。然而，當時，自動化系統的世界處於巨大的變動之中，因為有各種各樣的方法在使用。我們沒有試圖設計獨特的解決方案來讓 Auxon 與每個單獨的工具一起工作，而是將分配計畫塑造成普遍有用的，以便這些自動化系統可以自行開發整合點。這種「不可知論」的方法成為 Auxon 吸引新客戶的流程的關鍵，因為它允許客戶開始使用 Auxon，而無需切換到特定的啟動自動化工具、預測工具或性能數據工具。

在 Auxon 內部建立機器性能模型時，我們也利用模組化設計來處理模糊的需求。關於未來機器平台性能（例如，CPU）的數據很少，但我們的使用者希望有一種方法來模擬各種機器功率的情景。我們將機器數據抽象在一個單一的介面後面，允許使用者換入不同的未來機器性能模型。後來，我們根據越來越明確的需求進一步擴展了這種模組化，提供了一個在這個介面內工作的簡單機器性能建模庫。

如果要從我們的 Auxon 案例研究中得出一個主題，那就是「啟動並迭代」這句老話在 SRE 軟體開發專案中尤其重要。不要等待完美的設計；相反，在推進設計和開發的同時，要牢記總體願景。當你遇到不確定的領域時，要設計出足夠靈活的軟體，以便如果流程或策略在更高層次上發生變化，你不會招致巨大的重工成本。但與此同時，要透過確保通用解決方案具有真實世界的特定實現來保持腳踏實地，從而證明設計的實用性。

## 提高認知度和推動採用

與任何產品一樣，SRE 開發的軟體必須在了解其使用者和需求的基礎上進行設計。它需要透過實用性、性能和已證實的能力來推動採用，既要有利於 Google 的生產可靠性目標，又要改善 SRE 的生活。在整個組織中推廣產品並獲得認可的過程是專案成功的關鍵。

不要低估提高對你的軟體產品的認知度和興趣所需的努力——一次演講或一封電子郵件公告是不夠的。向廣大受眾推廣內部軟體工具需要以下所有條件：

- 一致且連貫的方法
- 使用者倡導
- 資深工程師和管理層的贊助，你必須向他們展示你的產品的實用性

從客戶的角度考慮，讓你的產品易於使用是很重要的。工程師可能沒有時間或意願去深入研究原始碼來弄清楚如何使用一個工具。儘管內部客戶通常比外部客戶更能容忍粗糙的邊緣和早期的 alpha 版本，但提供文件仍然是必要的。SRE 很忙，如果你的解決方案太困難或令人困惑，他們會自己寫解決方案。

### 設定期望

當一個在問題領域有多年經驗的工程師開始設計一個產品時，很容易想像工作的烏托邦式最終狀態。然而，區分產品的抱負性目標和最低成功標準（或最小可行產品）是很重要的。專案可能會因為承諾過多、過早而失去信譽並失敗；與此同時，如果一個產品沒有承諾足夠有回報的結果，就很難克服必要的啟動能量來說服內部團隊嘗試新事物。透過小版本展示穩定、漸進的進展，可以提高使用者對你的團隊交付有用軟體能力的信心。

在 Auxon 的案例中，我們透過規劃長期路線圖和短期修復來取得平衡。我們向團隊承諾：

- 任何上線和配置工作都將立即帶來緩解手動裝箱短期資源請求的痛苦。
- 隨著 Auxon 的附加功能被開發出來，相同的配置文件將會延續下去，並提供新的、更廣泛的長期成本節省和其他好處。專案路線圖使服務能夠快速確定它們的使用案例或所需功能是否在早期版本中實現。同時，Auxon 的迭代開發方法為開發優先級和路線圖的新里程碑提供了資訊。

### 識別合適的客戶

開發 Auxon 的團隊意識到，一個萬能的解決方案可能不適合所有情況；許多較大的團隊已經有了自家開發的容量規劃解決方案，這些方案運作得還不錯。雖然他們的自訂工具並不完美，但這些團隊在容量規劃過程中沒有遇到足夠的痛苦來嘗試一個新工具，特別是一個帶有粗糙邊緣的 alpha 版本。

Auxon 的初始版本有意針對那些沒有現有容量規劃流程的團隊。因為這些團隊無論是採用現有工具還是我們的新方法，都必須投入配置精力，所以他們有興趣採用最新的工具。Auxon 在這些團隊中取得的早期成功證明了該專案的實用性，並將客戶本身變成了該工具的倡導者。量化產品的實用性被證明更有益；當我們讓 Google 的一個業務領域上線時，該團隊撰寫了一份案例研究，詳細說明了流程並比較了前後的結果。僅節省的時間和減少的人力勞動就為其他團隊嘗試 Auxon 提供了巨大的動力。

### 客戶服務

儘管 SRE 內部開發的軟體針對的是具有高技術熟練度的 TPM 和工程師，但任何足夠創新的軟體仍然會給新使用者帶來學習曲線。不要害怕為早期採用者提供「白手套」客戶支援，以幫助他們完成上線過程。有時，自動化也會帶來一系列情感上的擔憂，例如害怕某人的工作將被一個 shell 腳本取代。透過與早期使用者一對一合作，你可以親自解決這些恐懼，並證明團隊不是擁有手動執行繁瑣任務的辛勞，而是擁有其技術工作的配置、流程和最終結果。後來的採用者會被早期採用者的快樂例子所說服。

此外，由於 Google 的 SRE 團隊分佈在全球各地，專案的早期採用者倡導者特別有益，因為他們可以作為當地專家，為其他有興趣嘗試該專案的團隊服務。

### 在正確的層級上設計

我們稱之為「不可知論」的一個想法——編寫軟體以使其通用化，以允許各種數據源作為輸入——是 Auxon 設計的一個關鍵原則。「不可知論」意味著客戶不需要承諾使用任何一個工具來使用 Auxon 框架。這種方法使得 Auxon 即使在具有不同使用案例的團隊開始使用它時，也能保持足夠的通用實用性。我們向潛在使用者傳達的訊息是：「就照你現在的樣子來；我們會配合你現有的東西。」透過避免為一兩個大用戶過度客製化，我們在整個組織中實現了更廣泛的採用，並降低了新服務的進入門檻。

我們也有意識地努力避免將成功定義為在整個組織中 100% 採用的陷阱。在許多情況下，為了實現一個對 Google 長尾中每個服務都足夠的功能集，完成最後一哩路會產生遞減的回報。

## 團隊動態

在為 SRE 軟體開發產品挑選工程師時，我們發現創建一個由能夠快速掌握新主題的通才和擁有廣泛知識和經驗的工程師組成的種子團隊非常有益。多樣化的經驗可以彌補盲點，以及假設每個團隊的使用案例都和你一樣的陷阱。

你的團隊與必要的專家建立工作關係至關重要，你的工程師也要能夠在新的問題領域中舒適地工作。對於大多數公司的 SRE 團隊來說，進入這個新的問題領域需要外包任務或與顧問合作，但較大組織的 SRE 團隊可能能夠與內部專家合作。在概念化和設計 Auxon 的初始階段，我們向 Google 專門從事運籌學和量化分析的內部團隊展示了我們的設計文件，以藉鑑他們在該領域的專業知識，並引導 Auxon 團隊了解容量規劃的知識。

隨著專案開發的繼續和 Auxon 的功能集變得越來越廣泛和複雜，團隊吸收了具有統計學和數學優化背景的成員，這在較小的公司可能類似於將外部顧問引入內部。當專案的基本功能完成並且增加精細度成為我們的首要任務時，這些新團隊成員能夠識別出需要改進的領域。

聘請專家的合適時機當然因專案而異。作為一個粗略的指導方針，專案應該已經成功起步並證明是成功的，這樣現有團隊的技能將會因額外的專業知識而得到顯著增強。

# 在 SRE 中培養軟體工程

什麼樣的專案是從一次性工具躍升為成熟軟體工程成果的好候選者？強烈的積極信號包括：在相關領域有第一手經驗的工程師有興趣參與該專案，以及目標使用者群體技術性很強（因此能夠在開發的早期階段提供高信號的錯誤報告）。該專案應提供顯著的好處，例如減少 SRE 的辛勞、改進現有的基礎設施或簡化複雜的流程。

專案必須與組織的總體目標相符，以便工程領導者可以權衡其潛在影響，並隨後為你的專案進行宣傳，無論是對他們的報告團隊還是對可能與他們團隊有介面的其他團隊。跨組織的社會化和審查有助於防止脫節或重疊的努力，一個能夠輕易地被確定為推動部門範圍內目標的產品更容易獲得人員和支持。

什麼樣的專案是不好的候選者？許多你可能會在任何軟體專案中本能地識別出的警示信號，例如同時觸及許多移動部件的軟體，或者需要「全有或全無」方法而無法進行迭代開發的軟體設計。由於 Google SRE 團隊目前是圍繞他們運行的服務來組織的，SRE 開發的專案特別容易出現過於具體的工作，只對組織的一小部分有利。因為團隊的激勵主要是為特定服務的使用者提供卓越的體驗，專案往往無法推廣到更廣泛的使用案例，因為跨 SRE 團隊的標準化排在第二位。在光譜的另一端，過於通用的框架也可能同樣有問題；如果一個工具力求過於靈活和通用，它就有可能不太適合任何使用案例，因此本身價值不足。範圍宏大、目標抽象的專案通常需要大量的開發工作，但缺乏在合理時間內為最終使用者帶來好處所需的具體使用案例。

作為一個廣泛使用案例的例子：由 Google SRE 開發的一個第 3 層負載均衡器多年來非常成功，以至於它被重新利用為一個面向客戶的產品，透過 Google Cloud Load Balancer 提供 [Eis16]。

## 在 SRE 中成功建立軟體工程文化：人員配置和開發時間

SRE 通常是通才，因為渴望廣度優先而非深度優先的學習方式有助於理解更大的圖景（而很少有比現代技術基礎設施複雜的內部運作更大的圖景了）。這些工程師通常具有很強的編碼和軟體開發技能，但可能沒有傳統軟體工程師（SWE）作為產品團隊一員或需要考慮客戶功能請求的經驗。一個早期 SRE 軟體開發專案的工程師的一句話總結了傳統 SRE 的軟體開發方法：「我有一個設計文件；我們為什麼需要需求？」與熟悉面向使用者軟體開發的工程師、技術專案經理（TPM）或產品經理（PM）合作，有助於建立一個團隊軟體開發文化，將軟體產品開發和實際生產經驗的精華結合在一起。

專門的、不間斷的專案工作時間對於任何軟體開發工作都至關重要。專門的專案時間是推動專案進展所必需的，因為當你在一個小時內在幾個任務之間來回切換時，幾乎不可能寫程式碼，更不用說專注於更大、更有影響力的專案了。因此，能夠在不受干擾的情況下從事軟體專案，通常是工程師開始從事開發專案的一個有吸引力的原因。這樣的時間必須被積極捍衛。

SRE 內部開發的大多數軟體產品都是從副專案開始的，其效用導致它們成長並變得正規化。此時，一個產品可能會分叉成幾個可能的方向之一：

- 仍然是工程師在業餘時間開發的草根努力
- 透過結構化流程被確立為正式專案（參見「如何實現」）
- 獲得 SRE 領導層的行政贊助，以擴展為一個人員齊全的軟體開發工作

然而，在任何這些情況下——這一點值得強調——至關重要的是，參與任何開發工作的 SRE 繼續作為 SRE 工作，而不是成為嵌入 SRE 組織的全職開發人員。沉浸在生產世界中，為從事開發工作的 SRE 提供了寶貴的視角，因為他們既是任何產品的創造者，也是客戶。

## 如何實現

如果你喜歡在 SRE 中進行有組織的軟體開發的想法，你可能想知道如何將軟體開發模型引入一個專注於生產支持的 SRE 組織。

首先，要認識到這個目標既是一個組織變革，也是一個技術挑戰。SRE 習慣於與隊友密切合作，快速分析和應對問題。因此，你正在與 SRE 快速編寫一些程式碼以滿足其直接需求的自然本能作鬥爭。如果你的 SRE 團隊很小，這種方法可能不是問題。然而，隨著你的組織成長，這種臨時的方法將無法擴展，反而會導致功能強大但狹隘或單一用途的軟體解決方案，這些解決方案無法共享，不可避免地導致重複工作和浪費時間。

接下來，思考一下你想透過在 SRE 中開發軟體來實現什麼。你只是想在你的團隊中培養更好的軟體開發實踐，還是你有興趣開發可以在團隊之間使用的成果，可能作為組織的標準？在較大的成熟組織中，後一種變革需要時間，可能跨越數年。這樣的變革需要在多個方面進行處理，但回報更高。以下是來自 Google 經驗的一些指導方針：

- 一致且受支持的軟體解決方案可以加快新 SRE 的上手速度。
- 減少執行相同任務的方式數量，可以讓整個部門從任何單一團隊發展的技能中受益，從而使知識和努力可以在團隊之間移植。

問問自己：如果這個產品是由一個單獨的開發團隊創建的，你會上線這個產品嗎？如果你的解決方案得到廣泛採用，它可能會對 SRE 成功執行其工作至關重要。因此，可靠性至關重要。你是否有適當的程式碼審查實踐？你是否有端到端或整合測試？讓另一個 SRE 團隊審查該產品的生產就緒性，就像他們上線任何其他服務一樣。

建立你的軟體開發工作的信譽需要很長時間，但由於一次失誤而失去信譽卻只需要很短的時間。

# 結論

隨著組織的發展，Google SRE 內部的軟體工程專案蓬勃發展，在許多情況下，從早期軟體開發專案中學到的經驗教訓和成功執行為後續的努力鋪平了道路。SRE 為開發工具帶來的獨特的實際生產經驗可以導致對老問題的創新方法，正如開發 Auxon 以解決複雜的容量規劃問題所見。SRE 驅動的軟體專案對公司在開發可持續模型以大規模支持服務方面也顯著有益。因為 SRE 通常開發軟體以簡化低效率的流程或自動化常見任務，這些專案意味著 SRE 團隊不必與其支持的服務規模成線性比例擴展。最終，讓 SRE 將部分時間投入軟體開發的好處由公司、SRE 組織和 SRE 本身共同收穫。