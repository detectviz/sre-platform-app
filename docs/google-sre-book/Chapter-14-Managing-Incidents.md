# 事件管理

作者：Andrew Stribblehill 78 編輯：Kavita Guliani

有效的事件管理是限制事件造成的干擾並盡快恢復正常業務運營的關鍵。如果您沒有事先對潛在事件的應對進行演練，那麼在現實情況下，有原則的事件管理可能會被拋到九霄雲外。

本章將描繪一個因臨時事件管理實踐而失控的事件，概述一個管理良好的事件處理方法，並回顧如果用運作良好的事件管理來處理，同一個事件可能會如何發展。

## 未經管理的事件

設身處地為 The Firm 的值班工程師 Mary 著想。現在是週四下午 2 點，您的呼叫器剛剛爆炸了。黑盒監控告訴您，您的服務在整個資料中心都已停止提供任何流量。您嘆了口氣，放下咖啡，開始著手修復。幾分鐘後，另一個警報告訴您，第二個資料中心已停止服務。然後，您的五個資料中心中的第三個也失敗了。更糟的是，剩餘的資料中心無法處理比平常更多的流量，因此它們開始過載。不知不覺中，服務已過載，無法處理任何請求。

你看著日誌，感覺像過了一個世紀。數千行的日誌表明，最近更新的一個模組中存在錯誤，因此您決定將伺服器恢復到上一個版本。當您看到回滾沒有幫助時，您打電話給 Josephine，她為這個現在正在「大出血」的服務編寫了大部分程式碼。她提醒您現在是她時區的凌晨 3:30，睡眼惺忪地同意登入並查看一下。您的同事 Sabrina 和 Robin 開始從他們自己的終端機上東張西望。「只是看看，」他們告訴您。

現在，一位西裝革履的人打電話給您的老闆，憤怒地要求知道為什麼他沒有被告知「這個業務關鍵型服務的全面崩潰」。與此同時，副總裁們在 nagging 您要一個預計完成時間 (ETA)，反覆問您：「這怎麼可能發生？」您本想表示同情，但這樣做需要您為工作保留的認知精力。副總裁們憑藉他們以前的工程經驗，提出一些無關緊要但難以反駁的評論，比如：「增加頁面大小！」

時間流逝；剩下的兩個資料中心完全失效。您不知道的是，睡眼惺忪的 Josephine 打電話給了 Malcolm。他靈光一閃：想到了關於 CPU 親和性的事情。他確信，如果他能將這個簡單的變更部署到生產環境中，他就能優化剩餘的伺服器進程，所以他這麼做了。幾秒鐘內，伺服器重新啟動，並應用了該變更。然後就死了。

# 未經管理的事件的剖析

請注意，在前面的場景中，每個人都在做他們認為是自己份內的工作。事情怎麼會變得這麼糟？一些常見的危險導致這次事件失控。

## 過於專注於技術問題

我們傾向於因為 Mary 這樣的人的技術實力而僱用他們。因此，她忙於對系統進行操作性變更，勇敢地試圖解決問題，這並不奇怪。她沒有條件去思考如何緩解問題的更大畫面，因為手頭的技術任務已經不堪重負。

## 溝通不暢

出於同樣的原因，Mary 忙得不可開交，無法進行清晰的溝通。沒有人知道他們的同事在採取什麼行動。業務領導很生氣，客戶很沮喪，而其他本可以幫助除錯或修復問題的工程師也沒有被有效地利用。

## 單打獨鬥 (Freelancing)

Malcolm 出於最好的意圖對系統進行了更改。然而，他沒有與他的同事協調——甚至沒有與技術上負責故障排除的 Mary 協調。他的更改使糟糕的情況變得更糟。

# 事件管理流程的要素

事件管理技能和實踐的存在是為了引導熱情個體的能量。Google 的事件管理系統基於**事件指揮系統 (Incident Command System)**，79 該系統以其清晰性和可擴展性而聞名。

一個設計良好的事件管理流程具有以下特點。

## 職責的遞歸性分離

確保參與事件的每個人都知道自己的角色，並且不侵犯他人的領域，這一點很重要。有點違反直覺的是，明確的職責分離允許個人擁有比他們原本可能擁有的更多的自主權，因為他們不必去猜測同事的想法。

如果某個成員的負擔過重，該成員需要向規劃負責人請求更多的人員。然後他們應該將工作委派給其他人，這項任務可能需要創建子事件。或者，一個角色負責人可以將系統組件委派給同事，同事們再將高層次的資訊回報給領導。

幾個不同的角色應該委派給特定的人：

## 一個公認的指揮所

相關方需要了解他們可以在哪裡與事件指揮官互動。在許多情況下，將事件應變小組成員集中到一個指定的中央「作戰室」是合適的。其他團隊可能更喜歡在自己的辦公桌上工作，通過電子郵件和 IRC 保持對事件更新的警覺。

Google 發現 IRC 在事件應變中是一個巨大的福音。IRC 非常可靠，可以用作有關此事件的通信日誌，而這樣的記錄在記住詳細的狀態變更方面是無價的。我們還編寫了機器人來記錄與事件相關的流量（這對事後分析很有幫助），以及其他機器人來將警報等事件記錄到頻道中。IRC 也是一個方便的媒介，地理上分散的團隊可以通過它進行協調。

## 即時事件狀態文件

事件指揮官最重要的職責是維護一份**即時的事件文件 (living incident document)**。這可以存在於一個 wiki 中，但理想情況下應該可以由多人同時編輯。我們的大多數團隊都使用 Google Docs，儘管 Google Docs SRE 使用 Google Sites：畢竟，依賴於您試圖作為事件管理系統一部分來修復的軟體，不太可能有好的結果。

請參閱「事件狀態文件範例」以獲取一個範例事件文件。這份即時文件可能會很亂，但必須是功能性的。使用範本可以使生成這份文件更容易，將最重要的資訊放在頂部可以使其更易於使用。保留這份文件用於事後分析，並在必要時進行元分析。

## 清晰、即時的交接

在工作日結束時，清楚地交接事件指揮官的職位至關重要。如果您要將指揮權交接給另一個地點的人，您可以簡單安全地通過電話或視訊通話向新的事件指揮官更新情況。一旦新的事件指揮官完全了解情況，即將卸任的指揮官應該明確地進行交接，具體說明：「你現在是事件指揮官了，好嗎？」，並且在收到明確的交接確認之前不應離開通話。交接應該傳達給正在處理事件的其他人，以便始終清楚誰在領導事件管理工作。

# 一個受管理的事件

現在讓我們來看看，如果這個事件是用事件管理的原則來處理的，它可能會如何發展。

現在是下午 2 點，Mary 正在喝她今天的第三杯咖啡。呼叫器的刺耳聲讓她吃了一驚，她一口喝下了飲料。問題：一個資料中心已停止服務流量。她開始調查。不久，另一個警報響起，五個資料中心中的第二個也出了問題。因為這是一個迅速擴大的問題，她知道她將從她的事件管理框架的結構中受益。

Mary 找到了 Sabrina。「你能接管指揮嗎？」Sabrina 點頭同意，迅速從 Mary 那裡了解了迄今為止發生的事情。她將這些細節記錄在一封電子郵件中，並發送到一個預先安排好的郵寄清單。Sabrina 意識到她還無法確定事件的影響範圍，所以她請求 Mary 的評估。Mary 回答說：「用戶還沒有受到影響；我們只希望不要失去第三個資料中心。」Sabrina 將 Mary 的回應記錄在一個即時事件文件中。

當第三個警報響起時，Sabrina 在 IRC 的除錯聊天中看到了這個警報，並迅速跟進了電子郵件線程進行了更新。這個線程讓副總裁們了解了高層次的狀態，而不會讓他們陷入細枝末節。Sabrina 請一位外部溝通代表開始起草用戶訊息。然後她跟進 Mary，看是否應該聯繫開發人員的值班人員（目前是 Josephine）。得到 Mary 的批准後，Sabrina 將 Josephine 拉了進來。

等到 Josephine 登入時，Robin 已經自願幫忙了。Sabrina 提醒 Robin 和 Josephine，他們要優先處理 Mary 委派給他們的任何任務，並且他們必須讓 Mary 了解他們採取的任何額外行動。Robin 和 Josephine 通過閱讀事件文件，迅速熟悉了當前的情況。

到現在，Mary 已經嘗試了舊的二進位版本，發現它不行：她對 Robin 咕噥了一句，Robin 更新了 IRC，說這個嘗試的修復沒有用。Sabrina 將這個更新貼到了即時事件管理文件中。

下午 5 點，Sabrina 開始尋找接替人員來處理這個事件，因為她和她的同事們準備回家了。她更新了事件文件。下午 5:45 開了一個簡短的電話會議，以便每個人都了解當前情況。下午 6 點，他們將職責交接給了他們在姐妹辦公室的同事。

第二天早上，Mary 回到工作崗位，發現她跨大西洋的同事已經接手了這個錯誤，緩解了問題，關閉了事件，並開始了事後檢討的工作。問題解決了，她泡了杯新鮮的咖啡，坐下來規劃結構性的改進，以免這類問題再次困擾團隊。

# 何時宣布事件

及早宣布事件，然後找到一個簡單的修復並結束事件，比在一個日益嚴重的問題發生數小時後才啟動事件管理框架要好。為宣布事件設定明確的條件。我的團隊遵循以下大致的指導方針——如果以下任何一項為真，該事件就是一個事件：

- 您是否需要讓第二個團隊參與解決問題？
- 中斷是否對客戶可見？
- 即使經過一個小時的集中分析，問題仍未解決？

事件管理能力在不經常使用時會迅速萎縮。那麼工程師如何保持他們的事件管理技能最新——處理更多的事件呢？幸運的是，事件管理框架可以應用於其他需要跨時區和/或團隊的運營變更。如果您經常將該框架作為常規變更管理程序的一部分，那麼當實際事件發生時，您可以輕鬆地遵循該框架。如果您的組織進行災難恢復測試（您應該這樣做，這很有趣：請參閱 [Kri12]），事件管理應該是該測試過程的一部分。我們經常角色扮演對一個已經解決的值班問題的回應，也許是由另一個地點的同事解決的，以進一步熟悉事件管理。

# 總結

我們發現，通過預先制定事件管理策略，構建這個計劃使其能夠平穩擴展，並定期將該計劃付諸實踐，我們能夠減少我們的平均恢復時間，並為員工提供一個壓力較小的方式來處理突發問題。任何關心可靠性的組織都會從追求類似的策略中受益。

**優先排序 (Prioritize)**。止血，恢復服務，並為根本原因分析保留證據。

**準備 (Prepare)**。與事件參與者協商，預先制定並記錄您的事件管理程序。

**信任 (Trust)**。在指定的角色範圍內，給予所有事件參與者完全的自主權。

**反省 (Introspect)**。在應對事件時，注意您的情緒狀態。如果您開始感到恐慌或不知所措，請尋求更多支持。

**考慮替代方案 (Consider alternatives)**。定期考慮您的選擇，並重新評估繼續您正在做的事情是否仍然有意義，或者您是否應該在事件應變中採取另一種策略。

**練習 (Practice)**。常規地使用這個流程，使其成為第二天性。

**換個角色 (Change it around)**。上次你是事件指揮官嗎？這次擔任一個不同的角色。鼓勵每個團隊成員熟悉每個角色。

78 本章的早期版本曾以文章形式發表在 ;login: (2015 年 4 月，第 40 卷，第 2 期)。

79 更多細節請參閱 https://www.fema.gov/national-incident-management-system。