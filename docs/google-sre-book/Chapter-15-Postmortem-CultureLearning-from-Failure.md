# 事後檢討文化：從失敗中學習

作者：John Lunney 和 Sue Lueder 編輯：Gary O’ Connor

> 失敗的代價是教育。
>
> Devin Carraway

作為 SRE，我們與大規模、複雜的分散式系統打交道。我們不斷地為我們的服務增加新功能，並添加新的系統。鑑於我們的規模和變更速度，事件和中斷是不可避免的。當事件發生時，我們會修復根本問題，服務恢復正常運行狀態。除非我們有某種正式化的流程來從這些事件中學習，否則它們可能會無限期地重演。如果不加以控制，事件的複雜性可能會倍增，甚至級聯，從而壓垮一個系統及其運營商，並最終影響我們的用戶。因此，事後檢討是 SRE 的一個重要工具。

事後檢討的概念在科技行業是眾所周知的 [All12]。事後檢討是一份關於事件、其影響、為減輕或解決事件而採取的行動、根本原因以及為防止事件再次發生而採取的後續行動的書面記錄。本章描述了決定何時進行事後檢討的標準、一些關於事後檢討的最佳實踐，以及基於我們多年來積累的經驗，如何培養一種事後檢討文化的建議。

## Google 的事後檢討哲學

撰寫事後檢討的主要目標是確保事件被記錄下來，所有導致事件的根本原因都被很好地理解，尤其是，有效的預防措施被落實到位，以減少再次發生的可能性和/或影響。對根本原因分析技術的詳細調查超出了本章的範圍（相反，請參閱 [Roo04]）；然而，在系統品質領域，文章、最佳實踐和工具比比皆是。我們的團隊使用各種技術進行根本原因分析，並選擇最適合其服務的技術。在任何重大的不良事件之後，都期望進行事後檢討。撰寫事後檢討不是懲罰——這是整個公司的一個學習機會。事後檢討過程確實存在時間或精力上的固有成本，因此我們在選擇何時撰寫時會深思熟慮。團隊有一定的內部靈活性，但常見的事後檢討觸發因素包括：

- 超過某個閾值的用戶可見的停機或降級
- 任何種類的資料丟失
- 值班工程師的干預（版本回滾、流量重新路由等）
- 解決時間超過某個閾值
- 監控失敗（這通常意味著手動發現事件）

在事件發生前定義事後檢討的標準非常重要，這樣每個人都知道何時需要進行事後檢討。除了這些客觀的觸發因素外，任何利益相關者都可以要求對某個事件進行事後檢討。

**無指責的事後檢討 (Blameless postmortems)** 是 SRE 文化的一個信條。要使事後檢討真正做到無可指責，它必須專注於識別導致事件的因素，而不是指責任何個人或團隊的不良或不當行為。一份無可指責地撰寫的事後檢討假定參與事件的每個人都有良好的意圖，並且根據他們所擁有的資訊做了正確的事情。如果指責和羞辱個人或團隊做「錯」事的文化盛行，人們就不會因為害怕懲罰而將問題公之於眾。

無指責文化起源於醫療保健和航空電子行業，在這些行業中，錯誤可能是致命的。這些行業培養了一種環境，在這種環境中，每一個「錯誤」都被視為加強系統的機會。當事後檢討從分配責任轉向調查個人或團隊擁有不完整或不正確資訊的系統性原因時，就可以制定出有效的預防計劃。你無法「修復」人，但你可以修復系統和流程，以更好地支持人們在設計和維護複雜系統時做出正確的選擇。

當中斷確實發生時，事後檢討並非作為一種形式而被遺忘。相反，工程師將事後檢討視為一個機會，不僅可以修復一個弱點，而且可以使 Google 作為一個整體更具彈性。雖然無指責的事後檢討並不僅僅是通過指責來發洩挫折，但它應該指出服務可以在哪些方面以及如何得到改進。這裡有兩個例子：

撰寫無指責的事後檢討可能具有挑戰性，因為事後檢討的格式清楚地標識了導致事件的行動。從事後檢討中移除指責，可以讓人們有信心在沒有恐懼的情況下升級問題。同樣重要的是，不要因為某個人或團隊頻繁地產生事後檢討而對其進行污名化。指責的氛圍有可能創造一種文化，在這種文化中，事件和問題被掩蓋起來，從而給組織帶來更大的風險 [Boy13]。

# 協作與知識共享

我們重視協作，事後檢討過程也不例外。事後檢討的工作流程在每個階段都包括協作和知識共享。

我們的事後檢討文件是 Google Docs，並附有內部範本（請參閱「事後檢討範例」）。無論您使用哪種特定工具，請尋找以下關鍵功能：

撰寫事後檢討還涉及正式的審查和發布。在實踐中，團隊會在內部共享第一份事後檢討草稿，並徵求一組資深工程師的意見，以評估草稿的完整性。審查標準可能包括：

- 關鍵事件資料是否為後人收集？
- 影響評估是否完整？
- 根本原因是否足夠深入？
- 行動計劃是否適當，由此產生的錯誤修復是否具有適當的優先級？
- 我們是否與相關利益相關者分享了結果？

一旦初步審查完成，事後檢討將被更廣泛地分享，通常是與更大的工程團隊或在內部郵件列表上。我們的目標是將事後檢討分享給盡可能廣泛的、能從所傳授的知識或教訓中受益的受眾。Google 對於任何可能識別最終用戶的資訊的存取都有嚴格的規定，80 即使是像事後檢討這樣的內部文件也絕不包含此類資訊。

一份未經審查的事後檢討，就如同從未存在過一樣。為了確保每一份完成的草稿都得到審查，我們鼓勵定期舉行事後檢討的審查會議。在這些會議中，結束任何正在進行的討論和評論，捕捉想法，並最終確定狀態，這一點非常重要。

一旦相關人員對文件及其行動項目感到滿意，事後檢討就會被添加到一個團隊或組織的過去事件儲存庫中。81 透明的分享使得其他人更容易找到並從事後檢討中學習。

# 引入事後檢討文化

將事後檢討文化引入您的組織說起來容易做起來難；這樣的努力需要持續的培養和強化。我們通過高層管理人員積極參與審查和協作過程來強化協作性的事後檢討文化。管理層可以鼓勵這種文化，但無指責的事後檢討理想情況下是工程師自我激勵的產物。本著培養事後檢討精神的宗旨，SRE 主動創建活動，傳播我們從系統基礎設施中學到的知識。一些範例活動包括：

將事後檢討引入組織的最大挑戰之一是，鑑於其準備成本，有些人可能會質疑其價值。以下策略有助於應對這一挑戰：

- **將事後檢討輕鬆地融入工作流程**。一個包含幾個完整且成功的事後檢討的試行期，可能有助於證明其價值，此外還有助於確定哪些標準應該啟動一個事後檢討。
- **確保撰寫有效的事後檢討是一種受到獎勵和慶祝的做法**，無論是通過前面提到的社交方法公開進行，還是通過個人和團隊的績效管理。
- **鼓勵高層領導的認可和參與**。就連 Larry Page 也談到事後檢討的高價值！

Google 的創始人 Larry Page 和 Sergey Brin 主持 TGIF，這是一個每週一次的全體會議，在我們加州山景城的總部現場舉行，並向全球的 Google 辦事處廣播。2014 年的一次 TGIF 專注於「事後檢討的藝術」，其中 SRE 討論了影響重大的事件。一位 SRE 討論了他最近推送的一個版本；儘管經過了徹底的測試，一個意想不到的互動無意中導致一個關鍵服務中斷了四分鐘。事件只持續了四分鐘，因為這位 SRE 當機立斷，立即回滾了變更，避免了一場更長、規模更大的中斷。這位工程師不僅因此迅速而沉著地處理事件而立即獲得了兩個同儕獎金 82，而且還獲得了包括公司創始人和數千名 Google 員工在內的 TGIF 觀眾的熱烈掌聲。除了這樣一個顯著的論壇，Google 還有一系列內部社交網路，可以推動同儕對寫得好的事後檢討和出色的事件處理給予讚揚。這是眾多例子中的一個，表明這些貢獻的認可來自同儕、CEO 以及介於兩者之間的所有人。83

在 Google，我們努力在問題出現時就解決它們，並在內部共享創新。我們會定期對我們的團隊進行調查，了解事後檢討流程如何支持他們的目標，以及該流程可以如何改進。我們會問諸如：文化是否支持你的工作？撰寫事後檢討是否會帶來太多的瑣務（請參閱「消除瑣務」）？你的團隊對其他團隊有什麼最佳實踐建議？你希望開發什麼樣的工具？調查結果讓身處第一線的 SRE 有機會提出改進建議，從而提高事後檢討文化的有效性。

除了事件管理和後續行動的操作方面，事後檢討的做法已經融入了 Google 的文化：現在，任何重大事件之後都會進行全面的事後檢討，這已成為一種文化常態。

# 結論與持續改進

我們可以自信地說，由於我們對培養事後檢討文化的持續投入，Google 經歷的中斷更少，並培養了更好的用戶體驗。我們的「Google 事後檢討」工作組是我們致力於無指責事後檢討文化的一個例子。該小組協調全公司的後續分析工作：匯總事後檢討範本、利用事件期間使用的工具資料自動創建事後檢討，並幫助自動化從事後檢討中提取資料，以便我們能夠進行趨勢分析。我們已經能夠就來自 YouTube、Google Fiber、Gmail、Google Cloud、AdWords 和 Google Maps 等截然不同產品的最佳實踐進行合作。雖然這些產品非常多樣化，但它們都以從我們最黑暗的時刻中學習為普遍目標來進行事後檢討。

隨著 Google 每月產生大量的事後檢討，匯總事後檢討的工具變得越來越有用。這些工具有助於我們識別跨產品邊界的共同主題和改進領域。為了便於理解和自動化分析，我們最近通過增加額外的元資料欄位，增強了我們的事後檢討範本（請參閱「事後檢討範例」）。該領域的未來工作包括機器學習，以幫助預測我們的弱點，促進即時事件調查，並減少重複事件。

80 請參閱 https://www.google.com/policies/privacy/。

81 如果您想開始自己的儲存庫，Etsy 已經發布了 Morgue，一個用於管理事後檢討的工具。

82 Google 的同儕獎金計畫是 Google 同仁表彰同事傑出努力的一種方式，並涉及一筆象徵性的現金獎勵。

83 有關此特定事件的進一步討論，請參閱「緊急應變」。