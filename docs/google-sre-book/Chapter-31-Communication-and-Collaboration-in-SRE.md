# SRE 中的溝通與協作

作者：Niall Murphy 與 Alex Rodriguez, Carl Crous, Dario Freni, Dylan Curley, Lorenzo Blanco, and Todd Underwood
編輯：Betsy Beyer

SRE 在 Google 的組織定位很有趣，並對我們的溝通與協作方式產生影響。

首先，SRE 的工作內容和方式具有極大的多樣性。我們有基礎設施團隊、服務團隊和橫向產品團隊。我們與產品開發團隊的關係也各不相同，從比我們規模大好幾倍的團隊，到與我們規模大致相當的團隊，甚至在某些情況下，我們自己就是產品開發團隊。SRE 團隊由具備系統工程或架構技能（見 [Hix15b]）、軟件工程技能、專案管理技能、領導才能、來自各種行業背景（見《從其他行業學到的教訓》）等的人員組成。我們不只有一種模式，並且我們發現了多種可行的配置；這種靈活性符合我們最終務實的本性。

同樣真實的是，SRE 不是一個命令與控制的組織。通常，我們至少效忠於兩位主人：對於服務或基礎設施 SRE 團隊，我們與負責這些服務或基礎設施的相應產品開發團隊緊密合作；我們顯然也在 SRE 的整體背景下工作。服務關係非常牢固，因為我們對這些系統的性能負責，但儘管有這種關係，我們的實際匯報線路是通過整個 SRE。如今，我們花在支持個別服務上的時間比跨生產工作的時間多，但我們的文化和共享價值觀產生了對問題高度同質化的處理方法。這是設計使然。

前述兩個事實引導 SRE 組織在團隊運作的兩個關鍵維度——溝通與協作——上朝著特定方向發展。**數據流**是我們溝通的一個恰當的計算機比喻：就像數據必須在生產環境中流動一樣，數據也必須在 SRE 團隊中流動——關於專案、服務狀態、生產環境和個人狀態的數據。為了團隊的最大效能，數據必須以可靠的方式從一個相關方流向另一個相關方。思考這種流動的一種方式是將 SRE 團隊必須向其他團隊呈現的介面視為一個 **API**。就像 API 一樣，良好的設計對於有效運作至關重要，如果 API 設計錯誤，日後修正將會很痛苦。

**API 作為合約**的比喻也適用於協作，無論是在 SRE 團隊之間，還是在 SRE 與產品開發團隊之間——所有人都必須在持續變化的環境中取得進展。就此而言，我們的協作看起來很像任何其他快速發展的公司中的協作。不同之處在於 SRE 在協作中帶來的軟件工程技能、系統工程專業知識和生產經驗的智慧的結合。最好的設計和最好的實施是在相互尊重的氛圍中，滿足生產和產品的共同關注點的結果。這就是 SRE 的承諾：一個負責可靠性的組織，擁有與產品開發團隊相同的技能，將會可衡量地改善事物。我們的經驗表明，僅僅有一個負責可靠性的人，而沒有完整的技能組合，是不夠的。

## 溝通：生產會議

儘管關於召開有效會議的文獻比比皆是 [Kra08]，但很難找到一個幸運到只參加有用、有效會議的人。這對 SRE 來說同樣如此。

然而，我們有一種比一般會議更有用的會議，稱為**生產會議**。生產會議是一種特殊的會議，SRE 團隊在會上向自己和受邀者仔細闡述其負責服務的狀態，以提高所有關心此事的人的普遍認識，並改善服務的運作。總的來說，這些會議是**以服務為導向的**；它們不直接關於個人的狀態更新。目標是讓每個人離開會議時都對正在發生的事情有一個概念——同一個概念。生產會議的另一個主要目標是通過將生產的智慧應用於我們的服務來改善我們的服務。這意味著我們詳細討論服務的運營性能，並將該運營性能與設計、配置或實施聯繫起來，並提出如何解決問題的建議。**在定期會議中將服務的性能與設計決策聯繫起來，是一個極其強大的反饋循環。**

我們的生產會議通常每週舉行一次；鑑於 SRE 對無意義會議的反感，這個頻率似乎恰到好處：有足夠的時間積累相關材料使會議值得召開，而又不會頻繁到讓人們找藉口不參加。會議通常持續 30 到 60 分鐘。時間再少，您可能不必要地縮短了某些內容，或者您應該擴大您的服務組合。時間再長，您可能陷入了細節，或者您有太多要談論的事情，您應該分拆團隊或服務集。

就像任何其他會議一樣，生產會議應該有一位**主席**。許多 SRE 團隊在不同團隊成員之間輪換主席，這樣做的好處是讓每個人都感覺到他們在服務中有份，並對問題有某種名義上的所有權。誠然，不是每個人的主持技巧都相同，但團隊所有權的價值如此之大，以至於暫時的次優性是值得的。此外，這也是一個灌輸主持技巧的機會，這在 SRE 常見的事件協調情況中非常有用。

在兩個 SRE 團隊通過視訊會議，且其中一個團隊比另一個大得多的情況下，我們注意到一個有趣的動態。我們建議默認將您的主席安排在通話規模較小的一方。較大的一方自然會傾向於安靜下來，團隊規模不平衡的一些不良影響（因視訊會議固有的延遲而加劇）將會改善。我們不知道這種技術是否有任何科學依據，但它確實有效。

## 議程

運行生產會議的方式有很多種，這證明了 SRE 負責的內容及其工作方式的多樣性。就此而言，對如何運行這些會議進行規定是不合適的。然而，一個預設的議程（見《生產會議紀要範例》）可能如下所示：

1.  **服務指標審查**：
    -   可用性、延遲、總體錯誤率、容量預測等。
2.  **事件審查**：
    -   上週的頁面。
    -   事件的事後檢討（無論是否無指責）。
3.  **基礎設施審查**：
    -   即將進行的變更。
    -   需要注意的任何重大基礎設施變更。
4.  **監控審查**：
    -   **一個可能應該觸發頁面但沒有觸發的問題**。在這些情況下，您可能應該修復監控，以便此類事件確實觸發頁面。通常您在嘗試修復其他問題時遇到這個問題，或者它與您正在追踪但尚未設置警報的指標有關。
    -   **一個不可觸發頁面但需要注意的問題**，例如低影響的數據損壞或系統某些非面向用戶維度的緩慢。在此處追踪被動的運營工作也是合適的。
    -   **一個不可觸發頁面且不需要注意的問題**。這些警報應該被移除，因為它們會產生額外的噪音，分散工程師對確實值得關注的問題的注意力。
5.  **發布/推送審查**：
    -   上週的推送。
    -   本週的推送。
    -   與推送相關的任何問題。
6.  **工單審查**：
    -   突出顯示的工單。
    -   工單負載的趨勢。
7.  **公開論壇/其他事項**。

## 出席

對於相關 SRE 團隊的所有成員來說，出席是**強制性的**。如果您的團隊遍布多個國家和/或時區，這一點尤其重要，因為這是您作為一個團隊互動的主要機會。

主要利益相關者也應該出席這次會議。您可能擁有的任何合作夥伴產品開發團隊也應該出席。一些 SRE 團隊會將他們的會議分段，以便只涉及 SRE 的事項保留在前半部分；這種做法是可以的，只要如前所述，每個人離開時都對正在發生的事情有相同的概念。有時，來自其他 SRE 團隊的代表可能會出現，特別是如果有更大的跨團隊問題需要討論，但總的來說，相關的 SRE 團隊加上主要的其他團隊應該出席。如果您的關係使得您無法邀請您的產品開發合作夥伴，您需要修復這種關係：也許第一步是邀請該團隊的一名代表，或者找一個受信任的中介來代理溝通或示範健康的互動。團隊不和的原因有很多，關於如何解決這個問題的文章也很豐富：這些信息也適用於 SRE 團隊，但重要的是，從運營中獲得反饋循環的最終目標必須實現，否則擁有 SRE 團隊的很大一部分價值就喪失了。

偶爾，您會有太多的團隊或忙碌但關鍵的與會者無法邀請。您可以使用多種技術來處理這些情況：

-   較不活躍的服務可能由產品開發團隊的一名代表出席，或者只要求產品開發團隊閱讀並評論議程紀要。
-   如果產品開發團隊相當大，提名一部分代表。
-   忙碌但關鍵的與會者可以提前向個人提供反饋和/或指導，或者使用預填議程的技術（下文描述）。

我們討論的大多數會議策略都是常識，帶有以服務為導向的特色。一個使會議更有效率和更具包容性的獨特方法是使用 Google 文件的即時協作功能。許多 SRE 團隊都有這樣一個文件，地址眾所周知，工程領域的任何人都可以訪問。擁有這樣一個文件可以實現兩個偉大的實踐：

-   **用「自下而上」的想法、評論和信息預先填充議程。**
-   **並行且提前準備議程**真的非常有效率。

充分利用產品所支持的多人協作功能。沒有什麼比看到一位會議主席輸入一句話，然後看到另一個人在他們輸入完畢後在括號中提供源材料的鏈接，然後又看到另一個人整理原句的拼寫和語法更棒的了。這種協作能更快地完成工作，並讓更多人感覺到他們對團隊所做的事情擁有一份所有權。

# SRE 內部協作

顯然，Google 是一個跨國組織。由於我們角色的緊急響應和呼叫器輪換部分，我們有非常好的業務理由成為一個分佈式組織，至少相隔幾個時區。這種分佈的實際影響是，我們對「團隊」的定義非常靈活，例如，與平均的產品開發團隊相比。我們有本地團隊、現場團隊、跨大陸團隊、各種規模和凝聚力的虛擬團隊，以及介於兩者之間的一切。這創造了一個愉快混亂的責任、技能和機會的組合。可以預期，任何足夠大的公司都會有許多相同的動態（儘管對於科技公司來說可能特別強烈）。鑑於大多數本地協作沒有特別的障礙，協作方面有趣的案例是跨團隊、跨站點、跨虛擬團隊等。

這種分佈模式也影響了 SRE 團隊的組織方式。因為我們的存在理由是通過技術專長帶來價值，而技術專長往往很難，所以我們試圖找到一種方法來掌握一些相關的系統或基礎設施子集，以減少認知負荷。**專業化**是實現這一目標的一種方式；即，團隊 X 只從事產品 Y 的工作。專業化是好的，因為它更有可能提高技術專長，但它也是壞的，因為它會導致孤島化和對更廣泛圖景的無知。我們試圖有一個清晰的團隊章程來定義一個團隊將支持什麼，更重要的是，**不**支持什麼，但我們並不總是成功。

## 團隊構成

我們在 SRE 中擁有廣泛的技能組合，從系統工程到軟件工程，再到組織和管理。關於協作，我們可以說的一件事是，您的團隊中擁有更多的**多樣性**，您成功協作的機會——以及幾乎所有其他事情的機會——都會提高。有很多證據表明，多樣化的團隊就是更好的團隊 [Nel14]。運營一個多樣化的團隊意味著要特別注意溝通、認知偏見等，我們無法在此詳細介紹。

正式地，SRE 團隊有「技術主管」（TL）、「經理」（SRM）和「專案經理」（也稱為 PM、TPM、PgM）的角色。有些人認為，當這些角色有明確定義的職責時，他們運作得最好：這樣做的主要好處是他們可以快速安全地做出範圍內的決策。其他人則在更靈活的環境中運作得最好，職責根據動態協商而變化。總的來說，團隊越靈活，個人能力方面就越發達，團隊適應新情況的能力也越強——但代價是需要更多、更頻繁的溝通，因為可以假設的背景更少。

無論這些角色定義得有多好，在基礎層面上，技術主管負責團隊的技術方向，並可以以多種方式領導——從仔細評論每個人的代碼，到舉辦季度方向簡報，再到在團隊中建立共識。在 Google，TL 幾乎可以做經理的所有工作，因為我們的經理技術性很強，但經理有兩個 TL 沒有的特殊職責：績效管理功能，以及作為其他人未處理的所有事務的總接盤俠。偉大的 TL、SRM 和 TPM 擁有一套完整的技能，可以愉快地根據需要組織專案、評論設計文檔或編寫代碼。

## 有效工作的技巧

在 SRE 中有效工程的方法有很多。

總的來說，**單人專案會失敗**，除非這個人特別有天賦或者問題很直接。要完成任何重要的事情，您幾乎都需要多個人。因此，您也需要良好的協作技巧。同樣，關於這個主題已經寫了很多材料，其中很多文獻都適用於 SRE。

總的來說，好的 SRE 工作要求在您純粹的本地團隊邊界之外工作時具備出色的溝通技巧。對於在大樓外的協作，有效地跨時區工作意味著要麼有出色的書面溝通，要麼有大量的差旅來提供可推遲但最終對於高質量關係必不可少的親身體驗。即使您是一位出色的作家，隨著時間的推移，您也會衰退成只是一個電子郵件地址，直到您再次親身出現。

# SRE 協作案例研究：Viceroy

一個成功的跨 SRE 協作的例子是一個名為 Viceroy 的專案，它是一個監控儀表板框架和服務。SRE 當前的組織架構可能導致團隊產生多個略有不同的同一件工作的副本；出於各種原因，監控儀表板框架是工作重複的一個特別肥沃的土壤。

導致許多冒煙、廢棄的監控框架殘骸嚴重散落問題的誘因非常簡單：每個團隊都因開發自己的解決方案而受到獎勵，跨團隊邊界工作很困難，而 SRE 範圍內提供的基礎設施通常更接近於一個工具包而不是一個產品。這種環境鼓勵個體工程師使用工具包製造另一個燃燒的殘骸，而不是為盡可能多的人解決問題（這項努力因此會花費更長的時間）。

## Viceroy 的到來

Viceroy 是不同的。它始於 2012 年，當時一些團隊正在考慮如何遷移到 Google 的新監控系統 Monarch。SRE 對於監控系統持深度保守態度，所以 Monarch 有點諷刺地在 SRE 內部獲得關注的時間比在非 SRE 團隊中要長。但沒有人能否認我們遺留的監控系統 Borgmon（見《從時間序列數據進行實用警報》）沒有改進的空間。例如，我們的控制台很笨重，因為它們使用一個特殊的、充滿古怪邊緣情況且難以測試的自定義 HTML 模板系統。那時，Monarch 已經成熟到原則上被接受為遺留系統的替代品，因此被越來越多的 Google 團隊採用，但結果證明我們仍然在控制台方面有問題。

我們這些嘗試為我們的服務使用 Monarch 的人很快發現，它在控制台支持方面存在不足，主要有兩個原因：

-   對於小型服務來說，控制台很容易設置，但對於具有複雜控制台的服務來說，擴展性不佳。
-   它們也不支持遺留的監控系統，使得向 Monarch 的過渡非常困難。

由於當時沒有可行的替代方案來以這種方式部署 Monarch，一些針對特定團隊的專案啟動了。由於當時幾乎沒有協調的開發解決方案，甚至沒有跨團隊的追踪（這個問題此後已得到解決），我們最終再次重複了努力。在 12-18 個月的時間裡，來自 Spanner、Ads 前端和各種其他服務的多個團隊都啟動了自己的努力（一個著名的例子叫做 Consoles++），最終當所有這些團隊的工程師醒來並發現彼此的努力時，理智占了上風。他們決定做明智的事情，聯合起來為所有 SRE 創建一個通用的解決方案。因此，Viceroy 專案於 2012 年中誕生。

到 2013 年初，Viceroy 開始引起那些尚未從遺留系統遷移，但希望試水的團隊的興趣。顯然，擁有較大現有監控專案的團隊遷移到新系統的動機較少：這些團隊很難合理化地拋棄他們現有解決方案的低維護成本，這個方案基本上運作良好，而去選擇一個相對較新且未經證實、需要大量努力才能工作的東西。需求的巨大多樣性加劇了這些團隊的猶豫，儘管所有監控控制台專案都共享兩個主要需求，即：

-   支持複雜的策展儀表板
-   同時支持 Monarch 和遺留監控系統

每個專案還有自己的一套技術要求，這取決於作者的偏好或經驗。例如：

-   核心監控系統之外的多個數據源
-   使用配置定義控制台 vs. 顯式 HTML 佈局
-   不使用 JavaScript vs. 完全擁抱帶有 AJAX 的 JavaScript
-   僅使用靜態內容，以便控制台可以在瀏覽器中緩存

儘管其中一些要求比其他的更棘手，但總體而言，它們使得合併努力變得困難。事實上，儘管 Consoles++ 團隊有興趣了解他們的專案與 Viceroy 的比較，但他們在 2013 年上半年的初步審查確定，兩個專案之間的根本差異足以阻止整合。最大的困難是，Viceroy 在設計上沒有使用太多 JavaScript，而 Consoles++ 則主要是用 JavaScript 編寫的。然而，一線希望在於，兩個系統確實有一些潛在的相似之處：

-   它們使用相似的語法進行 HTML 模板渲染。
-   它們共享一些長遠目標，而兩個團隊都尚未開始解決。例如，兩個系統都希望緩存監控數據並支持一個離線管道，以定期生成控制台可以使用的數據，但這些數據在需求時計算成本太高。

我們最終擱置了統一控制台的討論一段時間。然而，到 2013 年底，Consoles++ 和 Viceroy 都已顯著發展。它們的技術差異已經縮小，因為 Viceroy 開始使用 JavaScript 來渲染其監控圖表。兩個團隊會面並發現整合要容易得多，現在整合歸結為從 Viceroy 伺服器提供 Consoles++ 的數據。第一個整合的原型於 2014 年初完成，並證明了系統可以很好地協同工作。那時，兩個團隊都對共同努力感到放心，並且因為 Viceroy 已經確立了其作為通用監控解決方案的品牌，合併後的專案保留了 Viceroy 的名稱。開發完整功能花費了幾個季度，但到 2014 年底，合併後的系統已經完成。

聯合起來帶來了巨大的好處：

-   Viceroy 獲得了大量數據源和訪問它們的 JavaScript 客戶端。
-   JavaScript 編譯被重寫以支持可以選擇性包含的獨立模塊。這對於將系統擴展到任何數量的擁有自己 JavaScript 代碼的團隊至關重要。
-   Consoles++ 受益於 Viceroy 正在積極進行的許多改進，例如其緩存和後台數據管道的增加。
-   總體而言，一個解決方案的開發速度遠大於所有重複專案開發速度的總和。

最終，共同的未來願景是合併專案的關鍵因素。兩個團隊都發現擴大開發團隊的價值，並從彼此的貢獻中受益。勢頭如此之好，以至於到 2014 年底，Viceroy 被正式宣布為所有 SRE 的通用監控解決方案。也許對 Google 來說很典型的是，這個聲明並不要求團隊採用 Viceroy：相反，它建議團隊應該使用 Viceroy，而不是編寫另一個監控控制台。

## 挑戰

雖然 Viceroy 最終取得了成功，但並非沒有困難，其中許多困難是由於專案的跨站點性質而產生的。

一旦擴展的 Viceroy 團隊成立，遠程團隊成員之間的初步協調證明是困難的。第一次見面時，書寫和說話中的細微線索可能會被誤解，因為溝通風格因人而異。在專案開始時，不在山景城的團隊成員也錯過了會議前後經常發生的即興「飲水機旁」的討論（儘管此後溝通已大為改善）。

雖然核心 Viceroy 團隊保持相當穩定，但貢獻者的擴展團隊相當動態。貢獻者有其他隨時間變化的職責，因此許多人只能為專案投入一到三個月的時間。因此，開發者貢獻者池，本質上比核心 Viceroy 團隊大，其特點是大量的流失。

將新人加入專案需要對每個貢獻者進行系統的整體設計和結構的培訓，這需要一些時間。另一方面，當一名 SRE 為 Viceroy 的核心功能做出貢獻，然後回到自己的團隊時，他們就成了該系統的本地專家。這種本地 Viceroy 專家的意外傳播推動了更多的使用和採用。

隨著人員的加入和離開，我們發現臨時的貢獻既有用又代價高昂。主要代價是所有權的稀釋：一旦功能交付，人員離開，這些功能隨著時間的推移變得不受支持，並且通常被放棄。

此外，Viceroy 專案的範圍隨著時間的推移而擴大。它在啟動時有雄心勃勃的目標，但初始範圍是有限的。然而，隨著範圍的擴大，我們努力按時交付核心功能，並不得不改進專案管理和設定更清晰的方向，以確保專案保持在軌道上。

最後，Viceroy 團隊發現很難完全擁有一個由分佈式站點做出重大（決定性）貢獻的組件。即使有最好的意願，人們通常也會默認走阻力最小的路徑，在本地討論問題或做決策，而不涉及遠程的所有者，這可能導致衝突。

## 建議

您只應該在必要時才跨站點開發專案，但通常有很好的理由必須這樣做。跨站點工作的成本是行動延遲更高，需要更多溝通；好處是，如果您把機制做對了，吞吐量會高得多。單一站點的專案也可能陷入除了該站點之外沒有人知道您在做什麼的困境，所以兩種方法都有成本。

有動力的貢獻者很有價值，但並非所有貢獻都同樣有價值。確保專案貢獻者是真正投入的，而不是僅僅帶著一些模糊的自我實現目標加入（想在自己的腰帶上添一筆，將自己的名字附加到一個閃亮的專案上；想在一個新的令人興奮的專案上編碼，而不承諾維護該專案）。有特定目標要實現的貢獻者通常會更有動力，並且會更好地維護他們的貢獻。

隨著專案的發展，它們通常會增長，而您並不總是很幸運地在您的本地團隊中有人員為專案做出貢獻。因此，請仔細考慮專案結構。專案領導者很重要：他們為專案提供長遠的願景，並確保所有工作都與該願景保持一致並得到正確的優先級排序。您還需要有一個商定的決策方式，並且如果存在高度的一致和信任，應特別優化以在本地做出更多決策。

標準的「分而治之」策略適用於跨站點專案；您主要通過將專案拆分成盡可能多的合理大小的組件來降低溝通成本，並試圖確保每個組件都可以分配給一個小組，最好是在一個站點內。在專案子團隊之間分配這些組件，並建立明確的可交付成果和截止日期。（盡量不要讓康威定律過於深刻地扭曲軟件的自然形態。）

專案團隊的目標最好是面向提供某些功能或解決某些問題。這種方法確保了從事組件工作的個人知道對他們的期望是什麼，並且他們的工作只有在該組件完全整合並在主專案中使用後才算完成。

顯然，通常的工程最佳實踐適用於協作專案：每個組件都應該有設計文檔和團隊審查。通過這種方式，團隊中的每個人都有機會了解變更的最新情況，並有機會影響和改進設計。**把事情寫下來**是您用來抵消物理和/或邏輯距離的主要技巧之一——使用它。

標準很重要。編碼風格指南是一個好的開始，但它們通常很戰術性，因此只是建立團隊規範的起點。每當圍繞一個問題選擇哪個方案進行辯論時，與團隊充分辯論——但有嚴格的時間限制。然後選擇一個解決方案，記錄下來，然後繼續前進。如果您無法達成一致，您需要選擇一個每個人都尊重的仲裁者，然後再次前進。隨著時間的推移，您將建立起這些最佳實踐的集合，這將有助於新人快速上手。

最終，沒有什麼可以替代親身互動，儘管一部分面對面的互動可以通過善用視訊會議和良好的書面溝通來推遲。如果可以的話，讓專案的領導者親自與團隊的其他成員見面。如果時間和預算允許，組織一次團隊峰會，以便團隊的所有成員都可以親身互動。峰會也為敲定設計和目標提供了絕佳的機會。對於中立性很重要的情況，將團隊峰會安排在中立地點是有利的，這樣任何單個站點都沒有「主場優勢」。

最後，使用適合專案當前狀態的專案管理風格。即使是雄心勃勃的專案也會從小處著手，所以開銷應該相應地低。隨著專案的增長，適應和改變專案的管理方式是合適的。如果增長足夠大，**將需要完整的專案管理**。

# SRE 之外的協作

正如我們所建議的，以及《不斷演進的 SRE 參與模型》所討論的，產品開發組織與 SRE 之間的協作在設計階段的早期進行時效果最好，理想情況下是在提交任何一行代碼之前。SRE 最適合就架構和軟件行為提出建議，這些建議可能很難（如果不是不可能的話）進行改造。在設計新系統時，讓那個聲音在場對每個人都更好。廣義上講，我們使用目標與關鍵結果（OKR）流程 [Kla12] 來追踪這類工作。對於一些服務團隊來說，這種協作是他們工作的主體——追踪新設計、提出建議、幫助實施它們，並將它們貫徹到生產中。

# 案例研究：將 DFP 遷移到 F1

現有服務的大型遷移專案在 Google 相當普遍。典型的例子包括將服務組件移植到新技術或更新組件以支持新數據格式。隨著最近引入了可以擴展到全球級別的數據庫技術，例如 Spanner [Cor12] 和 F1 [Shu13]，Google 已經進行了許多涉及數據庫的大規模遷移專案。其中一個專案是將 DoubleClick for Publishers（DFP）的主數據庫從 MySQL 遷移到 F1。特別是，本章的一些作者負責服務系統的一部分（如圖 31-1 所示），該系統不斷地從數據庫中提取和處理數據，以生成一組索引文件，然後在全球範圍內加載和提供服務。該系統分佈在多個數據中心，每天使用約 1,000 個 CPU 和 8 TB 的 RAM 來索引 100 TB 的數據。

這次遷移非同小可：除了遷移到新技術外，數據庫模式還進行了顯著的重構和簡化，這要歸功於 F1 能夠在表列中存儲和索引協議緩衝區數據。目標是遷移處理系統，使其能夠產生與現有系統完全相同的輸出。這使我們能夠保持服務系統不變，並從用戶的角度執行無縫遷移。作為一個額外的限制，產品要求我們在任何時候都不能對我們的用戶造成任何服務中斷的情況下完成實時遷移。為了實現這一點，產品開發團隊和 SRE 團隊從一開始就密切合作，開發新的索引服務。

作為其主要開發者，產品開發團隊通常更熟悉軟件的**業務邏輯（BL）**，並且與產品經理和產品的實際「業務需求」部分接觸更緊密。另一方面，SRE 團隊通常在軟件的基礎設施組件方面擁有更多專業知識（例如，與分佈式存儲系統或數據庫通信的庫），因為 SRE 經常在不同服務之間重用相同的構建塊，學習了許多允許軟件隨著時間的推移可擴展且可靠運行的注意事項和細微之處。

從遷移專案一開始，產品開發和 SRE 就知道他們必須更加緊密地協作，每週召開會議以同步專案進度。在這個特定案例中，業務邏輯的變更部分依賴於基礎設施的變更。因此，專案始於新基礎設施的設計；擁有大規模提取和處理數據領域廣泛知識的 SRE 推動了基礎設施變更的設計。這包括設計如何從 F1 中提取各種表，如何過濾和連接數據，如何只提取已更改的數據（而不是整個數據庫），如何承受部分機器丟失而不影響服務，如何確保資源使用隨提取數據量的增加而線性增長，容量規劃以及許多其他類似方面。新提議的基礎設施與已經從 F1 提取和處理數據的其他服務相似。因此，我們可以確信解決方案的健全性，並重用部分監控和工具。

在進行這個新基礎設施的開發之前，兩名 SRE 製作了一份詳細的設計文檔。然後，產品開發和 SRE 團隊都徹底審查了該文檔，調整了解決方案以處理一些邊緣情況，並最終就設計計劃達成一致。這樣的計劃清楚地確定了新基礎設施將為業務邏輯帶來什麼樣的變更。例如，我們設計了新基礎設施只提取已更改的數據，而不是重複提取整個數據庫；業務邏輯必須考慮到這種新方法。早期，我們定義了基礎設施和業務邏輯之間的新接口，這樣做使得產品開發團隊可以獨立地進行業務邏輯的變更。同樣，產品開發團隊也讓 SRE 了解業務邏輯的變更。在它們相互作用的地方（例如，依賴於基礎設施的業務邏輯變更），這種協調結構使我們能夠知道變更正在發生，並快速正確地處理它們。

在專案的後期階段，SRE 開始在一個類似於專案最終完成的生產環境的測試環境中部署新服務。這一步驟對於衡量服務的預期行為至關重要——特別是性能和資源利用率——而業務邏輯的開發仍在進行中。產品開發團隊使用這個測試環境來對新服務進行驗證：由舊服務（在生產中運行）產生的廣告索引必須與由新服務（在測試環境中運行）產生的索引完全匹配。正如所料，驗證過程突顯了新舊服務之間的差異（由於新數據格式中的一些邊緣情況），產品開發團隊能夠迭代地解決這些問題：對於每個廣告，他們調試差異的原因並修復產生錯誤輸出的業務邏輯。與此同時，SRE 團隊開始準備生產環境：在不同的數據中心分配必要的資源，設置流程和監控規則，並培訓指定為該服務 on-call 的工程師。SRE 團隊還建立了一個基本的發布流程，其中包括驗證，這項任務通常由產品開發團隊或發布工程師完成——但在這個特定案例中由 SRE 完成以加快遷移速度。

當服務準備就緒時，SRE 與產品開發團隊合作準備了一份推出計劃，並啟動了新服務。這次啟動非常成功，進展順利，沒有任何可見的用戶影響。

# 結論

鑑於 SRE 團隊的全球分佈性，有效的溝通在 SRE 中始終是高度優先的事項。本章討論了 SRE 團隊用來維持其團隊內部以及與其各種合作夥伴團隊之間有效關係的工具和技術。

SRE 團隊之間的協作有其挑戰，但也有潛在的巨大回報，包括解決問題的平台的通用方法，讓我們能夠專注於解決更困難的問題。
