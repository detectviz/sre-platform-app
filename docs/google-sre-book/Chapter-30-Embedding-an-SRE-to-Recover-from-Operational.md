# 嵌入 SRE 以從運營過載中恢復

作者：Randall Bosetti，編輯：Diane Bates

Google SRE 團隊的標準政策是將他們的時間平均分配在專案和被動的運營工作之間。在實踐中，這種平衡可能會因為每日工單量的增加而被打亂數月之久。繁重的運營工作量尤其危險，因為 SRE 團隊可能會因此而精疲力竭，或者無法在專案工作上取得進展。當一個團隊必須不成比例地分配時間來解決工單，而犧牲了改善服務的時間時，可擴展性和可靠性就會受到影響。

緩解這種負擔的一種方法是暫時將一名 SRE 調入這個不堪重負的團隊。一旦嵌入團隊，SRE 的重點是改善團隊的實踐，而不是僅僅幫助團隊清空工單隊列。SRE 觀察團隊的日常工作，並提出改善其實踐的建議。這種諮詢為團隊提供了對其日常工作的新視角，這是團隊成員自己無法提供的。

在使用這種方法時，沒有必要調動超過一名工程師。兩名 SRE 不一定能產生更好的結果，如果團隊反應防禦性，實際上可能會引起問題。

如果您正在組建您的第一個 SRE 團隊，本章概述的方法將幫助您避免變成一個只專注於工單輪換的運營團隊。如果您決定將自己或您的一名下屬嵌入一個團隊，請花時間回顧 Ben Treynor Sloss 的介紹中的 SRE 實踐和哲學，以及《監控分散式系統》中關於監控的材料。

以下各節為將被嵌入團隊的 SRE 提供指導。

## 第一階段：學習服務並了解背景

您在嵌入團隊期間的工作是闡明流程和習慣為何有助於或有損於服務的可擴展性。提醒團隊，更多的工單不應該需要更多的 SRE：SRE 模型的目標是僅在系統增加更多複雜性時才引入更多的人。相反，試著將注意力引向健康的工作習慣如何減少花在工單上的時間。這樣做與指出自動化或簡化服務的錯失機會同樣重要。

**運營模式**一詞指的是維持服務運行的某種方法。各種工作項目隨著服務規模的擴大而增加。例如，一個服務需要一種方法來隨著其增長而增加配置的虛擬機（VM）數量。處於運營模式的團隊通過擁有更多管理這些 VM 的管理員來應對。SRE 則專注於編寫軟件或消除可擴展性問題，以便運行服務所需的人數不會隨著服務負載的增加而增加。

滑入運營模式的團隊可能會被說服，認為規模對他們不重要（「我的服務很小」）。跟隨一次 on-call 輪班來確定這個評估是否屬實，因為規模的因素會影響您的策略。

如果主要服務對業務很重要但實際上很小（資源少或複雜性低），則應更專注於團隊當前方法如何阻止他們提高服務的可靠性。請記住，您的工作是讓服務正常運行，而不是保護開發團隊免受警報的影響。

另一方面，如果服務才剛剛起步，則應專注於為團隊準備應對爆炸性增長的方法。一個每秒 100 個請求的服務可能在一年內變成每秒 1 萬個請求的服務。

## 識別最大的壓力來源

SRE 團隊有時會陷入運營模式，因為他們專注於如何快速處理緊急情況，而不是如何減少緊急情況的數量。默認進入運營模式通常是對壓倒性壓力（無論是真實的還是想像的）的回應。在您對服務有足夠的了解，可以就其設計和部署提出尖銳問題之後，花一些時間根據各種服務中斷對團隊壓力水平的影響來對其進行優先級排序。請記住，由於團隊的視角和歷史，一些非常小的問題或中斷可能會產生過度的壓力。

## 識別隱患 (Kindling)

一旦您識別出團隊最大的現有問題，就轉向等待發生的緊急情況。有時，即將發生的緊急情況是以一個未被設計為自我管理的新子系統的形式出現的。其他來源包括：

- 容量規劃不足
- 推出流程不佳
- 測試覆蓋率低
- 團隊成員對服務的不同部分有不同的理解

# 第二階段：分享背景

在了解了團隊的動態和痛點之後，通過事後檢討等最佳實踐為改進奠定基礎，並識別瑣事的來源以及如何最好地解決它們。

## 為團隊寫一份好的事後檢討報告

事後檢討報告能提供對團隊集體推理的深刻見解。不健康的團隊進行的事後檢討報告通常是無效的。一些團隊成員可能認為事後檢討報告是懲罰性的，甚至是無用的。雖然您可能很想審查事後檢討報告的檔案並留下改進意見，但這樣做對團隊沒有幫助。相反，這個練習可能會讓團隊處於防禦狀態。

與其試圖糾正以前的錯誤，不如接手下一次的事後檢討報告。在您被嵌入期間，肯定會發生中斷。如果您不是 on-call 的人，與 on-call 的 SRE 合作，寫一份出色的、無指責的事後檢討報告。這份文件是一個機會，可以展示轉向 SRE 模型如何通過使錯誤修復更持久來使團隊受益。更持久的錯誤修復可以減少中斷對團隊成員時間的影響。

如前所述，您可能會遇到諸如「為什麼是我？」這樣的回應。當團隊認為事後檢討過程是報復性的時，這種回應尤其可能出現。這種態度來自於信奉**壞蘋果理論**：系統運行良好，如果我們擺脫了所有的壞蘋果和他們的錯誤，系統將繼續良好。壞蘋果理論顯然是錯誤的，正如來自包括航空安全在內的多個學科的證據 [Dek14] 所示。您應該指出這一點。事後檢討報告最有效的措辭是說：「在任何具有多個微妙互動的系統中，錯誤都是不可避免的。您當時在 on-call，我相信您在掌握正確資訊的情況下會做出正確的決定。我希望您能寫下您在每個時間點的想法，以便我們能找出系統在哪裡誤導了您，以及認知需求過高的地方。」

## 按類型對火災進行分類

在這個為方便而簡化的模型中，有兩種火災：

- **有些火災本不應該存在。** 它們導致了通常被稱為運營工作或瑣事（見《消除瑣事》）的事情。
- **其他引起壓力**和/或狂敲鍵盤的火災實際上是工作的一部分。

無論哪種情況，團隊都需要建立工具來控制火勢。

將團隊的火災分為**瑣事**和**非瑣事**。完成後，將列表呈現給團隊，並清楚地解釋為什麼每場火災要麼是應該自動化的工作，要麼是運行服務可接受的開銷。

# 第三階段：推動變革

團隊健康是一個過程。因此，這不是您能通過英雄般的努力解決的事情。為了確保團隊能夠自我調節，您可以幫助他們建立一個理想的 SRE 參與模式的良好心智模型。

人類非常擅長體內平衡，所以專注於創造（或恢復）正確的初始條件，並教授做出健康選擇所需的一小套原則。

## 從基礎開始

在 SRE 和傳統運營模型之間掙扎的團隊，通常無法闡明為什麼團隊的代碼、流程或文化的某些方面會困擾他們。與其試圖逐點解決這些問題，不如從《引言》和《監控分散式系統》中概述的原則出發。

您對團隊的第一個目標應該是**撰寫服務水平目標（SLO）**，如果還沒有的話。SLO 很重要，因為它提供了對中斷影響的量化衡量，以及流程變更可能有多重要。**SLO 可能是將團隊從被動的運營工作轉向健康的、長期的 SRE 重點的最重要的單一槓桿。** 如果缺少這個協議，本章中的任何其他建議都將無濟於事。如果您發現自己所在的團隊沒有 SLO，請先閱讀《服務水平目標》，然後將技術主管和管理層召集到一個房間裡開始協商。

## 尋求幫助清除隱患

您可能有強烈的衝動想親自解決您發現的問題。請抵制自己解決這些問題的衝動，因為這樣做會強化「做改進是別人的事」的想法。相反，請採取以下步驟：

1. 找到一個團隊成員可以完成的有用工作。
2. 清楚地解釋這項工作如何**以永久的方式**解決事後檢討報告中的一個問題。即使是健康的團隊也可能產生短視的行動項目。
3. 擔任代碼更改和文件修訂的審查者。
4. 對兩三個問題重複此過程。

當您識別出一個額外的問題時，將其放入一個錯誤報告或文件中，供團隊查閱。這樣做有雙重目的：分發資訊和鼓勵團隊成員編寫文件（這通常是截止日期壓力的第一個犧牲品）。始終解釋您的理由，並強調好的文件可以確保團隊不會在稍微新的背景下重複舊的錯誤。

## 解釋您的理由

隨著團隊恢復動力並掌握您建議的變革的基礎知識，轉向解決最初導致運營過載的日常決策。準備好這項工作會受到挑戰。如果您幸運的話，挑戰將是這樣的：「解釋為什麼。現在。在每週的生產會議中間。」

如果您不幸，沒有人要求解釋。通過簡單地解釋您所有的決定，無論是否有人要求解釋，來完全避開這個問題。參考支撐您建議的基礎知識。這樣做有助於建立團隊的心智模型。在您離開後，團隊應該能夠預測您對一個設計或變更列表的評論會是什麼。如果您不解釋您的理由，或者解釋得不好，團隊很可能會模仿那種懶散的行為，所以要明確。

**對您的決定進行詳盡解釋的例子：**
- 「我不是因為測試不好而反對最新的發布。我反對是因為我們為發布設定的錯誤預算已經用盡了。」
- 「發布需要是可回滾的，因為我們的 SLO 很嚴格。滿足這個 SLO 要求平均恢復時間很短，所以在回滾前進行深入診斷是不現實的。」

**對您的決定解釋不充分的例子：**
- 「我認為讓每個伺服器生成自己的路由配置不安全，因為我們看不到它。」
  這個決定可能是正確的，但理由很差（或解釋得很差）。團隊無法讀懂您的心思，所以他們很可能會模仿觀察到的差勁理由。相反，試著說：「[…] 不安全，因為該代碼中的一個錯誤可能導致整個服務的相關故障，而且額外的代碼是可能減慢回滾的錯誤來源。」
- 「如果遇到衝突的部署，自動化應該放棄。」
  像前面的例子一樣，這個解釋可能是正確的，但不足夠。相反，試著說：「[…] 因為我們做了一個簡化的假設，即所有更改都通過自動化，而顯然有東西違反了這個規則。如果這種情況經常發生，我們應該識別並消除無組織的更改來源。」

## 提出引導性問題

引導性問題不是誘導性問題。在與 SRE 團隊交談時，試著以鼓勵人們思考基本原則的方式提問。您示範這種行為特別有價值，因為根據定義，處於運營模式的團隊會拒絕其自身成員的這種推理。在您花了一些時間解釋您對各種政策問題的理由之後，這種實踐會加強團隊對 SRE 哲學的理解。

**引導性問題的例子：**
- 「我看到 TaskFailures 警報頻繁觸發，但 on-call 工程師通常不會對此警報做出任何回應。這對 SLO 有何影響？」
- 「這個啟動過程看起來很複雜。您知道為什麼在創建服務的新實例時需要更新這麼多配置文件嗎？」

**引導性問題的反例：**
- 「這些舊的、停滯的發布是怎麼回事？」
- 「為什麼 Frobnitzer 做這麼多事情？」

# 結論

遵循本章中概述的原則，為 SRE 團隊提供以下內容：
- 一個技術性的，可能是量化的，關於他們為什麼應該改變的視角。
- 一個強有力的例子，說明變革是什麼樣子的。
- 對 SRE 使用的許多「民間智慧」的邏輯解釋。
- 以可擴展的方式處理新情況所需的核心原則。

您最後的任務是寫一份**行動後報告**。這份報告應該重申您的視角、例子和解釋。它還應該為團隊提供一些行動項目，以確保他們練習您所教的內容。您可以將報告組織成一份**事後總結報告 (postvitam)**，解釋導致成功的每一步的關鍵決策。

參與的大部分工作現已完成。一旦您的嵌入任務結束，您應該繼續為設計和代碼審查提供支持。在接下來的幾個月裡，繼續關注團隊，以確認他們在容量規劃、應急響應和推出流程方面正在緩慢改進。
