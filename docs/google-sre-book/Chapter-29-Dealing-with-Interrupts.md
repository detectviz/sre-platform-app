## 處理中斷

作者：Dave O’Connor，編輯：Diane Bates

「運營負載」，當應用於複雜系統時，是指為維持系統功能狀態而必須完成的工作。例如，如果您擁有一輛汽車，您（或您付錢的人）總是要對其進行保養、加油或進行其他定期維護，以使其保持其功能。

任何複雜的系統都與其創造者一樣不完美。在管理這些系統產生的運營負載時，請記住，其創造者也是不完美的機器。

當應用於管理複雜系統時，**運營負載**會以多種形式出現，有些比其他的更明顯。術語可能會改變，但運營負載可分為三大類：頁面、工單和持續的運營活動。

**頁面**涉及生產警報及其後續影響，並在應對生產緊急情況時觸發。它們有時可能是單調和重複的，幾乎不需要思考。它們也可能引人入勝，涉及戰術性的深入思考。頁面總是有一個預期的響應時間（SLO），有時以分鐘為單位。

**工單**涉及需要您採取行動的客戶請求。與頁面一樣，工單可以是簡單而乏味的，也可以需要真正的思考。一個簡單的工單可能會請求對團隊擁有的配置進行代碼審查。一個更複雜的工單可能需要一個特殊或不尋常的請求，以尋求設計或容量計劃的幫助。工單也可能有 SLO，但響應時間更可能以小時、天或週為單位。

**持續的運營職責**（也稱為「踢皮球」和「瑣事」；見《消除瑣事》）包括團隊擁有的代碼或標誌的推出，或對客戶的臨時、有時效性問題的回應等活動。雖然它們可能沒有定義的 SLO，但這些任務可能會中斷您。

某些類型的運營負載很容易預期或計劃，但大部分負載是計劃外的，或者可能在不特定的時間中斷某人，需要該人確定問題是否可以等待。

# 管理運營負載

Google 在團隊層面管理每種類型的運營負載有幾種方法。

**頁面**最常由一個專職的主要 on-call 工程師管理。這是一個人，他回應頁面並管理由此產生的事件或中斷。主要 on-call 工程師也可能管理用戶支持溝通、向產品開發人員升級等。為了最小化頁面對團隊的中斷並避免旁觀者效應，Google 的 on-call 輪班由一名工程師負責。如果問題不被充分理解，on-call 工程師可能會將頁面升級給另一位團隊成員。

通常，**次要 on-call 工程師**作為主要工程師的備份。次要工程師的職責各不相同。在某些輪班中，次要工程師的唯一職責是在頁面遺漏時聯繫主要工程師。在這種情況下，次要工程師可能在另一個團隊。次要工程師可能會或可能不會認為自己處於**中斷**狀態，這取決於職責。

**工單**的管理方式有幾種，取決於 SRE 團隊：主要 on-call 工程師可能在 on-call 時處理工單，次要工程師可能在 on-call 時處理工單，或者團隊可以有一個專職的工單處理人員，該人員不是 on-call。工單可能會在團隊成員之間隨機自動分配，或者團隊成員可能被期望臨時處理工單。

**持續的運營職責**也以不同的方式管理。有時，on-call 工程師會做這項工作（推送、標誌翻轉等）。或者，每個職責可以臨時分配給團隊成員，或者 on-call 工程師可能會接手一個持續的職責（即，一個持續數週的推出或工單），這個職責會持續到他們的輪班週之後。

# 決定如何處理中斷的因素

從管理運營負載的機制退一步看，有許多指標因素影響著這些中斷的處理方式。Google 的一些 SRE 團隊發現以下指標在決定如何管理中斷時很有用：

- 中斷 SLO 或預期響應時間
- 通常積壓的中斷數量
- 中斷的嚴重性
- 中斷的頻率
- 可用於處理某類中斷的人數（例如，一些團隊在 on-call 前需要一定的工單工作量）

您可能會注意到，所有這些指標都適用於滿足最低可能的響應時間，而沒有考慮到更多的人為成本。試圖評估人力和生產力成本是困難的。

# 不完美的機器

人類是不完美的機器。他們會感到無聊，他們的處理器（有時還有用戶界面）並未被很好地理解，而且他們不是很有效率。認識到人的因素是「按預期工作」並試圖圍繞或改善人的工作方式，這可能需要比這裡提供的更大的篇幅；目前，一些基本的想法在決定中斷應該如何運作時可能會有用。

## 認知心流狀態

心流狀態的概念被廣泛接受，並且幾乎每個在軟件工程、系統管理、SRE 或大多數其他需要集中精力時期的學科工作的人都可以憑經驗承認。處於「心流」狀態可以提高生產力，但也可以增加藝術和科學創造力。達到這種狀態鼓勵人們真正掌握和改進他們正在從事的任務或項目。如果中斷足夠具有破壞性，被打斷會把你從這種狀態中踢出來。**您希望最大化處於這種狀態的時間。**

認知心流也可以應用於較少創造性的追求，其中所需的技能水平較低，但心流的基本要素仍然得到滿足（明確的目標、即時的反饋、控制感和相關的時間扭曲）；例子包括做家務或開車。

您可以通過處理低技能、低難度的問題來進入心流狀態，例如玩一個重複性的電子遊戲。您也可以通過處理高技能、高難度的問題來同樣容易地達到那裡，例如工程師可能面臨的問題。達到認知心流狀態的方法不同，但結果本質上是相同的。

### 認知心流狀態：創造性和投入

這就是心流：某人處理一個問題一段時間，對問題的參數感到熟悉和舒適，並感覺他們可以修復或解決它。這個人專注於問題，忘記了時間，並盡可能地忽略中斷。最大化一個人在這種狀態下可以花費的時間是非常可取的——他們將產生創造性的結果，並在數量上做好工作。他們在他們正在做的工作中會更快樂。

不幸的是，許多在 SRE 類型角色中的人大部分時間都花在試圖進入這種模式而失敗，並在無法進入時感到沮喪，或者從未嘗試達到這種模式，而是在中斷狀態中 languish。

### 認知心流狀態：憤怒鳥

人們喜歡執行他們知道如何做的任務。事實上，執行這樣的任務是達到認知心流的最清晰路徑之一。一些 SRE 在 on-call 時達到認知心流狀態。追查問題的原因，與他人合作，並以如此切實的方式改善系統的整體健康狀況，可能會非常令人滿足。相反，對於大多數壓力過大的 on-call 工程師來說，壓力要麼是由於頁面量，要麼是因為他們把 on-call 當作中斷來對待。他們試圖在 on-call 或全職中斷的同時編寫代碼或從事項目。這些工程師處於持續中斷或**可中斷性**的狀態。這種工作環境壓力極大。

另一方面，當一個人全職專注於中斷時，**中斷就不再是中斷了**。在一個非常本能的層面上，對系統進行增量改進，處理工單，以及修復問題和中斷，成為一套清晰的目標、界限和清晰的反饋：您關閉了 X 個錯誤，或者您不再收到頁面。剩下的只是分心。**當您在處理中斷時，您的項目就是分心**。儘管中斷在短期內可能是令人滿意的時間利用，但在混合項目/on-call 環境中，人們最終對這兩種工作類型之間的平衡感到更快樂。理想的平衡因工程師而異。重要的是要意識到，一些工程師可能實際上並不知道哪種平衡最能激勵他們（或者可能認為他們知道，但您可能不同意）。

## 一件事做好

您可能想知道到目前為止您所讀到的內容的實際含義。

以下建議，基於我在 Google 管理的各種 SRE 團隊的經驗，主要針對團隊經理或有影響力的人。本文檔對個人習慣持不可知論態度——人們可以自由地按照他們認為合適的方式管理自己的時間。這裡的重點是指導團隊本身管理中斷的結構，以便人們不會因為團隊功能或結構而失敗。

### 可分心性

工程師可能被分心，從而無法達到認知心流狀態的方式有很多。例如：考慮一個名叫 Fred 的隨機 SRE。Fred 在周一早上來上班。Fred 今天不是 on-call 或處理中斷，所以 Fred 顯然想做他的項目。他拿了一杯咖啡，戴上他的「請勿打擾」耳機，坐在他的辦公桌前。心流時間，對吧？

然而，在任何時候，都可能發生以下任何事情：
- Fred 的團隊使用自動化工單系統隨機將工單分配給團隊。一個工單被分配給他，今天到期。
- Fred 的同事正在 on-call，並收到一個關於 Fred 是專家的組件的頁面，並中斷他詢問此事。
- Fred 的服務的一個用戶提高了自上週他 on-call 以來分配給他的一個工單的優先級。
- 一個為期 3-4 週並分配給 Fred 的標誌推出出錯了，迫使 Fred 放下一切來檢查推出，回滾更改等。
- Fred 的服務的一個用戶聯繫 Fred 問一個問題，因為 Fred 是一個如此樂於助人的人。
- 等等。

最終結果是，即使 Fred 有整個日曆日的時間來做項目，他仍然極易分心。其中一些分心他可以自己管理，例如關閉電子郵件、關閉即時通訊或採取其他類似措施。一些分心是由於政策，或由於圍繞中斷和持續職責的假設造成的。

您可以聲稱一定程度的分心是不可避免的，並且是設計使然。這個假設是正確的：人們確實會掛念他們是主要聯繫人的錯誤，人們也會建立起其他職責和義務。然而，團隊可以通過一些方式來管理中斷響應，以便更多的人（平均而言）可以在早上來上班時感到**不可分心**。

### 極化時間

為了限制您的可分心性，您應該盡量減少上下文切換。一些中斷是不可避免的。然而，將工程師視為一個可中斷的工作單元，其上下文切換是免費的，如果您希望人們快樂和高效，這是不理想的。**為上下文切換分配成本。** 在從事項目時 20 分鐘的中斷需要兩次上下文切換；實際上，這種中斷導致了幾個小時真正高效工作的損失。為了避免不斷發生生產力損失，目標是在工作風格之間實現**極化時間**，每個工作時段盡可能長。理想情況下，這個時間段是一周，但一天甚至半天可能更實用。這個策略也符合**創造時間**的互補概念。

**極化時間**意味著當一個人每天來上班時，他們應該知道他們是只做項目工作還是只處理中斷。以這種方式極化他們的時​​間意味著他們可以在手頭的任務上集中更長的時間。他們不會因為被捲入那些讓他們遠離他們應該做的工作的任務而感到壓力。

## 說真的，告訴我該怎麼做

如果本章中提出的一般模型不適合您，這裡有一些您可以零散實施的具體建議。

### 一般建議

對於任何給定的中斷類別，**如果中斷量對於一個人來說太高，就增加一個人**。這個概念最明顯地適用於工單，但也有可能適用於頁面——on-call 可以開始將事情轉給他們的次要人員，或者將頁面降級為工單。

### On-call

**主要 on-call 工程師應專注於 on-call 工作。** 如果您的服務的頁面很安靜，那麼可以相當快地放棄的工單或其他基於中斷的工作應該是 on-call 職責的一部分。當一個工程師 on-call 一周時，那一周就應該被視為項目工作方面的損失。如果一個項目太重要以至於不能延遲一周，那麼這個人就不應該 on-call。升級以便將 on-call 輪班分配給其他人。**一個人永遠不應該被期望既 on-call 又在項目（或任何其他具有高上下文切換成本的事情）上取得進展。**

次要職責取決於這些職責有多繁重。如果次要的功能是在主要人員遺漏時備份，那麼也許您可以安全地假設次要人員也可以完成項目工作。如果其他人被分配處理工單，而不是次要人員，請考慮合併角色。如果期望次要人員在頁面量高時實際幫助主要人員，他們也應該做中斷工作。

（旁白：**您永遠不會用完清理工作**。您的工單數量可能為零，但總有需要更新的文件，需要清理的配置等。您未來的 on-call 工程師會感謝您，這意味著他們在您寶貴的創造時間內打擾您的可能性較小）。

### 工單

**如果您目前隨機將工單分配給您團隊中的受害者，請停止。** 這樣做極不尊重您團隊的時間，並且完全違背了盡可能不被中斷的原則。

工單應該是一個全職角色，時間長度對一個人來說是可管理的。如果您不幸處於工單數量超過主要和次要 on-call 工程師總和可以關閉的位置，那麼將您的工單輪換結構化為在任何給定時間有兩個人處理工單。不要將負載分散到整個團隊。人不是機器，您只是在引起影響寶貴心流時間的上下文切換。

### 持續職責

盡可能地，定義讓團隊中任何人都可以接手的角色。如果有明確的執行和驗證推送或標誌翻轉的程序，那麼就沒有理由一個人必須在其整個生命週期內看護該更改，即使他們不再 on-call 或處理中斷。定義一個**推送經理**角色，他可以在 on-call 或處理中斷期間處理推送。**正式化交接過程**——為了非 on-call 人員不間斷的創造時間，這是一個很小的代價。

### 要麼處理中斷，要麼不處理

有時，當一個人不處理中斷時，團隊會收到一個該人特別有資格處理的中斷。雖然理想情況下這種情況永遠不應該發生，但有時確實會發生。您應該努力使這種情況變得罕見。

有時人們在沒有被分配處理工單時處理工單，因為這是一種讓自己看起來很忙的簡單方法。這種行為沒有幫助。這意味著這個人不如他們應該的那麼有效。他們在工單負載的可管理性方面扭曲了數字。如果一個人被分配處理工單，但另外兩三個人也嘗試處理工單隊列，您可能仍然有一個無法管理的工單隊列，即使您沒有意識到。

## 減少中斷

如果您的團隊的中斷負載需要太多團隊成員在任何給定時間同時處理中斷，那麼它可能是無法管理的。您可以使用許多技術來全面減少您的工單負載。

### 真正分析工單

許多工單輪換或 on-call 輪換的功能就像一個挑戰賽。這在較大的團隊中尤其如此。如果您每隔幾個月才處理一次中斷，那麼跑完挑戰賽，鬆一口氣，然後回到您的常規職責是很容易的。您的繼任者然後也這樣做，工單的根本原因從未被調查。您的團隊沒有取得進展，而是被一連串被同樣問題惹惱的人所困擾。

應該有工單的交接，以及 on-call 工作的交接。交接過程在責任轉換時維持工單處理者之間的共享狀態。即使對中斷的根本原因進行一些基本的反思，也可以為降低總體率提供好的解決方案。許多團隊進行 on-call 交接和頁面審查。很少有團隊對工單做同樣的事情。

您的團隊應該定期對工單和頁面進行清理，在其中您檢查中斷的類別，看看是否可以確定根本原因。**如果您認為根本原因可以在合理的時間內修復，那麼在預期修復根本原因之前，將中斷靜音。** 這樣做為處理中斷的人提供了緩解，並為修復根本原因的人創造了一個方便的截止日期執行。

### 尊重自己，也尊重您的客戶

這句格言更多地適用於用戶中斷，而不是自動中斷，儘管原則對兩種情況都成立。如果工單特別煩人或解決起來很繁重，您可以有效地使用政策來減輕負擔。

記住：
- **您的團隊設定了您的服務所提供的服務水平。**
- **將一些努力推回給您的客戶是可以的。**

如果您的團隊負責處理客戶的工單或中斷，您通常可以使用政策使您的工作負載更易於管理。政策修復可以是臨時的或永久的，取決於什麼是有意義的。這樣的修復應該在尊重客戶和尊重自己之間取得良好的平衡。**政策可以像代碼一樣強大。**

例如，如果您支持一個特別不穩定且沒有太多開發人員資源的工具，並且有少數有需求的客戶使用它，請考慮其他選項。想想您為這個系統做中斷所花費的時間的價值，以及您是否明智地花費了這段時間。在某個時候，如果您無法獲得修復導致中斷的問題的根本原因所需的關注，也許您正在支持的組件並不是那麼重要。您應該考慮交還頁面、棄用它、替換它，或者在這個方向上可能有意義的其他策略。

如果中斷的某些步驟耗時或棘手，但不需要您的權限來完成，請考慮使用政策將請求推回給請求者。例如，如果人們需要捐贈計算資源，準備一個代碼或配置更改或一些類似的步驟，然後指示客戶執行該步驟並將其發送給您審查。請記住，如果客戶希望完成某項任務，他們應該準備好花費一些精力來得到他們想要的。

前述解決方案的一個警告是，您需要在尊重客戶和尊重自己之間找到平衡。您在構建處理客戶請求的策略時的指導原則是，請求應該是有意義的、合理的，並提供您完成請求所需的所有信息和準備工作。作為回報，您的響應應該是有幫助和及時的。
