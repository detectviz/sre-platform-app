# 從其他行業學到的教訓

作者：Jennifer Petoff
編輯：Betsy Beyer

對 Google SRE 文化和實踐的深入探討，自然會引出一個問題：其他行業是如何管理其業務以實現可靠性的？編寫這本關於 Google SRE 的書創造了一個機會，可以與 Google 的一些工程師就他們之前在各種其他高可靠性領域的工作經驗進行交談，以解決以下比較性問題：

-   網站可靠性工程中使用的原則在 Google 之外也重要嗎？或者其他行業是以截然不同的方式來應對高可靠性要求的？
-   如果其他行業也遵循 SRE 原則，這些原則是如何體現的？
-   在不同行業中，這些原則的實施有哪些相似之處和不同之處？
-   哪些因素驅動了實施上的相似性和差異性？
-   Google 和科技行業可以從這些比較中學到什麼？

本書通篇討論了 Google 網站可靠性工程的許多基本原則。為了簡化我們對其他行業最佳實踐的比較，我們將這些概念提煉為四個關鍵主題：

-   準備與災難測試
-   事後檢討文化
-   自動化與減少運營開銷
-   結構化與理性決策

本章介紹了我們分析的行業以及我們採訪的行業資深人士。我們定義了關鍵的 SRE 主題，討論了這些主題在 Google 是如何實施的，並舉例說明這些原則在其他行業中是如何體現的，以供比較。最後，我們總結了一些我們發現的模式和反模式的見解和討論。

## 認識我們的行業資深人士

**Peter Dahl** 是 Google 的首席工程師。他之前曾作為國防承包商參與多個高可靠性系統，包括許多機載和輪式車輛的 GPS 及慣性導航系統。此類系統可靠性失誤的後果包括車輛故障或損失，以及與該故障相關的財務後果。

**Mike Doherty** 是 Google 的網站可靠性工程師。他曾在加拿大擔任救生員和救生員培訓師十年。在這個領域，可靠性本質上是絕對必要的，因為每天都有生命危在旦夕。

**Erik Gross** 目前是 Google 的軟件工程師。在加入公司之前，他花了七年時間設計用於屈光性眼科手術（如 LASIK）的激光和系統的算法和代碼。這是一個高風險、高可靠性的領域，在技術獲得 FDA 批准、逐漸改進並最終普及的過程中，學到了許多關於在政府法規和人類風險面前保持可靠性的教訓。

**Gus Hartmann** 和 **Kevin Greer** 在電信行業有經驗，包括維護 E911 緊急響應系統。Kevin 目前是 Google Chrome 團隊的軟件工程師，Gus 是 Google 企業工程團隊的系統工程師。用戶對電信行業的期望要求高可靠性。服務中斷的影響範圍從系統中斷造成的用戶不便到 E911 失效時的死亡事故。

**Ron Heiby** 是 Google 網站可靠性工程的技術專案經理。Ron 在手機、醫療設備和汽車行業的開發方面有經驗。在某些情況下，他從事這些行業的接口組件工作（例如，一種允許在救護車中的心電圖讀數通過數字無線電話網絡傳輸的設備）。在這些行業中，可靠性問題的影響範圍從設備召回對業務造成的損害到間接影響生命和健康（例如，如果心電圖無法與醫院通信，人們得不到所需的醫療關注）。

**Adrian Hilton** 是 Google 的啟動協調工程師。他之前曾在英國和美國的軍用飛機、海軍航空電子設備和飛機掛載管理系統以及英國鐵路信號系統方面工作。在這個領域，可靠性至關重要，因為事件的影響範圍從數百萬美元的設備損失到人員傷亡。

**Eddie Kennedy** 是 Google 全球客戶體驗團隊的專案經理，受過機械工程師的培訓。Eddie 曾作為六西格瑪黑帶流程工程師在一家製造合成鑽石的工廠工作了六年。這個行業的特點是對安全的 relentless 關注，因為工藝過程的極端溫度和壓力每天都對工人構成高度危險。

**John Li** 目前是 Google 的網站可靠性工程師。John 之前曾在一家金融行業的自營交易公司擔任系統管理員和軟件開發人員。金融領域的可靠性問題被非常嚴肅地對待，因為它們可能導致嚴重的財政後果。

**Dan Sheridan** 是 Google 的網站可靠性工程師。在加入公司之前，他曾在英國的民用核工業擔任安全顧問。在核工業中，可靠性很重要，因為一次事件可能產生嚴重後果：停電可能每天造成數百萬的收入損失，而對工人和社區的風險則更為嚴重，要求對故障零容忍。核基礎設施的設計帶有一系列故障安全裝置，可在任何此類規模的事件發生前停止操作。

**Jeff Stevenson** 目前是 Google 的硬件運營經理。他過去曾作為美國海軍潛艇上的核工程師。在核海軍中，可靠性的風險很高——事件發生時出現的問題範圍從設備損壞，到長期的環境影響，再到潛在的生命損失。

**Matthew Toia** 是一名專注於存儲系統的網站可靠性經理。在加入 Google 之前，他從事空中交通管制軟件系統的軟件開發和部署工作。這個行業事件的影響範圍從對乘客和航空公司的
不便（例如，航班延誤、飛機改道）到墜機事件中潛在的生命損失。**深度防禦**是避免災難性故障的關鍵策略。

現在您已經認識了我們的專家，並對他們各自前領域中可靠性為何重要有了高層次的了解，我們將深入探討可靠性的四個關鍵主題。

# 準備與災難測試

「希望不是一種策略。」這句 Google SRE 團隊的口號總結了我們所說的準備與災難測試的含義。SRE 文化永遠保持警惕並不斷質疑：可能會出什麼問題？我們可以採取什麼行動來在這些問題導致中斷或數據丟失之前解決它們？我們每年的**災難與恢復測試（DiRT）**演習旨在直接解決這些問題 [Kri12]。在 DiRT 演習中，SRE 將生產系統推向極限並造成實際中斷，以便：

-   確保系統按照我們的預期反應
-   確定意外的弱點
-   找出使系統更健壯的方法，以防止不受控制的中斷

從我們的對話中，其他行業測試災難準備和確保準備就緒的幾種策略浮現出來。策略包括：

-   組織對安全的 relentless 關注
-   注重細節
-   擺動容量
-   模擬和實彈演習
-   培訓和認證
-   對詳細需求收集和設計的執著關注
-   深度防禦

## 組織對安全的 relentless 關注

這一原則在工業工程背景下尤為重要。根據曾在工人面臨安全隱患的製造車間工作的 Eddie Kennedy 的說法，「每次管理會議都以討論安全開始。」製造業通過建立在組織各個層級都嚴格遵守的高度定義的流程來為意外情況做準備。所有員工都認真對待安全至關重要，並且工人感到有權在任何看起來不對勁的時候發聲。在核電、軍用飛機和鐵路信號行業，軟件的安全標準有詳細規定（例如，英國國防標準 00-56、IEC 61508、IEC513、美國 DO-178B/C 和 DO-254），並且此類系統的可靠性水平有明確標識（例如，安全完整性等級（SIL）1-4），旨在指定交付產品的可接受方法。

## 注重細節

從他在美國海軍的經歷中，Jeff Stevenson 回憶起對執行小任務（例如，潤滑油維護）時缺乏勤奮可能導致重大潛艇故障的敏銳意識。一個非常小的疏忽或錯誤可能會產生巨大影響。系統高度互聯，因此一個區域的事故可能會影響多個相關組件。核海軍專注於例行維護，以確保小問題不會滾雪球。

## 擺動容量

電信行業的系統利用率可能高度不可預測。絕對容量可能因自然災害等不可預見的事件以及奧運會等大型可預測事件而受到壓力。根據 Gus Hartmann 的說法，該行業通過部署**擺動容量**（swing capacity）來應對這些事件，形式為 SOW（輪式交換機），一個移動電信辦公室。這種額外容量可以在緊急情況下或在預期可能使系統過載的已知事件之前推出。容量問題也可能在與絕對容量無關的事務中轉向意想不到的情況。例如，2005 年一位名人的私人電話號碼被洩露，成千上萬的粉絲同時試圖給她打電話，電信系統表現出類似於 DDoS 或大規模路由錯誤的症狀。

## 模擬和實彈演習

Google 的災難恢復測試與我們研究的許多成熟行業的重點——模擬和實彈演習——有很多共同之處。系統中斷的潛在後果決定了使用模擬還是實彈演習是合適的。例如，Matthew Toia 指出，航空業無法在不危及設備和乘客的情況下「在生產中」進行實彈測試。相反，他們使用帶有實時數據饋送的極其逼真的模擬器，其中控制室和設備被建模到最微小的細節，以確保逼真的體驗而不會將真人置於危險之中。Gus Hartmann 報告說，電信行業通常專注於以應對颶風和其他天氣緊急情況為中心的實彈演習。這種建模導致了在建築物內配備發電機的防風雨設施的創建，這些設施能夠在風暴中持續運行。

美國核海軍使用「如果……會怎樣」的思想實驗和實彈演習的混合方式。根據 Jeff Stevenson 的說法，實彈演習涉及「實際破壞真實的東西，但有控制參數。實彈演習被虔誠地執行，每週，每週兩到三天。」對於核海軍來說，思想實驗很有用，但不足以應對實際事件。**反應必須經過練習，才不會被遺忘**。

根據 Mike Doherty 的說法，救生員面臨的災難測試演習更像是「神秘顧客」體驗。通常，設施經理會與一個孩子或一個偽裝成受訓救生員的人合作，上演一場模擬溺水。這些場景被進行得盡可能逼真，以便救生員無法區分真實和上演的緊急情況。

## 培訓和認證

我們的採訪表明，當生命攸關時，培訓和認證尤為重要。例如，Mike Doherty 描述了救生員如何完成嚴格的培訓認證，以及定期的再認證過程。課程包括體能部分（例如，救生員必須能夠將比自己重的人的肩膀托出水面）、急救和心肺復蘇等技術部分，以及操作要素（例如，如果一名救生員下水，其他團隊成員如何響應？）。每個設施還有特定地點的培訓，因為在游泳池當救生員與在湖邊沙灘或海邊當救生員有顯著不同。

## 專注於詳細的需求收集和設計

我們採訪的一些工程師討論了詳細需求收集和設計文檔的重要性。在處理醫療設備時，這種做法尤為重要。在許多這些情況下，設備的實際使用或維護不屬於產品設計師的職權範圍。因此，必須從其他來源收集使用和維護需求。

例如，根據 Erik Gross 的說法，激光眼科手術機被設計得盡可能萬無一失。因此，從實際使用這些機器的外科醫生和負責維護它們的技術人員那裡徵求需求尤為重要。在另一個例子中，前國防承包商 Peter Dahl 描述了一種非常詳細的設計文化，其中創建一個新的國防系統通常需要整整一年的設計，然後只用三週時間編寫代碼來實現設計。這兩個例子都與 Google 的**啟動和迭代**文化有顯著不同，後者以計算出的風險促進了更快的變革速度。其他行業（例如，前面討論的醫療行業和軍事）有非常不同的壓力、風險偏好和要求，它們的流程在很大程度上受到這些情況的影響。

## 深度和廣度防禦

在核電行業，**深度防禦**是準備就緒的關鍵要素 [IAEA12]。核反應堆在所有系統上都具有冗餘，並實施了一種設計方法，該方法規定在主系統發生故障時有備用系統。該系統設計有多層保護，包括在工廠周圍設置的防止放射性釋放的最終物理屏障。由於對故障和事件的零容忍，深度防禦在核工業中尤為重要。

# 事後檢討文化

**糾正和預防措施（CAPA）**是一個眾所周知的提高可靠性的概念，它專注於對已識別問題或風險的根本原因進行系統性調查，以防止再次發生。這一原則體現在 SRE 強烈的**無指責事後檢討**文化中。當出現問題時（考慮到 Google 的規模、複雜性和快速變革，問題不可避免地會發生），評估以下所有方面非常重要：

-   發生了什麼
-   響應的有效性
-   下次我們會做什麼不同的事情
-   將採取什麼行動來確保特定事件不再發生

這項工作是在不指責任何個人的情況下進行的。與其歸咎於人，更重要的是找出問題所在，以及作為一個組織，我們將如何團結起來確保它不再發生。糾纏於是誰可能導致了中斷是適得其反的。事後檢討在事件發生後進行，並在 SRE 團隊之間發布，以便所有人都能從中吸取教訓。

我們的採訪發現，許多行業都進行某種形式的事後檢討（儘管出於顯而易見的原因，許多行業不使用這個特定的名稱）。這些練習背後的動機似乎是行業實踐之間的主要區別。

許多行業受到嚴格監管，當出現問題時，會被特定的政府機構問責。當失敗的風險很高時（例如，生命攸關），這種監管尤其根深蒂固。相關的政府機構包括 FCC（電信）、FAA（航空）、OSHA（製造和化工行業）、FDA（醫療設備）以及歐盟的各種國家主管當局。核電和運輸行業也受到嚴格監管。

安全考慮是事後檢討背後的另一個動機因素。在製造和化工行業，由於生產最終產品所需條件的性質（高溫、高壓、毒性、腐蝕性等），受傷或死亡的風險始終存在。例如，美國鋁業公司（Alcoa）具有值得注意的安全文化。前首席執行官 Paul O'Neill 要求員工在任何導致工人損失工作日的傷害發生後 24 小時內通知他。他甚至將自己的家庭電話號碼分發給工廠車間的工人，以便他們可以親自向他報告安全問題。

在製造和化工行業，風險如此之高，以至於即使是「**險些失手**」（near misses）——即某個事件可能造成嚴重傷害但並未造成——也會被仔細審查。這些場景起著一種預防性事後檢討的作用。正如 VM Brasseur 在 YAPC NA 2015 的一次演講中所說，「幾乎每一次災難和商業危機中都有多次險些失手，而且通常在它們發生時被忽略了。潛在的錯誤，加上一個促成條件，等於事情沒有完全按照你的計劃進行」[Bra15]。險些失手實際上是等待發生的災難。例如，工人不遵守標準操作程序、員工在最後一刻跳開以避免飛濺、或者樓梯上的溢出物未被清理，所有這些都代表了險些失手和學習改進的機會。下一次，員工和公司可能就沒那麼幸運了。英國的 CHIRP（航空和海事機密報告計劃）旨在通過提供一個中央報告點來提高整個行業對此類事件的認識，航空和海事人員可以在此處機密地報告險些失手。這些險些失手的報告和分析隨後在定期通訊中發布。

救生行業有著根深蒂固的事件後分析和行動規劃文化。Mike Doherty 開玩笑說：「如果救生員的腳下水了，就會有文書工作！」在游泳池或海灘上發生任何事件後，都需要詳細的書面報告。在嚴重事件的情況下，團隊會集體從頭到尾審查事件，討論哪些做得對，哪些做得錯。然後根據這些發現進行操作上的更改，並且通常會安排培訓，以幫助人們建立處理未來類似事件的能力的信心。在特別令人震驚或創傷性的事件中，會請來顧問到現場幫助員工應對心理後遺症。救生員可能對實際發生的事情做好了充分的準備，但可能會覺得自己做得不夠好。與 Google 類似，救生行業也擁抱無指責的事件分析文化。事件是混亂的，任何給定事件都有許多促成因素。在這個領域，將責任歸咎於單一個體是沒有幫助的。

# 自動化重複性工作和運營開銷

在其核心，Google 的網站可靠性工程師是軟件工程師，對重複性的被動工作容忍度很低。在我們的文化中，避免重複對服務沒有增值的操作是根深蒂固的。如果一項任務可以被自動化，為什麼要讓一個系統運行在價值低的重複性工作上呢？自動化降低了運營開銷，並為我們的工程師騰出時間來主動評估和改進他們支持的服務。

我們調查的行業在是否、如何以及為何擁抱自動化方面情況不一。某些行業更信任人類而不是機器。在我們的行業資深人士任職期間，美國核海軍避開了自動化，而採用了一系列聯鎖裝置和行政程序。例如，根據 Jeff Stevenson 的說法，操作一個閥門需要一名操作員、一名主管和一名在電話中與負責監控所採取行動響應的工程值班官員通話的船員。由於擔心自動化系統可能無法發現人類肯定會注意到的問題，這些操作非常手動。潛艇上的操作由一個受信任的人類決策鏈——一系列人，而不是單一個體——來統治。核海軍還擔心自動化和計算機發展得如此之快，以至於它們完全有能力犯下一個巨大的、無法彌補的錯誤。當您處理核反應堆時，緩慢而穩健的方法比快速完成任務更重要。

根據 John Li 的說法，自營交易行業近年來在自動化應用方面變得越來越謹慎。經驗表明，配置不正確的自動化可以在很短的時間內造成重大損害並招致巨大的財務損失。例如，2012 年，Knight Capital Group 遇到一個「軟件故障」，導致在短短幾小時內損失 4.4 億美元。同樣，2010 年美國股市經歷了一次「閃電崩盤」，最終歸咎於一名流氓交易員試圖用自動化手段操縱市場。雖然市場很快恢復，但這次閃電崩盤在短短 30 分鐘內造成了數万億美元的損失。計算機可以非常快地執行任務，如果這些任務配置不正確，速度可能是一個負面因素。

相比之下，一些公司擁抱自動化正是因為計算機比人行動得更快。根據 Eddie Kennedy 的說法，效率和金錢節省在製造行業是關鍵，而自動化提供了一種更有效率和更具成本效益地完成任務的方法。此外，自動化通常比人類手動進行的工作更可靠和可重複，這意味著它能產生更高的質量標準和更嚴格的公差。Dan Sheridan 討論了在英國核工業中部署的自動化。在這裡，一條經驗法則是，如果要求工廠在不到 30 分鐘內對給定情況做出響應，那麼該響應必須是自動化的。

在 Matt Toia 的經驗中，航空業有選擇性地應用自動化。例如，運營故障轉移是自動執行的，但當涉及到某些其他任務時，該行業只在經過人類驗證後才信任自動化。雖然該行業採用了大量的自動監控，但實際的空中交通管制系統實施必須由人類手動檢查。

根據 Erik Gross 的說法，自動化在減少激光眼科手術中的用戶錯誤方面非常有效。在進行 LASIK 手術之前，醫生使用屈光眼科檢查儀測量患者。最初，醫生會輸入數字並按下一個按鈕，然後激光開始矯正患者的視力。然而，數據輸入錯誤可能是一個大問題。這個過程還可能導致混淆患者數據或弄亂左右眼的數字。

現在，自動化大大減少了人類犯錯影響某人視力的機會。對手動輸入數據的計算機化健全性檢查是第一個主要的自動化改進：如果人類操作員輸入的測量值超出預期範圍，自動化會立即並顯著地將此案例標記為異常。此後又進行了其他自動化改進：現在在初步屈光眼科檢查期間會拍攝虹膜照片。當進行手術時，患者的虹膜會自動與照片中的虹膜匹配，從而消除了混淆患者數據的可能性。當這個自動化解決方案實施後，一整類的醫療錯誤就消失了。

# 結構化與理性決策

在 Google，特別是在網站可靠性工程中，數據至關重要。團隊力求以結構化和理性的方式做出決策，確保：

-   決策的基礎是事先商定的，而不是事後辯解的
-   決策的輸入是清晰的
-   任何假設都明確說明
-   **數據驅動的決策**勝過基於感覺、直覺或房間裡最高級員工意見的決策

Google SRE 的基本假設是，團隊中的每個人：

-   都將服務用戶的最大利益放在心上
-   能夠根據現有數據找出如何進行

決策應該是**知情的**而不是**規定的**，並且做出決策時不應屈從於個人意見——即使是房間裡最高級的人，Eric Schmidt 和 Jonathan Rosenberg 稱之為「HiPPO」，即「薪水最高的人的意見」[Sch14]。

不同行業的決策方式差異很大。我們了解到，一些行業使用「**如果沒壞，就別修……永遠別修**」的方法。那些設計上投入大量思考和努力的系統所在的行業，通常不願改變底層技術。例如，電信行業仍在使用 1980 年代實施的長途交換機。為什麼他們依賴幾十年前開發的技術？根據 Gus Hartmann 的說法，這些交換機「幾乎是堅不可摧且大規模冗餘的」。正如 Dan Sheridan 所報告的，核工業的變革同樣緩慢。所有決策都基於這樣的想法：**如果現在能用，就不要改變它**。

許多行業都非常注重**劇本和程序**，而不是開放式問題解決。每個人類可以想像的場景都被記錄在清單或「活頁夾」中。當出現問題時，這個資源就是如何反應的權威來源。這種規定的方法適用於發展相對緩慢的行業，因為可能出錯的場景不會因為系統更新或變更而不斷演變。這種方法在工人技能水平可能有限的行業中也很常見，確保人們在緊急情況下能適當響應的最佳方式是提供一套簡單、清晰的指示。

其他行業也採用清晰、數據驅動的決策方法。在 Eddie Kennedy 的經驗中，研究和製造環境的特點是嚴格的實驗文化，高度依賴於制定和測試假設。這些行業定期進行對照實驗，以確保給定的變更在統計上顯著的水平上產生預期的結果，並且沒有意外發生。只有當實驗產生的數據支持決策時，才會實施變更。

最後，一些行業，如自營交易，為了更好地管理風險而將決策分開。根據 John Li 的說法，這個行業有一個獨立於交易員的執法團隊，以確保在追求利潤的過程中不會承擔過度的風險。執法團隊負責監控現場事件，並在事件失控時停止交易。如果發生系統異常，執法團隊的第一反應是關閉系統。正如 John Li 所說：「如果我們不交易，我們就不會虧錢。我們也不會賺錢，但至少我們不會虧錢。」只有執法團隊才能讓系統重新上線，儘管對於錯過潛在盈利機會的交易員來說，延遲可能看起來多麼痛苦。

# 結論

許多對 Google 網站可靠性工程至關重要的原則在廣泛的行業中都很明顯。成熟行業已經學到的教訓很可能啟發了今天在 Google 使用的一些實踐。

我們跨行業調查的一個主要收穫是，在其許多軟件業務中，Google 對**速度**的偏好高於大多數其他行業的參與者。快速行動或改變的能力必須與失敗的不同影響相權衡。例如，在核能、航空或醫療行業，一次中斷或失敗可能導致人員受傷甚至死亡。當風險很高時，採用保守的方法來實現高可靠性是合理的。

在 Google，我們不斷地在用戶對高可靠性的期望與對快速變革和創新的敏銳關注之間走鋼絲。雖然 Google 對可靠性極其認真，但我們必須使我們的方法適應我們的高變革率。正如前面章節所討論的，我們的許多軟件業務，如搜索，會有意識地決定「足夠可靠」的可靠性到底是什麼。

Google 在其大多數軟件產品和服務中都具有這種靈活性，這些產品和服務在一個如果出現問題不會直接危及生命的環境中運行。因此，我們能夠使用諸如**錯誤預算**（錯誤預算的動機）之類的工具，作為「資助」創新和計算風險文化的一種手段。從本質上講，Google 已經將在許多情況下由其他行業開發和磨練的已知可靠性原則進行了調整，以創造其自己獨特的可靠性文化，這種文化解決了一個平衡規模、複雜性和速度與高可靠性的複雜方程。
