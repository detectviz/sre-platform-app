# 歷史數據回放 (Backtesting) 任務提示詞

你是一位專精於 SRE 平台設計的資深工程師，任務是實作並優化「歷史數據回放 (Backtesting)」模組。請依以下任務清單逐步完成。

---

## 🎯 任務定位
- 提供驗證與模擬能力，讓使用者能根據過去的歷史數據回放告警規則，檢查正確性與合理性。
- 此模組屬於 **「智慧排查 (Analysis)」** 模組下的一個頁籤頁面，與分析總覽、日誌探索、容量規劃並列。

---

## 🔍 與告警引擎差異
- **告警引擎 (Alert Engine)**: 聚焦於「即時數據流」，持續判斷當下是否符合觸發條件並立即通知。
- **歷史數據回放 (Backtesting)**: 聚焦於「已存在的數據」，用於驗證規則在過去一段時間內是否會被觸發。

---

## ✅ 任務清單

1. **回放規則驗證**
   - 實作功能：使用者可選擇一組告警規則與一段歷史資料，系統模擬運行並輸出觸發次數與觸發點時間。

2. **趨勢比較**
   - 實作功能：提供可視化圖表，顯示「規則 vs 數據」對照，並標記觸發告警的時間點。

3. **誤報與漏報分析**
   - 實作功能：允許使用者標記「實際事件」，系統比對回放結果計算誤報率與漏報率。

4. **策略調校支援**
   - 實作功能：系統依據回放結果提供建議的門檻值與持續時間設定，幫助使用者調整規則以降低誤報。

5. **批次模擬**
   - 實作功能：支援一次回放多條規則，產生整體報告，用於審計與效能分析。

---

## 📂 實作影響範圍
1. **前端 (UI)**
   - 在「智慧排查」模組中新增一個頁籤 `Backtesting`。
   - 提供互動頁面，支援規則選擇、時間範圍設定、結果視覺化。

2. **後端 API (openapi-specs/)**
   - 新增 Backtesting API 路徑，例如：
     - `POST /backtesting/run` → 執行回放任務
     - `GET /backtesting/results/{task_id}` → 查詢模擬結果
   - Schema 定義需涵蓋：規則 ID、時間範圍、模擬結果、誤報/漏報統計。

3. **資料庫 (db_schema.sql)**
   - 新增 `backtesting_tasks` 表，用於存放回放任務參數與狀態。
   - 新增 `backtesting_results` 表，用於存放規則執行結果、觸發時間、誤報/漏報分析。

> ⚠️ **注意：設計 Backtesting 功能時，需同步規劃 `db_schema.sql` (資料表結構) 以及 `openapi-specs/` (API 介面規格)，確保資料流與 API 定義一致。**

---

## 📌 使用場景
- 驗證新建立或修改過的告警規則，確保合理性。
- 分析歷史事故，檢查當時規則是否能正確捕捉事件。
- 作為審計依據，提供規則設計與實際數據的比對證據。

---

**提示詞版本**: 1.1  
**最後更新**: 2025-10-02