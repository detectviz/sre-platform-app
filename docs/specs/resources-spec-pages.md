> **注意**：請一律使用 **繁體中文** 回報，程式碼需加入 **繁體中文註解**

# **資源 (Resources) 功能規格**

本文檔旨在根據 UI 截圖逆向分析並定義「資源」模組的相關功能、互動流程與 API 規格。

---

### `resources-auto-discovery-list.png`

**現況描述**
- 此頁面為「自動發現 (Auto Discovery)」管理介面，以表格形式呈現所有設定的掃描任務。
- **工具列**：
    - 右側提供一個「新增掃描」按鈕。
- **表格**：
    - 欄位包含：名稱、掃描類型、排程、最後執行、狀態。
    - 「掃描類型」使用帶樣式的標籤區分 (如 Kubernetes, VMWare)。
    - 「排程」欄位使用 `cron` 表達式格式。
    - 「狀態」欄位使用圖示和文字顯示任務的執行狀態 (如等待中、執行中、成功、失敗)。
    - 每行提供「查看結果」、「手動執行」、「編輯」、「刪除」的操作按鈕。

**互動流程**
- **載入頁面**：
    1. 頁面載入時，呼叫 API 獲取所有自動發現任務的列表。
    2. 若 API 呼叫失敗，顯示錯誤訊息。
- **新增掃描任務**：
    1. 使用者點擊「新增掃描」按鈕。
    2. 系統彈出「自動發現編輯 (AutoDiscoveryEditModal)」視窗。
    3. 使用者填寫任務名稱、選擇掃描類型、設定目標與排程後儲存。
    4. 系統呼叫 API 建立新任務，成功後刷新列表。
- **編輯掃描任務**：
    1. 使用者點擊任一任務的「編輯」按鈕。
    2. 系統彈出編輯視窗，並載入該任務的現有設定。
    3. 使用者修改後儲存，系統呼叫 API 更新任務，並刷新列表。
- **刪除掃描任務**：
    1. 使用者點擊「刪除」按鈕。
    2. 系統彈出確認對話框。
    3. 確認後，系統呼叫 API 刪除該任務，並刷新列表。
- **手動執行**：
    1. 使用者點擊「手動執行」按鈕。
    2. 前端顯示提示，並呼叫 API 觸發一次性的任務執行。
    3. 列表中的任務狀態會更新為「執行中」。
- **查看結果**：
    1. 使用者點擊「查看結果」按鈕。
    2. 系統從右側滑出一個抽屜 (Drawer)，其中包含 `DiscoveryJobResultDrawer` 元件，顯示該次任務掃描到的資源列表。

**API 與資料流**
- **獲取掃描任務列表**：
    - `GET /api/v1/resources/discovery-jobs`
    - **傳出資料**：`{ items: DiscoveryJob[], total: number }`
    - **實現細節**：前端使用 `fetchJobs` 函數依目前 `filters` 狀態呼叫 API 【F:pages/resources/AutoDiscoveryPage.tsx†L21-L84】

- **新增掃描任務**：
    - `POST /api/v1/resources/discovery-jobs`
    - **傳入資料**：`DiscoveryJob` 物件
    - **實現細節**：點擊「新增掃描」或「編輯」會開啟 `AutoDiscoveryEditModal`，Modal 送出後依據是否含 `id` 決定 POST 或 PATCH 【F:pages/resources/AutoDiscoveryPage.tsx†L46-L111】

- **更新掃描任務**：
    - `PATCH /api/v1/resources/discovery-jobs/{id}`
    - **傳入資料**：部分更新的 `DiscoveryJob` 物件
    - **實現細節**：編輯模式下載入現有資料並提供完整表單更新 【F:pages/resources/AutoDiscoveryPage.tsx†L46-L111】

- **刪除掃描任務**：
    - `DELETE /api/v1/resources/discovery-jobs/{id}`
    - **實現細節**：刪除按鈕先顯示警示 Modal，再於確認時呼叫 DELETE，成功或失敗皆以 toast 回饋 【F:pages/resources/AutoDiscoveryPage.tsx†L52-L84】

- **手動執行掃描**：
    - `POST /api/v1/resources/discovery-jobs/{id}/run`
    - **實現細節**：即時呼叫 `/run` 端點並重新整理列表；「查看結果」開啟抽屜供後續批次匯入或標籤處理 【F:pages/resources/AutoDiscoveryPage.tsx†L101-L176】

- **獲取掃描結果**：
    - `GET /api/v1/resources/discovery-jobs/:id/results`
    - **傳出資料**：`DiscoveredResource[]`，包含發現的資源列表。
    - **實現細節**：結果抽屜使用 `DiscoveryJobResultDrawer` 組件顯示掃描資源清單 【F:components/DiscoveryJobResultDrawer.tsx†L15-L69】

**需求與規格定義**
- **使用者需求**：
    - 作為平台管理員，我希望能設定自動化任務，定期掃描我的環境（如 K8s, VMWare）並發現新的資源，無需手動逐一添加。
    - 我需要能管理這些掃描任務，包括建立、修改、刪除和設定排程。
    - 我希望能隨時手動觸發一次掃描。
    - 我需要能查看每次掃描的結果，並決定要將哪些發現的資源正式納管。
- **功能規格**：
    - **R-AD-001**：系統必須提供一個自動發現任務管理頁面，以列表展示所有已設定的任務。
    - **R-AD-002**：列表應包含任務名稱、類型、排程、最後執行時間與執行狀態。
    - **R-AD-003**：系統必須提供新增和編輯掃描任務的功能。表單應允許使用者設定任務名稱、掃描類型 (K8s/VMWare等)、掃描目標 (如 Namespace)、排程 (cron)。
    - **R-AD-004**：使用者可以刪除一個掃描任務，刪除前需有確認提示。
    - **R-AD-005**：使用者可對任一任務觸發「手動執行」。
    - **R-AD-006**：使用者可查看任一任務的「掃描結果」，結果應以列表形式展示所有發現的資源。

---

### `resources-datasources-list.png`

**現況描述**
- 此頁面為「資料來源 (Datasources)」管理介面，以表格形式列出所有已設定的資料來源。
- **工具列**：
    - 僅在右側提供一個「新增 Datasource」的主要操作按鈕。
- **表格**：
    - 欄位包括：名稱、類型、連線狀態、建立時間。
    - 「類型」欄位使用帶有樣式的標籤來區分不同的資料來源類型 (如 VictoriaMetrics, Grafana)。
    - 「連線狀態」欄位使用圖示和文字顯示連線結果（正常、失敗、測試中）。
    - 每行最右側提供「測試連線」、「編輯」、「刪除」三個操作按鈕。

**互動流程**
- **載入頁面**：
    1. 頁面載入時，呼叫 API 獲取所有資料來源的列表。
    2. 若 API 呼叫失敗，顯示錯誤訊息。
- **新增資料來源**：
    1. 使用者點擊「新增 Datasource」按鈕。
    2. 系統彈出「編輯資料來源 (DatasourceEditModal)」視窗。
    3. 使用者填寫名稱、選擇類型、輸入 URL 及配置驗證方式後儲存。
    4. 系統呼叫 API 建立新的資料來源，成功後刷新列表。
- **編輯資料來源**：
    1. 使用者點擊任一資料來源的「編輯」按鈕。
    2. 系統彈出「編輯資料來源」視窗，並載入該資料來源的現有設定。
    3. 使用者修改後儲存，系統呼叫 API 更新設定，並刷新列表。
- **刪除資料來源**：
    1. 使用者點擊「刪除」按鈕。
    2. 系統彈出確認對話框。
    3. 確認後，系統呼叫 API 刪除該資料來源，並刷新列表。
- **測試連線**：
    1. 使用者點擊任一資料來源的「測試連線」按鈕。
    2. 前端顯示提示訊息，告知使用者正在測試連線。
    3. 系統呼叫 API 對指定的資料來源進行連線測試。
    4. API 返回測試結果（成功或失敗）後，前端會顯示相應的提示訊息，並更新表格中的「連線狀態」欄位。

**API 與資料流**
- **獲取資料來源列表**：
    - `GET /api/v1/resources/datasources`
    - **傳出資料**：`{ items: Datasource[], total: number }`。
- **新增資料來源**：
    - `POST /api/v1/resources/datasources`
    - **傳入參數**：`Partial<Datasource>`，包含新資料來源的設定。
- **更新資料來源**：
    - `PATCH /api/v1/resources/datasources/:id`
    - **傳入參數**：`Partial<Datasource>`，包含要更新的欄位。
- **刪除資料來源**：
    - `DELETE /api/v1/resources/datasources/:id`
- **測試連線**：
    - `POST /api/v1/resources/datasources/:id/test`
    - **傳出資料**：`{ success: boolean, message: string, ... }`，包含測試結果與訊息。

**需求與規格定義**
- **使用者需求**：
    - 作為平台管理員，我需要能夠設定與管理平台所依賴的外部資料來源 (如監控系統、日誌系統)。
    - 我希望能驗證我所提供的設定是否正確，確保平台能成功連線。
    - 我需要能隨時新增、修改或移除這些資料來源設定。
- **功能規格**：
    - **R-DS-001**：系統必須提供一個資料來源管理頁面，以列表展示所有已設定的資料來源。
    - **R-DS-002**：列表應包含每個資料來源的名稱、類型及最後一次的連線狀態。
    - **R-DS-003**：系統必須提供新增和編輯資料來源的功能。表單應包含名稱、類型、URL、驗證方式等必要欄位。
    - **R-DS-004**：使用者可以刪除一個資料來源，刪除前需有確認提示。
    - **R-DS-005**：使用者必須能夠對任一已設定的資料來源觸發一次性的「連線測試」。
    - **R-DS-006**：系統在收到連線測試請求後，應執行測試並將結果（成功/失敗）回饋給使用者，並更新該資料來源的狀態。

---

### `resources-discovery-results-modal.png`

**現況描述**
- 此畫面為「掃描結果」抽屜，在自動發現列表頁點擊「查看結果」後從右側滑出。
- **頂部摘要**：以三個卡片顯示執行該次掃描的任務設定：掃描類型、Exporter 模板、Edge Gateway。
- **工具列**：
    - 當使用者勾選列表中的資源後，工具列會變為批次操作模式。
    - 提供「匯入到資源清單」、「批次加標籤」、「忽略 (黑名單)」三個主要操作。
- **結果表格**：
    - 欄位包含：複選框、名稱/IP、類型、標籤、狀態。
    - 「狀態」欄位以圖示和文字標示每個資源的狀態（新發現、已匯入、已忽略）。
    - 只有狀態為「新發現」的資源才能被勾選。

**互動流程**
- **開啟抽屜**：
    1. 在自動發現列表頁點擊某任務的「查看結果」按鈕。
    2. 此抽屜從右側滑出，並呼叫 API 獲取該任務的掃描結果。
- **選取資源**：
    1. 使用者可以勾選一個或多個狀態為「新發現」的資源。
    2. 已匯入或已忽略的資源，其複選框為禁用狀態。
- **批次匯入**：
    1. 使用者勾選資源後，點擊「匯入到資源清單」。
    2. 系統彈出一個匯入確認視窗 (`ImportResourceModal`)，其中可能包含部署監控代理等選項。
    3. 確認後，系統呼叫 API 將選定資源正式納管，成功後刷新結果列表，對應資源的狀態變為「已匯入」。
- **批次加標籤**：
    1. 使用者勾選資源後，點擊「批次加標籤」。
    2. 系統彈出標籤編輯視窗 (`BatchTagModal`)。
    3. 使用者輸入要添加的標籤後儲存，系統呼叫 API 為這些資源添加標籤，成功後刷新列表。
- **批次忽略**：
    1. 使用者勾選資源後，點擊「忽略 (黑名單)」。
    2. 系統呼叫 API 將這些資源的狀態更新為「已忽略」，成功後刷新列表。

**API 與資料流**
- **獲取掃描結果**：
    - `GET /api/v1/resources/discovery-jobs/:id/results`
    - **傳出資料**：`DiscoveredResource[]`，包含該次掃描發現的所有資源及其狀態。
- **批次加標籤**：
    - `POST /api/v1/resources/batch-tags`
    - **傳入參數**：`{ resource_ids: string[], tags: KeyValueTag[] }`。
- **批次忽略**：
    - `POST /api/v1/discovery/batch-ignore`
    - **傳入參數**：`{ resource_ids: string[] }`。
- **批次匯入 (由 ImportResourceModal 觸發)**：
    - `POST /api/v1/resources/import-discovered` (推測)
    - **傳入參數**：`{ discovered_resource_ids: string[], job_id: string, deploy_agent: boolean }`。

**需求與規格定義**
- **使用者需求**：
    - 我需要能清楚地看到每次自動掃描發現了哪些新資源。
    - 我希望能對這些新發現的資源進行處理，例如決定要正式納管（匯入）、暫時忽略、或是在匯入前先統一加上標籤。
- **功能規格**：
    - **R-DRES-001**：系統必須提供一個抽屜或彈窗，用於展示指定掃描任務的結果。
    - **R-DRES-002**：結果列表必須清楚標示每個已發現資源的狀態（新發現、已匯入、已忽略）。
    - **R-DRES-003**：使用者只能對「新發現」狀態的資源進行操作。
    - **R-DRES-004**：系統必須提供「批次匯入」功能，允許使用者將選中的新資源正式納入平台管理。
    - **R-DRES-005**：系統必須提供「批次加標籤」功能，允許使用者在匯入前為選中的新資源統一添加標籤。
    - **R-DRES-006**：系統必須提供「批次忽略」功能，讓使用者可以將暫時不想處理的新資源加入黑名單，避免在下次掃描時重複出現。

---

### `resources-discovery-task-step3.png`

**現況描述**
- 此畫面為「新增/編輯自動掃描任務」視窗中的第三個區段：「**3. Exporter 綁定**」。
- 此區段的目的是定義在發現資源後，要用何種方式（Exporter）來持續監控它。
- **主要欄位**：
    - **Exporter 模板**：一個下拉選單，提供多種預設的監控模板（如 `node_exporter`, `snmp_exporter`）。
    - **MIB Profile**：一個下拉選單，此欄位只在選擇了支援 MIB 的 Exporter 模板（如 `snmp_exporter`）時才會出現。
    - **自訂覆寫 YAML**：一個文字輸入區，此欄位只在選擇了支援覆寫的 Exporter 模板時才會出現，允許使用者提供更進階的自訂設定。

**互動流程**
- **選擇 Exporter 模板**：
    1. 使用者從「Exporter 模板」下拉選單中選擇一個選項。
    2. 選擇後，下方的「MIB Profile」或「自訂覆寫 YAML」欄位會根據該模板的設定動態顯示或隱藏。
    3. 如果選擇了新的模板，系統可能會清空或重設相關的子選項（如 MIB Profile）。
- **選擇 MIB Profile**：
    1. 如果「MIB Profile」欄位可見，使用者可以從下拉選單中選擇一個預先定義好的 MIB 設定檔。
    2. 這些選項會根據所選的 Exporter 模板進行過濾。
- **填寫自訂 YAML**：
    1. 如果「自訂覆寫 YAML」欄位可見，使用者可以在其中貼上 YAML 格式的設定，來覆寫模板的預設行為。

**API 與資料流**
- **獲取表單選項**：
    - `GET /api/v1/ui/options`
    - **傳出資料**：在 `auto_discovery` 欄位中，`exporter_templates` 提供了模板列表及其元數據（如是否支援 MIB），`mib_profiles` 提供了可用的 MIB 設定檔。
- **儲存資料**：
    - 使用者在此區塊的所有操作，都會更新 `AutoDiscoveryEditModal` 元件內部的 `formData` 狀態。
    - 最終點擊「儲存」時，這些設定會被包含在 `exporter_binding` 物件中，隨整個任務的設定一同提交至 `POST /resources/discovery-jobs` 或 `PATCH /resources/discovery-jobs/:id` API。

**需求與規格定義**
- **使用者需求**：
    - 我希望在設定自動發現時，就能一併指定未來要如何監控這些被發現的資源。
    - 系統應該根據我選擇的掃描方式，推薦給我合適的監控模板。
    - 對於特殊設備（如 SNMP），我希望能選擇特定的 MIB 設定檔。
- **功能規格**：
    - **R-DT3-001**：在自動發現任務設定中，必須提供一個「Exporter 綁定」區段。
    - **R-DT3-002**：此區段的核心是一個「Exporter 模板」下拉選單，其選項必須由後端 API 提供。
    - **R-DT3-003**：表單必須是動態的，能夠根據所選模板的 `supports_mib_profile` 和 `supports_overrides` 屬性，來決定是否顯示「MIB Profile」和「自訂覆寫 YAML」欄位。
    - **R-DT3-004**：「MIB Profile」下拉選單中的選項，必須根據當前選擇的「Exporter 模板」進行過濾。

---

### `resources-discovery-task-step5.png`

**現況描述**
- 此畫面為「新增/編輯自動掃描任務」視窗中的第五個，也是最後一個區段：「**5. 標籤與分類 (Metadata)**」。
- 此區段用於為這個掃描任務本身附加標籤。
- **主要元件**：
    - **標籤 (Tags)**：一個可動態增減的鍵值對 (Key-Value) 輸入區域。
    - **鍵 (Key)**：這不是一個自由輸入的文字框，而是一個下拉選單，其選項來自系統中預先定義好的標籤。
    - **值 (Value)**：這是一個動態元件。根據所選的「鍵」，它可以是一個自由輸入的文字框，也可以是一個多選下拉選單（如果該標籤有預設的可選值）。
    - **新增標籤按鈕**：允許使用者增加一組新的鍵值對輸入框。

**互動流程**
- **新增標籤**：
    1. 使用者點擊「新增標籤」按鈕。
    2. 列表下方會出現一組新的、空的鍵值輸入框。
- **選擇標籤鍵**：
    1. 使用者點擊「鍵」的下拉選單。
    2. 系統顯示從 API (`GET /settings/tags`) 獲取的所有可用標籤鍵。
    3. 使用者選擇一個鍵。
- **填寫標籤值**：
    1. 系統根據所選的「鍵」是否有預設的 `allowed_values`，來決定「值」輸入框的形態。
    2. **(情況A：文字輸入)** 如果沒有預設值，使用者可以直接在文字框中輸入。
    3. **(情況B：多選)** 如果有預設值，使用者可以點擊下拉選單，在彈出的列表中勾選一個或多個值。
- **移除標籤**：
    1. 使用者點擊任一標籤行最右側的「刪除」按鈕。
    2. 該行標籤即被移除。

**API 與資料流**
- **獲取標籤定義**：
    - `GET /api/v1/settings/tags`
    - **傳出資料**：`TagDefinition[]`，包含所有已定義標籤的元數據，如 `key` 和 `allowed_values`。
- **儲存資料**：
    - 使用者在此區塊的所有操作，都會更新 `AutoDiscoveryEditModal` 元件內部的 `formData` 狀態。
    - 最終點擊「儲存」時，這些標籤會被包含在 `tags` 陣列中，隨整個任務的設定一同提交。

**需求與規格定義**
- **使用者需求**：
    - 我希望能為我建立的掃描任務加上一些標籤，方便我未來對任務本身進行分類和搜尋。
    - 為了保持一致性，我希望系統能提示我有哪些可用的標籤，而不是讓我憑記憶輸入。
- **功能規格**：
    - **R-DT5-001**：在自動發現任務設定中，必須提供一個「標籤與分類」區段。
    - **R-DT5-002**：此區段必須允許使用者為任務附加一或多個標籤。
    - **R-DT5-003**：標籤的「鍵」必須從一個預先定義的列表中選擇，該列表由 `GET /settings/tags` API 提供。
    - **R-DT5-004**：標籤的「值」輸入框必須是動態的：若對應的標籤鍵有 `allowed_values`，則必須呈現為多選下拉選單；否則，呈現為一般文字輸入框。

---

### `resources-edit-datasource-modal.png`

**現況描述**
- 此為「新增/編輯 Datasource」的彈出式視窗。截圖顯示的是「新增」時的狀態。
- **表單欄位**：
    - **名稱**：文字輸入框。
    - **類型**：下拉選單。
    - **驗證方式**：下拉選單。
    - **URL / Endpoint**：文字輸入框。
    - **標籤**：鍵值對 (Key-Value) 輸入元件。
- **操作按鈕**：
    - 左下角有「測試連線」按鈕。
    - 右下角有「取消」和「儲存」按鈕。

**互動流程**
- **開啟視窗**：
    1. 在資料來源列表頁點擊「新增」或「編輯」。
    2. 視窗彈出，並根據模式顯示對應標題。
    3. 系統從 API 獲取「類型」和「驗證方式」的下拉選單選項。
    4. 在編輯模式下，表單會預先填入該資料來源的現有設定。
- **測試連線**：
    1. 使用者填寫完 URL 等必要資訊後，點擊「測試連線」按鈕。
    2. 按鈕變為「測試中...」並顯示載入中圖示。
    3. 系統呼叫測試專用 API，將當前表單資料送往後端進行驗證。
    4. 後端返回測試結果後，系統會彈出一個提示框（Toast）告知使用者成功或失敗的訊息。此操作不會關閉視窗或儲存資料。
- **儲存**：
    1. 使用者點擊「儲存」。
    2. 系統根據模式呼叫 `POST` (新增) 或 `PATCH` (編輯) API。
    3. 成功後關閉視窗並刷新列表。

**API 與資料流**
- **獲取表單選項**：
    - `GET /api/v1/ui/options`
    - **傳出資料**：在 `datasources` 欄位中提供 `types` 和 `auth_methods` 的選項。
- **測試連線 (不儲存)**：
    - `POST /api/v1/resources/datasources/test`
    - **傳入參數**：包含當前表單所有內容的 `Datasource` 物件。
    - **傳出資料**：`{ success: boolean, message: string, latency_ms?: number }`，包含測試結果。
- **新增資料來源**：
    - `POST /api/v1/resources/datasources`
    - **傳入參數**：`Partial<Datasource>`。
- **更新資料來源**：
    - `PATCH /api/v1/resources/datasources/:id`
    - **傳入參數**：`Partial<Datasource>`。

**需求與規格定義**
- **使用者需求**：
    - 我希望能有一個表單來設定新的資料來源。
    - 在儲存之前，我希望能先測試一下我填寫的設定是否正確。
    - 我希望能為資料來源加上自訂標籤，方便分類。
- **功能規格**：
    - **R-DMOD-001**：系統必須提供一個彈出式視窗，用於新增和編輯資料來源。
    - **R-DMOD-002**：表單應包含名稱、URL、類型、驗證方式和標籤等欄位。
    - **R-DMOD-003**：必須提供一個「測試連線」按鈕，該按鈕能在不儲存資料的情況下，將當前表單配置發送至後端進行驗證。
    - **R-DMOD-004**：連線測試的結果（成功/失敗/延遲）必須以清晰的方式（如 Toast 通知）回饋給使用者。
    - **R-DMOD-005**：儲存時，根據模式呼叫對應的 `POST` 或 `PATCH` API。
    - **R-DMOD-006**：標籤輸入必須支援鍵值對 (Key-Value) 形式。

---

### `resources-edit-discovery-task-modal.png`

**現況描述**
- 此為「新增/編輯自動掃描任務」的彈出式視窗，採用多區段長表單的設計。
- **表單結構**：
    - **1. 基本資訊**：設定任務名稱、掃描類型（下拉選單）、掃描排程（Cron 表達式）。
    - **2. 目標配置**：此區塊內容根據「掃描類型」動態變化。例如，選擇 `K8s` 會顯示 `kubeconfig` 的文字輸入區；選擇 `SNMP` 則顯示 `Community String` 和 `IP 範圍` 輸入框。
    - **3. Exporter 綁定**：設定發現資源後要如何監控。包含 `Exporter 模板` 下拉選單，並可能根據模板顯示 `MIB Profile` 下拉選單或 `自訂覆寫 YAML` 輸入區。
    - **4. 邊緣掃描**：透過核取方塊和下拉選單，設定是否經由 Edge Gateway 執行掃描。
    - **5. 標籤與分類**：提供鍵值對輸入元件，用於為此任務本身加上標籤。
- **操作按鈕**：
    - 左下角有「測試掃描」按鈕。
    - 右下角有「取消」和「儲存」按鈕。

**互動流程**
- **開啟視窗**：
    1. 在自動發現列表頁點擊「新增掃描」或「編輯」。
    2. 視窗彈出，並根據模式顯示標題。在編輯模式下，會載入任務現有設定。
    3. 系統從 API 獲取所有下拉選單的選項（掃描類型、模板、MIB Profiles 等）。
- **動態表單互動**：
    1. 當使用者在「掃描類型」下拉選單中選擇不同選項時，「2. 目標配置」區塊的表單欄位會隨之改變。
    2. 當使用者在「Exporter 模板」下拉選單中選擇不同選項時，「3. Exporter 綁定」區塊的附加選項（如 MIB Profile）會動態顯示或隱藏。
- **測試掃描**：
    1. 使用者填寫完必要資訊後，點擊「測試掃描」。
    2. 系統呼叫測試 API，將當前表單配置送往後端進行預掃描。
    3. 後端返回測試結果（成功/失敗、預計發現資源數、警告訊息）後，系統以提示框（Toast）顯示結果。此操作不儲存資料。
- **儲存**：
    1. 使用者點擊「儲存」。
    2. 系統根據模式呼叫 `POST` (新增) 或 `PATCH` (編輯) API。
    3. 成功後關閉視窗並刷新列表。

**API 與資料流**
- **獲取表單選項**：
    - `GET /api/v1/ui/options`
    - **傳出資料**：在 `auto_discovery` 欄位中提供 `job_kinds`, `exporter_templates`, `mib_profiles`, `edge_gateways` 等選項。
- **測試掃描 (不儲存)**：
    - `POST /api/v1/resources/discovery-jobs/test`
    - **傳入參數**：包含當前表單所有配置的 `DiscoveryJob` 物件。
    - **傳出資料**：`{ success: boolean, message: string, discovered_count: number, warnings: string[] }`。
- **新增掃描任務**：
    - `POST /api/v1/resources/discovery-jobs`
    - **傳入參數**：完整的 `DiscoveryJob` 物件。
- **更新掃描任務**：
    - `PATCH /api/v1/resources/discovery-jobs/:id`
    - **傳入參數**：完整的 `DiscoveryJob` 物件。

**需求與規格定義**
- **使用者需求**：
    - 我希望能有一個引導清晰的介面來設定一個完整的自動發現任務，從如何找到資源到如何監控它們。
    - 我需要能根據不同的環境（K8s, SNMP 等）提供不同的掃描參數。
    - 在正式建立任務前，我希望能先測試我的設定是否能成功掃描到東西。
- **功能規格**：
    - **R-DMOD-001**：系統必須提供一個多區段的彈出式視窗，用於新增和編輯自動發現任務。
    - **R-DMOD-002**：「目標配置」區塊的表單欄位必須根據所選的「掃描類型」動態生成。
    - **R-DMOD-003**：「Exporter 綁定」區塊的選項必須根據所選的「Exporter 模板」動態生成。
    - **R-DMOD-004**：必須提供一個「測試掃描」按鈕，能在不儲存任務的情況下，對當前配置進行預掃描驗證。
    - **R-DMOD-005**：測試結果應包含成功與否、預計發現的資源數量，並以提示框形式回饋給使用者。
    - **R-DMOD-006**：對於 Kubernetes 掃描類型，必須支援直接貼上或上傳 `kubeconfig` 檔案。

---

### `resources-edit-group-modal.png`

**現況描述**
- 此為「新增/編輯資源群組」的彈出式視窗。截圖顯示的是「新增資源群組」時的狀態。
- **表單欄位**：
    - **群組名稱**：文字輸入框。
    - **擁有團隊**：下拉選單。
    - **描述**：多行文字輸入框。
- **成員管理**：
    - 採用左右雙欄佈局的「成員管理」區塊。
    - 左欄為「可用的資源」列表，右欄為「已選擇的資源」列表。
    - 每個資源旁有箭頭按鈕，可將其在兩欄之間移動。
- **操作按鈕**：
    - **取消**：關閉視窗。
    - **儲存**：提交表單。

**互動流程**
- **開啟視窗**：
    1. 在資源群組列表頁點擊「新增群組」或某群組的「編輯」。
    2. 系統彈出此視窗，並根據情境顯示「新增」或「編輯」標題。
    3. 系統會並行呼叫 API，獲取所有資源列表和所有團隊列表，以填充「擁有團隊」下拉選單和「成員管理」區塊。
    4. 在編輯模式下，表單會填入該群組的現有資料，且「成員管理」區塊會正確劃分已選和可用的資源。
- **填寫/修改資料**：
    1. 使用者填寫群組名稱、描述，並選擇擁有團隊。
    2. 使用者在「成員管理」區塊點擊箭頭按鈕，將資源在「可用」和「已選」列表間移動。
- **儲存**：
    1. 使用者點擊「儲存」按鈕。
    2. 系統根據模式呼叫 `POST /resource-groups` (新增) 或 `PUT /resource-groups/:id` (編輯) API，並傳入包含 `member_ids` 陣列的群組資料。
    3. 成功後關閉視窗並刷新列表。

**API 與資料流**
- **獲取表單所需資料 (在 Modal 內部觸發)**：
    - `GET /api/v1/resources`: 獲取所有資源，用於成員選擇。
    - `GET /api/v1/iam/teams`: 獲取所有團隊，用於「擁有團隊」下拉選單。
- **新增資源群組**：
    - `POST /api/v1/resource-groups`
    - **傳入參數**：`{ name: string, description: string, owner_team: string, member_ids: string[] }`。
- **更新資源群組**：
    - `PUT /api/v1/resource-groups/:id`
    - **傳入參數**：包含群組 ID 及更新後的所有欄位資料。

**需求與規格定義**
- **使用者需求**：
    - 我希望能有一個介面來定義一個資源群組，包含它的基本資訊和成員。
    - 我需要能從一個完整的資源列表中，方便地挑選成員加入群組。
- **功能規格**：
    - **R-GMOD-001**：系統必須提供一個彈出式視窗，用於新增和編輯資源群組。
    - **R-GMOD-002**：表單應包含群組名稱、描述和擁有團隊。
    - **R-GMOD-003**：表單必須提供一個雙列表（Picklist）介面，讓使用者可以從「可用資源」列表中將資源新增至「已選資源」列表，反之亦然。
    - **R-GMOD-004**：「擁有團隊」和「可用資源」列表的內容必須從後端 API 動態獲取。
    - **R-GMOD-005**：在編輯模式下，表單必須預載群組的現有資料，包括其成員列表。
    - **R-GMOD-006**：儲存時，系統需將 `member_ids` (已選資源的 ID 陣列) 連同其他表單資料一併提交。

---

### `resources-edit-modal.png`

**現況描述**
- 此為「新增/編輯資源」的彈出式視窗 (Modal)。截圖顯示的是「新增資源」時的狀態。
- 視窗標題會根據情境變為「新增資源」或「編輯資源」。
- **表單欄位**：
    - **資源名稱**：文字輸入框，為必填項。
    - **類型**：下拉選單。
    - **提供商**：下拉選單。
    - **區域**：下拉選單。
    - **擁有者**：下拉選單。
- **操作按鈕**：
    - **取消**：關閉視窗，不儲存任何變更。
    - **儲存**：提交表單資料。

**互動流程**
- **開啟視窗（新增模式）**：
    1. 在資源列表頁點擊「新增資源」。
    2. 系統彈出此視窗，標題為「新增資源」，所有欄位為空或預設值。
    3. 下拉選單的選項透過 API 載入。
- **開啟視窗（編輯模式）**：
    1. 在資源列表頁點擊某資源的「編輯」按鈕。
    2. 系統彈出此視窗，標題為「編輯資源」。
    3. 表單欄位會自動填入該資源的現有資料。
- **資料填寫**：
    1. 使用者在「資源名稱」欄位輸入文字。
    2. 使用者從各個下拉選單中選擇對應的選項。
- **儲存**：
    1. 使用者點擊「儲存」按鈕。
    2. 如果是新增模式，系統會呼叫 `POST /resources` API。
    3. 如果是編輯模式，系統會呼叫 `PATCH /resources/:id` API。
    4. API 呼叫成功後，視窗關閉，並刷新後方的資源列表。
    5. 若呼叫失敗，應提示錯誤訊息。
- **取消**：
    1. 使用者點擊「取消」按鈕。
    2. 視窗直接關閉，所有變更都不會被儲存。

**API 與資料流**
- **獲取表單選項**：
    - `GET /api/v1/ui/options`
    - **傳出資料**：`{ resources: { types: string[], providers: string[], ... } }`，提供所有下拉選單的選項內容。
- **新增資源**：
    - `POST /api/v1/resources`
    - **傳入參數**：`Partial<Resource>`，包含表單中所有欄位的資料。
- **更新資源**：
    - `PATCH /api/v1/resources/:id`
    - **傳入參數**：`Partial<Resource>`，包含表單中被修改的欄位資料。

**需求與規格定義**
- **使用者需求**：
    - 我希望能有一個清晰、簡單的表單來新增資源。
    - 當我需要修改一個資源的資訊時，我也希望能使用同樣的介面，並且能看到它目前的設定。
- **功能規格**：
    - **R-MOD-001**：系統必須提供一個彈出式視窗，用於新增和編輯資源。
    - **R-MOD-002**：視窗的標題必須能根據當前是「新增」還是「編輯」操作動態變化。
    - **R-MOD-003**：在「編輯」模式下，表單必須預先填入所選資源的當前資料。
    - **R-MOD-004**：「資源名稱」為必填欄位，儲存時應有基本驗證。
    - **R-MOD-005**：「類型」、「提供商」、「區域」、「擁有者」等欄位必須是下拉選單，其選項應由後端 API 提供，以保持一致性。
    - **R-MOD-006**：點擊「儲存」按鈕時，必須根據模式（新增/編輯）觸發對應的 `POST` 或 `PATCH` API 請求。

---

### `resources-groups-list.png`

**現況描述**
- 此頁面為「資源群組 (Resource Groups)」，以表格形式呈現所有定義好的資源群組。
- **工具列**：
    - 左側提供「搜索和篩選」按鈕。
    - 右側提供「欄位設定」與「新增群組」按鈕。
- **表格**：
    - 列表欄位包含：群組名稱與描述、負責團隊、成員數量、狀態總覽。
    - 「狀態總覽」欄位以不同顏色（綠、黃、紅）的計數器，直觀地展示了群組內各狀態資源的數量。
    - 每行最右側提供「編輯」和「刪除」操作按鈕。
    - 此頁面沒有提供批次選擇與操作的功能。

**互動流程**
- **載入頁面**：
    1. 頁面載入時，呼叫 API 獲取資源群組列表、所有可用欄位、及使用者自訂的欄位設定。
    2. 若 API 呼叫失敗，顯示錯誤訊息。
- **搜尋群組**：
    1. 使用者點擊「搜索和篩選」按鈕。
    2. 系統彈出搜尋視窗，使用者可輸入關鍵字。
    3. 點擊搜尋後，帶上關鍵字參數重新獲取群組列表。
- **新增群組**：
    1. 使用者點擊「新增群組」按鈕。
    2. 系統彈出「編輯資源群組 (ResourceGroupEditModal)」視窗。
    3. 使用者需填寫群組名稱、選擇負責團隊，並從資源列表中選取成員。
    4. 儲存後，系統呼叫 API 建立新群組，並刷新列表。
- **編輯群組**：
    1. 使用者點擊任一群組的「編輯」按鈕。
    2. 系統彈出「編輯資源群組」視窗，並載入該群組的現有資料。
    3. 使用者可修改群組資訊後儲存，系統呼叫 API 更新群組，並刷新列表。
- **刪除群組**：
    1. 使用者點擊任一群組的「刪除」按鈕。
    2. 系統彈出確認對話框。
    3. 確認後，系統呼叫 API 刪除該群組，並刷新列表。
- **欄位設定**：
    1. 使用者點擊「欄位設定」按鈕。
    2. 系統彈出「欄位設定」視窗。
    3. 使用者可自訂表格要顯示的欄位，儲存後前端即時更新，並將設定保存至後端。

**API 與資料流**
- **獲取資源群組列表**：
    - `GET /api/v1/resource-groups`
    - **傳入參數**：`keyword` (可選) 等篩選條件。
    - **傳出資料**：`{ items: ResourceGroup[], total: number }`。
- **新增資源群組**：
    - `POST /api/v1/resource-groups`
    - **傳入參數**：`{ name: string, description: string, owner_team: string, member_ids: string[] }`。
- **更新資源群組**：
    - `PUT /api/v1/resource-groups/:id`
    - **傳入參數**：包含群組 ID 及要更新的欄位資料。
- **刪除資源群組**：
    - `DELETE /api/v1/resource-groups/:id`
- **批次刪除** (雖然 UI 上沒有直接觸發點，但程式碼中有此邏輯)：
    - `POST /api/v1/resource-groups/batch-actions`
    - **傳入參數**：`{ action: 'delete', ids: string[] }`。
- **欄位設定相關 API**：
    - `GET /api/v1/pages/columns/resource_groups`
    - `GET /api/v1/settings/column-config/resource_groups`
    - `PUT /api/v1/settings/column-config/resource_groups`

**需求與規格定義**
- **使用者需求**：
    - 作為 SRE 或團隊負責人，我希望能將有關聯的資源組織成一個群組，方便統一監控與管理。
    - 我需要能快速查看某個群組下所有資源的整體健康狀況。
    - 我需要能方便地建立、修改和刪除這些群組。
- **功能規格**：
    - **R-GRP-001**：系統必須提供一個資源群組管理頁面，以表格形式展示所有群組。
    - **R-GRP-002**：表格中必須包含一個「狀態總覽」欄位，顯示群組內正常、警告、嚴重狀態的資源數量。
    - **R-GRP-003**：系統必須提供新增和編輯群組的功能。表單應允許使用者定義群組名稱、描述、負責團隊，並能從現有資源中挑選成員。
    - **R-GRP-004**：使用者可以刪除一個已存在的資源群組，刪除前需有確認提示。
    - **R-GRP-005**：使用者可以透過關鍵字搜尋來篩選資源群組列表。
    - **R-GRP-006**：使用者可以自訂列表顯示的欄位，此設定需與使用者帳號綁定。

---

### `resources-inventory-list.png`

**現況描述**
- 此頁面為「資源總覽 (Resource Inventory)」，以表格形式呈現所有受納管的資源。
- 主要元件包含：頂部工具列、資源列表表格、底部分頁控制器。
- **工具列**：
    - 左側提供「搜索和篩選」按鈕。
    - 右側提供「匯入」、「匯出」、「欄位設定」、「新增資源」等主要操作按鈕。
    - 當使用者在表格中勾選資源後，工具列會切換為批次操作模式，顯示已選項目數量，並提供「AI 分析」、「刪除」、「匯入」、「匯出」等批次操作按鈕。
- **表格**：
    - 採用多欄位設計，預設顯示：狀態、名稱、類型、提供者、地區、擁有者、最後上報時間等。
    - 每行最左側有複選框，供使用者選取資源進行批次操作。
    - 每行最右側提供「查看詳情」、「編輯」、「刪除」的獨立操作按鈕。
    - 「狀態」欄位使用帶有顏色和圖示的標籤，以視覺化方式呈現資源健康度（例如：綠色代表 Healthy、紅色代表 Critical）。
    - 「類型」欄位也使用不同顏色的標籤，方便快速識別資源種類。

**互動流程**
- **載入頁面**：
    1. 頁面首次載入時，會同時呼叫 API 獲取資源列表、所有可用欄位、及使用者自訂的欄位顯示設定。
    2. 顯示載入中動畫，直到資料返回。若獲取失敗，則顯示錯誤訊息與重試按鈕。
- **篩選與搜尋**：
    1. 使用者點擊「搜索和篩選」按鈕。
    2. 系統彈出「統一搜尋 (UnifiedSearchModal)」視窗。
    3. 使用者在視窗中設定篩選條件後，點擊「搜尋」。
    4. 頁面使用新的篩選條件重新呼叫 API 獲取資源列表。
- **新增資源**：
    1. 使用者點擊「新增資源」按鈕。
    2. 系統彈出「編輯資源 (ResourceEditModal)」視窗（此時為新增模式）。
    3. 使用者填寫表單後儲存，系統呼叫 API 建立新資源，成功後刷新列表。
- **編輯資源**：
    1. 使用者點擊任一資源列的「編輯」按鈕。
    2. 系統彈出「編輯資源 (ResourceEditModal)」視窗，並帶入該資源的現有資料。
    3. 使用者修改後儲存，系統呼叫 API 更新資源，成功後刷新列表。
- **刪除資源**：
    1. 使用者點擊任一資源列的「刪除」按鈕。
    2. 系統彈出確認對話框，提示此操作無法復原。
    3. 使用者確認後，系統呼叫 API 刪除該資源，成功後刷新列表。
- **批次刪除**：
    1. 使用者在表格中勾選一個或多個資源。
    2. 頂部工具列顯示批次操作按鈕。
    3. 使用者點擊「刪除」按鈕。
    4. 系統呼叫批次刪除 API，成功後刷新列表。
- **查看詳情**：
    1. 使用者點擊任一資源列的「查看詳情」按鈕。
    2. 系統從右側滑出一個抽屜 (Drawer)，顯示該資源的詳細資訊頁面 (`ResourceDetailPage`)。
- **欄位設定**：
    1. 使用者點擊「欄位設定」按鈕。
    2. 系統彈出「欄位設定 (ColumnSettingsModal)」視窗，列出所有可顯示的欄位。
    3. 使用者勾選或取消勾選欄位，點擊儲存。
    4. 系統呼叫 API 儲存使用者的偏好設定，並在前端即時更新表格顯示的欄位。
- **匯入/匯出**：
    - **匯入**：點擊「匯入」按鈕，彈出 `ImportFromCsvModal` 視窗，使用者可上傳 CSV 檔案來批次建立資源。
    - **匯出**：點擊「匯出」按鈕，系統會將當前列表（若無勾選則為全部，若有勾選則為選中部分）的資料匯出為 CSV 檔案。

**API 與資料流**
- **獲取資源列表**：
    - `GET /api/v1/resources`
    - **傳入參數**：`page`, `page_size`, 以及各種篩選條件 (filters)。
    - **傳出資料**：`{ items: Resource[], total: number }`，包含當前頁的資源物件陣列與總資源數量。
- **獲取頁面欄位設定**：
    - `GET /api/v1/pages/columns/resources`：獲取此頁面所有可用的欄位定義。
    - `GET /api/v1/settings/column-config/resources`：獲取使用者儲存的顯示欄位鍵值陣列。
- **儲存頁面欄位設定**：
    - `PUT /api/v1/settings/column-config/resources`
    - **傳入參數**：`string[]`，包含使用者選擇要顯示的欄位鍵值。
- **新增資源**：
    - `POST /api/v1/resources`
    - **傳入參數**：`Partial<Resource>`，包含新資源的資料。
- **更新資源**：
    - `PATCH /api/v1/resources/:id`
    - **傳入參數**：`Partial<Resource>`，包含要更新的資源欄位。
- **刪除資源**：
    - `DELETE /api/v1/resources/:id`
- **批次操作**：
    - `POST /api/v1/resources/batch-actions`
    - **傳入參數**：`{ action: 'delete', ids: string[] }`。
- **AI 分析**：
    - `POST /api/v1/ai/resources/analyze`
    - **傳入參數**：`{ resource_ids: string[] }`。

**需求與規格定義**
- **使用者需求**：
    - 作為系統管理員，我希望能有一個集中的地方查看所有納管的資源。
    - 我需要能快速地搜尋和篩選出我關心的特定資源。
    - 我希望能自訂列表要顯示哪些資訊，以符合我的使用習慣。
    - 我需要能方便地對資源進行新增、修改、刪除等基本管理操作。
    - 對於重複性的刪除工作，我希望能一次選取多個資源進行批次處理。
    - 我希望能將資源列表匯出，以便進行離線分析或報告。
- **功能規格**：
    - **R-INV-001**：系統必須提供一個資源總覽頁面，以分頁表格形式展示所有資源。
    - **R-INV-002**：表格必須支援後端分頁、排序與篩選功能。
    - **R-INV-003**：系統必須提供彈窗或獨立頁面，讓使用者能新增、編輯資源。表單需包含名稱、類型、擁有者等必要欄位。
    - **R-INV-004**：使用者可對單一資源執行刪除操作，執行前需有確認提示。
    - **R-INV-005**：使用者可勾選多個資源，並執行批次刪除。
    - **R-INV-006**：使用者可自訂表格要顯示的欄位，此設定需與使用者帳號綁定並永久保存。
    - **R-INV-007**：系統必須提供匯出功能，可將選定或所有資源匯出為 CSV 格式。
    - **R-INV-008**：系統必須提供匯入功能，允許使用者透過上傳 CSV 檔案批次新增資源。
    - **R-INV-009**：點擊資源的「詳情」應以不離開當前頁面的方式（如抽屜）展示詳細資訊。
    - **R-INV-010**：使用者可勾選多個資源，並觸發 AI 分析功能。

---

### `resources-topology-view.png`

**現況描述**
- 此頁面為「資源拓撲視圖 (Resource Topology View)」，使用圖形化方式展示系統中所有資源及其相互關聯。
- **主要區域**：
    - **控制列**：位於頁面頂部，提供「版型」和「類型」兩個下拉式選單，用於調整拓撲圖的佈局和篩選顯示的資源。
    - **圖例**：位於左側，標示出圖中不同資源類型對應的圖示或顏色。
    - **拓撲圖區域**：佔據頁面大部分空間，顯示節點和連線。節點顏色會根據資源的健康狀態（Healthy, Warning, Critical）而變化。
- **節點**：代表一個獨立的資源。
- **連線**：代表兩個資源之間的關聯。

**互動流程**
- **載入頁面**：
    1. 頁面載入時，呼叫 API 獲取拓撲資料（節點和連線）。
    2. 同時獲取拓撲圖的設定選項（如可用的佈局類型）。
    3. 渲染拓撲圖。若 API 呼叫失敗，顯示錯誤訊息與重試按鈕。
- **視圖操作**：
    1. 使用者可以使用滑鼠滾輪縮放視圖、按住拖曳平移視圖。
    2. 使用者可以點擊並拖曳單一節點。
- **調整版型**：
    1. 使用者從「版型」下拉選單中選擇一個新的佈局（如 `force`, `circular`）。
    2. 前端 ECharts 元件會重新計算並以動畫效果切換到新的佈局。
- **篩選類型**：
    1. 使用者從「類型」下拉選單中選擇一個資源類型。
    2. 拓撲圖會篩選並僅顯示該類型的資源節點及其相關的連線。
- **快捷操作 (右鍵選單)**：
    1. 使用者在任一資源節點上按下滑鼠右鍵。
    2. 在滑鼠指標位置彈出一個快捷選單。
    3. 選單提供「查看資源詳情」、「檢視相關事件」、「執行腳本」等選項。
    4. 點擊選項後，系統會導航到對應的功能頁面，並可能帶上該資源的 ID 作為參數。
- **查看節點資訊 (懸浮提示)**：
    1. 使用者將滑鼠懸停在任一節點上。
    2. 系統顯示一個 Tooltip，展示該資源的詳細資訊，如名稱、類型、狀態、擁有者等。

**API 與資料流**
- **獲取拓撲資料**：
    - `GET /api/v1/resources/topology`
    - **傳出資料**：`{ nodes: Resource[], links: { source: string, target: string }[] }`，包含所有資源節點和關聯連結。
- **獲取設定選項**：
    - `GET /api/v1/ui/options`
    - **傳出資料**：在 `topology.layouts` 欄位中包含可用的佈局選項陣列。

**需求與規格定義**
- **使用者需求**：
    - 我希望能有一個全局視圖，直觀地了解我所有資源以及它們之間的依賴關係。
    - 當系統出現問題時，我希望能快速從拓撲圖中定位到故障節點及其影響範圍。
    - 我希望能直接在拓撲圖上進行一些快捷操作，例如直接跳轉到某個資源的詳情頁。
- **功能規格**：
    - **R-TOPO-001**：系統必須提供一個拓撲視圖頁面，以網路圖的形式展示所有資源（節點）及其關聯（連線）。
    - **R-TOPO-002**：節點的顏色必須能反映其對應資源的即時健康狀態。
    - **R-TOPO-003**：使用者必須能夠透過下拉選單切換不同的圖表佈局演算法（如力導向、環形）。
    - **R-TOPO-004**：使用者必須能夠根據資源類型篩選圖中顯示的節點。
    - **R-TOPO-005**：在節點上按下滑鼠右鍵，必須彈出一個包含快捷操作的上下文選單。
    - **R-TOPO-006**：快捷操作至少應包含導向至「資源詳情」頁面的連結。
    - **R-TOPO-007**：滑鼠懸停在節點上時，必須顯示包含該資源關鍵資訊的提示框。