# SRE 平台功能規格 v2.20

本章節旨在提供一個全面的功能基準，按照平台導航結構，詳細描述每一個頁面的核心定位與功能。

### 1. SRE 戰情室 (`SREWarRoomPage`)

-   **定位**: 平台的核心儀表板，提供系統健康度的「駕駛艙視圖」。
-   **核心功能**:
    1.  **AI 每日簡報**: 由 AI 自動生成的系統狀態摘要，包含「穩定性總結」、「關鍵異常」和「建議操作」三個部分，並提供可操作的連結。
    2.  **服務健康度熱力圖**: 視覺化展示各個服務在不同環境的健康狀態。
    3.  **資源群組狀態**: 條列展示各個資源群組的健康、警告、嚴重狀態分佈。
    4.  **互動式圖表**: 所有圖表均支援點擊鑽取，可跳轉至相關的資源或事件頁面。

### 2. 事件 (Incidents)

#### 10.2.1 事件列表 (`IncidentListPage`)

-   **定位**: SRE 的「事故作戰室」，是一個高效的告警處理工作台。
-   **核心功能**:
    -   **整合工具列**: 左側提供「搜索和篩選」按鈕開啟統一搜尋 Modal，右側則包含「匯入」、「匯出」、「欄位設定」等管理操作，並可清除勾選項目。
    -   **列表檢視與欄位設定**: 表格會根據後端定義載入欄位清單，透過「欄位設定」Modal 儲存個人化欄位組合；勾選資料列後會顯示批次工具列。
    -   **批次操作**: 已勾選事件可一次觸發「AI 分析」、「認領」、「解決」，AI 模式會開啟 `IncidentAnalysisModal` 並回傳多事件分析報告。
    -   **快速靜音**: 單筆資料列提供「靜音」按鈕，開啟 `QuickSilenceModal` 設定暫停時間並自動建立靜音規則。
    -   **資料匯入/匯出**: 透過 `ImportFromCsvModal` 匯入事件 CSV，匯出則依勾選狀態輸出當前或全列表欄位。
    -   **抽屜詳情**: 點擊任一列會以 Drawer 方式載入 `IncidentDetailPage`，保留列表狀態並支援在抽屜內完成進一步操作後同步刷新。

#### 10.2.2 事故詳情 (`IncidentDetailPage`)

-   **定位**: 事件調查與協作中心，集中展示事故上下文、AI 分析與操作歷程。
-   **核心功能**:
    -   **重點資訊區**: 頂端顯示狀態、嚴重性、優先級、指派對象等標籤。未認領時提供「認領事件」按鈕，已指派則可開啟 `AssignIncidentModal` 轉派。
    -   **詳細資訊卡片**: 左側卡片列出資源、服務影響、觸發規則與時間，資源/規則皆連結回對應頁面。
    -   **AI 分析面板**: 右側顯示 `AIAnalysisDisplay`；若尚無分析報告提供「生成 AI 分析」按鈕，已有結果則支援「重新分析」並顯示載入中狀態。
    -   **時間軸備註**: 依序列出歷史事件，包含系統操作、AI 分析與人工備註。使用者可在底部新增備註，自己的備註可觸發刪除確認 Modal 後移除。
    -   **同步刷新**: 認領、轉派、重新分析、備註新增或刪除皆會回呼列表頁更新，確保抽屜與主表保持一致。

#### 10.2.3 告警規則 (`AlertRulePage`)

-   **定位**: 集中管理所有告警規則的入口，定義「什麼是問題」。
-   **核心功能**:
    -   **列表檢視**: 以表格形式展示所有告警規則，包含名稱、監控目標、觸發條件摘要、嚴重性、是否啟用自動化等關鍵資訊。
    -   **生命週期管理**: 支援規則的「新增」、「編輯」、「複製」與「刪除」。
    -   **快速啟用/停用**: 提供切換開關，可快速啟用或停用單一規則。
    -   **引導式建立/編輯 (Wizard)**:
        -   **目的**: 將複雜的規則設定拆解為清晰、專注的步驟，降低使用者的認知負擔。
        -   **編輯模式**: 在編輯現有規則時，精靈會直接從「步驟一：設定基本資訊」開始。
        -   **建立模式**:
            -   **步驟 0 - 選擇監控目標**:
                -   **介面**: 提供一個整合式的「範本市集」介面，左側為可篩選的「資源類型」，右側展示對應的告警範本卡片。
                -   **互動**: 使用者選擇一個範本（如「主機 CPU 使用率過高」）後，後續步驟的欄位將會被自動填入建議值，大幅簡化設定流程。
            -   **步驟 1 - 設定基本資訊**:
                -   定義規則的`名稱`、`描述`，並設定監控的`資源範圍`。
                -   監控範圍支援從「所有資源」、「特定資源群組」到「具體資源」的多層次選擇，並可附加標籤進行進一步篩選。
            -   **步驟 2 - 定義觸發條件**:
                -   設定告警的具體邏輯。支援 `(A AND B) OR C` 的複雜條件。
                -   每個 `OR` 條件群組可以獨立設定其觸發的`告警等級` (嚴重/警告/資訊)。
                -   每個 `AND` 條件包含`指標`、`運算子`、`閾值`和`持續時間`四個元素。
            -   **步驟 3 - 事件定義與通知**:
                -   客製化觸發事件時的`標題`和`內容`範本，支援使用 `{{變數}}`。
                -   為此規則及其產生的事件附加`標籤`，用於後續的通知路由和分類。
            -   **步驟 4 - 設定自動化響應 (可選)**:
                -   提供一個開關以`啟用自動化響應`。
                -   啟用後，使用者可以從下拉選單中選擇一個已存在的`自動化腳本`。
                -   若所選腳本包含參數，介面將動態呈現對應的輸入欄位，讓使用者可以為此規則配置固定的`參數值`。

#### 10.2.4 靜音規則 (`SilenceRulePage`)

-   **定位**: 管理用於在特定時間（如維護窗口）暫停告警通知的規則。
-   **核心功能**:
    -   **列表檢視**: 展示所有靜音規則，包含名稱、類型（單次/週期性）、靜音條件、排程與創建者。
    -   **生命週期管理**: 支援靜音規則的「新增」、「編輯」與「刪除」。
    -   **引導式建立/編輯**: 透過精靈引導使用者設定靜音規則的基本資訊、排程（支援單次時間區間或週期性的 CRON 表達式）以及要靜音的告警範圍（基於標籤匹配）。

### 3. 資源 (Resources)

-   **定位**: 平台的「資產與健康中心」，提供一個可探索的完整資產清單與資料來源治理能力。
-   **核心功能**:
    -   **頁籤式工作台**: 以 `資源列表`、`資源群組`、`拓撲視圖`、`Datasource 管理`、`自動掃描 (Discovery)` 等視圖組成，讓操作人員能在單一入口完成資產建模。
    -   **資源列表 (`ResourceListPage`)**:
        -   **統一搜尋 Modal**: 工具列左側提供「搜索和篩選」按鈕，開啟 `UnifiedSearchModal` 進行進階條件設定；提交後會更新列表並重置頁碼。
        -   **欄位設定與快取**: 透過 `ColumnSettingsModal` 管控欄位顯示順序，設定結果寫回 `/settings/column-config/{pageKey}` 並套用在 `TableContainer`。
        -   **匯入/匯出**: 工具列右側提供 CSV 匯入 (`ImportFromCsvModal`) 與匯出按鈕。匯出依勾選列輸出，未勾選時以整頁資料匯出；若無資料會跳出「沒有可匯出的資料」。
        -   **批次操作**: 多選列後會顯示批次工具列，可觸發 `AI 分析` Modal（打開 `ResourceAnalysisModal` 檢視 AI 建議）或批次刪除，刪除成功後清空選擇並重新載入。
        -   **單筆 CRUD 與刪除確認**: 每列提供查看詳情、編輯、刪除快捷鈕；刪除時彈出 `確認刪除` Modal 需再次確認，確定後以 API 刪除並提示成功/失敗。
        -   **抽屜式資源詳情**: 點擊「查看詳情」或透過 `/resources/list/:id` 深連結會開啟 `Drawer`，內嵌 `ResourceDetailPage` 顯示資源概覽與指派資訊，抽屜關閉時回到 `/resources/list`。
    -   **資源群組**: 允許使用者基於標籤查詢，建立動態的資源集合，並指派負責團隊。
    -   **Datasource 管理**: 集中管理所有監控資料來源，支援建立、測試與禁用 Datasource，並提供健康檢查結果與最近同步狀態。
    -   **拓撲視圖**: 視覺化展示服務與資源之間的依賴關係，節點與邊支援標籤篩選、顏色標示與快速跳轉資源詳情，並支援右鍵上下文選單進行快捷操作。
    -   **Edge Gateway 模式**: 用於邊緣場域的裝置監控，內建 Gateway 管理、佈署狀態監控，並支援 SNMP、Modbus、IPMI、MQTT 等協定資料的收集與轉換。

#### 自動掃描 (Discovery)

-   **任務列表**: `AutoDiscoveryPage` 以表格列出所有掃描任務，展示名稱、類型、排程、最後執行時間與狀態指示（成功/失敗/部分失敗/執行中），狀態欄位透過不同圖示與顏色標示目前進度。
-   **新增/編輯 Modal**: 工具列 `新增掃描` 會開啟 `AutoDiscoveryEditModal`，支援建立或調整掃描類型、排程與連線資訊，儲存後會重新整理列表並顯示成功/失敗提示。
-   **手動執行**: 每列含手動執行按鈕，觸發 `/resources/discovery-jobs/{id}/run` API 後顯示成功提示並刷新列表以反映執行中狀態。
-   **刪除確認**: 刪除按鈕會開啟 `確認刪除掃描任務` Modal，需再次確認後才會呼叫刪除 API，完成後關閉 Modal 並更新列表。
-   **結果 Drawer**: `查看結果` 會開啟 `DiscoveryJobResultDrawer` 抽屜呈現最近一次掃描摘要與資源差異；抽屜可由右側關閉。

### 4. 儀表板 (Dashboard)

-   **定位**: 統一的系統監控與業務洞察儀表板入口。
-   **核心功能**:
    -   **混合儀表板支援**: 支援管理「內建儀表板」和連結外部「Grafana 儀表板」。
    -   **儀表板 (`DashboardListPage`)**:
        -   **統一搜尋 Modal**: 工具列左側的「搜索和篩選」按鈕開啟 `UnifiedSearchModal`，可輸入關鍵字、類型、擁有者等條件；提交後會套用至 `/dashboards` API 參數並重設頁碼。
        -   **欄位設定與快取**: 「欄位設定」按鈕開啟 `ColumnSettingsModal`，勾選後儲存到 `/settings/column-config/{pageKey}`，同時更新 `TableContainer` 的顯示欄位；首次載入若無個人化設定則以 `/pages/columns/{pageKey}` 提供的預設欄位渲染。
        -   **匯入/匯出**: 工具列提供 `ImportFromCsvModal` 匯入儀表板定義；匯出則依勾選狀態使用 `exportToCsv` 下載，目前勾選輸出選取儀表板，未勾選則匯出當前頁資料，若列表為空會提示「沒有可匯出的資料」。
        -   **批次刪除**: 表格每列含勾選框，當存在勾選時工具列切換為批次模式並顯示刪除按鈕；確認後呼叫 `/dashboards/batch-actions` 執行批次刪除成功即清空選取並刷新列表。
        -   **個人首頁與 CRUD**: 操作欄位提供「設為首頁」星號按鈕，會將儀表板 ID 寫入 `localStorage` 並於名稱旁顯示徽章；另有編輯、刪除按鈕。新增儀表板透過 `AddDashboardModal`，外部 (Grafana) 儀表板使用 `DashboardEditModal` 編輯；刪除時開啟確認 Modal，若刪除的是個人首頁則自動回退到預設戰情室。
        -   **分頁與狀態提示**: 提供 `Pagination` 切換頁碼/每頁筆數，列表載入時顯示骨架 (`TableLoader`)、錯誤時顯示 `TableError` 並支援重試，空列表仍保留新增入口。
    -   **範本市集**: 提供一組預設的儀表板範本，使用者可以此為基礎快速建立新儀表板。
    -   **拖曳式編輯器 (`DashboardEditorPage`)**:
        -   **範本初始化與命名**: 透過列表或範本市集進入編輯頁時可攜帶 `DashboardTemplate`，自動帶入名稱與預設描述；若未指定則套用 `DEFAULT_NAME` 並允許使用者修改。
        -   **網格佈局操作**: 編輯器以 12 欄網格 (`COLS=12`) 與固定列高渲染，每個 widget 皆可拖曳調整位置或從右下角縮放尺寸，互動期間顯示半透明預覽並檢查碰撞，重疊時以紅色提示並回復原位。
        -   **撤銷/儲存流程**: 每次拖曳或縮放前推入歷史堆疊，提供「撤銷」按鈕回復最多 10 步；儲存時驗證名稱必填，再依建立或編輯模式呼叫 `POST/PATCH /dashboards`，期間顯示儲存中狀態並於成功後回到列表。
        -   **新增/移除 Widget**: 「新增小工具」按鈕開啟 Modal 顯示可用 Widget 清單，選取後自動尋找空位放入佈局；每個 Widget 右上角提供刪除鈕移除，並同步更新佈局陣列。
        -   **即時預覽與資料來源**: 佈局中的卡片以 `ContextualKPICard` 呈現，載入 `/kpi-data` 的指標值與說明，支援顏色標示趨勢文字；同時保留空狀態、錯誤提示與載入中畫面，確保編輯期間的即時回饋。

### 5. 事件與通知 (Incidents & Notifications)

-   **定位**: 從事件偵測到通知路由的整合作戰中樞。
-   **核心功能**:
    -   **事件列表**: 與 `IncidentListPage` 對應的清單工作台，支援批次操作、AI 分析與快速篩選。
    -   **事件詳情頁**: 以 Drawer 呈現的深入調查介面，內建血緣視覺化圖 (rule → metric → resource → action)，協助快速定位根因與已採取的動作。
    -   **通知策略編輯器**: 提供拖曳式 AND/OR 條件設定器，可視化顯示多層級條件組合，並即時預覽告警路由結果。
    -   **通知管道與歷史**: 管理所有通知通道並提供發送紀錄查詢與重送能力。

### 6. 自動化 (Automation)

-   **定位**: 提升維運效率、降低重複性工作的核心。
-   **核心功能**:
    -   **腳本庫**: 統一管理 Shell、Python、Ansible Playbook 等各類型的自動化腳本。支援「AI 輔助生成腳本」功能並提供版本控制與參數模板。
    -   **排程管理**: 以時間軸或列表呈現所有排程作業，支援 CRON 表達式設定、衝突提醒與排程啟停。
    -   **觸發器與整合**: 管理排程、Webhook、事件等觸發來源，並預留 `n8n Workflow` 整合入口供高階自動化流程編排。
    -   **執行日誌**: 提供所有腳本執行的詳細日誌與結果，用於審計與除錯，支援依時間、腳本、觸發來源篩選。
    
### 7. 智慧排查 (Intelligent Investigation)

-   **定位**: 平台的智慧大腦，提供從宏觀到微觀的深度洞察與趨勢預測。
-   **核心功能**:
    -   **總覽 (`AnalysisOverviewPage`)**: 整合式的智慧化分析中樞，匯聚 AI 洞察與跨域趨勢。
    -   **Logs Explorer (`LogExplorerPage`)**: 提供強大的日誌搜尋、篩選與即時串流功能，並支援「AI 日誌總結」。
    -   **Traces Explorer**: 支援分散式追蹤資料查詢，提供呼叫鏈視覺化、延遲熱點分析與相依服務關聯圖。
    -   **AI Insights**: 透過 RCA 模型與建議引擎，提供事件根因推論、修復建議與潛在風險預警。
    -   **容量規劃 (`CapacityPlanningPage`)**: 基於歷史數據和 AI 預測模型，提供對未來資源需求的預測和優化建議。

### 8. 設定 (Settings)

-   **定位**: 管理平台的全域性配置與治理控制。
-   **核心功能分區**:
    -   **身份與存取管理 (IAM)**:
        -   以 Keycloak 為核心，管理使用者、角色、團隊與審計紀錄，支援批次操作與權限範本。
        -   提供審計日誌視圖，記錄所有關鍵操作以符合治理需求。
    -   **多租戶管理**:
        -   支援 Realm/Role 隔離策略，提供租戶清單、配額與跨租戶資源治理設定。
    -   **標籤管理 (Tag Management)**:
        -   從設定模組獨立出專屬入口，提供標籤鍵值的建立、審核流程與使用頻率分析。
    -   **Grafana 設定**:
        -   提供 Endpoint 與 Token 驗證工具，支援即時測試並顯示最近同步狀態。
    -   **平台設定**:
        -   包含郵件設定、身份驗證與版面管理等全域配置。
    -   **License**:
        -   預留頁籤於展示版中隱藏，商業版可啟用以管理授權資訊與到期提醒。

### 9. 個人設定 (Profile)

-   **定位**: 使用者個人化的配置中心。
-   **核心功能**:
    -   **個人資訊**: 檢視與個人帳號相關的基本資訊。
    -   **安全設定**: 變更密碼、檢視登入歷史。
    -   **偏好設定**: 客製化個人化的平台體驗，如介面主題、預設首頁、語言和時區。